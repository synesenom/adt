(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";var r=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function i(i,n,a,l){var o;var s="du-widget-"+n+"-"+i;try{if(l){o=t.select(l).append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{o=t.select("body").append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var d={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,r,i,n){d[e]=r;t[e]=function(r){if(n){n(r)}else{d[e]=r}return t};if(typeof i==="string"&&d._categories.hasOwnProperty(i)){d._categories[i].push(e)}}};d.add(this,"relative",false);d.add(this,"resize",1);d.add(this,"x",0,"dim",function(t,e){d.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)d.xDim=e});d.add(this,"y",0,"dim",function(t,e){d.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)d.yDim=e});d.add(this,"width",200,"dim");d.add(this,"height",150,"dim");d.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){d.margins[e]=t})}else{e.forOwn(t,function(e,r){d.margins[r]=t[r]})}});d.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){d.borders[e]=t})}e.forOwn(t,function(e,r){d.borders[r]=t[r]})});d.add(this,"fontColor","black");d.add(this,"fontSize",10);d.add(this,"fontWeight","normal");d.add(this,"label",null);d.add(this,"xLabel",null);d.add(this,"yLabel",null);d.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});d.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});d.add(this,"xTickAngle",null);d.add(this,"yMin",0);d.add(this,"mouseover",null);d.add(this,"mouseleave",null);d.add(this,"click",null);d.add(this,"colors",null);d.add(this,"tooltip",false);var f=function(){function i(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function n(r,i){if(r===null||r===undefined||r.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var n=[t.min(r,function(t){return t.x}),t.max(r,function(t){return t.x})];var a={};var l=[];r.forEach(function(t){if(!a.hasOwnProperty(t.x)){a[t.x]=1;l.push(t.x)}});var o=[];if(typeof r[0].y==="number"){o=[t.min(r,function(t){return t.y}),t.max(r,function(t){return t.y})]}else{var s=[],d=[];e.forOwn(r[0].y,function(e,i){s.push(t.min(r,function(t){return t.y[i]}));d.push(t.max(r,function(t){return t.y[i]}))});o=[t.min(s),t.max(d)]}var f={x:[null,null],y:[null,null]};if(i){e.forOwn(f,function(t,e){[0,1].forEach(function(r){t[r]=i.hasOwnProperty(e)&&i[e][r]!==null?i[e][r]:t[r]})})}return{x:{min:f.x[0]!==null?f.x[0]:n[0],max:f.x[1]!==null?f.x[1]:n[1],domain:l.filter(function(t){return(!f.x[0]||t>=f.x[0])&&(!f.x[1]||t<=f.x[1])})},y:{min:f.y[0]!==null?f.y[0]:o[0],max:f.y[1]!==null?f.y[1]:o[1],domain:[]}}}function a(e,r,i,n){function a(e,r){var i=null;if(typeof e){switch(e){case"number":default:i=t.scaleLinear().domain([r.min,r.max]);break;case"time":i=t.scaleTime().domain([r.min,r.max]);break;case"string":i=t.scaleBand().domain(r.domain).padding(.1);break}}return i}return{x:a(n&&n.x?n.x.type:"number",e.x).range(n&&n.x&&n.x.reverse?[r,0]:[0,r]),y:a(n&&n.y?n.y.type:"number",e.y).range(n&&n.y&&n.y.reverse?[0,i]:[i,0])}}function l(e,r,n,a,l){if(r!==null){if(typeof a==="string"){r.g.selectAll(n).transition();r.g.selectAll(n).transition().duration(l?l:0).style("opacity",function(){return t.select(this).classed(i(a))?1:.1})}else{r.g.selectAll(n).transition();r.g.selectAll(n).transition().duration(l?l:0).style("opacity",1)}}return e}function o(e){if(e===null||e===undefined){return{}}if(e.length>0){if(d.colors===null||d.colors===undefined){return e.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,i){t[e]=r[i%18];return t},{})}if(typeof d.colors==="string"){var i=t.scaleLinear().domain([0,e.length]).range([d.colors,"#fff"]).interpolate(t.interpolateRgb);return e.reduce(function(t,e,r){t[e]=i(r);return t},{})}return d.colors}}return{encode:i,boundary:n,scale:a,highlight:l,colors:o}}();function u(e){var r="du-widgets-plot-tooltip";var i=t.event.pageX;var n=t.event.pageY;var a=o.node().getBoundingClientRect();if(typeof e!=="string"||e===""||i<a.left+d.margins.left||i>a.right-d.margins.right||n<a.top+d.margins.top||n>a.bottom-d.margins.bottom){t.select("#"+r).style("opacity",0).html("");return}var l=t.select("#"+r);if(t.select("#"+r).empty()){var s=t.color(d.fontColor);s.opacity=.3;l=t.select("body").append("div").attr("id",r).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-radius","2px").style("border","solid 1px "+s).style("padding","5px").style("font-family","Courier").style("font-size","0.7em").style("color",d.fontColor).style("pointer-events","none").style("left",(a.left+a.right)/2+"px").style("top",(a.top+a.bottom)/2+"px")}l.html(e);var f=l.node().getBoundingClientRect();var u=f.width;var y=f.height;var g=i+20;var c=n+20;if(g<a.left+d.margins.left+10){g+=d.margins.left+10}else if(g+u>a.right-d.margins.right){g-=d.margins.right+u-10}if(c<a.top+d.margins.top+10){c+=d.margins.top+10}else if(c+y>a.bottom-d.margins.bottom){c-=d.margins.bottom+y-10}l.style("opacity",1).transition();l.transition().duration(200).ease(t.easeLinear).style("left",g+"px").style("top",c+"px")}this.id=function(){return s};var y={build:null,update:null,style:null};this.render=function(r){var i=typeof r==="number"?r:500;if(typeof d.resize==="number"){d._categories.dim.forEach(function(t){if(t==="resize"||!d.hasOwnProperty(t))return;switch(typeof d[t]){case"number":if((t!=="x"||d.xDim!=="%")&&(t!=="y"||d.yDim!=="%"))d[t]*=d.resize;break;case"object":e.forOwn(d[t],function(e,r){if(typeof e==="number"){d[t][r]*=d.resize}});break;default:break}});d.resize=null}if(!this._isBuilt){y.build&&y.build(i);this._isBuilt=true}y.update&&y.update(i);if(d.relative){o.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{o.style("position","absolute").style(d.x>=0?"left":"right",Math.abs(d.x)+d.xDim).style(d.y>=0?"top":"bottom",Math.abs(d.y)+d.yDim)}o.style("width",d.width+"px").style("height",d.height+"px");if(f.tooltip!==undefined){o.style("pointer-events",d.tooltip?"all":null).on("mouseenter",function(){var e=t.mouse(o.node());d.tooltip&&u(f.tooltip([e[0]-d.margins.left,e[1]-d.margins.top]))}).on("mousemove",function(){var e=t.mouse(o.node());d.tooltip&&u(f.tooltip([e[0]-d.margins.left,e[1]-d.margins.top]))}).on("mouseleave",function(){d.tooltip&&u()})}o.selectAll(".axis path").style("fill","none").style("stroke",d.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > line").style("stroke",d.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",d.fontSize+"px").style("fill",d.fontColor);o.style("font-family","inherit");o.selectAll("g").attr("font-family","inherit");y.style&&y.style();o.style("display","block");return this};this.describe=function(e){var r=null;o.on("contextmenu",function(){t.event.preventDefault();if(r===null){r=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(r!==null){r.remove();r=null}});return this};this.placeholder=function(e){var r=300;var n="du-widget-placeholder-"+i;if(e){o.transition().duration(r).style("opacity",0);if(t.select("#"+n).empty()){var a=l?l:"body";t.select(a).append("div").attr("id",n).style("position","absolute").style("width",d.width+"px").style("height",d.height+"px").style("line-height",d.height+"px").style(d.x>=0?"left":"right",Math.abs(d.x)+d.xDim).style(d.y>=0?"top":"bottom",Math.abs(d.y)+d.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",d.fontWeight).style("font-size",d.fontSize).style("color",d.fontColor).style("opacity",0).html(e).transition().duration(r).style("opacity",1)}}else{o.transition().duration();o.transition().duration(r).style("opacity",1);var s=t.select("#"+n);if(!s.empty()){s.remove()}}return this};this.remove=function(){o.remove()};return{widget:o,attr:d,utils:f,render:y}}return i});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.TrackPad=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,i){var n=e.call(this,r,"slider","svg",i);n.attr.add(this,"xRange",[0,1]);n.attr.add(this,"yRange",[0,1]);n.attr.add(this,"callback",null);n.attr.add(this,"guide",false);var a=null;var l=null;n.render.build=function(){if(a!==null)return;a={};l={x:t.scaleLinear().domain(n.attr.xRange).range([0,n.attr.width-n.attr.margins.left-n.attr.margins.right]).clamp(true),y:t.scaleLinear().domain(n.attr.yRange).range([0,n.attr.height-n.attr.margins.top-n.attr.margins.bottom]).clamp(true)};a.g=n.widget.append("g").attr("transform","translate("+n.attr.margins.left+",20)");a.track=a.g.append("rect").attr("rx","3").attr("ry","3").attr("x",l.x.range()[0]).attr("y",l.y.range()[0]).attr("width",n.attr.width-n.attr.margins.left-n.attr.margins.right+"px").attr("height",n.attr.height-n.attr.margins.top-n.attr.margins.bottom+"px");a.inset=a.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("fill","white").style("opacity",.9).attr("rx","2.5").attr("ry","2.5").attr("x",l.x.range()[0]+.5).attr("y",l.y.range()[0]+.5).attr("width",n.attr.width-n.attr.margins.left-n.attr.margins.right-1+"px").attr("height",n.attr.height-n.attr.margins.top-n.attr.margins.bottom-1+"px");if(n.attr.guide){a.guide={h:a.g.append("line").attr("x1",l.x.range()[0]).attr("y1",l.y.range()[0]).attr("x2",l.x.range()[1]).attr("y2",l.y.range()[0]).attr("stroke-dasharray","3, 6").style("stroke",n.attr.fontColor).style("stroke-width","1px"),v:a.g.append("line").attr("x1",l.x.range()[0]).attr("y1",l.y.range()[0]).attr("x2",l.x.range()[0]).attr("y2",l.y.range()[1]).attr("stroke-dasharray","3, 6").style("stroke-width","1px")}}a.overlay=a.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","all").style("cursor","pointer").style("fill","transparent").call(t.drag().on("start drag",function(){var e=l.x.invert(t.event.x),r=l.y.invert(t.event.y);a.handle.attr("cx",l.x(e)).attr("cy",l.y(r));if(a.guide){a.guide.h.attr("x1",l.x.range()[0]).attr("y1",l.y(r)).attr("x2",l.x.range()[1]).attr("y2",l.y(r));a.guide.v.attr("x1",l.x(e)).attr("y1",l.y.range()[0]).attr("x2",l.x(e)).attr("y2",l.y.range()[1])}n.attr.callback&&n.attr.callback(e,r)}));a.axis={x:a.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none"),y:a.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none")};a.handle=a.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",7)};n.render.style=function(){n.widget.style("width",n.attr.width+"px");n.widget.style("height",n.attr.height+"px");l.x.range([0,n.attr.width-n.attr.margins.left-n.attr.margins.right]);l.y.range([0,n.attr.height-n.attr.margins.top-n.attr.margins.bottom]);a.track.style("fill",n.attr.fontColor).attr("x",l.x.range()[0]).attr("y",l.y.range()[0]).attr("width",n.attr.width-n.attr.margins.left-n.attr.margins.right+"px").attr("height",n.attr.height-n.attr.margins.top-n.attr.margins.bottom+"px");a.inset.attr("x",l.x.range()[0]+.5).attr("y",l.y.range()[0]+.5).attr("width",n.attr.width-n.attr.margins.left-n.attr.margins.right-1+"px").attr("height",n.attr.height-n.attr.margins.top-n.attr.margins.bottom-1+"px");if(n.attr.guide){a.guide.h.style("stroke",n.attr.fontColor);a.guide.v.style("stroke",n.attr.fontColor)}a.overlay.attr("x",l.x.range()[0]-n.attr.margins.left+10).attr("y",l.y.range()[0]-n.attr.margins.top+10).attr("width",n.attr.width-20+"px").attr("height",n.attr.height-20+"px");a.axis.x.attr("transform","translate(-1,"+(n.attr.height-n.attr.margins.bottom-30)+")").call(t.axisBottom().ticks(5).scale(l.x));a.axis.y.call(t.axisLeft().ticks(5).scale(l.y));a.g.selectAll("path").style("fill","none").style("stroke","none");a.g.selectAll(".tick > line").style("fill","none").style("stroke","none");a.g.selectAll("text").attr("font-size",n.attr.fontSize+"px").attr("fill",n.attr.fontColor);a.handle.style("stroke",n.attr.fontColor)}}r.prototype=Object.create(e.prototype);return r});