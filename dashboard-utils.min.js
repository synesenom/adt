(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";var i=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function n(n,r,l,o){var a;var s="du-widget-"+r+"-"+n;try{if(o){a=t.select(o).append(l).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{a=t.select("body").append(l).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var u={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,i,n,r){u[e]=i;t[e]=function(i){if(r){r(i)}else{u[e]=i}return t};if(typeof n==="string"&&u._categories.hasOwnProperty(n)){u._categories[n].push(e)}}};u.add(this,"relative",false);u.add(this,"x",0,"dim",function(t,e){u.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.xDim=e});u.add(this,"y",0,"dim",function(t,e){u.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.yDim=e});u.add(this,"width",200,"dim");u.add(this,"height",150,"dim");u.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){u.margins[e]=t})}else{e.forOwn(t,function(e,i){u.margins[i]=t[i]})}});u.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){u.borders[e]=t})}e.forOwn(t,function(e,i){u.borders[i]=t[i]})});u.add(this,"fontColor","black");u.add(this,"fontSize",10,"dim");u.add(this,"fontWeight","normal");u.add(this,"label",null);u.add(this,"xLabel",null);u.add(this,"yLabel",null);u.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"xTickAngle",null);u.add(this,"yMin",0);u.add(this,"mouseover",null);u.add(this,"mouseleave",null);u.add(this,"click",null);u.add(this,"colors",null);u.add(this,"tooltip",false);var d=function(){function n(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function r(i,n){if(i===null||i===undefined||i.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var r=[t.min(i,function(t){return t.x}),t.max(i,function(t){return t.x})];var l={};var o=[];i.forEach(function(t){if(!l.hasOwnProperty(t.x)){l[t.x]=1;o.push(t.x)}});var a=[];if(typeof i[0].y==="number"){a=[t.min(i,function(t){return t.y}),t.max(i,function(t){return t.y})]}else{var s=[],u=[];e.forOwn(i[0].y,function(e,n){s.push(t.min(i,function(t){return t.y[n]}));u.push(t.max(i,function(t){return t.y[n]}))});a=[t.min(s),t.max(u)]}var d={x:[null,null],y:[null,null]};if(n){e.forOwn(d,function(t,e){[0,1].forEach(function(i){t[i]=n.hasOwnProperty(e)&&n[e][i]!==null?n[e][i]:t[i]})})}return{x:{min:d.x[0]!==null?d.x[0]:r[0],max:d.x[1]!==null?d.x[1]:r[1],domain:o.filter(function(t){return(!d.x[0]||t>=d.x[0])&&(!d.x[1]||t<=d.x[1])})},y:{min:d.y[0]!==null?d.y[0]:a[0],max:d.y[1]!==null?d.y[1]:a[1],domain:[]}}}function l(e,i,n,r){function l(e,i){var n=null;if(typeof e){switch(e){case"number":default:n=t.scaleLinear().domain([i.min,i.max]);break;case"time":n=t.scaleTime().domain([i.min,i.max]);break;case"string":n=t.scaleBand().domain(i.domain).padding(.1);break}}return n}return{x:l(r&&r.x?r.x.type:"number",e.x).range(r&&r.x&&r.x.reverse?[i,0]:[0,i]),y:l(r&&r.y?r.y.type:"number",e.y).range(r&&r.y&&r.y.reverse?[0,n]:[n,0])}}function o(e,i,r,l,o){if(i!==null){if(typeof l==="string"){i.g.selectAll(r).transition();i.g.selectAll(r).transition().duration(o?o:0).style("opacity",function(){return t.select(this).classed(n(l))?1:.1})}else{i.g.selectAll(r).transition();i.g.selectAll(r).transition().duration(o?o:0).style("opacity",1)}}return e}function a(e){if(e===null||e===undefined){return{}}if(e.length>0){if(u.colors===null||u.colors===undefined){return e.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,n){t[e]=i[n%18];return t},{})}if(typeof u.colors==="string"){var n=t.scaleLinear().domain([0,e.length]).range([u.colors,"#fff"]).interpolate(t.interpolateRgb);return e.reduce(function(t,e,i){t[e]=n(i);return t},{})}return u.colors}}return{encode:n,boundary:r,scale:l,highlight:o,colors:a}}();function c(){var e="du-widgets-plot-tooltip";var i=t.mouse(a.node());var n=t.event.pageX;var r=t.event.pageY;var l=a.node().getBoundingClientRect();if(n<l.left+u.margins.left||n>l.right-u.margins.right||r<l.top+u.margins.top||r>l.bottom-u.margins.bottom){t.select("#"+e).style("opacity",0).html("");d.tooltip();return}var o=t.select("#"+e);if(t.select("#"+e).empty()){var s=t.color(u.fontColor);s.opacity=.3;o=t.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("border","solid 1px "+s).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",u.fontColor).style("pointer-events","none").style("left",(l.left+l.right)/2+"px").style("top",(l.top+l.bottom)/2+"px")}var c=d.tooltip([i[0]-u.margins.left,i[1]-u.margins.top]);if(!c){t.select("#"+e).style("opacity",0).html("");d.tooltip();return}o.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").style("border-bottom","solid 1px "+u.fontColor).text(c.title);c.plots.sort(function(t,e){return t.id.localeCompare(e.id)}).forEach(function(t){var e=o.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");e.append("div").style("position","relative").style("width","10px").style("height","10px").style("float","left").style("background-color",t.color);e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)});var f=o.node().getBoundingClientRect();var p=f.width;var h=f.height;var y=n+20;var m=r+20;if(y<l.left+u.margins.left+10){y+=u.margins.left+10}else if(y+p>l.right-u.margins.right){y-=p+30}if(m<l.top+u.margins.top+10){m+=u.margins.top+10}else if(m+h>l.bottom-u.margins.bottom){m-=h+30}o.style("opacity",1).transition();o.transition().duration(200).ease(t.easeLinear).style("left",y+"px").style("top",m+"px")}this.id=function(){return s};this.describe=function(e){var i=null;a.on("contextmenu",function(){t.event.preventDefault();if(i===null){i=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(i!==null){i.remove();i=null}});return this};this.placeholder=function(e){var i=300;var r="du-widget-placeholder-"+n;if(e){a.transition().duration(i).style("opacity",0);if(t.select("#"+r).empty()){var l=o?o:"body";t.select(l).append("div").attr("id",r).style("position","absolute").style("width",u.width+"px").style("height",u.height+"px").style("line-height",u.height+"px").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",u.fontWeight).style("font-size",u.fontSize).style("color",u.fontColor).style("opacity",0).html(e).transition().duration(i).style("opacity",1)}}else{a.transition().duration();a.transition().duration(i).style("opacity",1);var s=t.select("#"+r);if(!s.empty()){s.remove()}}return this};var f={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){f.build&&f.build(e);this._isBuilt=true}f.update&&f.update(e);if(u.relative){a.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{a.style("position","absolute").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim)}a.style("width",u.width+"px").style("height",u.height+"px");a.style("pointer-events",u.tooltip&&d.tooltip?"all":null).on("mousemove",function(){u.tooltip&&d.tooltip&&c()});a.selectAll(".axis path").style("fill","none").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");a.selectAll(".tick > line").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");a.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",u.fontSize+"px").style("fill",u.fontColor);a.style("font-family","inherit");a.selectAll("g").attr("font-family","inherit");f.style&&f.style();a.style("display","block");return this};this.remove=function(){a.remove()};return{widget:a,attr:u,utils:d,render:f}}return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.PieChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,i){"use strict";function n(n,r){var l=i.call(this,n,"piechart","svg",r);l.attr.add(this,"innerRadius",0,"dim");l.attr.add(this,"outerRadius",50,"dim");l.attr.add(this,"ticks",false);var o=null;var a=[];var s=null;this.data=function(t){a=[];e.forOwn(t,function(t,e){a.push({name:e,value:t})});a.sort(function(t,e){return e.value-t.value});return this};this.highlight=function(t,e){l.utils.highlight(this,o,"path",t,e);l.utils.highlight(this,o,"text",t,e);return this};l.utils.tooltip=function(){return s?{title:s.name,plots:[{id:"",color:l.attr.colors[s.name],value:(100*s.value/t.sum(a,function(t){return t.value})).toFixed(1)+"%&nbsp;("+s.value+")"}]}:null};l.render.build=function(){if(o!==null)return;o={};o.g=l.widget.append("g");o.label=o.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white");o.pie=t.pie().value(function(t){return t.value}).sort(null);o.arc=t.arc();o.arcs=o.g.selectAll(".arc").data(o.pie(a)).enter().append("g").attr("class","arc");o.paths=o.arcs.append("path").attr("class",function(t){return l.utils.encode(t.data.name)}).style("shape-rendering","geometricPrecision").style("pointer-events","all").each(function(t){this._current=t});if(l.attr.ticks){o.labelArc=t.arc();o.ticks=o.arcs.append("text").attr("class",function(t){return l.utils.encode(t.data.name)}).style("text-anchor","middle").attr("dy","0.35em").each(function(t){this._current=t})}};l.render.update=function(e){o.arcs.datum(a);o.paths.data(o.pie(a));o.paths.transition().duration(e).attrTween("d",function(e){var i=t.interpolate(this._current,e);this._current=i(0);return function(t){return o.arc(i(t))}});if(l.attr.ticks){o.ticks.data(o.pie(a));o.ticks.text(function(e){return l.attr.tickFormat(100*e.data.value/t.sum(a,function(t){return t.value}))}).transition().duration(e).attrTween("transform",function(e){var i=t.interpolate(this._current,e);this._current=i(0);return function(t){return"translate("+o.labelArc.centroid(i(t))+")"}})}};l.render.style=function(){l.attr.colors=l.utils.colors(a?a.map(function(t){return t.name}):null);var t=l.attr.outerRadius-l.attr.margins.left;l.attr.width=2*l.attr.outerRadius;l.attr.height=2*l.attr.outerRadius;l.widget.style("width",l.attr.width+"px").style("height",l.attr.height+"px");o.g.attr("transform","translate("+l.attr.outerRadius+","+l.attr.outerRadius+")");o.arc.outerRadius(t).innerRadius(l.attr.innerRadius);o.paths.attr("d",o.arc).attr("fill",function(t){return l.attr.colors[t.data.name]});if(l.attr.ticks){o.labelArc.outerRadius(.5*(l.attr.innerRadius+t)).innerRadius(.5*(l.attr.innerRadius+t));o.ticks.attr("d",o.labelArc).attr("fill",l.attr.fontColor)}o.label.attr("transform","translate(0,"+l.attr.outerRadius+")").style("width",10+2*l.attr.outerRadius+"px").style("font-size",Math.min(16,l.attr.outerRadius*.4)+"px").style("fill",l.attr.fontColor).text(l.attr.label);o.paths.on("mouseover",function(t){l.attr.mouseover&&l.attr.mouseover(t.data.name)}).on("mouseleave",function(t){l.attr.mouseleave&&l.attr.mouseleave(t.data.name)}).on("click",function(t){l.attr.click&&l.attr.click(t.data.name)}).on("mousemove",function(t){s=t.data})}}n.prototype=Object.create(i.prototype);return n});