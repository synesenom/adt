(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";var i=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function r(r,n,a,l){var o;var s="du-widget-"+n+"-"+r;try{if(l){o=t.select(l).append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{o=t.select("body").append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var d={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,i,r,n){d[e]=i;t[e]=function(i){if(n){n(i)}else{d[e]=i}return t};if(typeof r==="string"&&d._categories.hasOwnProperty(r)){d._categories[r].push(e)}}};d.add(this,"relative",false);d.add(this,"x",0,"dim",function(t,e){d.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)d.xDim=e});d.add(this,"y",0,"dim",function(t,e){d.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)d.yDim=e});d.add(this,"width",200,"dim");d.add(this,"height",150,"dim");d.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){d.margins[e]=t})}else{e.forOwn(t,function(e,i){d.margins[i]=t[i]})}});d.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){d.borders[e]=t})}e.forOwn(t,function(e,i){d.borders[i]=t[i]})});d.add(this,"fontColor","black");d.add(this,"fontSize",10,"dim");d.add(this,"fontWeight","normal");d.add(this,"label",null);d.add(this,"xLabel",null);d.add(this,"yLabel",null);d.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});d.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});d.add(this,"xTickAngle",null);d.add(this,"yMin",0);d.add(this,"mouseover",null);d.add(this,"mouseleave",null);d.add(this,"click",null);d.add(this,"colors",null);d.add(this,"tooltip",false);var u=function(){function r(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function n(i,r){if(i===null||i===undefined||i.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var n=[t.min(i,function(t){return t.x}),t.max(i,function(t){return t.x})];var a={};var l=[];i.forEach(function(t){if(!a.hasOwnProperty(t.x)){a[t.x]=1;l.push(t.x)}});var o=[];if(typeof i[0].y==="number"){o=[t.min(i,function(t){return t.y}),t.max(i,function(t){return t.y})]}else{var s=[],d=[];e.forOwn(i[0].y,function(e,r){s.push(t.min(i,function(t){return t.y[r]}));d.push(t.max(i,function(t){return t.y[r]}))});o=[t.min(s),t.max(d)]}var u={x:[null,null],y:[null,null]};if(r){e.forOwn(u,function(t,e){[0,1].forEach(function(i){t[i]=r.hasOwnProperty(e)&&r[e][i]!==null?r[e][i]:t[i]})})}return{x:{min:u.x[0]!==null?u.x[0]:n[0],max:u.x[1]!==null?u.x[1]:n[1],domain:l.filter(function(t){return(!u.x[0]||t>=u.x[0])&&(!u.x[1]||t<=u.x[1])})},y:{min:u.y[0]!==null?u.y[0]:o[0],max:u.y[1]!==null?u.y[1]:o[1],domain:[]}}}function a(e,i,r,n){function a(e,i){var r=null;if(typeof e){switch(e){case"number":default:r=t.scaleLinear().domain([i.min,i.max]);break;case"time":r=t.scaleTime().domain([i.min,i.max]);break;case"string":r=t.scaleBand().domain(i.domain).padding(.1);break}}return r}return{x:a(n&&n.x?n.x.type:"number",e.x).range(n&&n.x&&n.x.reverse?[i,0]:[0,i]),y:a(n&&n.y?n.y.type:"number",e.y).range(n&&n.y&&n.y.reverse?[0,r]:[r,0])}}function l(e,i,n,a,l){if(i!==null){if(typeof a==="string"){i.g.selectAll(n).transition();i.g.selectAll(n).transition().duration(l?l:0).style("opacity",function(){return t.select(this).classed(r(a))?1:.1})}else{i.g.selectAll(n).transition();i.g.selectAll(n).transition().duration(l?l:0).style("opacity",1)}}return e}function o(e){if(e===null||e===undefined){return{}}if(e.length>0){if(d.colors===null||d.colors===undefined){return e.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,r){t[e]=i[r%18];return t},{})}if(typeof d.colors==="string"){var r=t.scaleLinear().domain([0,e.length]).range([d.colors,"#fff"]).interpolate(t.interpolateRgb);return e.reduce(function(t,e,i){t[e]=r(i);return t},{})}return d.colors}}return{encode:r,boundary:n,scale:a,highlight:l,colors:o}}();function c(){var e="du-widgets-plot-tooltip";var i=t.mouse(o.node());var r=t.event.pageX;var n=t.event.pageY;var a=o.node().getBoundingClientRect();if(r<a.left+d.margins.left||r>a.right-d.margins.right||n<a.top+d.margins.top||n>a.bottom-d.margins.bottom){t.select("#"+e).style("opacity",0).html("");u.tooltip();return}var l=t.select("#"+e);if(t.select("#"+e).empty()){var s=t.color(d.fontColor);s.opacity=.3;l=t.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("border","solid 1px "+s).style("padding","5px").style("font-family","Courier").style("font-size","0.7em").style("color",d.fontColor).style("pointer-events","none").style("left",(a.left+a.right)/2+"px").style("top",(a.top+a.bottom)/2+"px")}l.html(u.tooltip([i[0]-d.margins.left,i[1]-d.margins.top]));var c=l.node().getBoundingClientRect();var f=c.width;var y=c.height;var p=r+20;var h=n+20;if(p<a.left+d.margins.left+10){p+=d.margins.left+10}else if(p+f>a.right-d.margins.right){p-=d.margins.right+f-10}if(h<a.top+d.margins.top+10){h+=d.margins.top+10}else if(h+y>a.bottom-d.margins.bottom){h-=d.margins.bottom+y-10}l.style("opacity",1).transition();l.transition().duration(200).ease(t.easeLinear).style("left",p+"px").style("top",h+"px")}this.id=function(){return s};this.describe=function(e){var i=null;o.on("contextmenu",function(){t.event.preventDefault();if(i===null){i=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(i!==null){i.remove();i=null}});return this};this.placeholder=function(e){var i=300;var n="du-widget-placeholder-"+r;if(e){o.transition().duration(i).style("opacity",0);if(t.select("#"+n).empty()){var a=l?l:"body";t.select(a).append("div").attr("id",n).style("position","absolute").style("width",d.width+"px").style("height",d.height+"px").style("line-height",d.height+"px").style(d.x>=0?"left":"right",Math.abs(d.x)+d.xDim).style(d.y>=0?"top":"bottom",Math.abs(d.y)+d.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",d.fontWeight).style("font-size",d.fontSize).style("color",d.fontColor).style("opacity",0).html(e).transition().duration(i).style("opacity",1)}}else{o.transition().duration();o.transition().duration(i).style("opacity",1);var s=t.select("#"+n);if(!s.empty()){s.remove()}}return this};var f={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){f.build&&f.build(e);this._isBuilt=true}f.update&&f.update(e);if(d.relative){o.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{o.style("position","absolute").style(d.x>=0?"left":"right",Math.abs(d.x)+d.xDim).style(d.y>=0?"top":"bottom",Math.abs(d.y)+d.yDim)}o.style("width",d.width+"px").style("height",d.height+"px");o.style("pointer-events",d.tooltip&&u.tooltip?"all":null).on("mousemove",function(){d.tooltip&&u.tooltip&&c()});o.selectAll(".axis path").style("fill","none").style("stroke",d.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > line").style("stroke",d.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",d.fontSize+"px").style("fill",d.fontColor);o.style("font-family","inherit");o.selectAll("g").attr("font-family","inherit");f.style&&f.style();o.style("display","block");return this};this.remove=function(){o.remove()};return{widget:o,attr:d,utils:u,render:f}}return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BarChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,i){"use strict";function r(r,n){var a=i.call(this,r,"barchart","svg",n);a.attr.add(this,"vertical",false);var l={};var o=[];this.data=function(t){o=[];e.forOwn(t,function(t,e){o.push({x:e,y:t})});o.sort(function(t,e){return t.x.localeCompare(e.x)});return this};this.highlight=function(t,e){return a.utils.highlight(this,l,".bar",t,e)};a.utils.tooltip=function(e){var i=a.attr.vertical?1:0;var r=t.bisector(function(t){return l.scale.x(t.x)}).right;var n=e?r(o,e[i]):null;if(n===null){return}var s=o[n-1]?o[n-1]:o[n];var d=o[n]?o[n]:o[n-1];var u=e[i]-s.x>d.x-e[i]?d:s;var c=t.select(document.createElement("div"));c.append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").style("border-bottom","solid 1px "+a.attr.fontColor).text(a.attr.xLabel+": "+u.x);var f=c.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");f.append("div").style("position","relative").style("width","10px").style("height","10px").style("float","left").style("background-color",a.attr.colors[u.x]);f.append("div").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").text(u.y.toPrecision(6));return c.node().innerHTML};a.render.build=function(){l.g=a.widget.append("g");l.axisFn={x:t.axisBottom().ticks(4),y:t.axisLeft().ticks(4)};l.axes={x:l.g.append("g").attr("class","x axis"),y:l.g.append("g").attr("class","y axis")};l.labels={x:l.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:l.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};a.render.update=function(t){if(a.attr.vertical){l.scale=a.utils.scale(a.utils.boundary(o,{y:[0,null]}),a.attr.height-a.attr.margins.top-a.attr.margins.bottom,a.attr.width-a.attr.margins.left-a.attr.margins.right,{x:{type:"string"},y:{reverse:true}})}else{l.scale=a.utils.scale(a.utils.boundary(o,{y:[0,null]}),a.attr.width-a.attr.margins.left-a.attr.margins.right,a.attr.height-a.attr.margins.top-a.attr.margins.bottom,{x:{type:"string"}})}l.axes.x.transition().duration(t).call(l.axisFn.x.scale(a.attr.vertical?l.scale.y:l.scale.x));l.axes.y.transition().duration(t).call(l.axisFn.y.scale(a.attr.vertical?l.scale.x:l.scale.y));if(o.length>0){if(l.bars===undefined){l.bars=l.g.selectAll(".bar").data(o).enter().append("rect").attr("class",function(t){return"bar "+a.utils.encode(t.x)}).style("pointer-events","all").style("stroke","none").style("shape-rendering","geometricPrecision");if(a.attr.vertical){l.bars.attr("x",1).attr("width",0)}else{l.bars.attr("y",a.attr.height-a.attr.margins.top-a.attr.margins.bottom-1).attr("height",0)}}l.bars.data(o);if(a.attr.vertical){l.bars.attr("y",function(t){return l.scale.x(t.x)}).attr("height",l.scale.x.bandwidth()).transition().duration(t).attr("x",1).attr("width",function(t){return l.scale.y(t.y)})}else{l.bars.attr("x",function(t){return l.scale.x(t.x)}).attr("width",l.scale.x.bandwidth()).transition().duration(t).attr("y",function(t){return l.scale.y(t.y)}).attr("height",function(t){return a.attr.height-a.attr.margins.top-a.attr.margins.bottom-l.scale.y(t.y)})}}};a.render.style=function(){a.attr.colors=a.utils.colors(o?o.map(function(t){return t.x}):null);var t=a.attr.width-a.attr.margins.left-a.attr.margins.right,e=a.attr.height-a.attr.margins.top-a.attr.margins.bottom;l.g.style("width",t+"px").style("height",e+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");if(a.attr.vertical){l.axisFn.x.tickFormat(a.attr.yTickFormat)}else{l.axisFn.y.tickFormat(a.attr.yTickFormat)}l.axes.x.attr("transform","translate(0,"+e+")");l.axes.y.attr("transform","translate(0,"+1+")");l.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(a.attr.vertical){l.g.selectAll(".y.axis .tick > line").style("display","none")}if(typeof a.attr.xTickAngle==="number"){l.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+a.attr.xTickAngle+")").style("text-anchor","start")}l.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");l.labels.x.attr("x",t+"px").attr("y",e+2.6*a.attr.fontSize+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.vertical?a.attr.yLabel:a.attr.xLabel);l.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.vertical?a.attr.xLabel:a.attr.yLabel);if(l.bars!==undefined){l.bars.style("fill",function(t){return typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[t.x]});if(a.attr.mouseover){l.bars.on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.x)});l.g.selectAll("."+(a.attr.vertical?"y":"x")+".axis .tick").on("mouseover",function(t,e){a.attr.mouseover&&a.attr.mouseover(o[e].x)})}if(a.attr.mouseleave){l.bars.on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.x)});l.g.selectAll("."+(a.attr.vertical?"y":"x")+".axis .tick").on("mouseleave",function(t,e){a.attr.mouseleave&&a.attr.mouseleave(o[e].x)})}if(a.attr.click){l.bars.on("click",function(t){a.attr.click&&a.attr.click(t.x)});l.g.selectAll("."+(a.attr.vertical?"y":"x")+".axis .tick").on("click",function(t,e){a.attr.click&&a.attr.click(o[e].x)})}}}}r.prototype=Object.create(i.prototype);return r});