(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("lodash"))}else if(typeof define==="function"&&define.amd){define(["_","exports"],e)}else{t.du=t.du||{};t.du.data=e(t._)}})(this,function(u){"use strict";var t={si:function(){var a="yzafpnÎ¼m kMGTPEZY";var i=(a.length-1)/2;var o=i;var s=-i;function t(t){if(t===null||t===undefined||isNaN(t))return"N/A";if(t===0)return"0";var e=Math.abs(t);var r=Math.max(Math.min(parseInt(Math.floor(Math.log(e)/Math.log(1e3))),o),s);var n=e/Math.pow(1e3,r);return(t<0?"-":"")+(r===s||r===o?n.toExponential(2):n.toPrecision(3)).replace(/e\+0$/,"")+a.charAt(i+r).trim()}return t}(),idfy:function(t){return t?t.replace(/ /g,"__"):""},namify:function(t){return t?t.replace(/__/g," "):""}};var e={sum:function(t,n,e){var a={};var i=[];if(Array.isArray(e)){i=e}else{i=[e]}var o=i.length;t.forEach(function(e){var r=[];i.forEach(function(t){if(e.hasOwnProperty(t)){r.push(e[t])}});if(r.length!==o)return;var t=r.join(".");if(!a.hasOwnProperty(t))a[t]=+e[n];else a[t]+=+e[n]});var r=[];u.forOwn(a,function(t,e){r.push({key:e,value:t})});return r.sort(function(t,e){return e.value-t.value})}};var r={Histogram:function(t){var n=t?t:[];this.set=function(t){n=t;return this};function e(){return u.cloneDeep(n)}function r(t,e){n.push({x:t,y:e,index:n.length});return this}function a(e){n.forEach(function(t){t.y*=e});return this}function i(){var e=d3.sum(n,function(t){return t.y});n.forEach(function(t){t.y/=e});return this}function o(r){n.sort(function(t,e){return r?e.x-t.x:t.x-e.x});return this}function s(r){n.sort(function(t,e){return r?e.y-t.y:t.y-e.y});return this}function l(){n.sort(function(t,e){return t.index-e.index});return this}return{set:set,get:e,add:r,scale:a,normalize:i,sortByX:o,sortByY:s,unsort:l}},TimeSeries:function(n){var i=[];function t(t){i=[];var e=0;if(t!==null){var r=new Date(t);while(r<=new Date){i.push({x:new Date(r),y:{}});n.forEach(function(t){i[e].y[t]=0});r.setDate(r.getDate()+1);e++}}return this}function e(t,e,r,n){i[t].x=e;i[t].y[r]+=n}function a(t,e){if(!t)return i;else{var r=e?e:0;return i.slice(-r-t,-r)}}function o(t,e){if(i.length<1)return{};var n={};u.forOwn(i[0].y,function(t,e){n[e]=0});a(t?t:1,e).forEach(function(r){u.forOwn(i[0].y,function(t,e){n[e]+=r.y[e]})});return n}function r(t,e){var r=0;if(i.length>0){var n=a(t,e);u.forOwn(i[0].y,function(t,e){r=Math.max(d3.max(n,function(t){return t.y.hasOwnProperty(e)?t.y[e]:0}),r)})}return r}function s(t){if(i.length<1)return{};var r=o(1,t);var n=o(2,t);var a={};u.forOwn(i[0].y,function(t,e){n[e]-=r[e];if(n[e]>=10&&r[e]>0){a[e]=(r[e]-n[e])/n[e]}});return a}function l(t,e){var r=o(t,e);var n=0;u.forOwn(r,function(t){n+=t});u.forOwn(r,function(t,e){r[e]/=n>0?n:1});return r}return{clear:t,update:e,sub:a,sum:o,peak:r,trend:s,yDist:l}},Table:function(t){var i=[];var r=[];if(t){i=u.cloneDeep(t);i.forEach(function(t,e){r.push(e)})}function e(t,n){var a=[];i.forEach(function(e){var r;if(typeof n==="string"){r=e[n]}else{r={};n.forEach(function(t){r[t]=e[t]})}a.push({x:e[t],y:r})});return a}function n(e,r){var t=null;switch(typeof r){case"number":var n=d3.min(i,function(t){return Math.abs((r-t[e])/r)});t=i.filter(function(t){return Math.abs((t[e]-r)/r)<=n*1.01});break;case"string":default:t=i.filter(function(t){return t[e]===r})}return new du.data.structures.Table(t)}function a(r){i.sort(function(t,e){return t[r]-e[r]});return this}function o(){var e=[];r.forEach(function(t){e.push(i[t])});i=e}return{slice:e,segment:n,sort:a,unsort:o}}};return{format:t,explore:e,structures:r}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.math=t.du.math||{};t.du.math.la=e()}})(this,function(){"use strict";var a=function(t){var n=t||[1,0];this.x=function(){return n[0]};this.y=function(){return n[1]};this.length=function(t){var e=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(typeof t==="number"){var r=t/e;return new a(n.map(function(t){return t*r}))}return e};this.angle=function(t){var e=Math.atan2(n[1],n[0]);if(typeof t==="number"){var r=Math.sqrt(n[0]*n[0]+n[1]*n[1]);return new a([r*Math.cos(t),r*Math.sin(t)])}return e};this.toArray=function(){return[n[0],n[1]]};this.map=function(t){return new a(t(n))};this.add=function(t){return new a([n[0]+t.x(),n[1]+t.y()])};this.sub=function(t){return new a([n[0]-t.x(),n[1]-t.y()])};this.multiply=function(e){return new a(n.map(function(t){return t*e}))}};var i=function(t){var n=t||[1,0,0];this.x=function(){return n[0]};this.y=function(){return n[1]};this.z=function(){return n[2]};this.length=function(e){var r=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);if(typeof e==="number"){return new i(n.map(function(t){return t*e/r}))}return r};this.toLatLon=function(){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return new e([Math.asin(n[2]/t),Math.atan2(n[1],n[0])].map(function(t){return t*180/Math.PI}))};this.add=function(t){return new i([n[0]+t.x(),n[1]+t.y(),n[2]+t.z()])};this.multiply=function(e){return new i(n.map(function(t){return t*e}))};this.dot=function(t){return n[0]*t.x()+n[1]*t.y()+n[2]*t.z()};this.cross=function(t){return new i([n[1]*t.z()-n[2]*t.y(),n[2]*t.x()-n[0]*t.z(),n[0]*t.y()-n[1]*t.x()])}};var e=function(t){var n=t||[0,0];this.toArray=function(){return[n[0],n[1]]};this.toVec=function(){var t=n[0]*Math.PI/180,e=n[1]*Math.PI/180;var r=Math.cos(t);return new t.Vector3([r*Math.cos(e),r*Math.sin(e),Math.sin(t)])}};return{Vector2:a,Vector3:i,LatLon:e}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.rest=e(t.d3)}})(this,function(u){"use strict";var t=function(l){function a(t,e,r,n,a){var i=l;var o=u.keys(t).sort();if(o.length>0){i+="?"+o[0]+"="+t[o[0]]}for(var s=1;s<o.length;s++){i+="&"+o[s]+"="+t[o[s]]}e(i).on("beforesend",function(t){if(a){for(var e in a){if(a.hasOwnProperty(e))t[e]=a[e]}}}).get(function(t,e){if(t){if(n)n(t);return}if(r)r(e)})}function t(t,e,r,n){a(t,u.json,e,r,n)}function e(t,e,r,n){a(t,u.csv,e,r,n)}return{json:t,csv:e}};return{Rest:t}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.signals=e()}})(this,function(){"use strict";var a={};function n(t,e){if(!a.hasOwnProperty(t))a[t]=[];for(var r=0;r<a[t].length;r++){if(a[t][r]===e){return}}a[t].push(e)}function t(t,e){if(typeof t==="string"){n(t,e)}else{if(t.constructor===Array){for(var r=0;r<t.length;r++){n(t[r],e)}}}}function e(t,e){var r=a[t];if(r!==undefined&&r!==null&&r.length>0){for(var n=0;n<r.length;n++){r[n](e)}}}return{subscribe:t,emit:e}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.log=e()}})(this,function(){"use strict";var e={error:"error",e:"error",warning:"warning",w:"warning",info:"info",i:"info",debug:"debug",d:"debug"};var r="info";var n=new Date;function a(t,e){return new Array(e-(""+t).length+1).join("0")+t}function i(){var t=new Date-n;return a(Math.floor(t/36e5),2)+":"+a(Math.floor(t%36e5/6e4),2)+":"+a(Math.floor(t%6e4/1e3),2)+"."+a(t%1e3,3)}function t(t){if(e.hasOwnProperty(t.toLowerCase())){r=t}}function o(t,e){if(r==="debug")console.debug("DEBUG ["+i()+"] "+t+": "+e)}function s(t,e){if(r==="info"||r==="debug")console.info("INFO  ["+i()+"] "+t+": "+e)}function l(t,e){if(r==="warning"||r==="info"||r==="debug")console.warn("WARN  ["+i()+"] "+t+": "+e)}function u(t,e){if(r==="error"||r==="warning"||r==="info"||r==="debug")console.error("ERROR ["+i()+"] "+t+": "+e)}return{severity:t,d:o,i:s,w:l,e:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.version=e()}})(this,function(){"use strict";var e="data/version.json";var i="du-version";var r=false;function a(t){if(typeof t!=="string"){return{major:0,minor:0,patch:1}}var e=t.split(".");return{major:e.length>0?+e[0]:0,minor:e.length>1?+e[1]:0,patch:e.length>2?+e[2]:1}}function o(t,e){var r=a(e),n=a(t);return n.major>r.major||n.major===r.major&&n.minor>r.minor||n.major===r.major&&n.minor===r.minor&&n.patch>r.patch}function t(t){e=t}function s(n,t){var a="0.0.1";d3.json(e,function(t,e){if(!t&&e.hasOwnProperty("version")&&typeof e.version==="string"){a=e.version}try{var r=localStorage.getItem(i);if(r===null)r="0.0.1";if(o(a,r)){localStorage.setItem(i,a);if(n)n(a,r)}}catch(t){console.error("MissingDOMException: there is no DOM, could not check version")}});if(t&&!r){r=true;setInterval(function(){s(n,false)},1810001)}}function n(){try{var t=localStorage.getItem(i);if(t===null){t="0.0.1";localStorage.setItem(i,t)}}catch(t){console.error("MissingDOMException: there is no DOM, could not read version")}return t}n();return{file:t,current:n,check:s}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.user=e(t.d3)}})(this,function(r){"use strict";var n=function(){var n=[];try{window.addEventListener("load",function(){r.select("body").on("keydown",function(){var t=String.fromCharCode(r.event.keyCode);if(!t)return;for(var e=0;e<n.length;e++){if(n[e]._check(t)){n.forEach(function(t){t._reset()});break}}})})}catch(t){console.error("No DOM, could not attach event listener")}function t(t,e){n.push(this);var r=t.toLowerCase();this._index=0;this._reset=function(){this._index=0};this._check=function(t){if(t.toLowerCase()===r.charAt(this._index)){this._index++}else{this._index=0}if(this._index===r.length){e();return true}return false}}return t}();var a=0;setInterval(function(){a+=1e4},1e4);try{window.addEventListener("load",function(){r.select("body").on("mousemove",function(){a=0})})}catch(t){console.error("No DOM, could not attach event listener")}function t(t,e){setInterval(function(){if(a>t){e()}},t)}function e(t){window.onblur=t}function i(t){window.onfocus=t}function o(){r.select("svg").style("pointer-events",null)}function s(){try{r.select("svg").style("pointer-events","none")}catch(t){console.error("No DOM, could not attach event listener")}}function l(){try{r.select("body").attr("oncontextmenu","return false;")}catch(t){console.error("No DOM, could not hide context menu")}}var u={egg:function(t,e){new n(t,e)},feature:function(t,e,r){new n("enable"+t,e);new n("disable"+t,r)}};return{enable:o,disable:s,noContext:l,idle:t,leave:e,enter:i,cheats:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3)}})(this,function(m){"use strict";var l=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function t(i,t,e,o){var h;var r="du-widget-"+t+"-"+i;try{if(o){h=m.select(o).append(e).attr("id",r).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{h=m.select("body").append(e).attr("id",r).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var y={xDim:"px",yDim:"px",fontWeight:"normal",innerWidth:200,innerHeight:150,_categories:{dim:[]},add:function(e,r,t,n,a){y[r]=t;e[r]=function(t){if(a){a(t)}else{y[r]=t}return e};if(typeof n==="string"&&y._categories.hasOwnProperty(n)){y._categories[n].push(r)}}};y.add(this,"relative",false);y.add(this,"x",0,"dim",function(t,e){y.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)y.xDim=e});y.add(this,"y",0,"dim",function(t,e){y.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)y.yDim=e});y.add(this,"width",200,"dim",function(t){y.width=t;y.innerWidth=y.width-y.margins.left-y.margins.right});y.add(this,"height",150,"dim",function(t){y.height=t;y.innerHeight=y.height-y.margins.top-y.margins.bottom});y.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(e){if(typeof e==="number"){["top","left","bottom","right"].forEach(function(t){y.margins[t]=e})}else{for(var t in e){if(e.hasOwnProperty(t)){y.margins[t]=e[t]}}}y.innerWidth=y.width-y.margins.left-y.margins.right;y.innerHeight=y.height-y.margins.top-y.margins.bottom});y.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(e){if(typeof e==="string"){["top","left","bottom","right"].forEach(function(t){y.borders[t]=e})}for(var t in e){if(e.hasOwnProperty(t)){y.borders[t]=e[t]}}});y.add(this,"fontColor","black");y.add(this,"fontSize",10,"dim");y.add(this,"fontWeight","normal");y.add(this,"label",null);y.add(this,"xLabel",null);y.add(this,"yLabel",null);y.add(this,"tickFormat",function(t){return t>1?m.format(".2s")(t):t});y.add(this,"yTickFormat",function(t){return t>1?m.format(".2s")(t):t});y.add(this,"xTickAngle",null);y.add(this,"yMin",0);y.add(this,"mouseover",null);y.add(this,"mouseleave",null);y.add(this,"click",null);y.add(this,"colors",null);y.add(this,"tooltip",false);y.add(this,"tooltipYFormat",function(t){return t});y.add(this,"tooltipXFormat",function(t){return t});var n=function(){var n=[];function t(r){return{remain:n.reduce(function(t,e){return r.indexOf(e)>-1?t.concat(e):t},[]),exit:n.reduce(function(t,e){return r.indexOf(e)===-1?t.concat(e):t},[]),enter:r.forEach(function(t,e){return n.indexOf(e)===-1?t.concat(e):t},[])}}return{update:t}}();var g=function(){function i(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function t(){var t=h.append("g");return{g:t,axisFn:{x:m.axisBottom(null).ticks(7),y:m.axisLeft(null).ticks(5)},axes:{x:t.append("g").attr("class","x axis"),y:t.append("g").attr("class","y axis")},labels:{x:t.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:t.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}}}function e(t,e,r){if(!t||t.length<1){return m.scaleLinear().domain([0,1]).range(e)}var n;switch(r){case undefined:case"linear":n=m.scaleLinear().domain([m.min(t),m.max(t)]);break;case"band":n=m.scaleBand().domain(t).padding(.1);break;case"point":n=m.scalePoint().domain(t).padding(.5)}return n.range(e)}function r(t,e,r,n,a){if(e!==null){if(typeof n==="string"){e.g.selectAll(r).transition();e.g.selectAll(r).transition().duration(a?a:0).style("opacity",function(){return m.select(this).classed(i(n))?1:.1})}else{e.g.selectAll(r).transition();e.g.selectAll(r).transition().duration(a?a:0).style("opacity",1)}}return t}function n(t){if(t===null||t===undefined){return{}}if(t.length>0){if(y.colors===null||y.colors===undefined){return t.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,r){t[e]=l[r%18];return t},{})}if(typeof y.colors==="string"){var n=m.scaleLinear().domain([0,t.length]).range([y.colors,"#fff"]).interpolate(m.interpolateRgb);return t.reduce(function(t,e,r){t[e]=n(r);return t},{})}return y.colors}}return{encode:i,standardAxis:t,scale:e,highlight:r,colors:n}}();this.id=function(){return r};this.describe=function(t){var e=null;h.on("contextmenu",function(){m.event.preventDefault();if(e===null){e=m.select("body").append("div").style("position","absolute").style("left",m.event.pageX+20+"px").style("top",m.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(t)}}).on("mouseleave",function(){if(e!==null){e.remove();e=null}});return this};this.placeholder=function(t){var e=300;var r="du-widget-placeholder-"+i;if(typeof t==="string"){h.transition().duration(e).style("opacity",0);if(m.select("#"+r).empty()){var n=o?o:"body";m.select(n).append("div").attr("id",r).style("position","absolute").style("width",y.width+"px").style("height",y.height+"px").style("line-height",y.height+"px").style(y.x>=0?"left":"right",Math.abs(y.x)+y.xDim).style(y.y>=0?"top":"bottom",Math.abs(y.y)+y.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",y.fontWeight).style("font-size",y.fontSize).style("color",y.fontColor).style("opacity",0).html(t).transition().duration(e).style("opacity",1)}}else{h.transition().duration();h.transition().duration(e).style("opacity",1);var a=m.select("#"+r);if(!a.empty()){a.remove()}}return this};function a(t){var e="du-widgets-plot-tooltip";var r=m.mouse(h.node());var n=m.event.pageX;var a=m.event.pageY;var i=h.node().getBoundingClientRect();if(!t){m.select("#"+e).style("display","none");g.tooltip();return}if(n<i.left+y.margins.left||n>i.right-y.margins.right||a<i.top+y.margins.top||a>i.bottom-y.margins.bottom){m.select("#"+e).style("display","none");g.tooltip();return}var o=m.select("#"+e);if(m.select("#"+e).empty()){var s=m.color(y.fontColor);s.opacity=.3;o=m.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-radius","2px").style("box-shadow","0 0 3px "+s).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",y.fontColor).style("pointer-events","none").style("left",(i.left+i.right)/2+"px").style("top",(i.top+i.bottom)/2+"px")}var l=g.tooltip([r[0]-y.margins.left,r[1]-y.margins.top]);if(!l){m.select("#"+e).style("display","none").html("");g.tooltip();return}o.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(l.title);o.style("border-left",l.stripe?"solid 2px "+l.stripe:null);switch(l.content.type){case"metrics":l.content.data.forEach(function(t){var e=o.append("div").style("position","relative").style("display","block").style("width","auto").style("height","10px").style("margin","5px");e.append("div").style("position","relative").style("float","left").style("color","#888").html(t.label);e.append("div").style("position","relative").style("float","right").style("margin-left","10px").html(t.value)});break;case"plots":l.content.data.sort(function(t,e){return t.name.localeCompare(e.name)}).forEach(function(t){var e=o.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");e.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background-color",t.color);e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)});break}var u=o.node().getBoundingClientRect();var c=u.width;var d=u.height;var f=n+20;var p=a+20;if(f+c>i.right-y.margins.right-5){f-=c+40}if(p+d>i.bottom-y.margins.bottom-5){p=i.bottom-y.margins.bottom-10-d}o.style("display","block").transition();o.transition().duration(200).ease(m.easeLinear).style("left",f+"px").style("top",p+"px")}var s={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){s.build&&s.build();this._isBuilt=true}s.update&&s.update(e);if(y.relative){h.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{h.style("position","absolute").style(y.x>=0?"left":"right",Math.abs(y.x)+y.xDim).style(y.y>=0?"top":"bottom",Math.abs(y.y)+y.yDim)}h.style("width",y.width+"px").style("height",y.height+"px");h.style("pointer-events",y.tooltip&&g.tooltip?"all":null).on("mousemove",function(){y.tooltip&&g.tooltip&&a(true)}).on("mouseleave",function(){y.tooltip&&g.tooltip&&a(false)});h.selectAll(".axis path").style("fill","none").style("stroke",y.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");h.selectAll(".tick > line").style("stroke",y.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");h.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",y.fontSize+"px").style("fill",y.fontColor);h.style("font-family","inherit");h.selectAll("g").attr("font-family","inherit");s.style&&s.style();h.style("display","block");return this};this.remove=function(){h.remove()};return{widget:h,attr:y,data:n,utils:g,render:s}}return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.AreaChart=e(t.d3,t.du.Widget)}})(this,function(a,i){"use strict";function t(t,e){var d=i.call(this,t,"areachart","svg",e);d.attr.add(this,"opacity",.3);var f={};var n=[];var p={};var r=false;this.data=function(t){n=t.map(function(t){return{name:t.name,values:t.values.sort(function(t,e){return t.x-e.x})}});return this};this.highlight=function(t,e){if(!r)d.utils.highlight(this,f,".area",t,e);return this};d.utils.tooltip=function(s){var e=a.bisector(function(t){return f.scale.x(t.x)}).left;var l=s?n.map(function(t){return e(t.values,s[0])}):null;if(l===null){for(var t in this.tt){if(this.tt.hasOwnProperty(t))this.tt[t].remove()}this.tt=null;return}else{this.tt=this.tt||{};var u=this.tt}var c=f.scale.x.invert(s[0]);var r=n.map(function(t,e){var r=l[e];var n=t.values;var a=n[r-1]?n[r-1]:n[r];var i=n[r]?n[r]:n[r-1];var o=s[0]-a.x>i.x-s[0]?i:a;u[t.name]=u[t.name]||f.g.append("circle");u[t.name].attr("r",4).attr("cx",f.scale.x(o.x)+1).attr("cy",f.scale.y(o.y)+1).style("fill",p[t.name]);c=o.x;return{name:t.name,color:p[t.name],value:d.attr.tooltipYFormat(o.y)}});return{title:d.attr.xLabel+": "+d.attr.tooltipXFormat(c),content:{type:"plots",data:r}}};d.render.build=function(){f=d.utils.standardAxis();f.plots={}};d.render.update=function(t){f.scale={x:d.utils.scale(n.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,d.attr.innerWidth]),y:d.utils.scale(n.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[d.attr.innerHeight,0])};var e=a.area().x(function(t){return f.scale.x(t.x)+1}).y0(d.attr.height-d.attr.margins.top-d.attr.margins.bottom).y1(function(t){return f.scale.y(t.y)});f.axes.x.transition().duration(t).call(f.axisFn.x.scale(f.scale.x));f.axes.y.transition().duration(t).call(f.axisFn.y.scale(f.scale.y));p=d.utils.colors(n?n.map(function(t){return t.name}):null);f.plots.areas=f.g.selectAll(".area").data(n,function(t){return t.name});f.plots.areas.exit().transition().duration(t).style("opacity",0).remove();f.plots.areas.enter().append("path").attr("class",function(t){return"area "+d.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("stroke","none").style("fill","transparent").merge(f.plots.areas).each(function(){r=true}).on("mouseover",function(t){d.attr.mouseover&&d.attr.mouseover(t.name)}).on("mouseleave",function(t){d.attr.mouseleave&&d.attr.mouseleave(t.name)}).on("click",function(t){d.attr.click&&d.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("d",function(t){return e(t.values)}).style("fill-opacity",d.attr.opacity).style("fill",function(t){return p[t.name]}).on("end",function(){r=false})};d.render.style=function(){f.g.attr("width",d.attr.innerWidth+"px").attr("height",d.attr.innerHeight+"px").attr("transform","translate("+d.attr.margins.left+","+d.attr.margins.top+")").style("pointer-events","all");f.axes.x.attr("transform","translate(0,"+d.attr.innerHeight+")");f.axisFn.y.tickFormat(d.attr.yTickFormat);f.axes.y.attr("transform","translate(0,"+1+")");f.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");f.labels.x.attr("x",d.attr.innerWidth+"px").attr("y",d.attr.innerHeight+2.2*d.attr.fontSize+"px").attr("fill",d.attr.fontColor).style("font-size",d.attr.fontSize+"px").text(d.attr.xLabel);f.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",d.attr.fontColor).style("font-size",d.attr.fontSize+"px").text(d.attr.yLabel)}}t.prototype=Object.create(i.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BarChart=e(t.d3,t.du.Widget)}})(this,function(c,r){"use strict";function t(t,e){var s=r.call(this,t,"barchart","svg",e);s.attr.add(this,"vertical",false);var l={};var u=[];var n={};var a=false;this.data=function(t){u=t;return this};this.highlight=function(t,e){if(!a)s.utils.highlight(this,l,".bar",t,e);return this};s.utils.tooltip=function(t){var e=s.attr.vertical?1:0;var r=c.bisector(function(t){return l.scale.x(t.name)}).right;var n=t?r(u,t[e]):null;if(n===null){return}var a=u[n-1]?u[n-1]:u[n];var i=u[n]?u[n]:u[n-1];var o=t[e]-a.name>i.name-t[e]?i:a;return{title:o.name,stripe:s.attr.colors[o.name],content:{type:"metrics",data:[{label:s.attr.yLabel+":",value:s.attr.tooltipYFormat(o.value)}]}}};s.render.build=function(){l=s.utils.standardAxis();l.plots={}};s.render.update=function(t){l.scale={x:s.utils.scale(u.map(function(t){return t.name}).reverse(),[s.attr.vertical?s.attr.innerHeight:s.attr.innerWidth,0],"band"),y:s.utils.scale([0,c.max(u,function(t){return t.value})],s.attr.vertical?[0,s.attr.innerWidth]:[s.attr.innerHeight,0])};l.axes.x.transition().duration(t).call(l.axisFn.x.scale(s.attr.vertical?l.scale.y:l.scale.x));l.axes.y.transition().duration(t).call(l.axisFn.y.scale(s.attr.vertical?l.scale.x:l.scale.y));n=s.utils.colors(u?u.map(function(t){return t.name}):null);l.plots.bars=l.g.selectAll(".bar").data(u,function(t){return t.name});l.plots.bars.exit().transition().duration(t).style("opacity",0).remove();var e=l.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+s.utils.encode(t.name)}).style("fill",function(t){return n[t.name]}).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none");if(s.attr.vertical){e.attr("y",function(t){return l.scale.x(t.name)}).attr("height",l.scale.x.bandwidth()).attr("x",1).attr("width",0)}else{e.attr("x",function(t){return l.scale.x(t.name)}).attr("width",l.scale.x.bandwidth()).attr("y",s.attr.height-s.attr.margins.top-s.attr.margins.bottom).attr("height",0)}var r=e.merge(l.plots.bars).each(function(){a=true}).on("mouseover",function(t){s.attr.mouseover&&s.attr.mouseover(t.name)}).on("mouseleave",function(t){s.attr.mouseleave&&s.attr.mouseleave(t.name)}).on("click",function(t){s.attr.click&&s.attr.click(t.name)});if(s.attr.vertical){r=r.transition().duration(t).attr("y",function(t){return l.scale.x(t.name)}).attr("height",l.scale.x.bandwidth()).attr("x",1).attr("width",function(t){return l.scale.y(t.value)})}else{r=r.transition().duration(t).attr("x",function(t){return l.scale.x(t.name)}).attr("width",l.scale.x.bandwidth()).attr("y",function(t){return l.scale.y(t.value)}).attr("height",function(t){return s.attr.height-s.attr.margins.top-s.attr.margins.bottom-l.scale.y(t.value)})}r.style("opacity",1).style("fill",function(t){return n[t.name]}).on("end",function(){a=false})};s.render.style=function(){l.g.style("width",s.attr.innerWidth+"px").style("height",s.attr.innerHeight+"px").attr("transform","translate("+s.attr.margins.left+","+s.attr.margins.top+")").style("pointer-events","all");if(s.attr.vertical){l.axisFn.x.tickFormat(s.attr.yTickFormat)}else{l.axisFn.y.tickFormat(s.attr.yTickFormat)}l.axes.x.attr("transform","translate(0,"+s.attr.innerHeight+")");l.axes.y.attr("transform","translate(0,"+1+")");l.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(s.attr.vertical){l.g.selectAll(".y.axis .tick > line").style("display","none")}if(typeof s.attr.xTickAngle==="number"){l.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+s.attr.xTickAngle+")").style("text-anchor","start")}l.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");l.labels.x.attr("x",s.attr.innerWidth+"px").attr("y",s.attr.innerHeight+2.2*s.attr.fontSize+"px").style("font-size",s.attr.fontSize+"px").style("fill",s.attr.fontColor).text(s.attr.vertical?s.attr.yLabel:s.attr.xLabel);l.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",s.attr.fontSize+"px").style("fill",s.attr.fontColor).text(s.attr.vertical?s.attr.xLabel:s.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BoxPlot=e(t.d3,t.du.Widget)}})(this,function(d,r){"use strict";function t(t,e){var i=r.call(this,t,"boxplot","svg",e);var o={};var s=[];var l=null;var u={};var c=false;this.data=function(t){s=t.map(function(t){var e=t.values.sort(d.ascending),r=d.min(e),n=d.max(e),a=d.quantile(e,.25),i=d.quantile(e,.75),o=i-a;var s=[],l=[];t.values.filter(function(t){return t<a-1.5*o||t>i+1.5*o}).forEach(function(t){if(t<a-3*o||t>i+3*o){l.push(t)}else{s.push(t)}});return{name:t.name,values:{min:r,max:n,mean:d.mean(e),median:d.median(e),q1:a,q3:i,whiskers:{lower:Math.max(r,a-1.5*o),upper:Math.min(n,i+1.5*o)},outliers:{mild:s,extreme:l}}}});return this};this.highlight=function(t,e){if(!c)i.utils.highlight(this,o,".box",t,e);return this};i.utils.tooltip=function(){return l?{title:l.name,stripe:i.attr.colors[l.name],content:{type:"metrics",data:[{label:"min/max:",value:l.values.min.toPrecision(3)+"/"+l.values.max.toPrecision(3)},{label:"mean:",value:l.values.mean.toPrecision(3)},{label:"median:",value:l.values.median.toPrecision(3)},{label:"Q1:",value:l.values.q1.toPrecision(3)},{label:"Q3:",value:l.values.q3.toPrecision(3)},{label:"mild outliers:",value:l.values.outliers.mild.length},{label:"extreme outliers:",value:l.values.outliers.extreme.length}]}}:null};i.render.build=function(){o=i.utils.standardAxis();o.plots={}};i.render.update=function(t){o.scale={x:i.utils.scale(s.map(function(t){return t.name}).reverse(),[i.attr.innerWidth,0],"point"),y:i.utils.scale(s.map(function(t){return[t.values.min-.1*(t.values.max-t.values.min),t.values.max+.1*(t.values.max-t.values.min)]}).reduce(function(t,e){return t.concat(e)},[]),[i.attr.innerHeight,0])};o.axes.x.transition().duration(t).call(o.axisFn.x.scale(o.scale.x));o.axes.y.transition().duration(t).call(o.axisFn.y.scale(o.scale.y));u=i.utils.colors(s?s.map(function(t){return t.name}):null);o.plots.groups=o.g.selectAll(".box-group").data(s,function(t){return t.name});o.plots.groups.exit().style("opacity",0).remove();var e=o.plots.groups.enter().append("g").attr("class",function(t){return"box-group "+i.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var r=e.merge(o.plots.groups).each(function(){c=true}).on("mouseover",function(t){l=t;i.attr.mouseover&&i.attr.mouseover(t.name)}).on("mouseleave",function(t){l=null;i.attr.mouseleave&&i.attr.mouseleave(t.name)}).on("click",function(t){i.attr.click&&i.attr.click(t.name)});r.transition().duration(t).style("opacity",1).style("fill-opacity",i.attr.opacity).style("fill",function(t){return u[t.name]}).style("stroke",function(t){return u[t.name]}).on("end",function(){c=false});e.append("rect").attr("class","body").attr("x",function(t){return o.scale.x(t.name)-10}).attr("y",function(t){return o.scale.y(t.values.q3)}).attr("width",20).attr("height",function(t){return o.scale.y(t.values.q1)-o.scale.y(t.values.q3)}).style("rx","2px").style("ry","2px").style("fill-opacity",.3).style("stroke-width","1px");r.select(".body").transition().duration(t).attr("x",function(t){return o.scale.x(t.name)-10}).attr("y",function(t){return o.scale.y(t.values.q3)}).attr("width",20).attr("height",function(t){return o.scale.y(t.values.q1)-o.scale.y(t.values.q3)});e.append("line").attr("class","median").attr("x1",function(t){return o.scale.x(t.name)-10}).attr("x2",function(t){return o.scale.x(t.name)+10}).attr("y1",function(t){return o.scale.y(t.values.median)}).attr("y2",function(t){return o.scale.y(t.values.median)}).style("stroke-width","2px").style("fill-opacity",.8);r.select(".median").transition().duration(t).attr("x1",function(t){return o.scale.x(t.name)-10}).attr("x2",function(t){return o.scale.x(t.name)+10}).attr("y1",function(t){return o.scale.y(t.values.median)}).attr("y2",function(t){return o.scale.y(t.values.median)});e.append("path").attr("class","lower-whisker").attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q1)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.lower)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.lower)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.lower)});r.select(".lower-whisker").transition().duration(t).attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q1)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.lower)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.lower)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.lower)});e.append("path").attr("class","upper-whisker").attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q3)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.upper)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.upper)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.upper)});r.select(".upper-whisker").transition().duration(t).attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q3)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.upper)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.upper)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.upper)});r.selectAll(".mild-outlier").transition().duration(t).style("opacity",0).remove();var n=r.selectAll(".mild-outlier").data(function(e){return e.values.outliers.mild.map(function(t){return{x:e.name,y:t}})});n.enter().append("circle").attr("class","mild-outlier").attr("r",2.5).attr("cx",function(t){return o.scale.x(t.x)}).attr("cy",function(t){return o.scale.y(t.y)}).attr("stroke","none").style("opacity",0).transition().duration(t).style("opacity",1);r.selectAll(".extreme-outlier").transition().duration(t).style("opacity",0).remove();var a=r.selectAll(".extreme-outlier").data(function(e){return e.values.outliers.extreme.map(function(t){return{x:e.name,y:t}})});a.enter().append("circle").attr("class","extreme-outlier").attr("r",2).attr("cx",function(t){return o.scale.x(t.x)}).attr("cy",function(t){return o.scale.y(t.y)}).attr("fill","none").attr("stroke-width","0.5px").style("opacity",0).transition().duration(t).style("opacity",1)};i.render.style=function(){i.attr.colors=i.utils.colors(s?s.map(function(t){return t.name}):null);o.g.style("width",i.attr.innerWidth+"px").style("height",i.attr.innerHeight+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");o.axes.x.attr("transform","translate(0,"+i.attr.innerHeight+")");o.axisFn.y.tickFormat(i.attr.yTickFormat);o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",i.attr.innerWidth+"px").attr("y",i.attr.innerHeight+2.2*i.attr.fontSize+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BubbleChart=e(t.d3,t.du.Widget)}})(this,function(t,l){"use strict";function e(t,e){var r=l.call(this,t,"bubblechart","svg",e);r.attr.add(this,"scale",1);r.attr.add(this,"sizeLabel","size");var n={};var a=[];var i={};var o=null;var s=false;this.data=function(t){a=t.map(function(t){return{name:t.name,values:{x:t.x,y:t.y,size:t.size}}});return this};this.highlight=function(t,e){if(!s)r.utils.highlight(this,n,".bubble",t,e);return this};r.utils.tooltip=function(){return o?{title:o.name,stripe:r.attr.colors[o.name],content:{type:"metrics",data:[{label:r.attr.xLabel+":",value:r.attr.tooltipXFormat(o.values.x)},{label:r.attr.yLabel+":",value:r.attr.tooltipYFormat(o.values.y)},{label:r.attr.sizeLabel+":",value:o.values.size.toFixed(1)}]}}:null};r.render.build=function(){n=r.utils.standardAxis();n.plots={}};r.render.update=function(t){n.scale={x:r.utils.scale(a.map(function(t){return[t.values.x-1.1*r.attr.scale*t.values.size,t.values.x+1.1*r.attr.scale*t.values.size]}).reduce(function(t,e){return t.concat(e)},[]),[0,r.attr.innerWidth]),y:r.utils.scale(a.map(function(t){return[t.values.y-1.1*r.attr.scale*t.values.size,t.values.y+1.1*r.attr.scale*t.values.size]}).reduce(function(t,e){return t.concat(e)},[]),[r.attr.innerHeight,0])};n.axes.x.transition().duration(t).call(n.axisFn.x.scale(n.scale.x));n.axes.y.transition().duration(t).call(n.axisFn.y.scale(n.scale.y));i=r.utils.colors(a?a.map(function(t){return t.name}):null);n.plots.bubbles=n.g.selectAll(".bubble").data(a,function(t){return t.name});n.plots.bubbles.exit().transition().duration(t).style("opacity",0).remove();n.plots.bubbles.enter().append("circle").attr("class",function(t){return"bubble "+r.utils.encode(t.name)}).attr("cx",function(t){return n.scale.x(t.values.x)}).attr("cy",function(t){return n.scale.y(t.values.y)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent").merge(n.plots.bubbles).each(function(){s=true}).on("mouseover",function(t){o=t;r.attr.mouseover&&r.attr.mouseover(t.name)}).on("mouseleave",function(t){o=null;r.attr.mouseleave&&r.attr.mouseleave(t.name)}).on("click",function(t){r.attr.click&&r.attr.click(t.name)}).transition().duration(t).attr("r",function(t){return r.attr.scale*t.values.size}).attr("cx",function(t){return n.scale.x(t.values.x)}).attr("cy",function(t){return n.scale.y(t.values.y)}).style("opacity",1).style("fill",function(t){return i[t.name]}).on("end",function(){s=false})};r.render.style=function(){n.g.attr("width",r.attr.innerWidth+"px").attr("height",r.attr.innerHeight+"px").attr("transform","translate("+r.attr.margins.left+","+r.attr.margins.top+")").style("pointer-events","all");n.axes.x.attr("transform","translate(0,"+r.attr.innerHeight+")");n.axisFn.y.tickFormat(r.attr.yTickFormat);n.axes.y.attr("transform","translate(0,"+1+")");n.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");n.labels.x.attr("x",r.attr.innerWidth+"px").attr("y",r.attr.innerHeight+2.2*r.attr.fontSize+"px").attr("fill",r.attr.fontColor).style("font-size",r.attr.fontSize+"px").text(r.attr.xLabel);n.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",r.attr.fontColor).style("font-size",r.attr.fontSize+"px").text(r.attr.yLabel)}}e.prototype=Object.create(l.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ChordChart=e(t.d3,t.du.Widget)}})(this,function(h,y){"use strict";function t(t,e){var n=y.call(this,t,"chordchart","svg",e);n.attr.add(this,"radius",100,"dim");n.attr.add(this,"thickness",10,"dim");n.attr.add(this,"ticks",false);n.attr.add(this,"invert",false);var u={};var o=[];var a=null;var s=h.map();var l=h.map();var r=10;var i=null;var c=false;this.data=function(t){s.clear();l.clear();o=[];var i=0,e=0;t.forEach(function(t){if(!s.has(e=t.source)){l.set(i,e);s.set(e,i++)}if(!s.has(e=t.target)){l.set(i,e);s.set(e,i++)}});t.forEach(function(t){var e=s.get(t.source),r=s.get(t.target),n=o[e];if(!n){n=o[e]=[];for(var a=0;a<i;a++)n[a]=0}n[r]=t.value;if(!o[r]){o[r]=[];for(a=0;a<i;a++)o[r][a]=0}});r=h.max(l.values(),function(t){return t.length});return this};function d(t){return t.source.index<t.target.index?t.source.index+"-"+t.target.index:t.target.index+"-"+t.source.index}function f(t){var a=h.map();if(t){t.groups.forEach(function(t){a.set(t.index,t)})}return function(t){var e;var r=a.get(t.index);if(r){e=h.interpolate(r,t)}else{var n={startAngle:t.startAngle,endAngle:t.startAngle};e=h.interpolate(n,t)}return function(t){return u.arc(e(t))}}}function p(s){var l=h.map();if(s){s.forEach(function(t){l.set(d(t),t)})}return function(e){var r;var t=l.get(d(e));if(t){if(e.source.index!==t.source.index){t={source:t.target,target:t.source}}r=h.interpolate(t,e)}else{if(s){var n=s.groups.filter(function(t){return t.index===e.source.index||t.index===e.target.index});t={source:n[0],target:n[1]||n[0]};if(t.source&&e.source.index!==t.source.index){t={source:t.target,target:t.source}}}else t=e;var a=t.source?t.source.startAngle:0;var i=t.target?t.target.startAngle:0;var o={source:{startAngle:a,endAngle:a},target:{startAngle:i,endAngle:i}};r=h.interpolate(o,e)}return function(t){return u.ribbonFn(r(t))}}}this.highlight=function(t,e){if(!c)n.utils.highlight(this,u,".ribbon",t,e);return this};n.utils.tooltip=function(){if(!a){return null}var r=o[s.get(a.name)];return a?{title:a.name,stripe:n.attr.colors[a.name],content:{type:"metrics",data:r.map(function(t,e){return{name:l.get(e),value:100*t/h.sum(r)}}).sort(function(t,e){return e.value-t.value}).map(function(t){return{label:t.name,value:t.value.toFixed(1)+"%"}})}}:null};n.render.build=function(){u.g=n.widget.append("g");u.chordFn=h.chord().padAngle(.05).sortGroups(h.descending).sortSubgroups(h.descending);u.arc=h.arc();u.ribbonFn=h.ribbon();u.label=u.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};n.render.update=function(t){n.attr.colors=n.utils.colors(s?s.keys():null);var e=n.attr.radius-n.attr.thickness-n.attr.margins.left,r=n.attr.radius-n.attr.margins.left;if(u.groups)u.groups.transition();if(u.newGroups)u.newGroups.transition();if(u.ribbons)u.ribbons.transition();if(u.newRibbons)u.newRibbons.transition();u.chord=u.chordFn(o);u.arc.innerRadius(e).outerRadius(r);u.groups=u.g.selectAll(".group").data(u.chord.groups,function(t){return t.index});u.groups.exit().transition().duration(t).style("opacity",0).remove();u.newGroups=u.groups.enter().append("g").each(function(t){t.name=l.get(t.index)}).attr("class","group").style("pointer-events","all");u.newGroups.merge(u.groups).on("mouseover",function(t){n.attr.mouseover&&n.attr.mouseover(t.name)}).on("mouseleave",function(t){a=null;n.attr.mouseleave&&n.attr.mouseleave(t.name)}).on("click",function(t){n.attr.click&&n.attr.click(t.name)}).on("mousemove",function(t){a=t});u.newGroups.append("path").attr("id",function(t){return"group"+t.index}).style("fill",function(t){return n.attr.colors[t.name]}).transition().duration(t).attrTween("d",f(i));if(n.attr.ticks){u.newGroups.append("text").attr("xlink:href",function(t){return"#group"+t.index}).attr("dy",".35em").text(function(t){return t.name}).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(n.attr.radius-n.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}u.groups.select("path").each(function(t){t.name=l.get(t.index)}).attr("d",u.arc).transition().duration(t).each(function(){c=true}).style("opacity",1).style("fill",function(t){return n.attr.colors[t.name]}).attrTween("d",f(i)).on("end",function(){c=false});if(n.attr.ticks){u.groups.select("text").transition().duration(t).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(n.attr.radius-n.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}u.ribbonFn.radius(e);u.ribbons=u.g.selectAll(".ribbon").data(u.chord,d);u.newRibbons=u.ribbons.enter().append("path").each(function(t){t.source.name=l.get(t.source.index);t.target.name=l.get(t.target.index)}).attr("class",function(t){return"ribbon "+n.utils.encode(t.source.name)}).style("pointer-events","all").style("fill",function(t){return n.attr.colors[n.attr.invert?t.source.name:t.target.name]}).style("stroke-width","1px").style("fill-opacity",.8).style("stroke-opacity",.8).style("stroke","white");u.newRibbons.transition().duration(t).attrTween("d",p(null));u.ribbons.exit().transition().duration(t).style("opacity",0).remove();u.ribbons.each(function(t){t.source.name=l.get(t.source.index);t.target.name=l.get(t.target.index)}).attr("class",function(t){return"ribbon "+n.utils.encode(t.source.name)}).transition().duration(t).style("opacity",1).style("fill",function(t){return n.attr.colors[n.attr.invert?t.source.name:t.target.name]}).attrTween("d",p(i));i=u.chord};n.render.style=function(){n.attr.width=2*n.attr.radius;n.attr.height=2*n.attr.radius;n.widget.style("width",n.attr.width+"px").style("height",n.attr.height+"px");u.g.attr("transform","translate("+n.attr.radius+","+n.attr.radius+")");if(n.attr.ticks){u.newGroups.selectAll("text").style("font-size",n.attr.fontSize*.8+"px").style("font-weight",n.attr.fontWeight).style("fill",n.attr.fontColor)}u.label.attr("transform","translate(0,"+n.attr.radius+")").style("width",2*(n.attr.radius+n.attr.thickness)+"px").attr("font-size",n.attr.fontSize+"px").style("fill",n.attr.fontColor).text(n.attr.label)}}t.prototype=Object.create(y.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Grid=e(t.d3,t.du.Widget)}})(this,function(p,i){"use strict";function t(t,s){var l=i.call(this,t,"grid","div",s);var r=l.attr.x;var n=l.attr.y;var u=1;var c=1;var d=[];var f=[];var a=false;function e(){d.forEach(function(t){t.forEach(function(t){if(t){t.remove()}})});d=[];for(var t=0;t<c;t++){d.push([]);for(var e=0;e<u;e++){d[t].push(null)}}}this.x=function(t,e){l.attr.x=e!=="%"?t:window.innerWidth*t/100;r=l.attr.x;return this};this.y=function(t,e){l.attr.y=e!=="%"?t:window.innerHeight*t/100;n=l.attr.y;return this};this.rows=function(t){u=t;e();return this};this.cols=function(t){c=t;e();return this};this.show=function(t){if(t){a=true;l.widget.style("box-shadow","0 0 1px black inset");for(var e=1;e<u;e++){l.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*l.attr.height/u-1.5+"px").style("width",l.attr.width+"px").style("height","3px").style("background-color","white")}for(var r=1;r<c;r++){l.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*l.attr.width/c-1.5+"px").style("top","0").style("width","3px").style("height",l.attr.height+"px").style("background-color","white")}for(e=1;e<u;e++){l.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*l.attr.height/u-.5+"px").style("width",l.attr.width+"px").style("height","1px").style("background-color","black")}for(r=1;r<c;r++){l.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*l.attr.width/c-.5+"px").style("top","0").style("width","1px").style("height",l.attr.height+"px").style("background-color","black")}}else{a=false;l.widget.style("border",null);l.widget.selectAll(".grid-border-h").remove();l.widget.selectAll(".grid-border-v").remove()}return this};this.add=function(t,e,r,n,a){if(e<0||n<1||e+n>c||r<0||a<1||r+a>u){t.remove();return null}for(var i=e;i<e+n;i++){if(d[i]){for(var o=r;o<r+a;o++){if(d[i][o]){t.remove();return null}}}}f.push({x:e,y:r,width:n,height:a,widget:t});for(i=e;i<e+n;i++){for(o=r;o<r+a;o++){d[i][o]=t}}p.select("#"+this.id()).node().appendChild(p.select("#"+t.id()).node());t.x(e*l.attr.width/c+l.attr.x+l.attr.margins.left).y(r*l.attr.height/u+l.attr.y+p.select(s).attr("top")+l.attr.margins.left).width(n*l.attr.width/c-2*l.attr.margins.left).height(a*l.attr.height/u-2*l.attr.margins.left).render();return t};this.get=function(t,e){if(d[e]&&d[e][t]){return d[e][t].widget}else{return null}};l.render.style=function(){l.widget.style("position","absolute").style(l.attr.x>0?"left":"right",Math.abs(l.attr.x)+l.attr.xDim).style(l.attr.y>0?"top":"bottom",Math.abs(l.attr.y)+l.attr.yDim).style("width",l.attr.width+"px").style("height",l.attr.height+"px");l.widget.selectAll(".grid-border-h").style("top",function(){return p.select(this).attr("data-y")*l.attr.height/u-1+"px"}).style("width",l.attr.width+"px");l.widget.selectAll(".grid-border-v").style("left",function(){return p.select(this).attr("data-x")*l.attr.width/c-1+"px"}).style("height",l.attr.height+"px");f.forEach(function(t){t.widget.x(t.x*l.attr.width/c+l.attr.x+l.attr.margins.left).y(t.y*l.attr.height/u+l.attr.y+l.attr.margins.left).width(t.width*l.attr.width/c-2*l.attr.margins.left).height(t.height*l.attr.height/u-2*l.attr.margins.left).render(0)})}}t.prototype=Object.create(i.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Hint=e(t.d3,t.du.Widget)}})(this,function(c,d){"use strict";var t=function(){var l={};function u(){for(var t in l){if(l.hasOwnProperty(t)){delete l[t]}}l={}}function t(t,e){var r="du-widgets-hint-";var n=r+t;var a=r+"css";var i=r+"class";if(l.hasOwnProperty(n)){return l[n]}else{var o=d.call(this,t,"hint","div",e);var s=this}o.attr.add(this,"text","");o.attr.add(this,"pin",false);try{if(c.select("#"+a).empty()){c.select("head").append("style").attr("id",a).text("."+i+":after{content:' ';position:absolute;width:0;height:0;left:20.5px;bottom:-10px;border:7px solid;border-color:#000 transparent transparent #000;}")}window.addEventListener("mousemove",function(){c.selectAll("."+i+".removable").remove();u()})}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}o.render.build=function(){o.widget.attr("class",i).style("position","absolute").style("display","block").style("padding","15px").style("text-align","center").style("line-height","1.1em").style("background-color","black").style("border-radius","4px").style("color","white").style("font-size","0.9em").style("font-weight","bold").style("pointer-events","none");if(!o.attr.pin){o.widget.classed("removable",true)}};o.render.style=function(t){o.widget.style("width","auto").style("height",null).html(o.attr.text);if(!l[n]){o.widget.style("opacity",0).transition().duration(t).style("opacity",1);if(!o.attr.pin){l[n]=s}}}}return t}();t.prototype=Object.create(d.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=e(t.d3,t.du.Widget)}})(this,function(y,r){"use strict";function t(t,e){var u=r.call(this,t,"histogram","svg",e);u.attr.add(this,"min",null);u.attr.add(this,"max",null);u.attr.add(this,"bin",null);u.attr.add(this,"binnedData",false);u.attr.add(this,"normalize",false);var c={};var d=[];var f=[];var p={};var h=false;this.data=function(t){d=t;return this};this.highlight=function(t,e){if(!h)u.utils.highlight(this,c,".bar",t,e);return this};u.utils.tooltip=function(t){var e=y.bisector(function(t){return c.scale.x(t.values.x0)}).right;var r=t?e(f,t[0]):null;if(r===null){return}var n=f[r-1]?f[r-1]:f[r];var a=f[r]?f[r]:f[r-1];var i=t[0]-n.x1>a.x0-t[0]?a:n;return{title:i.name,content:{type:"metrics",data:[{label:"min:",value:i.values.x0.toPrecision(3)},{label:"max:",value:i.values.x1.toPrecision(3)},{label:"count:",value:i.values.size.toPrecision(2)},{label:"fraction:",value:(100*i.values.size/y.sum(f,function(t){return t.values.size})).toFixed(2)+"%"}]}}};u.render.build=function(){c=u.utils.standardAxis();c.plots={}};u.render.update=function(t){if(d.length===0){return}else{var e=u.attr.binnedData?d.sort(function(t,e){return t.x-e.x}):d.sort(function(t,e){return t-e})}if(u.attr.binnedData){var r=y.min(e,function(t){return t.x});var n=e[1].x-e[0].x;var a=e.length;f=e.map(function(t,e){var r={x0:t.x,x1:t.x+n,size:t.y};return{name:"bin "+e,values:r}});var i=u.attr.normalize?e.reduce(function(t,e){return t+e.y},0):1}else{r=typeof u.attr.min==="number"?u.attr.min:e[0];var o=typeof u.attr.max==="number"?u.attr.max:e[e.length-1];n=typeof u.attr.bin==="number"?u.attr.bin:2*(y.quantile(e,.75)-y.quantile(e,.25))/Math.pow(e.length,1/3);var s=[];a=Math.ceil((o-r)/n);for(var l=0;l<=a;l++){s.push(r+l*n)}i=u.attr.normalize?e.length:1;f=y.histogram().domain([r,r+a*n]).thresholds(s)(e).map(function(t,e){t.size=t.length;return{name:"bin "+e,values:t}})}c.scale={x:u.utils.scale([r,r+a*n],[0,u.attr.innerWidth]),y:u.utils.scale([0,y.max(f,function(t){return t.values.size/i})],[u.attr.innerHeight,0])};c.axes.x.transition().duration(t).call(c.axisFn.x.scale(c.scale.x));c.axes.y.transition().duration(t).call(c.axisFn.y.scale(c.scale.y));p=u.utils.colors(f?f.map(function(t){return t.name}):null);c.plots.bars=c.g.selectAll(".bar").data(f,function(t){return t.name});c.plots.bars.exit().transition().duration(t).style("height",0).remove();c.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+u.utils.encode(t.name)}).attr("x",function(t){return c.scale.x(t.values.x0)+1}).attr("y",u.attr.height-u.attr.margins.top-u.attr.margins.bottom-1).attr("width",function(t){return Math.max(0,Math.abs(c.scale.x(t.values.x1)-c.scale.x(t.values.x0))-2)}).attr("height",0).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none").style("fill",function(){return p[f[0].name]}).merge(c.plots.bars).each(function(){h=true}).on("mouseover",function(t){u.attr.mouseover&&u.attr.mouseover(t.name)}).on("mouseleave",function(t){u.attr.mouseleave&&u.attr.mouseleave(t.name)}).on("click",function(t){u.attr.click&&u.attr.click(t.name)}).transition().duration(t).attr("x",function(t){return c.scale.x(t.values.x0)+1}).attr("y",function(t){return u.attr.margins.top-u.attr.margins.top+c.scale.y(t.values.size/i)}).attr("width",function(t){return Math.max(0,Math.abs(c.scale.x(t.values.x1)-c.scale.x(t.values.x0))-2)}).attr("height",function(t){return u.attr.height-u.attr.margins.top-u.attr.margins.bottom-c.scale.y(t.values.size/i)}).style("opacity",1).style("fill",function(){return p[f[0].name]}).on("end",function(){h=false})};u.render.style=function(){c.g.style("width",u.attr.innerWidth+"px").style("height",u.attr.innerHeight+"px").attr("transform","translate("+u.attr.margins.left+","+u.attr.margins.top+")").style("pointer-events","all");c.axisFn.y.tickFormat(u.attr.yTickFormat);c.axes.x.attr("transform","translate(0,"+u.attr.innerHeight+")");c.axes.y.attr("transform","translate(0,"+1+")");c.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof u.attr.xTickAngle==="number"){c.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+u.attr.xTickAngle+")").style("text-anchor","start")}c.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");c.labels.x.attr("x",u.attr.innerWidth+"px").attr("y",u.attr.innerHeight+2.2*u.attr.fontSize+"px").style("font-size",u.attr.fontSize+"px").style("fill",u.attr.fontColor).text(u.attr.xLabel);c.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",u.attr.fontSize+"px").style("fill",u.attr.fontColor).text(u.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.InfoBox=e(t.d3,t.du.Widget)}})(this,function(i,o){"use strict";var t=function(){var a=null;function t(){if(a){a.remove()}var e=o.call(this,"infobox","infobox","div");a=e.widget;e.attr.add(this,"content","");e.attr.add(this,"backgroundColor","#fff");var r=null;var n=null;e.render.build=function(t){e.widget.style("display","none").style("opacity",0).on("click",function(){i.select(this).transition().duration(t).style("opacity",0).on("end",function(){a.remove()})});r=e.widget.append("div").style("position","absolute").style("top",0).style("left","50%").style("width","50%").style("padding","20px").style("margin-left","calc(-25% - 10px)").style("margin-top","100px").style("box-shadow","1px 1px 4px grey").style("border-radius","3px");n=r.append("div").style("padding","10px").style("min-height","100px").style("font-size","14pt").style("text-align","left").style("overflow","scroll")};e.render.style=function(){var t=i.color("white");e.widget.style("width","100%").style("height","100%").style("top","0").style("left","0").style("pointer-events","all").style("background-color","rgba("+t.rgb().r+","+t.rgb().g+","+t.rgb().b+",0.9)");r.style("background-color",e.attr.backgroundColor);n.style("color",e.attr.fontColor).html(e.attr.content);e.widget.style("display","block").transition().duration(400).style("opacity",1)}}return t}();t.prototype=Object.create(o.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Label=e(t.d3,t.du.Widget)}})(this,function(t,a){"use strict";function e(t,e){var r=a.call(this,t,"label","div",e);r.attr.add(this,"align","center");var n={};r.render.build=function(){n.g=r.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");n.label=n.g.append("div").style("display","table-cell").style("vertical-align","middle").style("pointer-events","none").html(r.attr.label)};r.render.style=function(){n.label.style("color",r.attr.fontColor).style("font-size",r.attr.fontSize+"px").style("font-weight",r.attr.fontWeight).style("text-align",r.attr.align)}}e.prototype=Object.create(a.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Legend=e(t.d3,t.du.Widget)}})(this,function(t,r){"use strict";function e(t,e){var a=r.call(this,t,"legend","div",e);a.attr.add(this,"labels",[]);a.attr.add(this,"twoColumns",false);var i={};this.highlight=function(t,e){return a.utils.highlight(this,i,".legend-entry",t,e)};a.render.build=function(){i.g=a.widget.append("div").style("display","block").style("position","relative");i.legends={};a.attr.labels.forEach(function(t){var e=i.g.append("div").attr("class","legend-entry "+a.utils.encode(t)).style("display","inline-block").style("position","relative").style("width","100%").style("margin-bottom","6px").style("vertical-align","top").style("pointer-event","all");var r=e.append("div").style("display","inline-block").style("position","relative").style("float","left");var n=e.append("div").style("display","inline-block").style("position","relative").style("float","right").style("text-align","left").text(t);i.legends[t]={g:e,square:r,text:n}})};a.render.style=function(){a.attr.colors=a.utils.colors(a.attr.labels);i.g.style("width",a.attr.width+"px").style("height",a.attr.height+"px").style("pointer-events","all");for(var t in i.legends){if(i.legends.hasOwnProperty(t)){(function(t){var e=i.legends[t];e.g.style("width",a.attr.twoColumns?"50%":"100%");e.square.style("width",.7*a.attr.fontSize+"px").style("height",.7*a.attr.fontSize+"px").style("margin",.15*a.attr.fontSize+"px "+.15*a.attr.fontSize+"px").style("background-color",a.attr.colors[t]);if(a.attr.mouseover){e.square.style("cursor","pointer").on("mouseover",function(){a.attr.mouseover(t)})}if(a.attr.mouseleave){e.square.on("mouseleave",function(){a.attr.mouseleave(t)})}if(a.attr.click){e.square.style("cursor","pointer").on("click",function(){a.attr.click(t)})}e.text.style("width","calc(100% - "+1.2*a.attr.fontSize+"px)").style("line-height",a.attr.fontSize+"px").style("cursor",a.attr.mouseover||a.attr.click?"pointer":null).style("font-size",a.attr.fontSize+"px").on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(t)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(t)}).on("click",function(){a.attr.click&&a.attr.click(t)})})(t)}}}}e.prototype=Object.create(r.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.LineChart=e(t.d3,t.du.Widget)}})(this,function(y,r){"use strict";function t(t,e){var d=r.call(this,t,"linechart","svg",e);d.attr.add(this,"xMin",null);d.attr.add(this,"xMax",null);d.attr.add(this,"xType","number");var f={};var p=[];var l=false;var h={};var u={};this.data=function(t){p=t.map(function(t){return{name:t.name,values:t.values.sort(function(t,e){return t.x-e.x}).map(function(t){return{x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}})}});return this};this.highlight=function(t,e){if(!l){d.utils.highlight(this,f,".line",t,e);d.utils.highlight(this,f,".error",t,e);d.utils.highlight(this,f,".marker",t,e)}return this};function c(e,t,r){var n=p.filter(function(t){return t.name===e})[0];if(!n){return null}var a=y.bisector(function(t){return t.x}).left;var i=a(n.values,t);var o=a(n.values,r);if(i===null||o===null){return null}var s=n.values[i].x,l=n.values[i].y,u=n.values[o].x,c=n.values[o].y;var d=l<c?s:u;var f=l<c?c:l;return{start:{x:s,y:l},end:{x:u,y:c},corner:{x:d,y:f}}}this.addMarker=function(t,r,n,a,e){if(u.hasOwnProperty(t)){return null}var i=c(r,n,a);var o=f.g.append("g").attr("class","marker "+d.utils.encode(r));o.append("line").attr("class","horizontal").attr("x1",f.scale.x(Math.max(i.start.x,d.attr.xMin?d.attr.xMin:i.start.x))+2).attr("y1",f.scale.y(i.corner.y)).attr("x2",f.scale.x(Math.min(i.end.x,d.attr.xMax?d.attr.xMax:i.end.x))+2).attr("y2",f.scale.y(i.corner.y)).style("stroke",h[r]).style("stroke-dasharray","3 3").style("stroke-width",1);o.append("line").attr("class","vertical").attr("x1",f.scale.x(i.corner.x)+2).attr("y1",f.scale.y(i.start.y)).attr("x2",f.scale.x(i.corner.x)+2).attr("y2",f.scale.y(i.end.y)).style("stroke",h[r]).style("stroke-dasharray","3 3").style("stroke-width",1);o.append("circle").attr("class","start").attr("cx",f.scale.x(i.start.x)+2).attr("cy",f.scale.y(i.start.y)).attr("r",4).style("stroke","none").style("fill",h[r]);o.append("circle").attr("class","end").attr("cx",f.scale.x(i.end.x)+2).attr("cy",f.scale.y(i.end.y)).attr("r",4).style("stroke","none").style("fill",h[r]);o.append("text").attr("x",f.scale.x(i.corner.x)+2).attr("y",f.scale.y(i.corner.y)).attr("dy",-5).attr("text-anchor",i.start.y<i.end.y?"start":"end").style("fill",d.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").text(e);var s={key:r,g:o,update:function(t){var e=c(r,n,a);o.select(".horizontal").transition().duration(t).attr("x1",f.scale.x(Math.max(e.start.x,d.attr.xMin?d.attr.xMin:e.start.x))+2).attr("y1",f.scale.y(e.corner.y)).attr("x2",f.scale.x(Math.min(e.end.x,d.attr.xMax?d.attr.xMax:e.end.x))+2).attr("y2",f.scale.y(e.corner.y)).style("stroke",h[this.key]);o.select(".vertical").transition().duration(t).attr("x1",f.scale.x(e.corner.x)+2).attr("y1",f.scale.y(e.start.y)).attr("x2",f.scale.x(e.corner.x)+2).attr("y2",f.scale.y(e.end.y)).style("stroke",h[this.key]);o.select(".start").transition().duration(t).attr("cx",f.scale.x(e.start.x)+2).attr("cy",f.scale.y(e.start.y)).style("fill",h[this.key]);o.select(".end").transition().duration(t).attr("cx",f.scale.x(e.end.x)+2).attr("cy",f.scale.y(e.end.y)).style("fill",h[this.key]);o.select("text").transition().duration(t).attr("x",f.scale.x(e.corner.x)+2).attr("y",f.scale.y(e.corner.y)).attr("text-anchor",e.start.y<e.end.y?"start":"end").style("fill",d.attr.fontColor)}};u[t]=s;return s};this.removeMarker=function(t){if(u.hasOwnProperty(t)){u[t].g.remove();delete u[t];return true}return false};d.utils.tooltip=function(s){var e=y.bisector(function(t){return f.scale.x(t.x)}).left;var l=s?p.map(function(t){return e(t.values,s[0])}):null;if(l===null){for(var t in this.tt){if(this.tt.hasOwnProperty(t))this.tt[t].remove()}this.tt=null;return}else{this.tt=this.tt||{};var u=this.tt}var c=f.scale.x.invert(s[0]);var r=p.map(function(t,e){var r=l[e];var n=t.values;var a=n[r-1]?n[r-1]:n[r];var i=n[r]?n[r]:n[r-1];var o=s[0]-a.x>i.x-s[0]?i:a;u[t.name]=u[t.name]||f.g.append("circle");u[t.name].attr("cx",f.scale.x(o.x)+2).attr("cy",f.scale.y(o.y)).attr("r",4).style("fill",h[t.name]);c=o.x;return{name:t.name,color:h[t.name],value:d.attr.tooltipYFormat(o.y)}});return{title:d.attr.xLabel+": "+d.attr.tooltipXFormat(c),content:{type:"plots",data:r}}};d.render.build=function(){f=d.utils.standardAxis();f.plots={}};d.render.update=function(t){var e=p.map(function(t){return{name:t.name,values:t.values.filter(function(t){return(d.attr.xMax===null||t.x<=d.attr.xMax)&&(d.attr.xMin===null||t.x>=d.attr.xMin)})}});var r=e.reduce(function(t,e){return t.concat(e.values)},[]);var n=y.min(r,function(t){return t.y});var a=y.max(r,function(t){return t.y});f.scale={x:d.utils.scale(e.reduce(function(t,e){return t.concat(e.values)},(d.attr.xMin?[{x:d.attr.xMin}]:[]).concat(d.attr.xMax?[{x:d.attr.xMax}]:[])).map(function(t){return t.x}),[0,d.attr.innerWidth]),y:d.utils.scale(e.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[d.attr.innerHeight,0])};var i=y.line().x(function(t){return f.scale.x(t.x)+2}).y(function(t){return f.scale.y(t.y)});var o=y.area().x(function(t){return f.scale.x(t.x)+2}).y0(function(t){return f.scale.y(Math.max(t.y-t.lo,n))}).y1(function(t){return f.scale.y(Math.min(t.y+t.hi,a))});f.axes.x.transition().duration(t).call(f.axisFn.x.scale(f.scale.x));f.axes.y.transition().duration(t).call(f.axisFn.y.scale(f.scale.y));h=d.utils.colors(p?p.map(function(t){return t.name}):null);f.plots.errors=f.g.selectAll(".error").data(e,function(t){return t.name});f.plots.errors.exit().transition().duration(t).style("opacity",0).remove();f.plots.errors=f.plots.errors.enter().append("path").attr("class",function(t){return"error "+d.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("stroke","none").style("fill","transparent").merge(f.plots.errors).each(function(){l=true}).on("mouseover",function(t){d.attr.mouseover&&d.attr.mouseover(t.name)}).on("mouseleave",function(t){d.attr.mouseleave&&d.attr.mouseleave(t.name)}).on("click",function(t){d.attr.click&&d.attr.click(t.name)}).transition().duration(t).attr("d",function(t){return o(t.values)}).style("opacity",1).style("fill-opacity",.2).style("fill",function(t){return h[t.name]});f.plots.lines=f.g.selectAll(".line").data(e,function(t){return t.name});f.plots.lines.exit().transition().duration(t).style("opacity",0).remove();f.plots.lines.enter().append("path").attr("class",function(t){return"line "+d.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","none").merge(f.plots.lines).each(function(){l=true}).on("mouseover",function(t){d.attr.mouseover&&d.attr.mouseover(t.name)}).on("mouseleave",function(t){d.attr.mouseleave&&d.attr.mouseleave(t.name)}).on("click",function(t){d.attr.click&&d.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("d",function(t){return i(t.values)}).style("stroke-width","2px").style("stroke",function(t){return h[t.name]}).on("end",function(){l=false});for(var s in u){if(u.hasOwnProperty(s)){u[s].update(t)}}};d.render.style=function(){f.g.attr("width",d.attr.innerWidth+"px").attr("height",d.attr.innerHeight+"px").attr("transform","translate("+d.attr.margins.left+","+d.attr.margins.top+")").style("pointer-events","all");f.axes.x.attr("transform","translate(0,"+d.attr.innerHeight+")");f.axisFn.y.tickFormat(d.attr.yTickFormat);f.axes.y.attr("transform","translate(0,"+1+")");f.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");f.labels.x.attr("x",d.attr.innerWidth+"px").attr("y",d.attr.innerHeight+2.2*d.attr.fontSize+"px").style("fill",d.attr.fontColor).style("font-size",d.attr.fontSize+"px").text(d.attr.xLabel);f.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",d.attr.fontColor).style("font-size",d.attr.fontSize+"px").text(d.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("topojson"),require("leaflet"),require("./math.la"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","_","topojson","leaflet","src/math.la","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Map=e(t.d3,t._,t.topojson,t.L,t.du.math.la,t.du.Widget)}})(this,function(C,f,c,s,P,n){"use strict";function t(t,e){var x="du-widgets-map";var A=n.call(this,t,"map","div",e);var b=this;A.attr.add(this,"resource",null);A.attr.add(this,"centerX",0);A.attr.add(this,"centerY",0);A.attr.add(this,"backgroundColor","white");A.attr.add(this,"foregroundColor","black");A.attr.add(this,"borderColor","white");A.attr.add(this,"outClick",null);A.attr.add(this,"tiles",null);A.attr.add(this,"noZoom",false);A.attr.add(this,"ready",null);var v=function(){var n=null;var a=null;var i=C.map();function t(e){C.json(A.attr.resource,function(t,r){n=c.feature(r.paths,r.paths["objects"]["countries"]).features;n.filter(function(e){return r.info.some(function(t){if(e.id===t.id)return e.name=t.name})}).sort(function(t,e){return t.name.localeCompare(e.name)});a=C.map();r.info.forEach(function(t){a.set(t.name,{name:t.name,capital:t.capital,population:t.population})});n.forEach(function(t,e){i.set(t.name,e)});e&&e()})}function e(t){return i.has(t)?i.get(t):null}function r(){return n.map(function(t){return{id:t.id,name:t.name}})}function o(t){return t&&a.has(t)?a.get(t).capital:a.values().map(function(t){return{name:t.name,capital:t.capital}})}function s(t){return t&&a.has(t)?a.get(t).population:a.values().map(function(t){return{name:t.name,population:t.population}})}function l(t,e){var r,n,a,i,o,s=t[0],l=t[1],u=false;for(var c=0,d=e.length-1;c<e.length;d=c++){r=e[c][0];a=e[c][1];n=e[d][0];i=e[d][1];o=a>l!==i>l&&s<(n-r)*(l-a)/(i-a)+r;if(o)u=!u}return u}function u(t,e){var r=v._id(t);if(r){var n=_._project(e);var a=v._paths()[r].svg.areas;for(var i=0;i<a.length;i++){if(l(n,a[i])){return true}}}return false}return{_paths:function(){return n},_id:e,_build:t,get:r,capital:o,population:s,containsGeoLoc:u}}();this.countries={get:v.get,capital:v.capital,population:v.population,containsGeoLoc:v.containsGeoLoc};var r=function(){var r={};function a(t,e){return A.utils.encode(t)+"__"+A.utils.encode(e)}function t(t){if(t&&r.hasOwnProperty(t)){return Object.keys(r[t])}else{return Object.keys(r)}}function e(t,e){if(!r.hasOwnProperty(t)){r[t]=e;return true}else{return false}}function n(n){if(r.hasOwnProperty(n)){f.forOwn(r[n],function(t,e){var r=a(n,e);t.forEach(function(t){if(typeof v._id(t)==="number"){_._select(t).classed(r,false)}})});return true}else{return false}}function i(){f.forOwn(r,function(t,n){f.forOwn(t,function(t,e){var r=a(n,e);t.forEach(function(t){if(typeof v._id(t)==="number"){_._select(t).classed(r,true)}})})})}return{get:t,add:e,remove:n,selector:a,_mark:i}}();this.clustering={get:r.get,add:r.add,remove:r.remove,selector:r.selector};var O=function(){var s=128;var t=.3;var l={};var e=C.zoomIdentity;var r=1;var u=C.zoom().scaleExtent([1,s]).on("zoom",d);function n(t){return e.apply(t)}function a(t){return e.invert(t)}function i(){return r}function o(){u.translateExtent([[-t*A.attr.width,-t*A.attr.height],[(1+t)*A.attr.width,(1+t)*A.attr.height]])}function c(t,e){l[t]=e}function d(){if(A.attr.noZoom){return}var t=C.event.transform.k;l.map.paths.style("stroke-width",.5/t+"px");l.map.paths.attr("transform",C.event.transform);g._zoom(C.event.transform);y._zoom(C.event.transform);m._zoom(C.event.transform);w._zoom(C.event.transform);if(C.event&&C.event.transform){e=C.zoomIdentity.translate(C.event.transform.x,C.event.transform.y).scale(C.event.transform.k);r=C.event.transform.k}}function f(){l.map.svg.transition().duration(1e3).call(u.transform,C.zoomIdentity)}function p(t){var e=t[1][0]-t[0][0],r=t[1][1]-t[0][1],n=(t[0][0]+t[1][0])/2,a=(t[0][1]+t[1][1])/2,i=Math.max(1,Math.min(s,.8/Math.max(e/A.attr.width,r/A.attr.height))),o=[A.attr.width/2-i*n,A.attr.height/2-i*a];l.map.svg.transition().duration(1e3).call(u.transform,C.zoomIdentity.translate(o[0],o[1]).scale(i))}function h(){return e}return{init:o,setLayer:c,zoom:u,reset:f,click:p,transform:n,invert:a,level:i,current:h}}();var _=function(){var t=A.widget.append("svg").attr("id",x+"-map-layer").style("position","absolute").call(O.zoom);var e=t.append("rect").attr("id","water").style("position","absolute").style("width","100%").style("height","100%").style("fill","transparent").style("top",0).style("left",0);var r=t.append("g").attr("id","land");var i=null;var o=C.geoMercator().precision(.1);var s=C.geoPath().projection(o);var n=null;function a(t){return o([t[1],t[0]])}function l(t){return o.invert(t).reverse()}function u(){v._paths().forEach(function(t){t.svg.center=s.centroid(t)})}function c(){v._paths().forEach(function(r){var n=[];var a=[];var t=r.geometry.coordinates;if(t.length===1){t[0].forEach(function(t){var e=o(t);n.push(Math.abs(e[0]-r.svg.center[0]));a.push(Math.abs(e[1]-r.svg.center[1]))})}else{t.forEach(function(t){t[0].forEach(function(t){var e=o(t);n.push(Math.abs(e[0]-r.svg.center[0]));a.push(Math.abs(e[1]-r.svg.center[1]))});if(t.length>1){t.forEach(function(t){var e=o(t);n.push(Math.abs(e[0]-r.svg.center[0]));a.push(Math.abs(e[1]-r.svg.center[1]))})}})}r.svg.width=C.max(n)*2;r.svg.height=C.max(a)*2})}function d(){v._paths().forEach(function(r){r.svg.areas=null;if(r.geometry.coordinates.length===1){var e=[];r.geometry.coordinates[0].forEach(function(t){e.push(o(t))});r.svg.areas=[e]}else{r.svg.areas=[];r.geometry.coordinates.forEach(function(t){var e=[];if(t.length>1){t.forEach(function(t){e.push(o(t))})}else{t[0].forEach(function(t){e.push(o(t))})}r.svg.areas.push(e)})}})}function f(){i=r.selectAll("path").data(v._paths()).enter().append("path").attr("class",function(t){return"country-"+v._id(t.name)}).style("stroke-width","0.5px").style("cursor","pointer");p();h()}function p(){if(i===null){return}o.scale(A.attr.width/(2*Math.PI)).translate([A.attr.width/2+A.attr.centerX,A.attr.height/2+A.attr.centerY]);s=C.geoPath().projection(o);v._paths().forEach(function(t){t.svg={}});u();c();d()}function h(){if(i===null){return}t.attr("width",A.attr.width+"px").attr("height",A.attr.height+"px");e.style("fill",A.attr.backgroundColor).style("width",A.attr.width+"px").style("height",A.attr.height+"px").on("click",function(){O.reset();i.classed("focus",false).style("fill",function(t){return A.attr.colors&&A.attr.colors[t.name]?A.attr.colors[t.name]:A.attr.foregroundColor});if(A.attr.outClick)A.attr.outClick()});i.attr("d",s).style("fill",function(t){return A.attr.colors&&A.attr.colors[t.name]?A.attr.colors[t.name]:A.attr.foregroundColor}).style("stroke",A.attr.borderColor).style("cursor","pointer").on("mouseover",function(t,e){C.select(this).style("fill",C.color(A.attr.colors&&A.attr.colors[t.name]?A.attr.colors[t.name]:A.attr.foregroundColor).brighter());A.attr.mouseover&&A.attr.mouseover(t.name)}).on("mouseleave",function(t,e){var r=C.select(this);var n=C.color(A.attr.colors&&A.attr.colors[t.name]?A.attr.colors[t.name]:A.attr.foregroundColor);r.style("fill",r.classed("focus")?n.brighter():n);A.attr.mouseleave&&A.attr.mouseleave(t.name)}).on("click",function(e,t){var r=C.select(this);var n=r.classed("focus");if(n)O.reset();else{O.click(s.bounds(e))}i.classed("focus",function(t){return t===e?!n:false}).style("fill",function(t){return A.attr.colors&&A.attr.colors[t.name]?A.attr.colors[t.name]:A.attr.foregroundColor});var a=C.color(A.attr.colors&&A.attr.colors[e.name]?A.attr.colors[e.name]:A.attr.foregroundColor);r.style("fill",!n?a.brighter():a);A.attr.click&&A.attr.click(e.name)});O.setLayer("map",{svg:t,paths:i,labels:n})}function y(t){if(typeof t==="string"){return v._id(t)?r.select("path.country-"+v._id(t)):r.selectAll("path."+A.utils.encode(t))}else{return i}}function g(t){i.style("opacity",t?t:1);return b}function m(r,n,t){y(r).transition().duration(t?t:0).style("fill",function(t){var e=A.attr.colors&&A.attr.colors[t.name]?A.attr.colors[t.name]:A.attr.foregroundColor;return typeof n==="string"?n:typeof r==="string"?C.color(e).brighter():e});return b}return{_select:y,_project:a,_invert:l,_build:f,_update:p,_style:h,dim:g,highlight:m}}();this.dim=_.dim;this.highlight=_.highlight;var y=function(){var l=A.widget.append("div").attr("id",x+"-static-layers").style("position","absolute").style("pointer-events","none").style("width",A.attr.width+"px").style("height",A.attr.height+"px");var v={};function u(t,e,r){return[e[0]*t[0]+r[0],e[1]*t[1]+r[1]]}function t(){return Object.keys(v)}function e(t){var s=A.utils.encode(t);if(!v.hasOwnProperty(s)){v[s]=function(){var t=l.append("canvas").attr("id",x+"-static-layer-"+s).attr("width",A.attr.width+"px").attr("height",A.attr.height+"px").style("position","absolute").style("pointer-events","none");var h=t.node().getContext("2d");var a=[];function e(t,e){i[t](e);a.push({type:t,params:e});return true}function r(t,e){var r=[1/t,1/t],n=[A.attr.centerX*(t-1)/t,(A.attr.height*(t-e)/2+A.attr.centerY*(t-1))/t];a.forEach(function(t){switch(t.type){case"dot":case"circle":t.params.pos=u(t.params.pos,r,n);break;case"arrow":for(var e=0;e<t.params.segments.length;e++){t.params.segments[e]=new P.Vector2(u(t.params.segments[e].toArray(),r,n))}break}})}function n(){a=[]}var i={dot:function(t,e){if(t.color)h.fillStyle=t.color;var r=t.size/(e?O.level():1);var n=!e?O.transform(t.pos):t.pos;h.fillRect(n[0]-r/2,n[1]-r/2,r,r)},circle:function(t,e){if(t.color)h.fillStyle=t.color;var r=t.radius/(e?O.level():1);var n=!e?O.transform(t.pos):t.pos;h.beginPath();h.arc(n[0],n[1],r,0,2*Math.PI,false);h.fill()},arrow:function(t,e){if(t.color)h.strokeStyle=t.color;var r=t.width/(e?O.level():1);var n=[];t.segments.forEach(function(t){n.push(!e?t.map(O.transform):t)});var a=r*2;var i=r*5;var o=n[n.length-2];var s=n[n.length-1];var l=s.sub(o).length(i);h.beginPath();h.lineWidth=r;h.lineJoin="round";h.moveTo(n[0].x(),n[0].y());for(var u=1;u<n.length-1;u++){if(n[u].sub(n[u-1]).length()<.6*A.attr.width)h.lineTo(n[u].x(),n[u].y());else h.moveTo(n[u].x(),n[u].y())}var c=s.sub(l.length(.5*i));h.lineTo(c.x(),c.y());h.stroke();var d=l.angle(l.angle()+Math.PI/2).length(a);var f=s.sub(l).sub(d);var p=s.sub(l).add(d);h.beginPath();h.moveTo(f.x(),f.y());h.lineTo(p.x(),p.y());h.lineTo(s.x(),s.y());h.closePath();h.fillStyle=t.color;h.fill()}};function o(){var t=O.invert([0,0]);var e=O.invert([A.attr.width,A.attr.height]);var r={xMin:t[0],xMax:e[0],yMin:t[1],yMax:e[1]};a.forEach(function(t){if(t.params.pos&&(t.params.pos[0]<r.xMin||t.params.pos[0]>r.xMax||t.params.pos[1]<r.yMin||t.params.pos[1]>r.yMax)){return}i[t.type](t.params,true)})}return{g:t,canvas:h,rescaleContent:r,clearContent:n,append:e,render:o}}();return true}else{return false}}function r(){var e=parseFloat(l.style("width"))/A.attr.width;var r=parseFloat(l.style("height"))/A.attr.height;l.style("width",A.attr.width+"px").style("height",A.attr.height+"px");f.forOwn(v,function(t){t.g.attr("width",A.attr.width+"px").attr("height",A.attr.height+"px");t.rescaleContent(e,r);t.render()});d(O.current())}function n(t){var e=A.utils.encode(t);if(v.hasOwnProperty(e)){v[e].canvas.clearRect(0,0,A.attr.width,A.attr.height);v[e].clearContent();return true}else{return false}}function a(){f.forOwn(v,function(t){t.canvas.save();t.canvas.clearRect(0,0,A.attr.width,A.attr.height)})}function i(t){var r=A.utils.encode(t);if(r&&v.hasOwnProperty(r)){f.forOwn(v,function(t,e){t.g.transition().duration(100).style("opacity",r===e?1:0)})}else{f.forOwn(v,function(t){t.g.transition().duration(100).style("opacity",1)})}return b}function o(e){f.forOwn(v,function(t){t.render(e)})}function s(){f.forOwn(v,function(t){t.canvas.restore()})}var c={dot:function(t,e,r,n){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var a=A.utils.encode(t);return v.hasOwnProperty(a)&&v[a].append("dot",{pos:_._project(e),size:r,color:n})},circle:function(t,e,r,n){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof r!=="number"||isNaN(r)||r<=0)return false;var a=A.utils.encode(t);return v.hasOwnProperty(a)&&v[a].append("circle",{pos:_._project(e),radius:r,color:n})},arrow:function(t,e,r,n,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof n!=="number")return false;var i=A.utils.encode(t);if(v.hasOwnProperty(i)){var o=new P.LatLon(e).toVec(),s=new P.LatLon(r).toVec(),l=o.cross(s).cross(o).length(1),u=Math.acos(o.dot(s));var c=1,d=100,f=n*5,p=new P.Vector2(_._project(e)),h=new P.Vector2(_._project(r)),y=p,g=[y];do{var m=new P.Vector2(_._project(o.multiply(Math.cos((c+1)*u/d)).add(l.multiply(Math.sin((c+1)*u/d))).toLatLon().toArray()));c++;y=m;g.push(m)}while(c<d&&m.sub(h).length()>f);g.push(h);v[i].append("arrow",{segments:g,width:n,color:a});return true}else{return false}}};function d(e){y._clear();f.forOwn(v,function(t){t.canvas.translate(e.x,e.y);t.canvas.scale(e.k,e.k)});y._render(e.k);y._restore()}return{_style:r,_zoom:d,_clear:a,_restore:s,_render:o,get:t,add:e,highlight:i,erase:n,draw:c}}();this.staticLayer={get:y.get,add:y.add,erase:y.erase,highlight:y.highlight,draw:y.draw};var g=function(){var t=A.widget.append("div").attr("id",x+"-tiles-layer").style("position","absolute").style("pointer-events","none").style("z-index",99).style("opacity",.5).style("width",A.attr.width+"px").style("height",A.attr.height+"px");var r=null;function n(t){return _._invert([t[0]-.5*A.attr.width,t[1]+.5*A.attr.height])}function a(t){return Math.log(.00391382924*t*A.attr.width)/Math.log(2)}function e(){if(A.attr.tiles===null){return}if(!this.headerAdded){C.select("head").append("link").attr("rel","stylesheet").attr("href","https://unpkg.com/leaflet@1.3.1/dist/leaflet.css").attr("integrity","sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==").attr("crossorigin","");this.headerAdded=true}r=s.map(x+"-tiles-layer",{attributionControl:false,zoomSnap:0,zoomControl:false}).setView(n([0,0]),a(O.level()));var t=null,e=null;switch(A.attr.tiles){case"cartodb-positron":t="https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";e="abcd";break}if(t&&e){s.tileLayer(t,{subdomains:e}).addTo(r)}i()}function i(){if(r===null){return}t.style("width",A.attr.width+"px").style("height",A.attr.height+"px");r.invalidateSize()}function o(t){if(r===null){return}r.setView(n([-t.x/t.k-.5*(t.k-1)*A.attr.width/t.k,-t.y/t.k-.5*(t.k-1)*A.attr.height/t.k]),a(t.k),true)}return{_build:e,_style:i,_getLatLon:n,_getZoom:a,_zoom:o}}();var m=function(){var a=A.widget.append("div").attr("id",x+"-dynamic-layers").style("position","absolute").style("pointer-events","none");var z={};function t(){return Object.keys(z)}function e(t){var r=A.utils.encode(t);if(!z.hasOwnProperty(r)){z[r]=function(){var t=a.append("svg").attr("id",x+"-dynamic-layer-"+r).attr("width",A.attr.width+"px").attr("height",A.attr.height+"px").style("position","absolute").style("pointer-events","none").append("g");var n=[];function e(t){n.push({elem:t,birth:(new Date).getTime()/1e3})}setInterval(function(){var e=(new Date).getTime()/1e3;var r=[];n.forEach(function(t){if(e-t.birth>10){t.elem.transition().duration(700).style("opacity",0).on("end",function(){C.select(this).remove()})}else{r.push(t)}});n=r},2e3);return{g:t,append:e}}();return true}else{return false}}function r(){a.style("width",A.attr.width+"px").style("height",A.attr.height+"px");f.forOwn(z,function(t){t.g.attr("width",A.attr.width+"px").attr("height",A.attr.height+"px")})}function n(t){var e=A.utils.encode(t);if(z.hasOwnProperty(e)){z[e].g.html("");return true}else{return false}}function i(t){var r=A.utils.encode(t);if(r&&z.hasOwnProperty(r)){f.forOwn(z,function(t,e){t.g.transition().duration(200).style("opacity",r===e?1:0)})}else{f.forOwn(z,function(t){t.g.transition().duration(200).style("opacity",1)})}return b}var o={circle:function(t,e,r,n,a,i){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof r!=="number"||isNaN(r)||r<=0)return false;var o=A.utils.encode(t);if(z.hasOwnProperty(o)){var s=r/O.level();var l=_._project(e);var u=z[o].g.append("circle").attr("class","circle").attr("cx",l[0]).attr("cy",l[1]).attr("r",s).style("fill",n);z[o].append(u);u.transition().duration(a?a:700).ease(C.easeExp).attr("r",0).on("end",function(){i&&i();C.select(this).remove()});return true}else{return false}},arrow:function(t,e,r,n,a,i,o){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof n!=="number")return false;var s=A.utils.encode(t);if(z.hasOwnProperty(s)){var l=100;var u=null;var c=null;var d=new P.Vector2(_._project(e));var f=new P.Vector2(_._project(r));var p=n/O.level();var h=p*2;var y=p*5;u=z[s].g.append("path").style("fill","none").style("stroke",a).style("stroke-width",p).attr("d","M"+d.x()+","+d.y());c=z[s].g.append("path").style("fill",a).style("stroke","none");var g=new P.LatLon(e).toVec();var m=new P.LatLon(r).toVec();var v=g.cross(m).cross(g).length(1);var x=Math.acos(g.dot(m));var b=1;var w=d;var k=(typeof i==="number"?i:700)/l;var M=setInterval(function(){var t=new P.Vector2(_._project(g.multiply(Math.cos((b+1)*x/l)).add(v.multiply(Math.sin((b+1)*x/l))).toLatLon().toArray()));u.attr("d",u.attr("d")+(t.sub(w).length()<.5*A.attr.width?"L":"M")+t.x()+","+t.y());if(t.sub(w).length()<.5*A.attr.width){var e=t.sub(w).length(1);var r=e.angle(e.angle()+Math.PI/2).multiply(h);var n=t.sub(r);var a=t.add(r);var i=t.add(e.multiply(y));c.attr("d","M"+n.x()+","+n.y()+"L"+a.x()+","+a.y()+"L"+i.x()+","+i.y()+"Z")}if(t.sub(f).length()>y){b++;w=t}else{clearInterval(M);e=f.sub(t).length(1);r=e.angle(e.angle()+Math.PI/2).multiply(h);n=f.sub(e.multiply(y)).sub(r);a=f.sub(e.multiply(y)).add(r);c.transition().duration(k).attr("d","M"+n.x()+","+n.y()+"L"+a.x()+","+a.y()+"L"+f.x()+","+f.y()+"Z").on("end",function(){o&&o();u.transition().duration(1e3).style("opacity",0).on("end",function(){C.select(this).remove()});C.select(this).transition().duration(1e3).style("opacity",0).on("end",function(){C.select(this).remove()})})}},k);return true}else{return false}}};function s(e){f.forOwn(z,function(t){t.g.attr("transform",e)})}return{_style:r,_zoom:s,get:t,add:e,highlight:i,erase:n,draw:o}}();this.dynamicLayer={get:m.get,add:m.add,highlight:m.highlight,erase:m.erase,draw:m.draw};var w=function(){var t=A.widget.append("svg").attr("id",x+"-touch-layer").attr("width",A.attr.width+"px").attr("height",A.attr.height+"px").style("position","absolute").style("pointer-events","none");var l=t.append("g");function e(t,e,r,n,a,i){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var o=r/O.level();var s=_._project(e);l.append("circle").attr("id",x+"-touch-layer-"+t).attr("cx",s[0]).attr("cy",s[1]).attr("r",o).style("fill",null).style("opacity",0).style("pointer-events","all").on("mouseover",function(t,e){if(n)n(t,e)}).on("mouseleave",function(t,e){if(a)a(t,e)}).on("click",function(t,e){if(i)i(t,e)});return true}function r(t){var e=l.select("#"+t);if(e.empty())return false;else{e.remove();return true}}function n(){t.style("width",A.attr.width+"px").style("height",A.attr.height+"px");l.style("width",A.attr.width+"px").style("height",A.attr.height+"px")}function a(t){l.attr("transform",t)}function i(){l.html("")}return{_style:n,_zoom:a,add:e,remove:r,erase:i}}();this.touchLayer={add:w.add,remove:w.remove,erase:w.erase};A.render.build=function(){v._build(function(){_._build();g._build();A.attr.ready&&A.attr.ready()})};A.render.update=function(){_._update()};A.render.style=function(){A.widget.style("background-color",A.attr.backgroundColor).style("pointer-events",null);O.init();_._style();y._style();m._style();g._style();w._style();r._mark()}}t.prototype=Object.create(n.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Picture=e(t.d3,t.du.Widget)}})(this,function(t,r){"use strict";function e(t,e){var a=r.call(this,t,"picture","div",e);a.attr.add(this,"src","");var i={};var o=null;a.render.build=function(){i.g=a.widget.append("div").style("width",a.attr.width>0?a.attr.width:null).style("height",a.attr.height>0?a.attr.height:null).style("position","relative").style("pointer-events","all");o=new Image;o.onload=function(){var t=o.width/o.height;var e=a.attr.width/a.attr.height;var r=t>e?a.attr.width:a.attr.height*t;var n=t<e?a.attr.height:a.attr.width/t;i.g.style("background-image","url("+a.attr.src+")").style("background-repeat","none").style("background-size",r+"px "+n+"px").style("width",r+"px").style("height",n+"px").style("margin-left",(a.attr.width-r)/2+"px").style("margin-top",(a.attr.height-n)/2+"px").on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(o)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(o)}).on("click",function(){a.attr.click&&a.attr.click(o)})}};a.render.style=function(){if(a.attr.src){o.src=a.attr.src}}}e.prototype=Object.create(r.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.PieChart=e(t.d3,t.du.Widget)}})(this,function(m,r){"use strict";function t(t,e){var o=r.call(this,t,"piechart","svg",e);o.attr.add(this,"innerRadius",0,"dim");o.attr.add(this,"outerRadius",50,"dim");o.attr.add(this,"ticks",false);var s={};var l=[];var u={};var c=null;var d=false;function f(t){return t.data?t.data.name:""}function p(t,e,r,n){var a;return(a=i(t,e,r,n))?{startAngle:a.endAngle,endAngle:a.endAngle}:(a=h(t,e,r,n))?{startAngle:a.startAngle,endAngle:a.startAngle}:null}function i(t,e,r,n){var a=e.length;while(--t>=0){var i=n(r[t]);for(var o=0;o<a;++o){if(n(e[o])===i)return e[o]}}}function h(t,e,r,n){var a=r.length,i=e.length;while(++t<a){var o=n(r[t]);for(var s=0;s<i;++s){if(n(e[s])===o)return e[s]}}}function y(t){var e=m.interpolate(this._current,t);this._current=e(0);return function(t){return s.arc(e(t))}}function g(t){var e=m.interpolate(this._current,t);this._current=e(0);return function(t){return"translate("+s.arcLabel.centroid(e(t))+")"}}this.data=function(t){l=t;return this};this.highlight=function(t,e){if(!d){o.utils.highlight(this,s,"path",t,e);o.utils.highlight(this,s,"text",t,e)}return this};o.utils.tooltip=function(){return c?{title:c.name,stripe:o.attr.colors[c.name],content:{type:"metrics",data:[{label:"value:",value:o.attr.tooltipYFormat(c.value)},{label:"fraction:",value:(100*c.value/m.sum(l,function(t){return t.value})).toFixed(1)+"%"}]}}:null};o.render.build=function(){s.g=o.widget.append("g");s.label=s.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};o.render.update=function(t){s.arc=m.arc().outerRadius(o.attr.outerRadius-o.attr.margins.left).innerRadius(o.attr.innerRadius);s.arcLabel=m.arc().outerRadius(.5*(o.attr.innerRadius+o.attr.outerRadius-o.attr.margins.left)).innerRadius(.5*(o.attr.innerRadius+o.attr.outerRadius-o.attr.margins.left));var e=m.pie().value(function(t){return t.value}).sort(null);u=o.utils.colors(l?l.map(function(t){return t.name}):null);var r=s.g.selectAll(".slice");var n=s.g.selectAll(".label");var a=r.data(),i=e(l);r=r.data(i,f);r.exit().datum(function(t,e){return p(e,i,a,f)||t}).transition().duration(t).attrTween("d",y).remove();r.enter().append("path").attr("class",function(t){return"slice "+o.utils.encode(t.data.name)}).each(function(t,e){this._current=p(e,a,i,f)||t}).style("pointer-events","all").style("fill",function(t){return u[t.data.name]}).merge(r).each(function(){d=true}).on("mouseover",function(t){c=t.data;o.attr.mouseover&&o.attr.mouseover(t.data.name)}).on("mouseleave",function(t){c=null;o.attr.mouseleave&&o.attr.mouseleave(t.data.name)}).on("click",function(t){o.attr.click&&o.attr.click(t.data.name)}).transition().duration(t).style("opacity",1).style("fill",function(t){return u[t.data.name]}).attrTween("d",y).on("end",function(){d=false});n=n.data(i,f);n.exit().datum(function(t,e){return p(e,i,a,f)||t}).transition().duration(t).style("opacity",0).attrTween("transform",g).remove();n.enter().append("text").attr("class",function(t){return"label "+o.utils.encode(t.data.name)}).each(function(t,e){this._current=p(e,a,i,f)||t}).merge(n).attr("dy","0.35em").style("text-anchor","middle").style("pointer-events","none").attr("fill",o.attr.fontColor).text(function(t){return o.attr.tickFormat(100*t.data.value/m.sum(i,function(t){return t.value}))}).transition().duration(t).attrTween("transform",g)};o.render.style=function(){o.attr.colors=o.utils.colors(l?l.map(function(t){return t.name}):null);var t=o.attr.outerRadius-o.attr.margins.left;o.attr.width=2*o.attr.outerRadius;o.attr.height=2*o.attr.outerRadius;o.widget.style("width",o.attr.width+"px").style("height",o.attr.height+"px");s.g.attr("transform","translate("+o.attr.outerRadius+","+o.attr.outerRadius+")");s.label.attr("transform","translate(0,"+o.attr.outerRadius+")").style("width",10+2*o.attr.outerRadius+"px").style("font-size",Math.min(16,o.attr.outerRadius*.4)+"px").style("fill",o.attr.fontColor).text(o.attr.label)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ProgressBar=e(t.d3,t.du.Widget)}})(this,function(t,a){"use strict";function e(t,e){var r=a.call(this,t,"progressbar","div",e);r.attr.add(this,"backgroundColor","transparent");r.attr.add(this,"thickness",1);r.attr.add(this,"align","center");r.attr.add(this,"percentage",0);var n={};r.render.build=function(){n.g=r.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");n.container=n.g.append("div").style("display","table-cell").style("vertical-align","middle").style("pointer-events","none").style("height","100%");n.label=n.container.append("div").style("display","block").style("pointer-events","none");n.barTrack=n.container.append("div").style("display","block").style("width","100%").style("bottom","0").style("background-color",r.attr.backgroundColor);n.bar=n.barTrack.append("div").style("display","block").style("float","left").style("width","0%").style("height","100%")};r.render.update=function(){n.bar.style("width",r.attr.percentage+"%")};r.render.style=function(){n.container.style("text-align",r.attr.align);n.label.style("color",r.attr.fontColor).style("height",r.attr.fontSize+"px").style("line-height",r.attr.fontSize+"px").style("font-size",r.attr.fontSize+"px").text(r.attr.label);n.barTrack.style("height",r.attr.thickness+"px");n.bar.style("background-color",r.attr.fontColor)}}e.prototype=Object.create(a.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ScatterPlot=e(t.d3,t.du.Widget)}})(this,function(c,r){"use strict";function t(t,e){var a=r.call(this,t,"scatterplot","svg",e);a.attr.add(this,"opacity",.4);var i={};var o=[];var s={};var l=null;var u=false;this.data=function(t){o=t;return this};this.highlight=function(t,e){if(!u)a.utils.highlight(this,i,".dot-group",t,e);return this};a.utils.tooltip=function(t){if(!t){this.tt&&this.tt.remove();this.tt=null;return null}var e=l.find(t[0],t[1],10);if(!e){this.tt&&this.tt.remove();this.tt=null;return}this.tt=this.tt||i.g.append("circle");this.tt.attr("r",6).attr("cx",e.data[0]).attr("cy",e.data[1]).style("pointer-events","none").style("stroke",a.attr.stroke).style("fill",s[e.data.name]);return{title:e.data.name,stripe:s[e.data.name],content:{type:"metrics",data:[{label:a.attr.xLabel+":",value:a.attr.tooltipXFormat(e.data[0])},{label:a.attr.yLabel+":",value:a.attr.tooltipXFormat(e.data[1])}]}}};a.render.build=function(){i=a.utils.standardAxis();i.plots={}};a.render.update=function(t){i.scale={x:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,a.attr.innerWidth]),y:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[a.attr.innerHeight,0])};i.axes.x.transition().duration(t).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(t).call(i.axisFn.y.scale(i.scale.y));s=a.utils.colors(o?o.map(function(t){return t.name}):null);i.plots.groups=i.g.selectAll(".dot-group").data(o,function(t){return t.name});i.plots.groups.exit().transition().duration(t).remove();var e=i.plots.groups.enter().append("g").attr("class",function(t){return"dot-group "+a.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent");i.plots.groups=e.merge(i.plots.groups).each(function(){u=true}).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)});i.plots.groups.transition().duration(t).style("fill-opacity",a.attr.opacity).style("fill",function(t){return s[t.name]}).on("end",function(){u=false});i.plots.dots=i.plots.groups.selectAll(".dot").data(function(t){return t.values});i.plots.dots.exit().transition().duration(t).style("opacity",0).remove();i.plots.dots.enter().append("circle").attr("class","dot").style("opacity",0).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)}).merge(i.plots.dots).transition().duration(t).style("opacity",1).attr("r",3).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)});var n=[];o.forEach(function(r){r.values.forEach(function(t){var e=[i.scale.x(t.x),i.scale.y(t.y)];e.name=r.name;n.push(e)})});var r=c.voronoi().extent([[-1,-1],[a.attr.width+1,a.attr.height+1]]);l=r(n)};a.render.style=function(){a.attr.colors=a.utils.colors(o[0]?c.keys(o[0].y):null);i.g.attr("width",a.attr.innerWidth+"px").attr("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Slider=e(t.d3,t.du.Widget)}})(this,function(l,u){"use strict";function t(t,e){var n=u.call(this,t,"slider","svg",e);n.attr.add(this,"min",0);n.attr.add(this,"max",1);n.attr.add(this,"step",0);n.attr.add(this,"callback",null);var a={};var r={right:20,left:20};var i=false;var o=[];var s=null;n.render.build=function(){o=[n.attr.min,n.attr.max];s=l.scaleLinear().domain(o).range([0,n.attr.width-r.left-r.right]).clamp(true);if(n.attr.step){i=true;o=[];for(var t=n.attr.min;t<=n.attr.max;t+=n.attr.step){o.push(t)}s=l.scalePoint().domain(o).range([0,n.attr.width-r.left-r.right])}a.g=n.widget.append("g").attr("transform","translate("+r.left+",20)");a.track=a.g.append("line").attr("stroke-linecap","round").attr("stroke",n.attr.fontColor).attr("stroke-width","9px").attr("x1",s.range()[0]).attr("x2",s.range()[1]);a.inset=a.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("stroke","white").style("opacity",.9).style("stroke-width","8px");a.overlay=a.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","stroke").style("cursor","pointer").style("stroke","transparent").style("stroke-width","50px").call(l.drag().on("start drag",function(){var t=null;if(i){var r=l.event.x;t=o.reduce(function(t,e){return Math.abs(s(e)-r)<Math.abs(s(t)-r)?e:t})}else{t=s.invert(l.event.x)}a.handle.attr("cx",s(t));n.attr.callback&&n.attr.callback(t)}));a.axis=a.g.insert("g",".track-overlay").style("font-size","10px").attr("font-family","inherit").attr("transform","translate(0,"+20+")");a.ticks=a.axis.selectAll("text").data(i?o:s.ticks(5)).enter().append("text").attr("x",s).attr("text-anchor","middle").attr("font-family","inherit").text(function(t){return t});a.handle=a.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",8)};n.render.style=function(){n.widget.style("width",n.attr.width+"px");n.widget.style("height",50+"px");s.range([0,n.attr.width-r.left-r.right]);a.track.attr("x1",s.range()[0]).attr("x2",s.range()[1]);a.inset.attr("x1",s.range()[0]).attr("x2",s.range()[1]);a.overlay.attr("x1",s.range()[0]).attr("x2",s.range()[1]);a.ticks.attr("x",s).attr("font-size",n.attr.fontSize+"px").attr("fill",n.attr.fontColor);a.handle.style("stroke",n.attr.fontColor)}}t.prototype=Object.create(u.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Status=e(t.d3,t.du.Widget)}})(this,function(t,a){"use strict";function e(t,e){var r=a.call(this,t,"status","div",e);r.attr.add(this,"value","");var n={};r.render.build=function(){n.g=r.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");n.label=n.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","25%").style("pointer-events","none").text(r.attr.label);n.status=n.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","75%").style("text-align","right").style("pointer-events","none")};r.render.style=function(){r.widget.style("font-size",r.attr.fontSize+"px").style("pointer-events","none");for(var t in r.attr.margins){if(r.attr.margins.hasOwnProperty(t)){r.widget.style("margin-"+t,r.attr.margins[t]+"px")}}for(t in r.attr.borders){if(r.attr.borders.hasOwnProperty(t)){r.widget.style("border-"+t,r.attr.borders[t])}}n.label.style("color",r.attr.fontColor).style("font-weight",r.attr.fontWeight);n.status.style("color",r.attr.fontColor).style("font-weight",r.attr.fontWeight).text(r.attr.value)}}e.prototype=Object.create(a.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.TrackPad=e(t.d3,t.du.Widget)}})(this,function(i,o){"use strict";function t(t,e){var r=o.call(this,t,"slider","svg",e);r.attr.add(this,"xRange",[0,1]);r.attr.add(this,"yRange",[0,1]);r.attr.add(this,"callback",null);r.attr.add(this,"guide",false);var n={};var a=null;r.render.build=function(){a={x:i.scaleLinear().domain(r.attr.xRange).range([0,r.attr.width-r.attr.margins.left-r.attr.margins.right]).clamp(true),y:i.scaleLinear().domain(r.attr.yRange).range([0,r.attr.height-r.attr.margins.top-r.attr.margins.bottom]).clamp(true)};n.g=r.widget.append("g").attr("transform","translate("+r.attr.margins.left+",20)");n.track=n.g.append("rect").attr("rx","3").attr("ry","3").attr("x",a.x.range()[0]).attr("y",a.y.range()[0]).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom+"px");n.inset=n.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("fill","white").style("opacity",.9).attr("rx","2.5").attr("ry","2.5").attr("x",a.x.range()[0]+.5).attr("y",a.y.range()[0]+.5).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right-1+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom-1+"px");if(r.attr.guide){n.guide={h:n.g.append("line").attr("x1",a.x.range()[0]).attr("y1",a.y.range()[0]).attr("x2",a.x.range()[1]).attr("y2",a.y.range()[0]).attr("stroke-dasharray","3, 6").style("stroke",r.attr.fontColor).style("stroke-width","1px"),v:n.g.append("line").attr("x1",a.x.range()[0]).attr("y1",a.y.range()[0]).attr("x2",a.x.range()[0]).attr("y2",a.y.range()[1]).attr("stroke-dasharray","3, 6").style("stroke-width","1px")}}n.overlay=n.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","all").style("cursor","pointer").style("fill","transparent").call(i.drag().on("start drag",function(){var t=a.x.invert(i.event.x),e=a.y.invert(i.event.y);n.handle.attr("cx",a.x(t)).attr("cy",a.y(e));if(n.guide){n.guide.h.attr("x1",a.x.range()[0]).attr("y1",a.y(e)).attr("x2",a.x.range()[1]).attr("y2",a.y(e));n.guide.v.attr("x1",a.x(t)).attr("y1",a.y.range()[0]).attr("x2",a.x(t)).attr("y2",a.y.range()[1])}r.attr.callback&&r.attr.callback(t,e)}));n.axis={x:n.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none"),y:n.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none")};n.handle=n.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",7)};r.render.style=function(){r.widget.style("width",r.attr.width+"px");r.widget.style("height",r.attr.height+"px");a.x.range([0,r.attr.width-r.attr.margins.left-r.attr.margins.right]);a.y.range([0,r.attr.height-r.attr.margins.top-r.attr.margins.bottom]);n.track.style("fill",r.attr.fontColor).attr("x",a.x.range()[0]).attr("y",a.y.range()[0]).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom+"px");n.inset.attr("x",a.x.range()[0]+.5).attr("y",a.y.range()[0]+.5).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right-1+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom-1+"px");if(r.attr.guide){n.guide.h.style("stroke",r.attr.fontColor);n.guide.v.style("stroke",r.attr.fontColor)}n.overlay.attr("x",a.x.range()[0]-r.attr.margins.left+10).attr("y",a.y.range()[0]-r.attr.margins.top+10).attr("width",r.attr.width-20+"px").attr("height",r.attr.height-20+"px");n.axis.x.attr("transform","translate(-1,"+(r.attr.height-r.attr.margins.bottom-30)+")").call(i.axisBottom().ticks(5).scale(a.x));n.axis.y.call(i.axisLeft().ticks(5).scale(a.y));n.g.selectAll("path").style("fill","none").style("stroke","none");n.g.selectAll(".tick > line").style("fill","none").style("stroke","none");n.g.selectAll("text").attr("font-size",r.attr.fontSize+"px").attr("fill",r.attr.fontColor);n.handle.style("stroke",r.attr.fontColor)}}t.prototype=Object.create(o.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ViolinPlot=e(t.d3,t.du.Widget)}})(this,function(h,r){"use strict";function t(t,e){var u=r.call(this,t,"violinplot","svg",e);function c(r,e){return function(t){return e.map(function(e){return{x:e,y:h.mean(t,function(t){return r(e-t)})}})}}function d(e){return function(t){return Math.abs(t/=e)<=1?.75*(1-t*t)/e:0}}var n={};var a=[];var i=null;var f=0;var p=1;var o={};var s=false;this.data=function(t){var e=t.reduce(function(t,e){return t.concat(e.values)},[]);f=h.min(e);p=h.max(e);a=t.map(function(t){var e=t.values.sort(h.ascending),r=h.min(e),n=h.max(e),a=h.quantile(e,.25),i=h.quantile(e,.75),o=.2*(n-r);var s=c(d(.05*(n-r)),h.range(21).map(function(t){return(n-r+2*o)*t/20+(r-o)}));var l=s(t.values);return{name:t.name,scale:{x:h.scaleLinear().domain([f,p]).range([u.attr.innerHeight,0]),y:h.scaleLinear().range([10,0]).domain([0,h.max(l,function(t){return t.y})])},values:{min:r,max:n,mean:h.mean(e),median:h.median(e),q1:a,q3:i,data:l}}});return this};this.highlight=function(t,e){if(!s)u.utils.highlight(this,n,".violin",t,e);return this};u.utils.tooltip=function(){return i?{title:i.name,stripe:o[i.name],content:{type:"metrics",data:[{label:"min/max:",value:i.values.min.toPrecision(3)+"/"+i.values.max.toPrecision(3)},{label:"mean:",value:i.values.mean.toPrecision(3)},{label:"median:",value:i.values.median.toPrecision(3)},{label:"Q1:",value:i.values.q1.toPrecision(3)},{label:"Q3:",value:i.values.q3.toPrecision(3)}]}}:null};u.render.build=function(){n=u.utils.standardAxis();n.plots={}};u.render.update=function(t){n.scale={x:u.utils.scale(a.map(function(t){return t.name}).reverse(),[u.attr.innerWidth,0],"point"),y:u.utils.scale(a.map(function(t){return[t.values.min-.1*(t.values.max-t.values.min),t.values.max+.1*(t.values.max-t.values.min)]}).reduce(function(t,e){return t.concat(e)},[]),[u.attr.innerHeight,0])};n.axes.x.transition().duration(t).call(n.axisFn.x.scale(n.scale.x));n.axes.y.transition().duration(t).call(n.axisFn.y.scale(n.scale.y));o=u.utils.colors(a?a.map(function(t){return t.name}):null);n.plots.groups=n.g.selectAll(".box-group").data(a,function(t){return t.name});n.plots.groups.exit().style("opacity",0).remove();var e=n.plots.groups.enter().append("g").attr("class",function(t){return"box-group "+u.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var r=e.merge(n.plots.groups).each(function(){s=true}).attr("transform",function(t){return"translate("+n.scale.x(t.name)+",0)"}).on("mouseover",function(t){i=t;u.attr.mouseover&&u.attr.mouseover(t.name)}).on("mouseleave",function(t){i=null;u.attr.mouseleave&&u.attr.mouseleave(t.name)}).on("click",function(t){u.attr.click&&u.attr.click(t.name)});r.transition().duration(t).attr("transform",function(t){return"translate("+n.scale.x(t.name)+",0)"}).style("opacity",1).style("fill-opacity",.3).style("fill",function(t){return o[t.name]}).style("stroke",function(t){return o[t.name]}).on("end",function(){s=false});e.append("path").attr("transform","rotate(90) translate(0,-"+(10+.5)+")");r.select("path").transition().duration(t).attr("d",function(e){e.scale.x.range([u.attr.innerHeight,0]);var t=h.area().curve(h.curveBasis).x(function(t){return e.scale.x(Math.min(p,Math.max(f,t.x)))}).y0(function(t){return e.scale.y(-t.y)}).y1(function(t){return e.scale.y(t.y)});return t(e.values.data)}).attr("transform","rotate(90) translate(0,-"+(10+.5)+")")};u.render.style=function(){n.g.style("width",u.attr.innerWidth+"px").style("height",u.attr.innerHeight+"px").attr("transform","translate("+u.attr.margins.left+","+u.attr.margins.top+")").style("pointer-events","all");n.axes.x.attr("transform","translate(0,"+u.attr.innerHeight+")");n.axisFn.y.tickFormat(u.attr.yTickFormat);n.axes.y.attr("transform","translate(0,"+1+")");n.labels.x.attr("x",u.attr.innerWidth+"px").attr("y",u.attr.innerHeight+2.2*u.attr.fontSize+"px").attr("fill",u.attr.fontColor).style("font-size",u.attr.fontSize+"px").text(u.attr.xLabel);n.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",u.attr.fontColor).style("font-size",u.attr.fontSize+"px").text(u.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});