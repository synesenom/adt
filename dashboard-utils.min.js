(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";var n=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function r(r,i,o,a){var l;var s="du-widget-"+i+"-"+r;try{if(a){l=t.select(a).append(o).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{l=t.select("body").append(o).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var u={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,n,r,i){u[e]=n;t[e]=function(n){if(i){i(n)}else{u[e]=n}return t};if(typeof r==="string"&&u._categories.hasOwnProperty(r)){u._categories[r].push(e)}}};u.add(this,"relative",false);u.add(this,"x",0,"dim",function(t,e){u.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.xDim=e});u.add(this,"y",0,"dim",function(t,e){u.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.yDim=e});u.add(this,"width",200,"dim");u.add(this,"height",150,"dim");u.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){u.margins[e]=t})}else{e.forOwn(t,function(e,n){u.margins[n]=t[n]})}});u.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){u.borders[e]=t})}e.forOwn(t,function(e,n){u.borders[n]=t[n]})});u.add(this,"fontColor","black");u.add(this,"fontSize",10,"dim");u.add(this,"fontWeight","normal");u.add(this,"label",null);u.add(this,"xLabel",null);u.add(this,"yLabel",null);u.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"xTickAngle",null);u.add(this,"yMin",0);u.add(this,"mouseover",null);u.add(this,"mouseleave",null);u.add(this,"click",null);u.add(this,"colors",null);u.add(this,"tooltip",false);var d=function(){function r(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function i(n,r){if(n===null||n===undefined||n.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var i=[t.min(n,function(t){return t.x}),t.max(n,function(t){return t.x})];var o={};var a=[];n.forEach(function(t){if(!o.hasOwnProperty(t.x)){o[t.x]=1;a.push(t.x)}});var l=[];if(typeof n[0].y==="number"){l=[t.min(n,function(t){return t.y}),t.max(n,function(t){return t.y})]}else{var s=[],u=[];e.forOwn(n[0].y,function(e,r){s.push(t.min(n,function(t){return t.y[r]}));u.push(t.max(n,function(t){return t.y[r]}))});l=[t.min(s),t.max(u)]}var d={x:[null,null],y:[null,null]};if(r){e.forOwn(d,function(t,e){[0,1].forEach(function(n){t[n]=r.hasOwnProperty(e)&&r[e][n]!==null?r[e][n]:t[n]})})}return{x:{min:d.x[0]!==null?d.x[0]:i[0],max:d.x[1]!==null?d.x[1]:i[1],domain:a.filter(function(t){return(!d.x[0]||t>=d.x[0])&&(!d.x[1]||t<=d.x[1])})},y:{min:d.y[0]!==null?d.y[0]:l[0],max:d.y[1]!==null?d.y[1]:l[1],domain:[]}}}function o(e,n,r,i){function o(e,n){var r=null;if(typeof e){switch(e){case"number":default:r=t.scaleLinear().domain([n.min,n.max]);break;case"time":r=t.scaleTime().domain([n.min,n.max]);break;case"string":r=t.scaleBand().domain(n.domain).padding(.1);break}}return r}return{x:o(i&&i.x?i.x.type:"number",e.x).range(i&&i.x&&i.x.reverse?[n,0]:[0,n]),y:o(i&&i.y?i.y.type:"number",e.y).range(i&&i.y&&i.y.reverse?[0,r]:[r,0])}}function a(e,n,i,o,a){if(n!==null){if(typeof o==="string"){n.g.selectAll(i).transition();n.g.selectAll(i).transition().duration(a?a:0).style("opacity",function(){return t.select(this).classed(r(o))?1:.1})}else{n.g.selectAll(i).transition();n.g.selectAll(i).transition().duration(a?a:0).style("opacity",1)}}return e}function l(e){if(e===null||e===undefined){return{}}if(e.length>0){if(u.colors===null||u.colors===undefined){return e.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,r){t[e]=n[r%18];return t},{})}if(typeof u.colors==="string"){var r=t.scaleLinear().domain([0,e.length]).range([u.colors,"#fff"]).interpolate(t.interpolateRgb);return e.reduce(function(t,e,n){t[e]=r(n);return t},{})}return u.colors}}return{encode:r,boundary:i,scale:o,highlight:a,colors:l}}();function c(){var e="du-widgets-plot-tooltip";var n=t.mouse(l.node());var r=t.event.pageX;var i=t.event.pageY;var o=l.node().getBoundingClientRect();if(r<o.left+u.margins.left||r>o.right-u.margins.right||i<o.top+u.margins.top||i>o.bottom-u.margins.bottom){t.select("#"+e).style("opacity",0).html("");d.tooltip();return}var a=t.select("#"+e);if(t.select("#"+e).empty()){var s=t.color(u.fontColor);s.opacity=.3;a=t.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("border","solid 1px "+s).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",u.fontColor).style("pointer-events","none").style("left",(o.left+o.right)/2+"px").style("top",(o.top+o.bottom)/2+"px")}var c=d.tooltip([n[0]-u.margins.left,n[1]-u.margins.top]);if(!c){t.select("#"+e).style("opacity",0).html("");d.tooltip();return}a.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").style("border-bottom","solid 1px "+u.fontColor).text(c.title);c.plots.sort(function(t,e){return t.id.localeCompare(e.id)}).forEach(function(t){var e=a.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");e.append("div").style("position","relative").style("width","10px").style("height","10px").style("float","left").style("background-color",t.color);e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)});var f=a.node().getBoundingClientRect();var p=f.width;var g=f.height;var y=r+20;var h=i+20;if(y<o.left+u.margins.left+10){y+=u.margins.left+10}else if(y+p>o.right-u.margins.right){y-=p+30}if(h<o.top+u.margins.top+10){h+=u.margins.top+10}else if(h+g>o.bottom-u.margins.bottom){h-=g+30}a.style("opacity",1).transition();a.transition().duration(200).ease(t.easeLinear).style("left",y+"px").style("top",h+"px")}this.id=function(){return s};this.describe=function(e){var n=null;l.on("contextmenu",function(){t.event.preventDefault();if(n===null){n=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(n!==null){n.remove();n=null}});return this};this.placeholder=function(e){var n=300;var i="du-widget-placeholder-"+r;if(e){l.transition().duration(n).style("opacity",0);if(t.select("#"+i).empty()){var o=a?a:"body";t.select(o).append("div").attr("id",i).style("position","absolute").style("width",u.width+"px").style("height",u.height+"px").style("line-height",u.height+"px").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",u.fontWeight).style("font-size",u.fontSize).style("color",u.fontColor).style("opacity",0).html(e).transition().duration(n).style("opacity",1)}}else{l.transition().duration();l.transition().duration(n).style("opacity",1);var s=t.select("#"+i);if(!s.empty()){s.remove()}}return this};var f={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){f.build&&f.build(e);this._isBuilt=true}f.update&&f.update(e);if(u.relative){l.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{l.style("position","absolute").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim)}l.style("width",u.width+"px").style("height",u.height+"px");l.style("pointer-events",u.tooltip&&d.tooltip?"all":null).on("mousemove",function(){u.tooltip&&d.tooltip&&c()});l.selectAll(".axis path").style("fill","none").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");l.selectAll(".tick > line").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");l.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",u.fontSize+"px").style("fill",u.fontColor);l.style("font-family","inherit");l.selectAll("g").attr("font-family","inherit");f.style&&f.style();l.style("display","block");return this};this.remove=function(){l.remove()};return{widget:l,attr:u,utils:d,render:f}}return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ChordChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function n(n,r){var i=e.call(this,n,"chordchart","svg",r);i.attr.add(this,"radius",100,"dim");i.attr.add(this,"thickness",10,"dim");i.attr.add(this,"ticks",false);i.attr.add(this,"invert",false);var o={};var a=[];var l=null;var s=t.map();var u=t.map();var d=10;var c=null;this.data=function(e){s.clear();u.clear();a=[];var n=0,r=0;e.forEach(function(t){if(!s.has(r=t.source)){u.set(n,r);s.set(r,n++)}if(!s.has(r=t.target)){u.set(n,r);s.set(r,n++)}});e.forEach(function(t){var e=s.get(t.source),r=s.get(t.target),i=a[e];if(!i){i=a[e]=[];for(var o=0;o<n;o++)i[o]=0}i[r]=t.value;if(!a[r]){a[r]=[];for(o=0;o<n;o++)a[r][o]=0}});d=t.max(u.values(),function(t){return t.length});return this};function f(t){return t.source.index<t.target.index?t.source.index+"-"+t.target.index:t.target.index+"-"+t.source.index}function p(e){var n=t.map();if(e){e.groups.forEach(function(t){n.set(t.index,t)})}return function(e){var r;var i=n.get(e.index);if(i){r=t.interpolate(i,e)}else{var a={startAngle:e.startAngle,endAngle:e.startAngle};r=t.interpolate(a,e)}return function(t){return o.arc(r(t))}}}function g(e){var n=t.map();if(e){e.forEach(function(t){n.set(f(t),t)})}return function(r){var i;var a=n.get(f(r));if(a){if(r.source.index!==a.source.index){a={source:a.target,target:a.source}}i=t.interpolate(a,r)}else{if(e){var l=e.groups.filter(function(t){return t.index===r.source.index||t.index===r.target.index});a={source:l[0],target:l[1]||l[0]};if(a.source&&r.source.index!==a.source.index){a={source:a.target,target:a.source}}}else a=r;var s=a.source?a.source.startAngle:0;var u=a.target?a.target.startAngle:0;var d={source:{startAngle:s,endAngle:s},target:{startAngle:u,endAngle:u}};i=t.interpolate(d,r)}return function(t){return o.ribbonFn(i(t))}}}this.highlight=function(t,e){return i.utils.highlight(this,o,".ribbon",t,e)};i.utils.tooltip=function(){if(!l){return null}var e=a[s.get(l.name)];return l?{title:l.name,plots:e.map(function(n,r){return{color:i.attr.colors[u.get(r)],value:100*n/t.sum(e)}}).sort(function(t,e){return e.value-t.value}).map(function(t){return{id:"",color:t.color,value:t.value.toFixed(1)+"%"}})}:null};i.render.build=function(){o.g=i.widget.append("g");o.chordFn=t.chord().padAngle(.05).sortGroups(t.descending).sortSubgroups(t.descending);o.arc=t.arc();o.ribbonFn=t.ribbon();o.label=o.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};i.render.update=function(t){i.attr.colors=i.utils.colors(s?s.keys():null);var e=i.attr.radius-i.attr.thickness-i.attr.margins.left,n=i.attr.radius-i.attr.margins.left;if(o.groups)o.groups.transition();if(o.newGroups)o.newGroups.transition();if(o.ribbons)o.ribbons.transition();if(o.newRibbons)o.newRibbons.transition();o.chord=o.chordFn(a);o.arc.innerRadius(e).outerRadius(n);o.groups=o.g.selectAll(".group").data(o.chord.groups,function(t){return t.index});o.newGroups=o.groups.enter().append("g").each(function(t){t.name=u.get(t.index)}).attr("class","group").style("pointer-events","all").on("mouseover",function(t){i.attr.mouseover&&i.attr.mouseover(t.name)}).on("mouseleave",function(t){l=null;i.attr.mouseleave&&i.attr.mouseleave(t.name)}).on("click",function(t){i.attr.click&&i.attr.click(t.name)}).on("mousemove",function(t){l=t});o.newGroups.append("path").attr("id",function(t){return"group"+t.index}).style("fill",function(t){return i.attr.colors[t.name]}).transition().duration(t).attrTween("d",p(c));if(i.attr.ticks){o.newGroups.append("text").attr("xlink:href",function(t){return"#group"+t.index}).attr("dy",".35em").text(function(t){return t.name}).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(i.attr.radius-i.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}o.groups.exit().transition().duration(t).style("opacity",0).remove();o.groups.select("path").each(function(t){t.name=u.get(t.index)}).attr("d",o.arc).transition().duration(t).style("fill",function(t){return i.attr.colors[t.name]}).attrTween("d",p(c));if(i.attr.ticks){o.groups.select("text").transition().duration(t).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(i.attr.radius-i.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}o.ribbonFn.radius(e);o.ribbons=o.g.selectAll(".ribbon").data(o.chord,f);o.newRibbons=o.ribbons.enter().append("path").each(function(t){t.source.name=u.get(t.source.index);t.target.name=u.get(t.target.index)}).attr("class",function(t){return"ribbon "+i.utils.encode(t.source.name)}).style("pointer-events","all").style("fill",function(t){return i.attr.colors[i.attr.invert?t.source.name:t.target.name]}).style("stroke-width","1px").style("fill-opacity",.8).style("stroke-opacity",.8).style("stroke","white");o.newRibbons.transition().duration(t).attrTween("d",g(null));o.ribbons.exit().transition().duration(t).style("opacity",0).remove();o.ribbons.each(function(t){t.source.name=u.get(t.source.index);t.target.name=u.get(t.target.index)}).attr("class",function(t){return"ribbon "+i.utils.encode(t.source.name)}).transition().duration(t).style("fill",function(t){return i.attr.colors[i.attr.invert?t.source.name:t.target.name]}).attrTween("d",g(c));c=o.chord};i.render.style=function(){i.attr.width=2*i.attr.radius;i.attr.height=2*i.attr.radius;i.widget.style("width",i.attr.width+"px").style("height",i.attr.height+"px");o.g.attr("transform","translate("+i.attr.radius+","+i.attr.radius+")");if(i.attr.ticks){o.newGroups.selectAll("text").style("font-size",i.attr.fontSize*.8+"px").style("font-weight",i.attr.fontWeight).style("fill",i.attr.fontColor)}o.label.attr("transform","translate(0,"+i.attr.radius+")").style("width",2*(i.attr.radius+i.attr.thickness)+"px").attr("font-size",i.attr.fontSize+"px").style("fill",i.attr.fontColor).text(i.attr.label)}}n.prototype=Object.create(e.prototype);return n});