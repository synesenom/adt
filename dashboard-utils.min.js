(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("lodash.clonedeep"))}else if(typeof define==="function"&&define.amd){define(["cloneDeep","exports"],e)}else{t.du=t.du||{};t.du.data=e(t.cloneDeep)}})(this,function(u){"use strict";var t={si:function(){var n="yzafpnÎ¼m kMGTPEZY";var i=(n.length-1)/2;var o=i;var s=-i;function t(t){if(t===null||t===undefined||isNaN(t))return"N/A";if(t===0)return"0";var e=Math.abs(t);var r=Math.max(Math.min(parseInt(Math.floor(Math.log(e)/Math.log(1e3))),o),s);var a=e/Math.pow(1e3,r);return(t<0?"-":"")+(r===s||r===o?a.toExponential(2):a.toPrecision(3)).replace(/e\+0$/,"")+n.charAt(i+r).trim()}return t}(),idfy:function(t){return t?t.replace(/ /g,"__"):""},namify:function(t){return t?t.replace(/__/g," "):""}};var e={sum:function(t,a,e){var n={};var i=[];if(Array.isArray(e)){i=e}else{i=[e]}var o=i.length;t.forEach(function(e){var r=[];i.forEach(function(t){if(e.hasOwnProperty(t)){r.push(e[t])}});if(r.length!==o)return;var t=r.join(".");if(!n.hasOwnProperty(t))n[t]=+e[a];else n[t]+=+e[a]});var r=[];for(var s in n){if(n.hasOwnProperty(s)){r.push({key:s,value:n[s]})}}return r.sort(function(t,e){return e.value-t.value})}};var r={Histogram:function(t){var a=t?t:[];this.set=function(t){a=t;return this};function e(){return u(a)}function r(t,e){a.push({x:t,y:e,index:a.length});return this}function n(e){a.forEach(function(t){t.y*=e});return this}function i(){var e=d3.sum(a,function(t){return t.y});a.forEach(function(t){t.y/=e});return this}function o(r){a.sort(function(t,e){return r?e.x-t.x:t.x-e.x});return this}function s(r){a.sort(function(t,e){return r?e.y-t.y:t.y-e.y});return this}function l(){a.sort(function(t,e){return t.index-e.index});return this}return{set:set,get:e,add:r,scale:n,normalize:i,sortByX:o,sortByY:s,unsort:l}},TimeSeries:function(a){var i=[];function t(t){i=[];var e=0;if(t!==null){var r=new Date(t);while(r<=new Date){i.push({x:new Date(r),y:{}});a.forEach(function(t){i[e].y[t]=0});r.setDate(r.getDate()+1);e++}}return this}function e(t,e,r,a){i[t].x=e;i[t].y[r]+=a}function o(t,e){if(!t)return i;else{var r=e?e:0;return i.slice(-r-t,-r)}}function s(t,e){if(i.length<1)return{};var r={};for(var a in i[0].y){if(i[0].y.hasOwnProperty(a)){r[a]=0}}o(t?t:1,e).forEach(function(t){for(var e in i[0].y){if(i[0].y.hasOwnProperty(e)){r[e]+=t.y[e]}}});return r}function r(t,e){var r=0;if(i.length>0){var a=o(t,e);for(var n in i[0].y){if(i[0].y.hasOwnProperty(n)){r=Math.max(d3.max(a,function(t){return t.y.hasOwnProperty(n)?t.y[n]:0}),r)}}}return r}function n(t){if(i.length<1)return{};var e=s(1,t);var r=s(2,t);var a={};for(var n in i[0].y){if(i[0].y.hasOwnProperty(n)){r[n]-=e[n];if(r[n]>=10&&e[n]>0){a[n]=(e[n]-r[n])/r[n]}}}return a}function l(t,e){var r=s(t,e);var a=0;for(var n in r){if(r.hasOwnProperty(n)){a+=r[n]}}for(n in r){if(r.hasOwnProperty(n)){r[n]/=a>0?a:1}}return r}return{clear:t,update:e,sub:o,sum:s,peak:r,trend:n,yDist:l}},Table:function(t){var i=[];var r=[];if(t){i=u(t);i.forEach(function(t,e){r.push(e)})}function e(t,a){var n=[];i.forEach(function(e){var r;if(typeof a==="string"){r=e[a]}else{r={};a.forEach(function(t){r[t]=e[t]})}n.push({x:e[t],y:r})});return n}function a(e,r){var t=null;switch(typeof r){case"number":var a=d3.min(i,function(t){return Math.abs((r-t[e])/r)});t=i.filter(function(t){return Math.abs((t[e]-r)/r)<=a*1.01});break;case"string":default:t=i.filter(function(t){return t[e]===r})}return new du.data.structures.Table(t)}function n(r){i.sort(function(t,e){return t[r]-e[r]});return this}function o(){var e=[];r.forEach(function(t){e.push(i[t])});i=e}return{slice:e,segment:a,sort:n,unsort:o}}};return{format:t,explore:e,structures:r}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.math=t.du.math||{};t.du.math.la=e()}})(this,function(){"use strict";var n=function(t){var a=t||[1,0];this.x=function(){return a[0]};this.y=function(){return a[1]};this.length=function(t){var e=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(typeof t==="number"){var r=t/e;return new n(a.map(function(t){return t*r}))}return e};this.angle=function(t){var e=Math.atan2(a[1],a[0]);if(typeof t==="number"){var r=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return new n([r*Math.cos(t),r*Math.sin(t)])}return e};this.toArray=function(){return[a[0],a[1]]};this.map=function(t){return new n(t(a))};this.add=function(t){return new n([a[0]+t.x(),a[1]+t.y()])};this.sub=function(t){return new n([a[0]-t.x(),a[1]-t.y()])};this.multiply=function(e){return new n(a.map(function(t){return t*e}))}};var i=function(t){var a=t||[1,0,0];this.x=function(){return a[0]};this.y=function(){return a[1]};this.z=function(){return a[2]};this.length=function(e){var r=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);if(typeof e==="number"){return new i(a.map(function(t){return t*e/r}))}return r};this.toLatLon=function(){var t=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return new e([Math.asin(a[2]/t),Math.atan2(a[1],a[0])].map(function(t){return t*180/Math.PI}))};this.add=function(t){return new i([a[0]+t.x(),a[1]+t.y(),a[2]+t.z()])};this.multiply=function(e){return new i(a.map(function(t){return t*e}))};this.dot=function(t){return a[0]*t.x()+a[1]*t.y()+a[2]*t.z()};this.cross=function(t){return new i([a[1]*t.z()-a[2]*t.y(),a[2]*t.x()-a[0]*t.z(),a[0]*t.y()-a[1]*t.x()])}};var e=function(t){var a=t||[0,0];this.toArray=function(){return[a[0],a[1]]};this.toVec=function(){var t=a[0]*Math.PI/180,e=a[1]*Math.PI/180;var r=Math.cos(t);return new t.Vector3([r*Math.cos(e),r*Math.sin(e),Math.sin(t)])}};return{Vector2:n,Vector3:i,LatLon:e}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.rest=e(t.d3)}})(this,function(u){"use strict";var t=function(l){function n(t,e,r,a,n){var i=l;var o=u.keys(t).sort();if(o.length>0){i+="?"+o[0]+"="+t[o[0]]}for(var s=1;s<o.length;s++){i+="&"+o[s]+"="+t[o[s]]}e(i).on("beforesend",function(t){if(n){for(var e in n){if(n.hasOwnProperty(e))t[e]=n[e]}}}).get(function(t,e){if(t){if(a)a(t);return}if(r)r(e)})}function t(t,e,r,a){n(t,u.json,e,r,a)}function e(t,e,r,a){n(t,u.csv,e,r,a)}return{json:t,csv:e}};return{Rest:t}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.signals=e()}})(this,function(){"use strict";var n={};function a(t,e){if(!n.hasOwnProperty(t))n[t]=[];for(var r=0;r<n[t].length;r++){if(n[t][r]===e){return}}n[t].push(e)}function t(t,e){if(typeof t==="string"){a(t,e)}else{if(t.constructor===Array){for(var r=0;r<t.length;r++){a(t[r],e)}}}}function e(t,e){var r=n[t];if(r!==undefined&&r!==null&&r.length>0){for(var a=0;a<r.length;a++){r[a](e)}}}return{subscribe:t,emit:e}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.log=e()}})(this,function(){"use strict";var e={error:"error",e:"error",warning:"warning",w:"warning",info:"info",i:"info",debug:"debug",d:"debug"};var r="info";var a=new Date;function n(t,e){return new Array(e-(""+t).length+1).join("0")+t}function i(){var t=new Date-a;return n(Math.floor(t/36e5),2)+":"+n(Math.floor(t%36e5/6e4),2)+":"+n(Math.floor(t%6e4/1e3),2)+"."+n(t%1e3,3)}function t(t){if(e.hasOwnProperty(t.toLowerCase())){r=t}}function o(t,e){if(r==="debug")console.debug("DEBUG ["+i()+"] "+t+": "+e)}function s(t,e){if(r==="info"||r==="debug")console.info("INFO  ["+i()+"] "+t+": "+e)}function l(t,e){if(r==="warning"||r==="info"||r==="debug")console.warn("WARN  ["+i()+"] "+t+": "+e)}function u(t,e){if(r==="error"||r==="warning"||r==="info"||r==="debug")console.error("ERROR ["+i()+"] "+t+": "+e)}return{severity:t,d:o,i:s,w:l,e:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.version=e()}})(this,function(){"use strict";var e="data/version.json";var i="du-version";var r=false;function n(t){if(typeof t!=="string"){return{major:0,minor:0,patch:1}}var e=t.split(".");return{major:e.length>0?+e[0]:0,minor:e.length>1?+e[1]:0,patch:e.length>2?+e[2]:1}}function o(t,e){var r=n(e),a=n(t);return a.major>r.major||a.major===r.major&&a.minor>r.minor||a.major===r.major&&a.minor===r.minor&&a.patch>r.patch}function t(t){e=t}function s(a,t){var n="0.0.1";d3.json(e,function(t,e){if(!t&&e.hasOwnProperty("version")&&typeof e.version==="string"){n=e.version}try{var r=localStorage.getItem(i);if(r===null)r="0.0.1";if(o(n,r)){localStorage.setItem(i,n);if(a)a(n,r)}}catch(t){console.error("MissingDOMException: there is no DOM, could not check version")}});if(t&&!r){r=true;setInterval(function(){s(a,false)},1810001)}}function a(){try{var t=localStorage.getItem(i);if(t===null){t="0.0.1";localStorage.setItem(i,t)}}catch(t){console.error("MissingDOMException: there is no DOM, could not read version")}return t}a();return{file:t,current:a,check:s}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.user=e(t.d3)}})(this,function(r){"use strict";var a=function(){var a=[];try{window.addEventListener("load",function(){r.select("body").on("keydown",function(){var t=String.fromCharCode(r.event.keyCode);if(!t)return;for(var e=0;e<a.length;e++){if(a[e]._check(t)){a.forEach(function(t){t._reset()});break}}})})}catch(t){console.error("No DOM, could not attach event listener")}function t(t,e){a.push(this);var r=t.toLowerCase();this._index=0;this._reset=function(){this._index=0};this._check=function(t){if(t.toLowerCase()===r.charAt(this._index)){this._index++}else{this._index=0}if(this._index===r.length){e();return true}return false}}return t}();var n=0;setInterval(function(){n+=1e4},1e4);try{window.addEventListener("load",function(){r.select("body").on("mousemove",function(){n=0})})}catch(t){console.error("No DOM, could not attach event listener")}function t(t,e){setInterval(function(){if(n>t){e()}},t)}function e(t){window.onblur=t}function i(t){window.onfocus=t}function o(){r.select("svg").style("pointer-events",null)}function s(){try{r.select("svg").style("pointer-events","none")}catch(t){console.error("No DOM, could not attach event listener")}}function l(){try{r.select("body").attr("oncontextmenu","return false;")}catch(t){console.error("No DOM, could not hide context menu")}}var u={egg:function(t,e){new a(t,e)},feature:function(t,e,r){new a("enable"+t,e);new a("disable"+t,r)}};return{enable:o,disable:s,noContext:l,idle:t,leave:e,enter:i,cheats:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3)}})(this,function(b){"use strict";var l=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function t(i,t,e,o){var h;var y="du-widget-"+t+"-"+i;try{if(o){h=b.select(o).append(e).attr("id",y).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{h=b.select("body").append(e).attr("id",y).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var g={tooltipContainer:"du-widget-tooltips"};var m={xDim:"px",yDim:"px",fontWeight:"normal",innerWidth:200,innerHeight:150,placeholder:false,_categories:{dim:[]},add:function(e,r,t,a,n){m[r]=t;e[r]=function(t){if(n){n(t)}else{m[r]=t}return e};if(typeof a==="string"&&m._categories.hasOwnProperty(a)){m._categories[a].push(r)}}};m.add(this,"relative",false);m.add(this,"x",0,"dim",function(t,e){m.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)m.xDim=e});m.add(this,"y",0,"dim",function(t,e){m.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)m.yDim=e});m.add(this,"width",200,"dim",function(t){m.width=t;m.innerWidth=m.width-m.margins.left-m.margins.right});m.add(this,"height",150,"dim",function(t){m.height=t;m.innerHeight=m.height-m.margins.top-m.margins.bottom});m.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(e){if(typeof e==="number"){["top","left","bottom","right"].forEach(function(t){m.margins[t]=e})}else{for(var t in e){if(e.hasOwnProperty(t)){m.margins[t]=e[t]}}}m.innerWidth=m.width-m.margins.left-m.margins.right;m.innerHeight=m.height-m.margins.top-m.margins.bottom});m.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(e){if(typeof e==="string"){["top","left","bottom","right"].forEach(function(t){m.borders[t]=e})}for(var t in e){if(e.hasOwnProperty(t)){m.borders[t]=e[t]}}});m.add(this,"fontColor","black");m.add(this,"fontSize",10,"dim");m.add(this,"fontWeight","normal");m.add(this,"label",null);m.add(this,"xLabel",null);m.add(this,"yLabel",null);m.add(this,"xTicks",null);m.add(this,"yTicks",null);m.add(this,"tickFormat",function(t){return t>1?b.format(".2s")(t):t});m.add(this,"xTickFormat",function(t){return t>1?b.format(".2s")(t):t});m.add(this,"yTickFormat",function(t){return t>1?b.format(".2s")(t):t});m.add(this,"xTickAngle",null);m.add(this,"yMin",0);m.add(this,"mouseover",null);m.add(this,"mouseleave",null);m.add(this,"click",null);m.add(this,"colors",null);m.add(this,"tooltip",false);m.add(this,"tooltipTitleFormat",function(t){return t});m.add(this,"tooltipXFormat",function(t){return t});m.add(this,"tooltipYFormat",function(t){return t});m.add(this,"tooltipZFormat",function(t){return t});var r=function(){var a=[];function t(r){return{remain:a.reduce(function(t,e){return r.indexOf(e)>-1?t.concat(e):t},[]),exit:a.reduce(function(t,e){return r.indexOf(e)===-1?t.concat(e):t},[]),enter:r.forEach(function(t,e){return a.indexOf(e)===-1?t.concat(e):t},[])}}return{update:t}}();var x=function(){function s(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function t(){var t=h.append("g");return{g:t,axisFn:{x:b.axisBottom(null).ticks(7),y:b.axisLeft(null).ticks(5)},axes:{x:t.append("g").attr("class","x axis"),y:t.append("g").attr("class","y axis")},labels:{x:t.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:t.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}}}function e(t,e,r){if(!t||t.length<1){return b.scaleLinear().domain([0,1]).range(e)}var a;switch(r){case undefined:case"linear":a=b.scaleLinear().domain(b.extent(t));break;case"time":a=b.scaleTime().domain(b.extent(t));break;case"band":a=b.scaleBand().domain(t).padding(.1);break;case"point":a=b.scalePoint().domain(t).padding(.5)}return a.range(e)}function r(t,e,r,a,n){var i=e.g.selectAll(r);i.transition();if(e!==null){if(typeof a==="string"){i.transition().duration(n?n:0).style("opacity",function(){return b.select(this).classed(s(a))?1:.1})}else if(Array.isArray(a)){var o=a.map(function(t){return s(t)});i.transition().duration(n?n:0).style("opacity",function(){var r=b.select(this);return o.reduce(function(t,e){return t||r.classed(e)},false)?1:.1})}else{i.transition().duration(n?n:0).style("opacity",1)}}return t}function a(t,e,r,a,n){var i=e.g.selectAll(r);i.transition();if(e!==null){if(a){i.transition().duration(n?n:0).style("opacity",function(t){return t.x>=a[0]&&t.x<=a[1]?1:.1})}else{i.transition().duration(n?n:0).style("opacity",1)}}return t}function n(t){if(t===null||t===undefined){return{}}if(t.length>0){if(m.colors===null||m.colors===undefined){return t.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,r){t[e]=l[r%18];return t},{})}if(typeof m.colors==="string"){var e=b.scaleLinear().domain([0,t.length]).range([m.colors,"#fff"]).interpolate(b.interpolateRgb);return t.reduce(function(t,e,r){t[e]=m.colors;return t},{})}return m.colors}}return{encode:s,standardAxis:t,scale:e,highlight:r,highlightRange:a,colors:n}}();this.id=function(){return y};this.describe=function(t){var e=null;h.on("contextmenu",function(){b.event.preventDefault();if(e===null){e=b.select("body").append("div").style("position","absolute").style("left",b.event.pageX+20+"px").style("top",b.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").style("font-family","inherit").html(t)}}).on("mouseout",function(){if(e!==null){e.remove();e=null}});return this};this.placeholder=function(t){var e=300;var r="du-widget-placeholder-"+i;if(typeof t==="string"){h.transition().duration(e).style("opacity",0);var a=b.select("#"+r);if(a.empty()){var n=o?o:"body";a=b.select(n).append("div").attr("id",r).style("position","absolute").style("width",m.width+"px").style("height",m.height+"px").style("line-height",m.height+"px").style(m.x>=0?"left":"right",Math.abs(m.x)+m.xDim).style(m.y>=0?"top":"bottom",Math.abs(m.y)+m.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",m.fontWeight).style("font-size",m.fontSize).style("color",m.fontColor).style("opacity",0).html(t).transition().duration(e).style("opacity",1)}else{a.html(t)}m.placeholder=true}else{h.transition().duration();h.transition().duration(e).style("opacity",1);var a=b.select("#"+r);if(!a.empty()){a.remove()}m.placeholder=false}return this};function v(){var t=y+"-tooltip";b.select("#"+g.tooltipContainer+" > #"+t).transition().duration(200).style("opacity",0).on("end",function(){b.select(this).style("display","none")})}function a(t){var e=y+"-tooltip";var r=b.mouse(h.node());var a=b.event.clientX;var n=b.event.clientY;var i=h.node().getBoundingClientRect();if(!t){v();x.tooltip();return}if(a<i.left+m.margins.left||a>i.right-m.margins.right||n<i.top+m.margins.top||n>i.bottom-m.margins.bottom){v();x.tooltip();return}var o=x.tooltip([r[0]-m.margins.left,r[1]-m.margins.top]);if(!o){v();x.tooltip();return}if(b.select("#"+g.tooltipContainer).empty()){b.select("body").append("div").attr("id",g.tooltipContainer)}var s=b.select("#"+e);if(b.select("#"+e).empty()){var l=b.color(m.fontColor);l.opacity=.3;s=b.select("#"+g.tooltipContainer).append("div").attr("id",e).style("position","fixed").style("min-width","100px").style("background-color","rgba(255, 255, 255, 0.98)").style("border-radius","2px").style("box-shadow","0 0 3px "+l).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",m.fontColor).style("pointer-events","none").style("z-index",9999).style("left",(i.left+i.right)/2+"px").style("top",(i.top+i.bottom)/2+"px")}s.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(o.title);s.style("border-left",o.stripe?"solid 3px "+o.stripe:null);switch(o.content.type){case"metrics":o.content.data.forEach(function(t){var e=s.append("div").style("position","relative").style("display","block").style("width","auto").style("height","10px").style("margin","5px");e.append("div").style("position","relative").style("float","left").style("color","#888").html(t.label);e.append("div").style("position","relative").style("float","right").style("margin-left","10px").html(t.value)});break;case"plots":o.content.data.forEach(function(t){if(t.color&&t.color!=="transparent"){var e=s.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");var r=e.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background-color",t.color);if(t.dashed){r.style("background","repeating-linear-gradient(45deg, transparent, transparent 2px, "+t.color+" 2px, "+t.color+" 4px)")}e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)}});break}var u=s.node().getBoundingClientRect(),c=u.width,d=u.height,f=a+20,p=n+20;if(f+c>i.right-m.margins.right-5){f-=c+40}if(p+d>i.bottom-m.margins.bottom-5){p=i.bottom-m.margins.bottom-10-d}s.style("display","block").transition().duration(0).style("opacity",1);s.transition().duration(200).ease(b.easeLinear).style("left",f+"px").style("top",p+"px")}var n={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){n.build&&n.build();this._isBuilt=true}n.update&&n.update(e);if(m.relative){h.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{h.style("position","absolute").style(m.x>=0?"left":"right",Math.abs(m.x)+m.xDim).style(m.y>=0?"top":"bottom",Math.abs(m.y)+m.yDim)}h.style("width",m.width+"px").style("height",m.height+"px");h.style("pointer-events",m.tooltip&&x.tooltip?"all":null).on("mousemove",function(){m.tooltip&&!m.placeholder&&x.tooltip&&a(true)}).on("mouseleave",function(){m.tooltip&&x.tooltip&&a(false)});h.selectAll(".axis path").style("fill","none").style("stroke",m.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");h.selectAll(".tick > line").style("stroke",m.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");h.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",m.fontSize+"px").style("fill",m.fontColor);h.style("font-family","inherit");h.selectAll("g").attr("font-family","inherit");n.style&&n.style();h.style("display","block");return this};this.remove=function(){h.remove()};return{widget:h,attr:m,data:r,utils:x,render:n}}return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.AreaChart=e(t.d3,t.du.Widget)}})(this,function(m,n){"use strict";function t(t,e){var h=n.call(this,t,"areachart","svg",e);h.attr.add(this,"opacity",.3);var y={};var a=[];var g={};var r=false;this.data=function(t){a=t.map(function(t){return{name:t.name,values:t.values.sort(function(t,e){return t.x-e.x})}});return this};this.highlight=function(t,e){if(!r)h.utils.highlight(this,y,".area",t,e);return this};h.utils.tooltip=function(c){var e=m.bisector(function(t){return y.scale.x(t.x)}).left;var d=c?a.map(function(t){return e(t.values,c[0])}):null;if(d===null){for(var t in this.tt){if(this.tt.hasOwnProperty(t))this.tt[t].remove()}this.tt=null;return}else{this.tt=this.tt||{};var f=this.tt}var p=y.scale.x.invert(c[0]);var r=a.map(function(t,e){var r=d[e],a=t.values,n=a[r-1]?a[r-1]:a[r],i=a[r]?a[r]:a[r-1],o=p-n.x>i.x-p?i:n;p=o.x;var s=y.scale.x.invert(c[0]),l=m.interpolateNumber(n.y,i.y),u=l((s-n.x)/(i.x-n.x));f[t.name]=f[t.name]||y.g.append("circle");f[t.name].attr("cx",c[0]+2).attr("cy",y.scale.y(!isNaN(u)?u:n.y)).attr("r",4).style("fill",g[t.name]);return{name:t.name,color:g[t.name],value:h.attr.tooltipYFormat(o.y)}});return{title:h.attr.tooltipXFormat(p),content:{type:"plots",data:r}}};h.render.build=function(){y=h.utils.standardAxis();y.plots={}};h.render.update=function(t){y.scale={x:h.utils.scale(a.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,h.attr.innerWidth]),y:h.utils.scale(a.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[h.attr.innerHeight,0])};var e=m.area().x(function(t){return y.scale.x(t.x)+1}).y0(h.attr.height-h.attr.margins.top-h.attr.margins.bottom).y1(function(t){return y.scale.y(t.y)});y.axes.x.transition().duration(t).call(y.axisFn.x.tickValues(h.attr.xTicks).scale(y.scale.x));y.axes.y.transition().duration(t).call(y.axisFn.y.tickValues(h.attr.yTicks).scale(y.scale.y));g=h.utils.colors(a?a.map(function(t){return t.name}):null);y.plots.areas=y.g.selectAll(".area").data(a,function(t){return t.name});y.plots.areas.exit().transition().duration(t).style("opacity",0).remove();y.plots.areas.enter().append("path").attr("class",function(t){return"area "+h.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("stroke","none").style("fill","transparent").merge(y.plots.areas).each(function(){r=true}).on("mouseover",function(t){h.attr.mouseover&&h.attr.mouseover(t.name)}).on("mouseleave",function(t){h.attr.mouseleave&&h.attr.mouseleave(t.name)}).on("click",function(t){h.attr.click&&h.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("d",function(t){return e(t.values)}).style("fill-opacity",h.attr.opacity).style("fill",function(t){return g[t.name]}).on("end",function(){r=false})};h.render.style=function(){y.g.attr("width",h.attr.innerWidth+"px").attr("height",h.attr.innerHeight+"px").attr("transform","translate("+h.attr.margins.left+","+h.attr.margins.top+")").style("pointer-events","all");y.axisFn.x.tickFormat(h.attr.xTickFormat);y.axes.x.attr("transform","translate(0,"+h.attr.innerHeight+")");y.axisFn.y.tickFormat(h.attr.yTickFormat);y.axes.y.attr("transform","translate(0,"+1+")");y.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");y.labels.x.attr("x",h.attr.innerWidth+"px").attr("y",h.attr.innerHeight+2.8*h.attr.fontSize+"px").attr("fill",h.attr.fontColor).style("font-size",h.attr.fontSize+"px").text(h.attr.xLabel);y.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",h.attr.fontColor).style("font-size",h.attr.fontSize+"px").text(h.attr.yLabel)}}t.prototype=Object.create(n.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BarChart=e(t.d3,t.du.Widget)}})(this,function(f,r){"use strict";function t(t,e){var s=r.call(this,t,"barchart","svg",e);s.attr.add(this,"vertical",false);s.attr.add(this,"xDomain",null);s.attr.add(this,"corner",0);s.attr.add(this,"values",false);s.attr.add(this,"valueFormat",function(t){return t});var l={};var u=[];var c={};var d=false;this.data=function(t){u=t;return this};this.highlight=function(t,e){if(!d)s.utils.highlight(this,l,".bar",t,e);return this};s.utils.tooltip=function(t){var e=s.attr.vertical?1:0;var r=f.bisector(function(t){return l.scale.x(t.name)}).right;var a=t?r(u,t[e]):null;if(a===null){return}var n=u[a-1]?u[a-1]:u[a];var i=u[a]?u[a]:u[a-1];var o=t[e]-n.name>i.name-t[e]?i:n;return{title:o.name,stripe:c[o.name],content:{type:"metrics",data:[{label:s.attr.yLabel+":",value:s.attr.tooltipYFormat(o.value)}]}}};s.render.build=function(){l=s.utils.standardAxis();l.plots={}};s.render.update=function(t){var e=[];if(s.attr.xDomain){e=s.attr.xDomain}else if(typeof u!=="undefined"&&u.length>0){e=u.map(function(t){return t.name}).reverse()}var r=0;if(typeof u!=="undefined"&&u.length>0){r=f.max(u,function(t){return 1.1*t.value})}if(r===0){r=1}l.scale={x:s.utils.scale(e,[s.attr.vertical?s.attr.innerHeight:s.attr.innerWidth,0],"band"),y:s.utils.scale([0,r],s.attr.vertical?[0,s.attr.innerWidth]:[s.attr.innerHeight,0])};if(s.attr.vertical){l.axisFn.x.tickFormat(s.attr.yTickFormat);l.axisFn.y.tickFormat(s.attr.xTickFormat)}else{l.axisFn.x.tickFormat(s.attr.xTickFormat);l.axisFn.y.tickFormat(s.attr.yTickFormat)}l.axes.x.transition().duration(t).call(l.axisFn.x.tickValues(s.attr.xTicks).scale(s.attr.vertical?l.scale.y:l.scale.x));l.axes.y.transition().duration(t).call(l.axisFn.y.tickValues(s.attr.yTicks).scale(s.attr.vertical?l.scale.x:l.scale.y));if(typeof u==="undefined"||u.length===0){return}c=s.utils.colors(u?u.map(function(t){return t.name}):null);l.plots.bars=l.g.selectAll(".bar").data(u,function(t){return t.name});l.plots.bars.exit().transition().duration(t).style("opacity",0).remove();var a=l.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+s.utils.encode(t.name)}).style("fill",function(t){return c[t.name]}).style("rx",s.attr.corner>0?s.attr.corner+"px":null).style("ry",s.attr.corner>0?s.attr.corner+"px":null).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none");if(s.attr.vertical){a.attr("y",function(t){return l.scale.x(t.name)}).attr("height",l.scale.x.bandwidth()).attr("x",1).attr("width",0)}else{a.attr("x",function(t){return l.scale.x(t.name)}).attr("width",l.scale.x.bandwidth()).attr("y",s.attr.height-s.attr.margins.top-s.attr.margins.bottom).attr("height",0)}var n=a.merge(l.plots.bars).each(function(){d=true}).on("mouseover",function(t){s.attr.mouseover&&s.attr.mouseover(t.name)}).on("mouseleave",function(t){s.attr.mouseleave&&s.attr.mouseleave(t.name)}).on("click",function(t){s.attr.click&&s.attr.click(t.name)});if(s.attr.vertical){n=n.transition().duration(t).attr("y",function(t){return l.scale.x(t.name)}).attr("height",l.scale.x.bandwidth()).attr("x",1).attr("width",function(t){return l.scale.y(t.value)})}else{n=n.transition().duration(t).attr("x",function(t){return l.scale.x(t.name)}).attr("width",l.scale.x.bandwidth()).attr("y",function(t){return l.scale.y(t.value)}).attr("height",function(t){return s.attr.height-s.attr.margins.top-s.attr.margins.bottom-l.scale.y(t.value)})}n.style("opacity",1).style("fill",function(t){return c[t.name]}).on("end",function(){d=false});l.plots.values=l.g.selectAll(".bar-value").data(u,function(t){return t.name});l.plots.values.exit().transition().duration(t).style("opacity",0).remove();var i=l.plots.values.enter().append("text").attr("class",function(t){return"bar-value "+s.utils.encode(t.name)}).attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size",s.attr.fontSize+"px").style("fill","white").style("stroke","none").text(function(t){return s.attr.valueFormat(t.value)});if(s.attr.vertical){i.attr("y",function(t){return l.scale.x(t.name)+l.scale.x.bandwidth()/2}).attr("x",1)}else{i.attr("x",function(t){return l.scale.x(t.name)+l.scale.x.bandwidth()/2}).attr("y",s.attr.height-s.attr.margins.top-s.attr.margins.bottom-2*s.attr.fontSize)}var o=i.merge(l.plots.values).each(function(){d=true});if(s.attr.vertical){o=o.transition().duration(t).attr("y",function(t){return l.scale.x(t.name)+l.scale.x.bandwidth()/2}).attr("x",function(t){var e=l.scale.y(t.value)-s.attr.fontSize;return e>1.5*s.attr.fontSize?e:l.scale.y(t.value)+s.attr.fontSize}).style("fill",function(t){var e=l.scale.y(t.value)-s.attr.fontSize;return e>1.5*s.attr.fontSize?"white":s.attr.fontColor}).text(function(t){return s.attr.valueFormat(t.value)})}else{o=o.transition().duration(t).attr("x",function(t){return l.scale.x(t.name)+l.scale.x.bandwidth()/2}).attr("y",function(t){var e=l.scale.y(t.value)+1.5*s.attr.fontSize;var r=s.attr.height-s.attr.margins.top-s.attr.margins.bottom;return r-e>2*s.attr.fontSize?e:l.scale.y(t.value)-.9*s.attr.fontSize}).style("fill",function(t){var e=l.scale.y(t.value)+1.5*s.attr.fontSize;var r=s.attr.height-s.attr.margins.top-s.attr.margins.bottom;return r-e>2*s.attr.fontSize?"white":s.attr.fontColor}).text(function(t){return s.attr.valueFormat(t.value)})}o.style("opacity",1).on("end",function(){d=false})};s.render.style=function(){l.g.style("width",s.attr.innerWidth+"px").style("height",s.attr.innerHeight+"px").attr("transform","translate("+s.attr.margins.left+","+s.attr.margins.top+")").style("pointer-events","all");if(s.attr.vertical){l.axisFn.x.tickFormat(s.attr.yTickFormat);l.axisFn.y.tickFormat(s.attr.xTickFormat)}else{l.axisFn.x.tickFormat(s.attr.xTickFormat);l.axisFn.y.tickFormat(s.attr.yTickFormat)}l.axes.x.call(l.axisFn.x).attr("transform","translate(0,"+s.attr.innerHeight+")");l.axes.y.call(l.axisFn.y).attr("transform","translate(0,"+1+")");l.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(s.attr.vertical){l.g.selectAll(".y.axis .tick > line").style("display","none")}if(typeof s.attr.xTickAngle==="number"){l.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+s.attr.xTickAngle+")").style("text-anchor","start")}l.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");l.labels.x.attr("x",s.attr.innerWidth+"px").attr("y",s.attr.innerHeight+2.8*s.attr.fontSize+"px").style("font-size",s.attr.fontSize+"px").style("fill",s.attr.fontColor).text(s.attr.vertical?s.attr.yLabel:s.attr.xLabel);l.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",s.attr.fontSize+"px").style("fill",s.attr.fontColor).text(s.attr.vertical?s.attr.xLabel:s.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BoxPlot=e(t.d3,t.du.Widget)}})(this,function(d,r){"use strict";function t(t,e){var i=r.call(this,t,"boxplot","svg",e);var o={};var s=[];var l=null;var u={};var c=false;this.data=function(t){s=t.map(function(t){var e=t.values.sort(d.ascending),r=d.min(e),a=d.max(e),n=d.quantile(e,.25),i=d.quantile(e,.75),o=i-n;var s=[],l=[];t.values.filter(function(t){return t<n-1.5*o||t>i+1.5*o}).forEach(function(t){if(t<n-3*o||t>i+3*o){l.push(t)}else{s.push(t)}});return{name:t.name,values:{min:r,max:a,mean:d.mean(e),median:d.median(e),q1:n,q3:i,whiskers:{lower:Math.max(r,n-1.5*o),upper:Math.min(a,i+1.5*o)},outliers:{mild:s,extreme:l}}}});return this};this.highlight=function(t,e){if(!c)i.utils.highlight(this,o,".box",t,e);return this};i.utils.tooltip=function(){return l?{title:l.name,stripe:i.attr.colors[l.name],content:{type:"metrics",data:[{label:"min/max:",value:l.values.min.toPrecision(3)+"/"+l.values.max.toPrecision(3)},{label:"mean:",value:l.values.mean.toPrecision(3)},{label:"median:",value:l.values.median.toPrecision(3)},{label:"Q1:",value:l.values.q1.toPrecision(3)},{label:"Q3:",value:l.values.q3.toPrecision(3)},{label:"mild outliers:",value:l.values.outliers.mild.length},{label:"extreme outliers:",value:l.values.outliers.extreme.length}]}}:null};i.render.build=function(){o=i.utils.standardAxis();o.plots={}};i.render.update=function(t){o.scale={x:i.utils.scale(s.map(function(t){return t.name}).reverse(),[i.attr.innerWidth,0],"point"),y:i.utils.scale(s.map(function(t){return[t.values.min-.1*(t.values.max-t.values.min),t.values.max+.1*(t.values.max-t.values.min)]}).reduce(function(t,e){return t.concat(e)},[]),[i.attr.innerHeight,0])};o.axes.x.transition().duration(t).call(o.axisFn.x.tickValues(i.attr.xTicks).scale(o.scale.x));o.axes.y.transition().duration(t).call(o.axisFn.y.tickValues(i.attr.yTicks).scale(o.scale.y));u=i.utils.colors(s?s.map(function(t){return t.name}):null);o.plots.groups=o.g.selectAll(".box-group").data(s,function(t){return t.name});o.plots.groups.exit().style("opacity",0).remove();var e=o.plots.groups.enter().append("g").attr("class",function(t){return"box-group "+i.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var r=e.merge(o.plots.groups).each(function(){c=true}).on("mouseover",function(t){l=t;i.attr.mouseover&&i.attr.mouseover(t.name)}).on("mouseleave",function(t){l=null;i.attr.mouseleave&&i.attr.mouseleave(t.name)}).on("click",function(t){i.attr.click&&i.attr.click(t.name)});r.transition().duration(t).style("opacity",1).style("fill-opacity",i.attr.opacity).style("fill",function(t){return u[t.name]}).style("stroke",function(t){return u[t.name]}).on("end",function(){c=false});e.append("rect").attr("class","body").attr("x",function(t){return o.scale.x(t.name)-10}).attr("y",function(t){return o.scale.y(t.values.q3)}).attr("width",20).attr("height",function(t){return o.scale.y(t.values.q1)-o.scale.y(t.values.q3)}).style("rx","2px").style("ry","2px").style("fill-opacity",.3).style("stroke-width","1px");r.select(".body").transition().duration(t).attr("x",function(t){return o.scale.x(t.name)-10}).attr("y",function(t){return o.scale.y(t.values.q3)}).attr("width",20).attr("height",function(t){return o.scale.y(t.values.q1)-o.scale.y(t.values.q3)});e.append("line").attr("class","median").attr("x1",function(t){return o.scale.x(t.name)-10}).attr("x2",function(t){return o.scale.x(t.name)+10}).attr("y1",function(t){return o.scale.y(t.values.median)}).attr("y2",function(t){return o.scale.y(t.values.median)}).style("stroke-width","2px").style("fill-opacity",.8);r.select(".median").transition().duration(t).attr("x1",function(t){return o.scale.x(t.name)-10}).attr("x2",function(t){return o.scale.x(t.name)+10}).attr("y1",function(t){return o.scale.y(t.values.median)}).attr("y2",function(t){return o.scale.y(t.values.median)});e.append("path").attr("class","lower-whisker").attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q1)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.lower)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.lower)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.lower)});r.select(".lower-whisker").transition().duration(t).attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q1)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.lower)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.lower)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.lower)});e.append("path").attr("class","upper-whisker").attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q3)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.upper)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.upper)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.upper)});r.select(".upper-whisker").transition().duration(t).attr("d",function(t){return"M"+o.scale.x(t.name)+","+o.scale.y(t.values.q3)+"L"+o.scale.x(t.name)+","+o.scale.y(t.values.whiskers.upper)+"M"+(o.scale.x(t.name)-8)+","+o.scale.y(t.values.whiskers.upper)+"L"+(o.scale.x(t.name)+8)+","+o.scale.y(t.values.whiskers.upper)});r.selectAll(".mild-outlier").transition().duration(t).style("opacity",0).remove();var a=r.selectAll(".mild-outlier").data(function(e){return e.values.outliers.mild.map(function(t){return{x:e.name,y:t}})});a.enter().append("circle").attr("class","mild-outlier").attr("r",2.5).attr("cx",function(t){return o.scale.x(t.x)}).attr("cy",function(t){return o.scale.y(t.y)}).attr("stroke","none").style("opacity",0).transition().duration(t).style("opacity",1);r.selectAll(".extreme-outlier").transition().duration(t).style("opacity",0).remove();var n=r.selectAll(".extreme-outlier").data(function(e){return e.values.outliers.extreme.map(function(t){return{x:e.name,y:t}})});n.enter().append("circle").attr("class","extreme-outlier").attr("r",2).attr("cx",function(t){return o.scale.x(t.x)}).attr("cy",function(t){return o.scale.y(t.y)}).attr("fill","none").attr("stroke-width","0.5px").style("opacity",0).transition().duration(t).style("opacity",1)};i.render.style=function(){i.attr.colors=i.utils.colors(s?s.map(function(t){return t.name}):null);o.g.style("width",i.attr.innerWidth+"px").style("height",i.attr.innerHeight+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");o.axes.x.attr("transform","translate(0,"+i.attr.innerHeight+")");o.axisFn.y.tickFormat(i.attr.yTickFormat);o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",i.attr.innerWidth+"px").attr("y",i.attr.innerHeight+2.8*i.attr.fontSize+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BubbleChart=e(t.d3,t.du.Widget)}})(this,function(t,l){"use strict";function e(t,e){var r=l.call(this,t,"bubblechart","svg",e);r.attr.add(this,"scale",1);r.attr.add(this,"sizeLabel","size");var a={};var n=[];var i={};var o=null;var s=false;this.data=function(t){n=t.map(function(t){return{name:t.name,values:{x:t.x,y:t.y,size:t.size}}});return this};this.highlight=function(t,e){if(!s)r.utils.highlight(this,a,".bubble",t,e);return this};r.utils.tooltip=function(){return o?{title:o.name,stripe:r.attr.colors[o.name],content:{type:"metrics",data:[{label:r.attr.xLabel+":",value:r.attr.tooltipXFormat(o.values.x)},{label:r.attr.yLabel+":",value:r.attr.tooltipYFormat(o.values.y)},{label:r.attr.sizeLabel+":",value:o.values.size.toFixed(1)}]}}:null};r.render.build=function(){a=r.utils.standardAxis();a.plots={}};r.render.update=function(t){a.scale={x:r.utils.scale(n.map(function(t){return[t.values.x-1.1*r.attr.scale*t.values.size,t.values.x+1.1*r.attr.scale*t.values.size]}).reduce(function(t,e){return t.concat(e)},[]),[0,r.attr.innerWidth]),y:r.utils.scale(n.map(function(t){return[t.values.y-1.1*r.attr.scale*t.values.size,t.values.y+1.1*r.attr.scale*t.values.size]}).reduce(function(t,e){return t.concat(e)},[]),[r.attr.innerHeight,0])};a.axes.x.transition().duration(t).call(a.axisFn.x.tickValues(r.attr.xTicks).scale(a.scale.x));a.axes.y.transition().duration(t).call(a.axisFn.y.tickValues(r.attr.yTicks).scale(a.scale.y));i=r.utils.colors(n?n.map(function(t){return t.name}):null);a.plots.bubbles=a.g.selectAll(".bubble").data(n,function(t){return t.name});a.plots.bubbles.exit().transition().duration(t).style("opacity",0).remove();a.plots.bubbles.enter().append("circle").attr("class",function(t){return"bubble "+r.utils.encode(t.name)}).attr("cx",function(t){return a.scale.x(t.values.x)}).attr("cy",function(t){return a.scale.y(t.values.y)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent").merge(a.plots.bubbles).each(function(){s=true}).on("mouseover",function(t){o=t;r.attr.mouseover&&r.attr.mouseover(t.name)}).on("mouseleave",function(t){o=null;r.attr.mouseleave&&r.attr.mouseleave(t.name)}).on("click",function(t){r.attr.click&&r.attr.click(t.name)}).transition().duration(t).attr("r",function(t){return r.attr.scale*t.values.size}).attr("cx",function(t){return a.scale.x(t.values.x)}).attr("cy",function(t){return a.scale.y(t.values.y)}).style("opacity",1).style("fill",function(t){return i[t.name]}).on("end",function(){s=false})};r.render.style=function(){a.g.attr("width",r.attr.innerWidth+"px").attr("height",r.attr.innerHeight+"px").attr("transform","translate("+r.attr.margins.left+","+r.attr.margins.top+")").style("pointer-events","all");a.axisFn.x.tickFormat(r.attr.xTickFormat);a.axes.x.attr("transform","translate(0,"+r.attr.innerHeight+")");a.axisFn.y.tickFormat(r.attr.yTickFormat);a.axes.y.attr("transform","translate(0,"+1+")");a.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");a.labels.x.attr("x",r.attr.innerWidth+"px").attr("y",r.attr.innerHeight+2.8*r.attr.fontSize+"px").attr("fill",r.attr.fontColor).style("font-size",r.attr.fontSize+"px").text(r.attr.xLabel);a.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",r.attr.fontColor).style("font-size",r.attr.fontSize+"px").text(r.attr.yLabel)}}e.prototype=Object.create(l.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Checkbox=e(t.d3,t.du.Widget)}})(this,function(i,o){"use strict";function t(t,e){var r=o.call(this,t,"legend","div",e);r.attr.add(this,"callback",null);this.check=function(t){n=t;return this};var a={};var n=null;r.render.build=function(){a.g=r.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table").style("pointer-events","all");a.container=a.g.append("div").style("display","table-cell").style("vertical-align","middle");a.label=a.container.append("label").style("display","inline-block").style("position","relative").style("cursor","pointer").style("user-select","none").style("padding-left",1.8*r.attr.fontSize+"px");a.text=a.label.append("span").text(r.attr.label);a.input=a.label.append("input").attr("type","checkbox").property("checked",false).style("position","absolute").style("opacity",0).style("width",0).style("height",0).style("cursor","pointer").on("change",function(){var t=i.select(this).property("checked");a.box.style("opacity",t?1:.1);a.checkmark.style("display",t?"block":"none");r.attr.callback&&r.attr.callback(t)});a.box=a.label.append("span").style("position","absolute").style("display","inline-block").style("top",0).style("left",0).style("width",1.2*r.attr.fontSize+"px").style("height",1.2*r.attr.fontSize+"px").style("margin-top",.5*(r.attr.height-1.4*r.attr.fontSize)+"px").style("background-color",r.attr.colors).style("opacity",.1);a.checkmark=a.box.append("span").style("position","absolute").style("display","none").style("left",.45*r.attr.fontSize+"px").style("top",.15*r.attr.fontSize+"px").style("width",.35*r.attr.fontSize+"px").style("height",.7*r.attr.fontSize+"px").style("border","solid white").style("border-width","0 "+.1*r.attr.fontSize+"px "+.1*r.attr.fontSize+"px 0").style("transform","rotate(45deg)")};r.render.update=function(){if(n!==null){a.input.property("checked",n);a.box.style("opacity",n?1:.1);a.checkmark.style("display",n?"block":"none");n=null}};r.render.style=function(){r.widget.style("font-size",r.attr.fontSize+"px");a.text.text(r.attr.label)}}t.prototype=Object.create(o.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ChordChart=e(t.d3,t.du.Widget)}})(this,function(h,y){"use strict";function t(t,e){var a=y.call(this,t,"chordchart","svg",e);a.attr.add(this,"radius",100,"dim");a.attr.add(this,"thickness",10,"dim");a.attr.add(this,"ticks",false);a.attr.add(this,"invert",false);var u={};var o=[];var n=null;var s=h.map();var l=h.map();var r=10;var i=null;var c=false;this.data=function(t){s.clear();l.clear();o=[];var i=0,e=0;t.forEach(function(t){if(!s.has(e=t.source)){l.set(i,e);s.set(e,i++)}if(!s.has(e=t.target)){l.set(i,e);s.set(e,i++)}});t.forEach(function(t){var e=s.get(t.source),r=s.get(t.target),a=o[e];if(!a){a=o[e]=[];for(var n=0;n<i;n++)a[n]=0}a[r]=t.value;if(!o[r]){o[r]=[];for(n=0;n<i;n++)o[r][n]=0}});r=h.max(l.values(),function(t){return t.length});return this};function d(t){return t.source.index<t.target.index?t.source.index+"-"+t.target.index:t.target.index+"-"+t.source.index}function f(t){var n=h.map();if(t){t.groups.forEach(function(t){n.set(t.index,t)})}return function(t){var e;var r=n.get(t.index);if(r){e=h.interpolate(r,t)}else{var a={startAngle:t.startAngle,endAngle:t.startAngle};e=h.interpolate(a,t)}return function(t){return u.arc(e(t))}}}function p(s){var l=h.map();if(s){s.forEach(function(t){l.set(d(t),t)})}return function(e){var r;var t=l.get(d(e));if(t){if(e.source.index!==t.source.index){t={source:t.target,target:t.source}}r=h.interpolate(t,e)}else{if(s){var a=s.groups.filter(function(t){return t.index===e.source.index||t.index===e.target.index});t={source:a[0],target:a[1]||a[0]};if(t.source&&e.source.index!==t.source.index){t={source:t.target,target:t.source}}}else t=e;var n=t.source?t.source.startAngle:0;var i=t.target?t.target.startAngle:0;var o={source:{startAngle:n,endAngle:n},target:{startAngle:i,endAngle:i}};r=h.interpolate(o,e)}return function(t){return u.ribbonFn(r(t))}}}this.highlight=function(t,e){if(!c)a.utils.highlight(this,u,".ribbon",t,e);return this};a.utils.tooltip=function(){if(!n){return null}var r=o[s.get(n.name)];return n?{title:n.name,stripe:a.attr.colors[n.name],content:{type:"metrics",data:r.map(function(t,e){return{name:l.get(e),value:100*t/h.sum(r)}}).sort(function(t,e){return e.value-t.value}).map(function(t){return{label:t.name,value:t.value.toFixed(1)+"%"}})}}:null};a.render.build=function(){u.g=a.widget.append("g");u.chordFn=h.chord().padAngle(.05).sortGroups(h.descending).sortSubgroups(h.descending);u.arc=h.arc();u.ribbonFn=h.ribbon();u.label=u.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};a.render.update=function(t){a.attr.colors=a.utils.colors(s?s.keys():null);var e=a.attr.radius-a.attr.thickness-a.attr.margins.left,r=a.attr.radius-a.attr.margins.left;if(u.groups)u.groups.transition();if(u.newGroups)u.newGroups.transition();if(u.ribbons)u.ribbons.transition();if(u.newRibbons)u.newRibbons.transition();u.chord=u.chordFn(o);u.arc.innerRadius(e).outerRadius(r);u.groups=u.g.selectAll(".group").data(u.chord.groups,function(t){return t.index});u.groups.exit().transition().duration(t).style("opacity",0).remove();u.newGroups=u.groups.enter().append("g").each(function(t){t.name=l.get(t.index)}).attr("class","group").style("pointer-events","all");u.newGroups.merge(u.groups).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){n=null;a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).on("mousemove",function(t){n=t});u.newGroups.append("path").attr("id",function(t){return"group"+t.index}).style("fill",function(t){return a.attr.colors[t.name]}).transition().duration(t).attrTween("d",f(i));if(a.attr.ticks){u.newGroups.append("text").attr("xlink:href",function(t){return"#group"+t.index}).attr("dy",".35em").text(function(t){return t.name}).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(a.attr.radius-a.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}u.groups.select("path").each(function(t){t.name=l.get(t.index)}).attr("d",u.arc).transition().duration(t).each(function(){c=true}).style("opacity",1).style("fill",function(t){return a.attr.colors[t.name]}).attrTween("d",f(i)).on("end",function(){c=false});if(a.attr.ticks){u.groups.select("text").transition().duration(t).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(a.attr.radius-a.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}u.ribbonFn.radius(e);u.ribbons=u.g.selectAll(".ribbon").data(u.chord,d);u.newRibbons=u.ribbons.enter().append("path").each(function(t){t.source.name=l.get(t.source.index);t.target.name=l.get(t.target.index)}).attr("class",function(t){return"ribbon "+a.utils.encode(t.source.name)}).style("pointer-events","all").style("fill",function(t){return a.attr.colors[a.attr.invert?t.source.name:t.target.name]}).style("stroke-width","1px").style("fill-opacity",.8).style("stroke-opacity",.8).style("stroke","white");u.newRibbons.transition().duration(t).attrTween("d",p(null));u.ribbons.exit().transition().duration(t).style("opacity",0).remove();u.ribbons.each(function(t){t.source.name=l.get(t.source.index);t.target.name=l.get(t.target.index)}).attr("class",function(t){return"ribbon "+a.utils.encode(t.source.name)}).transition().duration(t).style("opacity",1).style("fill",function(t){return a.attr.colors[a.attr.invert?t.source.name:t.target.name]}).attrTween("d",p(i));i=u.chord};a.render.style=function(){a.attr.width=2*a.attr.radius;a.attr.height=2*a.attr.radius;a.widget.style("width",a.attr.width+"px").style("height",a.attr.height+"px");u.g.attr("transform","translate("+a.attr.radius+","+a.attr.radius+")");if(a.attr.ticks){u.newGroups.selectAll("text").style("font-size",a.attr.fontSize*.8+"px").style("font-weight",a.attr.fontWeight).style("fill",a.attr.fontColor)}u.label.attr("transform","translate(0,"+a.attr.radius+")").style("width",2*(a.attr.radius+a.attr.thickness)+"px").attr("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.label)}}t.prototype=Object.create(y.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","d3-contour","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ContourPlot=e(t.d3,t.du.Widget)}})(this,function(p,a){"use strict";function t(t,e){var l=a.call(this,t,"contourplot","svg",e);l.attr.add(this,"layers",20);l.attr.add(this,"grid",[40,40]);l.attr.add(this,"borders",false);var u={};var c=[];var d=null;var f=null;var i=false;this.data=function(t){c={xDomain:p.extent(t,function(t){return t.x}),yDomain:p.extent(t,function(t){return t.y}),values:new Array(l.attr.grid[0]*l.attr.grid[1]).fill(0)};var a=(c.xDomain[1]-c.xDomain[0])/l.attr.grid[0],n=(c.yDomain[1]-c.yDomain[0])/l.attr.grid[1];t.forEach(function(t){var e=Math.floor((t.x-c.xDomain[0])/a),r=Math.floor((t.y-c.yDomain[0])/n);c.values[e+r*l.attr.grid[0]]+=t.value||1});return this};this.highlight=function(t,e){if(!i)l.utils.highlight(this,u,".contour",t,e);return this};l.utils.tooltip=function(t){if(f===null||!t){return null}var e=u.scale.x.invert(t[0]),r=u.scale.y.invert(t[1]);var a=(c.xDomain[1]-c.xDomain[0])/l.attr.grid[0],n=(c.yDomain[1]-c.yDomain[0])/l.attr.grid[1];var i=Math.floor((e-c.xDomain[0])/a),o=l.attr.grid[1]-Math.floor((r-c.yDomain[0])/n);var s=c.values[i+l.attr.grid[0]*o];if(typeof s==="undefined"){return null}return{title:l.attr.tooltipTitleFormat(s),stripe:d(f.value),content:{type:"metrics",data:[{label:l.attr.xLabel+":",value:l.attr.tooltipXFormat(e)},{label:l.attr.yLabel+":",value:l.attr.tooltipYFormat(r)}]}}};function r(l,u,c){return function(){var a=p.select(".contour-"+u).node(),n=a.cloneNode(),i=a.getTotalLength(),o=(n.setAttribute("d",l),n).getTotalLength();var t=[0],e=0,r=c/Math.max(i,o);while((e+=r)<1){t.push(e)}var s=t.map(function(t){var e=a.getPointAtLength(t*i),r=n.getPointAtLength(t*o);return p.interpolate([e.x,e.y],[r.x,r.y])});return function(e){return e<1?"M"+s.map(function(t){return t(e)}).join("L"):l}}}l.render.build=function(){u=l.utils.standardAxis();u.plots={}};l.render.update=function(t){u.scale={x:l.utils.scale(c.xDomain,[0,l.attr.innerWidth]),y:l.utils.scale(c.yDomain,[l.attr.innerHeight,0])};var e=p.interpolateHsl(l.attr.colors?l.attr.colors[0]:"transparent",l.attr.colors?l.attr.colors[1]:"grey"),r=p.interpolateHsl(l.attr.colors?l.attr.colors[1]:"grey",l.attr.colors?l.attr.colors[2]:"black"),a=function(t){return t<.5?e(t*2):r((t-.5)*2)};d=p.scaleSequential(a).domain(p.extent(c.values));var n=p.contours().size([l.attr.grid[0],l.attr.grid[1]]).thresholds(l.attr.layers)(c.values);u.axes.x.transition().duration(t).call(u.axisFn.x.tickValues(l.attr.xTicks).scale(u.scale.x));u.axes.y.transition().duration(t).call(u.axisFn.y.tickValues(l.attr.yTicks).scale(u.scale.y));u.plots.contours=u.g.selectAll(".contour").data(n,function(t,e){return e});u.plots.contours.exit().remove();u.plots.contours.enter().append("path").attr("class",function(t,e){return"contour contour-"+e}).attr("d",p.geoPath()).attr("transform","translate(1, 0) scale("+l.attr.innerWidth/l.attr.grid[0]+","+l.attr.innerHeight/l.attr.grid[1]+")").attr("fill",function(t){return d(t.value)}).attr("stroke",l.attr.borders?"#fff":"none").attr("stroke-width",function(t,e){return l.attr.borders&&e!==0?"0.1px":"0px"}).style("opacity",0).merge(u.plots.contours).each(function(){i=true}).on("mouseover",function(t,e){f=t;l.attr.mouseover&&l.attr.mouseover("contour-"+e)}).on("mouseleave",function(t,e){f=null;l.attr.mouseleave&&l.attr.mouseleave("contour-"+e)}).on("click",function(t,e){l.attr.click&&l.attr.click("contour-"+e)}).transition().duration(t).style("opacity",1).attr("d",p.geoPath()).style("fill",function(t){return d(t.value)}).on("end",function(){i=false})};l.render.style=function(){u.g.attr("width",l.attr.innerWidth+"px").attr("height",l.attr.innerHeight+"px").attr("transform","translate("+l.attr.margins.left+","+l.attr.margins.top+")").style("pointer-events","all");u.axisFn.x.tickFormat(l.attr.xTickFormat);u.axes.x.attr("transform","translate(0,"+l.attr.innerHeight+")");u.axisFn.y.tickFormat(l.attr.yTickFormat);u.axes.y.attr("transform","translate(0,"+1+")");u.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");u.labels.x.attr("x",l.attr.innerWidth+"px").attr("y",l.attr.innerHeight+2.8*l.attr.fontSize+"px").attr("fill",l.attr.fontColor).style("font-size",l.attr.fontSize+"px").text(l.attr.xLabel);u.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",l.attr.fontColor).style("font-size",l.attr.fontSize+"px").text(l.attr.yLabel)}}t.prototype=Object.create(a.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Grid=e(t.d3,t.du.Widget)}})(this,function(p,i){"use strict";function t(t,s){var l=i.call(this,t,"grid","div",s);var r=l.attr.x;var a=l.attr.y;var u=1;var c=1;var d=[];var f=[];var n=false;function e(){d.forEach(function(t){t.forEach(function(t){if(t){t.remove()}})});d=[];for(var t=0;t<c;t++){d.push([]);for(var e=0;e<u;e++){d[t].push(null)}}}this.x=function(t,e){l.attr.x=e!=="%"?t:window.innerWidth*t/100;r=l.attr.x;return this};this.y=function(t,e){l.attr.y=e!=="%"?t:window.innerHeight*t/100;a=l.attr.y;return this};this.rows=function(t){u=t;e();return this};this.cols=function(t){c=t;e();return this};this.show=function(t){if(t){n=true;l.widget.style("box-shadow","0 0 1px black inset");for(var e=1;e<u;e++){l.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*l.attr.height/u-1.5+"px").style("width",l.attr.width+"px").style("height","3px").style("background-color","white")}for(var r=1;r<c;r++){l.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*l.attr.width/c-1.5+"px").style("top","0").style("width","3px").style("height",l.attr.height+"px").style("background-color","white")}for(e=1;e<u;e++){l.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*l.attr.height/u-.5+"px").style("width",l.attr.width+"px").style("height","1px").style("background-color","black")}for(r=1;r<c;r++){l.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*l.attr.width/c-.5+"px").style("top","0").style("width","1px").style("height",l.attr.height+"px").style("background-color","black")}}else{n=false;l.widget.style("border",null);l.widget.selectAll(".grid-border-h").remove();l.widget.selectAll(".grid-border-v").remove()}return this};this.add=function(t,e,r,a,n){if(e<0||a<1||e+a>c||r<0||n<1||r+n>u){t.remove();return null}for(var i=e;i<e+a;i++){if(d[i]){for(var o=r;o<r+n;o++){if(d[i][o]){t.remove();return null}}}}f.push({x:e,y:r,width:a,height:n,widget:t});for(i=e;i<e+a;i++){for(o=r;o<r+n;o++){d[i][o]=t}}p.select("#"+this.id()).node().appendChild(p.select("#"+t.id()).node());t.x(e*l.attr.width/c+l.attr.x+l.attr.margins.left).y(r*l.attr.height/u+l.attr.y+p.select(s).attr("top")+l.attr.margins.left).width(a*l.attr.width/c-2*l.attr.margins.left).height(n*l.attr.height/u-2*l.attr.margins.left).render();return t};this.get=function(t,e){if(d[e]&&d[e][t]){return d[e][t].widget}else{return null}};l.render.style=function(){l.widget.style("position","absolute").style(l.attr.x>0?"left":"right",Math.abs(l.attr.x)+l.attr.xDim).style(l.attr.y>0?"top":"bottom",Math.abs(l.attr.y)+l.attr.yDim).style("width",l.attr.width+"px").style("height",l.attr.height+"px");l.widget.selectAll(".grid-border-h").style("top",function(){return p.select(this).attr("data-y")*l.attr.height/u-1+"px"}).style("width",l.attr.width+"px");l.widget.selectAll(".grid-border-v").style("left",function(){return p.select(this).attr("data-x")*l.attr.width/c-1+"px"}).style("height",l.attr.height+"px");f.forEach(function(t){t.widget.x(t.x*l.attr.width/c+l.attr.x+l.attr.margins.left).y(t.y*l.attr.height/u+l.attr.y+l.attr.margins.left).width(t.width*l.attr.width/c-2*l.attr.margins.left).height(t.height*l.attr.height/u-2*l.attr.margins.left).render(0)})}}t.prototype=Object.create(i.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","d3-contour","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.HeatMap=e(t.d3,t.du.Widget)}})(this,function(h,r){"use strict";function t(t,e){var d=r.call(this,t,"heatmap","svg",e);d.attr.add(this,"grid",[40,40]);d.attr.add(this,"smooth",false);d.attr.add(this,"background",{});d.attr.add(this,"opacity",1);d.attr.add(this,"zScale",null);var f={};var l=[];var p=null;var s=false;this.data=function(t){if(typeof t==="undefined"||t.length===0){l=undefined;return this}l={xDomain:h.extent(t,function(t){return t.x}),yDomain:h.extent(t,function(t){return t.y}),values:new Array((1+d.attr.grid[0])*(1+d.attr.grid[1])).fill(0)};var a=(l.xDomain[1]-l.xDomain[0])/d.attr.grid[0],n=(l.yDomain[1]-l.yDomain[0])/d.attr.grid[1];t.forEach(function(t){var e=Math.floor((t.x-l.xDomain[0])/a),r=Math.floor((t.y-l.yDomain[0])/n);l.values[e+r*d.attr.grid[0]]+=t.value||1});return this};d.utils.tooltip=function(t){if(!t){return null}var e=f.scale.x.invert(t[0]),r=f.scale.y.invert(t[1]);var a=(l.xDomain[1]-l.xDomain[0])/d.attr.grid[0],n=(l.yDomain[1]-l.yDomain[0])/d.attr.grid[1];var i=Math.floor((e-l.xDomain[0])/a),o=d.attr.grid[1]-Math.ceil((r-l.yDomain[0])/n);var s=l.values[i+d.attr.grid[0]*o];if(typeof s==="undefined"){return null}return{title:d.attr.tooltipTitleFormat(s),stripe:p(s),content:{type:"metrics",data:[{label:d.attr.xLabel+":",value:d.attr.tooltipXFormat(e)},{label:d.attr.yLabel+":",value:d.attr.tooltipYFormat(r)}]}}};function u(t,e,r){var a=f.canvas.ctx.createImageData(d.attr.grid[0],d.attr.grid[1]);for(var n=0,i=0,o=0;n<d.attr.grid[1];n++){for(var s=0;s<d.attr.grid[0];s++,i++,o+=4){var l=h.rgb(t[o],t[o+1],t[o+2],t[o+3]/255),u=p(e[i]),c=h.rgb(h.interpolateHsl(l,u)(r));a.data[o]=c.r;a.data[o+1]=c.g;a.data[o+2]=c.b;a.data[o+3]=255*c.opacity}}f.canvas.ctx.putImageData(a,0,0);return a}d.render.build=function(){f=d.utils.standardAxis();f.plots={};f.canvas={};f.canvas.container=d.widget.append("foreignObject").attr("x",d.attr.margins.left+1).attr("y",d.attr.margins.top).attr("width",d.attr.innerWidth).attr("height",d.attr.innerHeight);f.canvas.body=f.canvas.container.append("xhtml:body").style("margin",0).style("padding",0).style("background-color","none").style("width","100%").style("height","100%");f.canvas.background=f.canvas.body.append("div").style("position","absolute").style("margin",0).style("padding",0).style("width","100%").style("height","100%").style("background-color",d.attr.background.path?null:"transparent").style("background-image",d.attr.background.path?"url("+d.attr.background.path+")":null).style("background-repeat","none").style("background-size",d.attr.innerWidth+"px "+d.attr.innerHeight+"px").style("opacity",d.attr.background.opacity?d.attr.background.opacity:null);f.canvas.canvas=f.canvas.body.append("canvas").attr("x",0).attr("y",0).attr("width",d.attr.grid[0]).attr("height",d.attr.grid[1]).style("position","absolute").style("width",d.attr.innerWidth+"px").style("height",d.attr.innerHeight+"px");f.canvas.ctx=f.canvas.canvas.node().getContext("2d");f.canvas.img=f.canvas.ctx.createImageData(d.attr.grid[0],d.attr.grid[1]).data};d.render.update=function(a){f.scale={x:d.utils.scale(l?l.xDomain:[0,1],[0,d.attr.innerWidth]),y:d.utils.scale(l?l.yDomain:[0,1],[d.attr.innerHeight,0])};f.axes.x.transition().duration(a).call(f.axisFn.x.tickValues(d.attr.xTicks).scale(f.scale.x));f.axes.y.transition().duration(a).call(f.axisFn.y.tickValues(d.attr.yTicks).scale(f.scale.y));if(typeof l==="undefined"||l.length===0){return}var t=h.extent(l.values);var r=h.interpolateHsl(d.attr.colors?d.attr.colors[0]:"transparent",d.attr.colors?d.attr.colors[1]:"grey"),n=h.interpolateHsl(d.attr.colors?d.attr.colors[1]:"grey",d.attr.colors?d.attr.colors[2]:"black"),e=function(t){var e=d.attr.zScale?d.attr.zScale(t):t;return e<.5?r(e*2):n((e-.5)*2)};p=h.scaleSequential(e).domain(t);s=true;var i=f.canvas.ctx.createImageData(d.attr.grid[0],d.attr.grid[1]);var o=h.timer(function(t){var e=t/a;u(f.canvas.img,l.values,e);if(e>=1){var r=u(f.canvas.img,l.values,1);f.canvas.img=r.data.slice();s=false;o.stop()}})};d.render.style=function(){f.g.attr("width",d.attr.innerWidth+"px").attr("height",d.attr.innerHeight+"px").attr("transform","translate("+d.attr.margins.left+","+d.attr.margins.top+")").style("pointer-events","all");f.axisFn.x.tickFormat(d.attr.xTickFormat);f.axes.x.attr("transform","translate(0,"+d.attr.innerHeight+")");f.axisFn.y.tickFormat(d.attr.yTickFormat);f.axes.y.attr("transform","translate(0,"+1+")");f.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");f.labels.x.attr("x",d.attr.innerWidth+"px").attr("y",d.attr.innerHeight+2.8*d.attr.fontSize+"px").attr("fill",d.attr.fontColor).style("font-size",d.attr.fontSize+"px").text(d.attr.xLabel);f.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",d.attr.fontColor).style("font-size",d.attr.fontSize+"px").text(d.attr.yLabel);f.canvas.container.attr("x",d.attr.margins.left+1).attr("y",d.attr.margins.top).attr("width",d.attr.innerWidth).attr("height",d.attr.innerHeight);f.canvas.background.style("background-color",d.attr.background.path?null:"transparent").style("background-image",d.attr.background.path?"url("+d.attr.background.path+")":null).style("background-size",d.attr.innerWidth+"px "+d.attr.innerHeight+"px").style("opacity",d.attr.background.opacity?d.attr.background.opacity:1);f.canvas.canvas.style("width",d.attr.innerWidth+"px").style("height",d.attr.innerHeight+"px").style("image-rendering",d.attr.smooth?null:"crisp-edges").style("image-rendering",d.attr.smooth?null:"pixelated").style("opacity",d.attr.opacity)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Hint=e(t.d3,t.du.Widget)}})(this,function(c,d){"use strict";var t=function(){var l={};function u(){for(var t in l){if(l.hasOwnProperty(t)){delete l[t]}}l={}}function t(t,e){var r="du-widgets-hint-";var a=r+t;var n=r+"css";var i=r+"class";if(l.hasOwnProperty(a)){return l[a]}else{var o=d.call(this,t,"hint","div",e);var s=this}o.attr.add(this,"text","");o.attr.add(this,"pin",false);try{if(c.select("#"+n).empty()){c.select("head").append("style").attr("id",n).text("."+i+":after{content:' ';position:absolute;width:0;height:0;left:20.5px;bottom:-10px;border:7px solid;border-color:#000 transparent transparent #000;}")}window.addEventListener("mousemove",function(){c.selectAll("."+i+".removable").remove();u()})}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}o.render.build=function(){o.widget.attr("class",i).style("position","absolute").style("display","block").style("padding","15px").style("text-align","center").style("line-height","1.1em").style("background-color","black").style("border-radius","4px").style("color","white").style("font-size","0.9em").style("font-weight","bold").style("pointer-events","none");if(!o.attr.pin){o.widget.classed("removable",true)}};o.render.style=function(t){o.widget.style("width","auto").style("height",null).html(o.attr.text);if(!l[a]){o.widget.style("opacity",0).transition().duration(t).style("opacity",1);if(!o.attr.pin){l[a]=s}}}}return t}();t.prototype=Object.create(d.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=e(t.d3,t.du.Widget)}})(this,function(y,r){"use strict";function t(t,e){var u=r.call(this,t,"histogram","svg",e);u.attr.add(this,"min",null);u.attr.add(this,"max",null);u.attr.add(this,"bin",null);u.attr.add(this,"binnedData",false);u.attr.add(this,"normalize",false);var c={};var d=[];var f=[];var p={};var h=false;this.data=function(t){d=t;return this};this.highlight=function(t,e){if(!h)u.utils.highlight(this,c,".bar",t,e);return this};u.utils.tooltip=function(t){var e=y.bisector(function(t){return c.scale.x(t.values.x0)}).right;var r=t?e(f,t[0]):null;if(r===null){return}var a=f[r-1]?f[r-1]:f[r];var n=f[r]?f[r]:f[r-1];var i=t[0]-a.x1>n.x0-t[0]?n:a;return{title:i.name,content:{type:"metrics",data:[{label:"min:",value:i.values.x0.toPrecision(3)},{label:"max:",value:i.values.x1.toPrecision(3)},{label:"count:",value:i.values.size.toPrecision(2)},{label:"fraction:",value:(100*i.values.size/y.sum(f,function(t){return t.values.size})).toFixed(2)+"%"}]}}};u.render.build=function(){c=u.utils.standardAxis();c.plots={}};u.render.update=function(t){if(d.length===0){return}else{var e=u.attr.binnedData?d.sort(function(t,e){return t.x-e.x}):d.sort(function(t,e){return t-e})}if(u.attr.binnedData){var r=y.min(e,function(t){return t.x});var a=e[1].x-e[0].x;var n=e.length;f=e.map(function(t,e){var r={x0:t.x,x1:t.x+a,size:t.y};return{name:"bin "+e,values:r}});var i=u.attr.normalize?e.reduce(function(t,e){return t+e.y},0):1}else{r=typeof u.attr.min==="number"?u.attr.min:e[0];var o=typeof u.attr.max==="number"?u.attr.max:e[e.length-1];a=typeof u.attr.bin==="number"?u.attr.bin:2*(y.quantile(e,.75)-y.quantile(e,.25))/Math.pow(e.length,1/3);var s=[];n=Math.ceil((o-r)/a);for(var l=0;l<=n;l++){s.push(r+l*a)}i=u.attr.normalize?e.length:1;f=y.histogram().domain([r,r+n*a]).thresholds(s)(e).map(function(t,e){t.size=t.length;return{name:"bin "+e,values:t}})}c.scale={x:u.utils.scale([r,r+n*a],[0,u.attr.innerWidth]),y:u.utils.scale([0,y.max(f,function(t){return t.values.size/i})],[u.attr.innerHeight,0])};c.axes.x.transition().duration(t).call(c.axisFn.x.tickValues(u.attr.xTicks).scale(c.scale.x));c.axes.y.transition().duration(t).call(c.axisFn.y.tickValues(u.attr.yTicks).scale(c.scale.y));p=u.utils.colors(f?f.map(function(t){return t.name}):null);c.plots.bars=c.g.selectAll(".bar").data(f,function(t){return t.name});c.plots.bars.exit().transition().duration(t).style("height",0).remove();c.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+u.utils.encode(t.name)}).attr("x",function(t){return c.scale.x(t.values.x0)+1}).attr("y",u.attr.height-u.attr.margins.top-u.attr.margins.bottom-1).attr("width",function(t){return Math.max(0,Math.abs(c.scale.x(t.values.x1)-c.scale.x(t.values.x0))-2)}).attr("height",0).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none").style("fill",function(){return p[f[0].name]}).merge(c.plots.bars).each(function(){h=true}).on("mouseover",function(t){u.attr.mouseover&&u.attr.mouseover(t.name)}).on("mouseleave",function(t){u.attr.mouseleave&&u.attr.mouseleave(t.name)}).on("click",function(t){u.attr.click&&u.attr.click(t.name)}).transition().duration(t).attr("x",function(t){return c.scale.x(t.values.x0)+1}).attr("y",function(t){return u.attr.margins.top-u.attr.margins.top+c.scale.y(t.values.size/i)}).attr("width",function(t){return Math.max(0,Math.abs(c.scale.x(t.values.x1)-c.scale.x(t.values.x0))-2)}).attr("height",function(t){return u.attr.height-u.attr.margins.top-u.attr.margins.bottom-c.scale.y(t.values.size/i)}).style("opacity",1).style("fill",function(){return p[f[0].name]}).on("end",function(){h=false})};u.render.style=function(){c.g.style("width",u.attr.innerWidth+"px").style("height",u.attr.innerHeight+"px").attr("transform","translate("+u.attr.margins.left+","+u.attr.margins.top+")").style("pointer-events","all");c.axisFn.x.tickFormat(u.attr.xTickFormat);c.axisFn.y.tickFormat(u.attr.yTickFormat);c.axes.x.attr("transform","translate(0,"+u.attr.innerHeight+")");c.axes.y.attr("transform","translate(0,"+1+")");c.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof u.attr.xTickAngle==="number"){c.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+u.attr.xTickAngle+")").style("text-anchor","start")}c.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");c.labels.x.attr("x",u.attr.innerWidth+"px").attr("y",u.attr.innerHeight+2.8*u.attr.fontSize+"px").style("font-size",u.attr.fontSize+"px").style("fill",u.attr.fontColor).text(u.attr.xLabel);c.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",u.attr.fontSize+"px").style("fill",u.attr.fontColor).text(u.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.InfoBox=e(t.d3,t.du.Widget)}})(this,function(i,o){"use strict";var t=function(){var n=null;function t(){if(n){n.remove()}var e=o.call(this,"infobox","infobox","div");n=e.widget;e.attr.add(this,"content","");e.attr.add(this,"backgroundColor","#fff");var r=null;var a=null;e.render.build=function(t){e.widget.style("display","none").style("opacity",0).on("click",function(){i.select(this).transition().duration(t).style("opacity",0).on("end",function(){n.remove()})});r=e.widget.append("div").style("position","absolute").style("top",0).style("left","50%").style("width","50%").style("padding","20px").style("margin-left","calc(-25% - 10px)").style("margin-top","100px").style("box-shadow","1px 1px 4px grey").style("border-radius","3px");a=r.append("div").style("padding","10px").style("min-height","100px").style("font-size","14pt").style("text-align","left").style("overflow","scroll")};e.render.style=function(){var t=i.color("white");e.widget.style("width","100%").style("height","100%").style("top","0").style("left","0").style("pointer-events","all").style("background-color","rgba("+t.rgb().r+","+t.rgb().g+","+t.rgb().b+",0.9)");r.style("background-color",e.attr.backgroundColor);a.style("color",e.attr.fontColor).html(e.attr.content);e.widget.style("display","block").transition().duration(400).style("opacity",1)}}return t}();t.prototype=Object.create(o.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Label=e(t.d3,t.du.Widget)}})(this,function(t,n){"use strict";function e(t,e){var r=n.call(this,t,"label","div",e);r.attr.add(this,"align","center");var a={};r.render.build=function(){a.g=r.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");a.label=a.g.append("div").style("display","table-cell").style("vertical-align","middle").style("pointer-events","none").html(r.attr.label)};r.render.style=function(){a.label.style("color",r.attr.fontColor).style("font-size",r.attr.fontSize+"px").style("font-weight",r.attr.fontWeight).style("text-align",r.attr.align)}}e.prototype=Object.create(n.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Legend=e(t.d3,t.du.Widget)}})(this,function(t,r){"use strict";function e(t,e){var n=r.call(this,t,"legend","div",e);n.attr.add(this,"labels",[]);n.attr.add(this,"twoColumns",false);var i={};this.highlight=function(t,e){return n.utils.highlight(this,i,".legend-entry",t,e)};n.render.build=function(){i.g=n.widget.append("div").style("display","block").style("position","relative");i.legends={};n.attr.labels.forEach(function(t){var e=i.g.append("div").attr("class","legend-entry "+n.utils.encode(t.key)).style("display","inline-block").style("position","relative").style("width","100%").style("margin-bottom","6px").style("vertical-align","top").style("pointer-event","all");var r=e.append("div").style("display","inline-block").style("position","relative").style("float","left");var a=e.append("div").style("display","inline-block").style("position","relative").style("float","right").style("text-align","left");i.legends[t.key]={g:e,square:r,text:a}})};n.render.update=function(){n.attr.labels.forEach(function(t){i.legends[t.key].text.text(t.text||t.key)})};n.render.style=function(){n.attr.colors=n.utils.colors(n.attr.labels.map(function(t){return t.key}));i.g.style("width",n.attr.width+"px").style("height",n.attr.height+"px").style("pointer-events","all");for(var t in i.legends){if(i.legends.hasOwnProperty(t)){(function(t){var e=i.legends[t];e.g.style("width",n.attr.twoColumns?"50%":"100%");e.square.style("width",.7*n.attr.fontSize+"px").style("height",.7*n.attr.fontSize+"px").style("margin",.15*n.attr.fontSize+"px "+.15*n.attr.fontSize+"px").style("background-color",n.attr.colors[t]);if(n.attr.mouseover){e.square.style("cursor","pointer").on("mouseover",function(){n.attr.mouseover(t)})}if(n.attr.mouseleave){e.square.on("mouseleave",function(){n.attr.mouseleave(t)})}if(n.attr.click){e.square.style("cursor","pointer").on("click",function(){n.attr.click(t)})}e.text.style("width","calc(100% - "+1.2*n.attr.fontSize+"px)").style("line-height",n.attr.fontSize+"px").style("cursor",n.attr.mouseover||n.attr.click?"pointer":null).style("color",n.attr.fontColor?n.attr.fontColor:"inherit").style("font-size",n.attr.fontSize+"px").on("mouseover",function(){n.attr.mouseover&&n.attr.mouseover(t)}).on("mouseleave",function(){n.attr.mouseleave&&n.attr.mouseleave(t)}).on("click",function(){n.attr.click&&n.attr.click(t)})})(t)}}}}e.prototype=Object.create(r.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.LinearGauge=e(t.d3,t.du.Widget)}})(this,function(u,c){"use strict";function t(t,e){var a=c.call(this,t,"lineargauge","svg",e);a.attr.add(this,"min",0);a.attr.add(this,"max",1);a.attr.add(this,"thickness",20);a.attr.add(this,"tick",false);a.attr.add(this,"trackColor","rgba(0, 0, 0, 0.1)");var n={};var i=null;var o=0;var r=null;var s=null;function l(r,t){n.bar.transition().duration(t).attr("width",i(r)+"px").style("fill",s(r/(a.attr.max-a.attr.min)));if(n.label){n.label.transition().duration(t).tween("progress",function(){return function(t){var e=o+(r-o)*t;return n.label.text(a.attr.tickFormat(e))}}).on("end",function(){o=r})}}this.position=function(t){r=t;return this};a.render.build=function(){n.g=a.widget.append("g");i=u.scaleLinear().domain([a.attr.min,a.attr.max]).range([0,a.attr.innerWidth]).clamp(true);s=u.interpolateHsl(a.attr.colors?a.attr.colors[0]:"#e41a1c",a.attr.colors?a.attr.colors[1]:"#4daf4a");n.container=n.g.append("rect").attr("x",0).attr("y",0);n.bar=n.g.append("rect").attr("x",0).attr("y",0).attr("width",0).style("fill",s(0));if(a.attr.tick){n.label=n.g.append("text").attr("x",-5).attr("alignment-baseline","central").attr("text-anchor","end").text(0)}l(a.attr.min,0)};a.render.update=function(t){i=u.scaleLinear().domain([a.attr.min,a.attr.max]).range([0,a.attr.innerWidth]).clamp(true);s=u.interpolateHsl(a.attr.colors?a.attr.colors[0]:"#e41a1c",a.attr.colors?a.attr.colors[1]:"#4daf4a");if(r!==null){l(r,t);r=null}};a.render.style=function(){a.widget.style("width",a.attr.width+"px");a.widget.style("height",a.attr.height+"px");s=u.interpolateHsl(a.attr.colors?a.attr.colors[0]:"#e41a1c",a.attr.colors?a.attr.colors[1]:"#4daf4a");n.g.attr("transform","translate("+a.attr.margins.left+","+(a.attr.height-a.attr.thickness)/2+")");n.container.attr("width",a.attr.innerWidth).attr("height",a.attr.thickness).style("fill",a.attr.trackColor);n.bar.attr("height",a.attr.thickness);if(n.label){n.label.attr("y",a.attr.thickness/2).attr("font-size",a.attr.fontSize)}}}t.prototype=Object.create(c.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.LineChart=e(t.d3,t.du.Widget)}})(this,function(m,r){"use strict";function t(t,e){var f=r.call(this,t,"linechart","svg",e);f.attr.add(this,"xMin",null);f.attr.add(this,"xMax",null);f.attr.add(this,"xType","number");f.attr.add(this,"lineStyles",null);f.attr.add(this,"smooth",false);var p={},h=[],u=false,y={},c={},d={};this.data=function(t){h=t.map(function(t){return{name:t.name,values:t.values.sort(function(t,e){return t.x-e.x}).map(function(t){return{x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}})}});return this};this.highlight=function(t,e){if(!u){f.utils.highlight(this,p,".line",t,e);f.utils.highlight(this,p,".error",t,e);f.utils.highlight(this,p,".marker",t,e)}return this};function g(t,e){var r=t.getTotalLength();var a=0;var n=r;var i=(a+n)/2;e=Math.max(e,t.getPointAtLength(0).x);e=Math.min(e,t.getPointAtLength(r).x);while(i>=a&&i<=r){var o=t.getPointAtLength(i);if(Math.abs(o.x-e)<.01){return o.y}else if(o.x>e){n=i}else{a=i}i=(a+n)/2}}function l(e,t,r){var a=h.filter(function(t){return t.name===e})[0];if(!a){return null}var n=m.bisector(function(t){return t.x}).left;var i=n(a.values,t);var o=n(a.values,r);if(i===null||o===null){return null}var s=a.values[i].x,l=a.values[i].y,u=a.values[o].x,c=a.values[o].y;var d=l<c?s:u;var f=l<c?c:l;return{start:{x:s,y:l},end:{x:u,y:c},corner:{x:d,y:f}}}this.addMarker=function(t,r,a,n,e){if(c.hasOwnProperty(t)){return null}var i=l(r,a,n);var o=p.g.append("g").attr("class","marker "+f.utils.encode(r));o.append("line").attr("class","horizontal").attr("x1",p.scale.x(Math.max(i.start.x,f.attr.xMin?f.attr.xMin:i.start.x))+2).attr("y1",p.scale.y(i.corner.y)).attr("x2",p.scale.x(Math.min(i.end.x,f.attr.xMax?f.attr.xMax:i.end.x))+2).attr("y2",p.scale.y(i.corner.y)).style("stroke",y[r]).style("stroke-dasharray","3 3").style("stroke-width",1);o.append("line").attr("class","vertical").attr("x1",p.scale.x(i.corner.x)+2).attr("y1",p.scale.y(i.start.y)).attr("x2",p.scale.x(i.corner.x)+2).attr("y2",p.scale.y(i.end.y)).style("stroke",y[r]).style("stroke-dasharray","3 3").style("stroke-width",1);o.append("circle").attr("class","start").attr("cx",p.scale.x(i.start.x)+2).attr("cy",p.scale.y(i.start.y)).attr("r",4).style("stroke","none").style("fill",y[r]);o.append("circle").attr("class","end").attr("cx",p.scale.x(i.end.x)+2).attr("cy",p.scale.y(i.end.y)).attr("r",4).style("stroke","none").style("fill",y[r]);o.append("text").attr("x",p.scale.x(i.corner.x)+2).attr("y",p.scale.y(i.corner.y)).attr("dy",-5).attr("text-anchor",i.start.y<i.end.y?"start":"end").style("fill",f.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").text(e);var s={key:r,g:o,update:function(t){var e=l(r,a,n);o.select(".horizontal").transition().duration(t).attr("x1",p.scale.x(Math.max(e.start.x,f.attr.xMin?f.attr.xMin:e.start.x))+2).attr("y1",p.scale.y(e.corner.y)).attr("x2",p.scale.x(Math.min(e.end.x,f.attr.xMax?f.attr.xMax:e.end.x))+2).attr("y2",p.scale.y(e.corner.y)).style("stroke",y[this.key]);o.select(".vertical").transition().duration(t).attr("x1",p.scale.x(e.corner.x)+2).attr("y1",p.scale.y(e.start.y)).attr("x2",p.scale.x(e.corner.x)+2).attr("y2",p.scale.y(e.end.y)).style("stroke",y[this.key]);o.select(".start").transition().duration(t).attr("cx",p.scale.x(e.start.x)+2).attr("cy",p.scale.y(e.start.y)).style("fill",y[this.key]);o.select(".end").transition().duration(t).attr("cx",p.scale.x(e.end.x)+2).attr("cy",p.scale.y(e.end.y)).style("fill",y[this.key]);o.select("text").transition().duration(t).attr("x",p.scale.x(e.corner.x)+2).attr("y",p.scale.y(e.corner.y)).attr("text-anchor",e.start.y<e.end.y?"start":"end").style("fill",f.attr.fontColor)}};c[t]=s;return s};this.removeMarker=function(t){if(c.hasOwnProperty(t)){c[t].g.remove();delete c[t];return true}return false};this.addPin=function(t,e,r,a,n){if(d.hasOwnProperty(t)){return null}var i=p.g.append("g").attr("class","pin");i.append("line").attr("class","pin-needle").attr("x1",p.scale.x(e)+2).attr("y1",p.scale.y.range()[0]).attr("x2",p.scale.x(e)+2).attr("y2",(1-(n||1))*p.scale.y.range()[0]).style("stroke",r||f.attr.fontColor).style("stroke-width",1);i.append("circle").attr("class","pin-head").attr("cx",p.scale.x(e)+2).attr("cy",(1-(n||1))*p.scale.y.range()[0]).attr("r",(a||6)+"px").style("stroke","white").style("stroke-width","2px").style("fill",r||f.attr.fontColor);var o={g:i,update:function(t){i.select(".pin-needle").transition().duration(t).attr("x1",p.scale.x(e)+2).attr("y1",p.scale.y.range()[0]).attr("x2",p.scale.x(e)+2).attr("y2",(1-(n||1))*p.scale.y.range()[0]);i.select(".pin-head").transition().duration(t).attr("cx",p.scale.x(e)+2).attr("cy",(1-(n||1))*p.scale.y.range()[0])}};d[t]=o;return o};this.removePin=function(t){if(d.hasOwnProperty(t)){d[t].g.remove();delete d[t];return true}return false};f.utils.tooltip=function(l){var e=m.bisector(function(t){return p.scale.x(t.x)}).left;var u=l?h.map(function(t){return e(t.values,l[0])}):null;if(u===null){for(var t in this.tt){if(this.tt.hasOwnProperty(t))this.tt[t].remove()}this.tt=null;return}else{this.tt=this.tt||{};var c=this.tt}var d=p.scale.x.invert(l[0]);var r=h.map(function(t,e){var r=u[e],a=t.values,n=a[r-1]?a[r-1]:a[r],i=a[r]?a[r]:a[r-1],o=d-n.x>i.x-d?i:n;d=o.x;var s=g(p.plots.paths[t.name],l[0]);c[t.name]=c[t.name]||p.g.append("circle");c[t.name].attr("cx",l[0]+2).attr("cy",s).attr("r",4).style("fill",y[t.name]);return{name:t.name,color:y[t.name],dashed:f.attr.lineStyles&&f.attr.lineStyles[t.name]?true:undefined,value:f.attr.tooltipYFormat(o.y)}});return{title:f.attr.tooltipXFormat(d),content:{type:"plots",data:r}}};f.render.build=function(){p=f.utils.standardAxis();p.plots={}};f.render.update=function(t){var e=h.map(function(t){return{name:t.name,values:t.values.filter(function(t){return(f.attr.xMax===null||t.x<=f.attr.xMax)&&(f.attr.xMin===null||t.x>=f.attr.xMin)})}});var r=e.reduce(function(t,e){return t.concat(e.values)},[]);var a=m.min(r,function(t){return t.y-(t.lo?t.lo:0)});var n=m.max(r,function(t){return t.y+(t.hi?t.hi:0)});p.scale={x:f.utils.scale(e.reduce(function(t,e){return t.concat(e.values)},(f.attr.xMin?[{x:f.attr.xMin}]:[]).concat(f.attr.xMax?[{x:f.attr.xMax}]:[])).map(function(t){return t.x}),[0,f.attr.innerWidth]),y:f.utils.scale(e.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}).concat([a,n]),[f.attr.innerHeight,0])};var i=m.line().x(function(t){return p.scale.x(t.x)+2}).y(function(t){return p.scale.y(t.y)}).curve(f.attr.smooth?m.curveMonotoneX:m.curveLinear);var o=m.area().x(function(t){return p.scale.x(t.x)+2}).y0(function(t){return p.scale.y(Math.max(t.y-t.lo,a))}).y1(function(t){return p.scale.y(Math.min(t.y+t.hi,n))}).curve(f.attr.smooth?m.curveMonotoneX:m.curveLinear);p.axes.x.transition().duration(t).call(p.axisFn.x.tickValues(f.attr.xTicks).scale(p.scale.x));p.axes.y.transition().duration(t).call(p.axisFn.y.tickValues(f.attr.yTicks).scale(p.scale.y));y=f.utils.colors(h?h.map(function(t){return t.name}):null);p.plots.errors=p.g.selectAll(".error").data(e,function(t){return t.name});p.plots.errors.exit().transition().duration(t).style("opacity",0).remove();p.plots.errors=p.plots.errors.enter().append("path").attr("class",function(t){return"error "+f.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("stroke","none").style("fill","transparent").merge(p.plots.errors).each(function(){u=true}).on("mouseover",function(t){f.attr.mouseover&&f.attr.mouseover(t.name)}).on("mouseleave",function(t){f.attr.mouseleave&&f.attr.mouseleave(t.name)}).on("click",function(t){f.attr.click&&f.attr.click(t.name)}).transition().duration(t).attr("d",function(t){return o(t.values)}).style("opacity",1).style("fill-opacity",.2).style("fill",function(t){return y[t.name]});p.plots.paths={};p.plots.lines=p.g.selectAll(".line").data(e,function(t){return t.name});p.plots.lines.exit().transition().duration(t).style("opacity",0).remove();p.plots.lines.enter().append("path").attr("class",function(t){return"line "+f.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","none").merge(p.plots.lines).on("mouseover",function(t){f.attr.mouseover&&f.attr.mouseover(t.name)}).on("mouseleave",function(t){f.attr.mouseleave&&f.attr.mouseleave(t.name)}).on("click",function(t){f.attr.click&&f.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("d",function(t){return i(t.values)}).style("stroke-width","2px").style("stroke-dasharray",function(t){return f.attr.lineStyles&&f.attr.lineStyles[t.name]?f.attr.lineStyles[t.name]:null}).style("stroke",function(t){return y[t.name]}).on("end",function(t){u=false;p.plots.paths[t.name]=m.select(this).node()});for(var s in c){if(c.hasOwnProperty(s)){c[s].update(t)}}for(var l in d){if(d.hasOwnProperty(l)){d[l].update(t)}}};f.render.style=function(){p.g.attr("width",f.attr.innerWidth+"px").attr("height",f.attr.innerHeight+"px").attr("transform","translate("+f.attr.margins.left+","+f.attr.margins.top+")").style("pointer-events","all");p.axisFn.x.tickFormat(f.attr.xTickFormat);p.axes.x.attr("transform","translate(0,"+f.attr.innerHeight+")");p.axisFn.y.tickFormat(f.attr.yTickFormat);p.axes.y.attr("transform","translate(0,"+1+")");p.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");p.labels.x.attr("x",f.attr.innerWidth+"px").attr("y",f.attr.innerHeight+2.8*f.attr.fontSize+"px").style("fill",f.attr.fontColor).style("font-size",f.attr.fontSize+"px").text(f.attr.xLabel);p.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",f.attr.fontColor).style("font-size",f.attr.fontSize+"px").text(f.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("topojson"),require("leaflet"),require("./math.la"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","topojson","leaflet","src/math.la","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Map=e(t.d3,t.topojson,t.L,t.du.math.la,t.du.Widget)}})(this,function(A,c,s,j,a){"use strict";function t(t,e){var v="du-widgets-map";var F=a.call(this,t,"map","div",e);var b=this;F.attr.add(this,"resource",null);F.attr.add(this,"centerX",0);F.attr.add(this,"centerY",0);F.attr.add(this,"backgroundColor","white");F.attr.add(this,"foregroundColor","black");F.attr.add(this,"borderColor","white");F.attr.add(this,"outClick",null);F.attr.add(this,"tiles",null);F.attr.add(this,"noZoom",false);F.attr.add(this,"ready",null);var x=function(){var a=null;var n=null;var i=A.map();function t(e){A.json(F.attr.resource,function(t,r){a=c.feature(r.paths,r.paths["objects"]["countries"]).features;a.filter(function(e){return r.info.some(function(t){if(e.id===t.id)return e.name=t.name})}).sort(function(t,e){return t.name.localeCompare(e.name)});n=A.map();r.info.forEach(function(t){n.set(t.name,{name:t.name,capital:t.capital,population:t.population})});a.forEach(function(t,e){i.set(t.name,e)});e&&e()})}function e(t){return i.has(t)?i.get(t):null}function r(){return a.map(function(t){return{id:t.id,name:t.name}})}function o(t){return t&&n.has(t)?n.get(t).capital:n.values().map(function(t){return{name:t.name,capital:t.capital}})}function s(t){return t&&n.has(t)?n.get(t).population:n.values().map(function(t){return{name:t.name,population:t.population}})}function l(t,e){var r,a,n,i,o,s=t[0],l=t[1],u=false;for(var c=0,d=e.length-1;c<e.length;d=c++){r=e[c][0];n=e[c][1];a=e[d][0];i=e[d][1];o=n>l!==i>l&&s<(a-r)*(l-n)/(i-n)+r;if(o)u=!u}return u}function u(t,e){var r=x._id(t);if(r){var a=C._project(e);var n=x._paths()[r].svg.areas;for(var i=0;i<n.length;i++){if(l(a,n[i])){return true}}}return false}return{_paths:function(){return a},_id:e,_build:t,get:r,capital:o,population:s,containsGeoLoc:u}}();this.countries={get:x.get,capital:x.capital,population:x.population,containsGeoLoc:x.containsGeoLoc};var r=function(){var i={};function o(t,e){return F.utils.encode(t)+"__"+F.utils.encode(e)}function t(t){if(t&&i.hasOwnProperty(t)){return Object.keys(i[t])}else{return Object.keys(i)}}function e(t,e){if(!i.hasOwnProperty(t)){i[t]=e;return true}else{return false}}function r(t){if(i.hasOwnProperty(t)){for(var e in i[t]){if(i[t].hasOwnProperty(e)){var r=o(t,e),a=i[t][e];a.forEach(function(t){if(typeof x._id(t)==="number"){C._select(t).classed(r,false)}})}}return true}else{return false}}function a(){for(var t in i){if(i.hasOwnProperty(t)){var e=i[t];for(var r in i[t]){if(i[t].hasOwnProperty(r)){var a=o(t,r),n=i[t][r];n.forEach(function(t){if(typeof x._id(t)==="number"){C._select(t).classed(a,true)}})}}}}}return{get:t,add:e,remove:r,selector:o,_mark:a}}();this.clustering={get:r.get,add:r.add,remove:r.remove,selector:r.selector};var P=function(){var s=4096;var t=.3;var l={};var e=A.zoomIdentity;var r=1;var u=A.zoom().scaleExtent([1,s]).on("zoom",d);function a(t){return e.apply(t)}function n(t){return e.invert(t)}function i(){return r}function o(){u.translateExtent([[-t*F.attr.width,-t*F.attr.height],[(1+t)*F.attr.width,(1+t)*F.attr.height]])}function c(t,e){l[t]=e}function d(){if(F.attr.noZoom){return}var t=A.event.transform.k;l.map.paths.style("stroke-width",.5/t+"px");l.map.paths.attr("transform",A.event.transform);g._zoom(A.event.transform);y._zoom(A.event.transform);m._zoom(A.event.transform);w._zoom(A.event.transform);if(A.event&&A.event.transform){e=A.zoomIdentity.translate(A.event.transform.x,A.event.transform.y).scale(A.event.transform.k);r=A.event.transform.k}}function f(){l.map.svg.transition().duration(1e3).call(u.transform,A.zoomIdentity)}function p(t){var e=t[1][0]-t[0][0],r=t[1][1]-t[0][1],a=(t[0][0]+t[1][0])/2,n=(t[0][1]+t[1][1])/2,i=Math.max(1,Math.min(s,.8/Math.max(e/F.attr.width,r/F.attr.height))),o=[F.attr.width/2-i*a,F.attr.height/2-i*n];l.map.svg.transition().duration(1e3).call(u.transform,A.zoomIdentity.translate(o[0],o[1]).scale(i))}function h(){return e}return{init:o,setLayer:c,zoom:u,reset:f,click:p,transform:a,invert:n,level:i,current:h}}();var C=function(){var t=F.widget.append("svg").attr("id",v+"-map-layer").style("position","absolute").call(P.zoom);var e=t.append("rect").attr("id","water").style("position","absolute").style("width","100%").style("height","100%").style("fill","transparent").style("top",0).style("left",0);var r=t.append("g").attr("id","land");var i=null;var o=A.geoMercator().precision(.1);var s=A.geoPath().projection(o);var a=null;function n(t){return o([t[1],t[0]])}function l(t){return o.invert(t).reverse()}function u(){x._paths().forEach(function(t){t.svg.center=s.centroid(t)})}function c(){x._paths().forEach(function(r){var a=[];var n=[];var t=r.geometry.coordinates;if(t.length===1){t[0].forEach(function(t){var e=o(t);a.push(Math.abs(e[0]-r.svg.center[0]));n.push(Math.abs(e[1]-r.svg.center[1]))})}else{t.forEach(function(t){t[0].forEach(function(t){var e=o(t);a.push(Math.abs(e[0]-r.svg.center[0]));n.push(Math.abs(e[1]-r.svg.center[1]))});if(t.length>1){t.forEach(function(t){var e=o(t);a.push(Math.abs(e[0]-r.svg.center[0]));n.push(Math.abs(e[1]-r.svg.center[1]))})}})}r.svg.width=A.max(a)*2;r.svg.height=A.max(n)*2})}function d(){x._paths().forEach(function(r){r.svg.areas=null;if(r.geometry.coordinates.length===1){var e=[];r.geometry.coordinates[0].forEach(function(t){e.push(o(t))});r.svg.areas=[e]}else{r.svg.areas=[];r.geometry.coordinates.forEach(function(t){var e=[];if(t.length>1){t.forEach(function(t){e.push(o(t))})}else{t[0].forEach(function(t){e.push(o(t))})}r.svg.areas.push(e)})}})}function f(){i=r.selectAll("path").data(x._paths()).enter().append("path").attr("class",function(t){return"country-"+x._id(t.name)}).style("stroke-width","0.5px").style("cursor","pointer");p();h()}function p(){if(i===null){return}o.scale(F.attr.width/(2*Math.PI)).translate([F.attr.width/2+F.attr.centerX,F.attr.height/2+F.attr.centerY]);s=A.geoPath().projection(o);x._paths().forEach(function(t){t.svg={}});u();c();d()}function h(){if(i===null){return}t.attr("width",F.attr.width+"px").attr("height",F.attr.height+"px");e.style("fill",F.attr.backgroundColor).style("width",F.attr.width+"px").style("height",F.attr.height+"px").on("click",function(){P.reset();i.classed("focus",false).style("fill",function(t){return F.attr.colors&&F.attr.colors[t.name]?F.attr.colors[t.name]:F.attr.foregroundColor});if(F.attr.outClick)F.attr.outClick()});i.attr("d",s).style("fill",function(t){return F.attr.colors&&F.attr.colors[t.name]?F.attr.colors[t.name]:F.attr.foregroundColor}).style("stroke",F.attr.borderColor).style("cursor","pointer").on("mouseover",function(t,e){A.select(this).style("fill",A.color(F.attr.colors&&F.attr.colors[t.name]?F.attr.colors[t.name]:F.attr.foregroundColor).brighter());F.attr.mouseover&&F.attr.mouseover(t.name)}).on("mouseleave",function(t,e){var r=A.select(this);var a=A.color(F.attr.colors&&F.attr.colors[t.name]?F.attr.colors[t.name]:F.attr.foregroundColor);r.style("fill",r.classed("focus")?a.brighter():a);F.attr.mouseleave&&F.attr.mouseleave(t.name)}).on("click",function(e,t){var r=A.select(this);var a=r.classed("focus");if(a)P.reset();else{P.click(s.bounds(e))}i.classed("focus",function(t){return t===e?!a:false}).style("fill",function(t){return F.attr.colors&&F.attr.colors[t.name]?F.attr.colors[t.name]:F.attr.foregroundColor});var n=A.color(F.attr.colors&&F.attr.colors[e.name]?F.attr.colors[e.name]:F.attr.foregroundColor);r.style("fill",!a?n.brighter():n);F.attr.click&&F.attr.click(e.name)});P.setLayer("map",{svg:t,paths:i,labels:a})}function y(t){if(typeof t==="string"){return x._id(t)?r.select("path.country-"+x._id(t)):r.selectAll("path."+F.utils.encode(t))}else{return i}}function g(t){i.style("opacity",t?t:1);return b}function m(r,a,t){y(r).transition().duration(t?t:0).style("fill",function(t){var e=F.attr.colors&&F.attr.colors[t.name]?F.attr.colors[t.name]:F.attr.foregroundColor;return typeof a==="string"?a:typeof r==="string"?A.color(e).brighter():e});return b}return{_select:y,_project:n,_invert:l,_build:f,_update:p,_style:h,dim:g,highlight:m}}();this.dim=C.dim;this.highlight=C.highlight;var y=function(){var l=F.widget.append("div").attr("id",v+"-static-layers").style("position","absolute").style("pointer-events","none").style("z-index",9).style("width",F.attr.width+"px").style("height",F.attr.height+"px");var x={};function u(t,e,r){return[e[0]*t[0]+r[0],e[1]*t[1]+r[1]]}function t(){return Object.keys(x)}function e(t){var s=F.utils.encode(t);if(!x.hasOwnProperty(s)){x[s]=function(){var t=l.append("canvas").attr("id",v+"-static-layer-"+s).attr("width",F.attr.width+"px").attr("height",F.attr.height+"px").style("position","absolute").style("pointer-events","none");var h=t.node().getContext("2d");var n=[];function e(t,e){i[t](e);n.push({type:t,params:e});return true}function r(t,e){var r=[1/t,1/t],a=[F.attr.centerX*(t-1)/t,(F.attr.height*(t-e)/2+F.attr.centerY*(t-1))/t];n.forEach(function(t){switch(t.type){case"dot":case"circle":t.params.pos=u(t.params.pos,r,a);break;case"arrow":for(var e=0;e<t.params.segments.length;e++){t.params.segments[e]=new j.Vector2(u(t.params.segments[e].toArray(),r,a))}break}})}function a(){n=[]}var i={dot:function(t,e){if(t.color)h.fillStyle=t.color;var r=t.size/(e?P.level():1);var a=!e?P.transform(t.pos):t.pos;h.fillRect(a[0]-r/2,a[1]-r/2,r,r)},circle:function(t,e){if(t.color)h.fillStyle=t.color;var r=t.radius/(e?P.level():1);var a=!e?P.transform(t.pos):t.pos;h.beginPath();h.arc(a[0],a[1],r,0,2*Math.PI,false);h.fill()},arrow:function(t,e){if(t.color)h.strokeStyle=t.color;var r=t.width/(e?P.level():1);var a=[];t.segments.forEach(function(t){a.push(!e?t.map(P.transform):t)});var n=r*2;var i=r*5;var o=a[a.length-2];var s=a[a.length-1];var l=s.sub(o).length(i);h.beginPath();h.lineWidth=r;h.lineJoin="round";h.moveTo(a[0].x(),a[0].y());for(var u=1;u<a.length-1;u++){if(a[u].sub(a[u-1]).length()<.6*F.attr.width)h.lineTo(a[u].x(),a[u].y());else h.moveTo(a[u].x(),a[u].y())}var c=s.sub(l.length(.5*i));h.lineTo(c.x(),c.y());h.stroke();var d=l.angle(l.angle()+Math.PI/2).length(n);var f=s.sub(l).sub(d);var p=s.sub(l).add(d);h.beginPath();h.moveTo(f.x(),f.y());h.lineTo(p.x(),p.y());h.lineTo(s.x(),s.y());h.closePath();h.fillStyle=t.color;h.fill()}};function o(){var t=P.invert([0,0]);var e=P.invert([F.attr.width,F.attr.height]);var r={xMin:t[0],xMax:e[0],yMin:t[1],yMax:e[1]};n.forEach(function(t){if(t.params.pos&&(t.params.pos[0]<r.xMin||t.params.pos[0]>r.xMax||t.params.pos[1]<r.yMin||t.params.pos[1]>r.yMax)){return}i[t.type](t.params,true)})}return{g:t,canvas:h,rescaleContent:r,clearContent:a,append:e,render:o}}();return true}else{return false}}function r(){var t=parseFloat(l.style("width"))/F.attr.width;var e=parseFloat(l.style("height"))/F.attr.height;l.style("width",F.attr.width+"px").style("height",F.attr.height+"px");for(var r in x){if(x.hasOwnProperty(r)){var a=x[r];a.g.attr("width",F.attr.width+"px").attr("height",F.attr.height+"px");a.rescaleContent(t,e);a.render()}}d(P.current())}function a(t){var e=F.utils.encode(t);if(x.hasOwnProperty(e)){x[e].canvas.clearRect(0,0,F.attr.width,F.attr.height);x[e].clearContent();return true}else{return false}}function n(){for(var t in x){if(x.hasOwnProperty(t)){var e=x[t];e.canvas.save();e.canvas.clearRect(0,0,F.attr.width,F.attr.height)}}}function i(t){var e=F.utils.encode(t);if(e&&x.hasOwnProperty(e)){for(var r in x){if(x.hasOwnProperty(r)){x[r].g.transition().duration(100).style("opacity",e===r?1:0)}}}else{for(var r in x){if(x.hasOwnProperty(r)){x[r].g.transition().duration(100).style("opacity",1)}}}return b}function o(t){for(var e in x){if(x.hasOwnProperty(e)){x[e].render(t)}}}function s(){for(var t in x){if(x.hasOwnProperty(t)){x[t].canvas.restore()}}}var c={dot:function(t,e,r,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var n=F.utils.encode(t);return x.hasOwnProperty(n)&&x[n].append("dot",{pos:C._project(e),size:r,color:a})},circle:function(t,e,r,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof r!=="number"||isNaN(r)||r<=0)return false;var n=F.utils.encode(t);return x.hasOwnProperty(n)&&x[n].append("circle",{pos:C._project(e),radius:r,color:a})},arrow:function(t,e,r,a,n){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof a!=="number")return false;var i=F.utils.encode(t);if(x.hasOwnProperty(i)){var o=new j.LatLon(e).toVec(),s=new j.LatLon(r).toVec(),l=o.cross(s).cross(o).length(1),u=Math.acos(o.dot(s));var c=1,d=100,f=a*5,p=new j.Vector2(C._project(e)),h=new j.Vector2(C._project(r)),y=p,g=[y];do{var m=new j.Vector2(C._project(o.multiply(Math.cos((c+1)*u/d)).add(l.multiply(Math.sin((c+1)*u/d))).toLatLon().toArray()));c++;y=m;g.push(m)}while(c<d&&m.sub(h).length()>f);g.push(h);x[i].append("arrow",{segments:g,width:a,color:n});return true}else{return false}}};function d(t){y._clear();for(var e in x){if(x.hasOwnProperty(e)){var r=x[e];r.canvas.translate(t.x,t.y);r.canvas.scale(t.k,t.k)}}y._render(t.k);y._restore()}return{_style:r,_zoom:d,_clear:n,_restore:s,_render:o,get:t,add:e,highlight:i,erase:a,draw:c}}();this.staticLayer={get:y.get,add:y.add,erase:y.erase,highlight:y.highlight,draw:y.draw};var g=function(){var t=F.widget.append("div").attr("id",v+"-tiles-layer").style("position","absolute").style("pointer-events","none").style("z-index",99).style("mix-blend-mode","multiply").style("width",F.attr.width+"px").style("height",F.attr.height+"px");var r=null;function a(t){return C._invert([t[0]-.5*F.attr.width,t[1]+.5*F.attr.height])}function n(t){return Math.log(.00391382924*t*F.attr.width)/Math.log(2)}function e(){if(F.attr.tiles===null){return}if(!this.headerAdded){A.select("head").append("link").attr("rel","stylesheet").attr("href","https://unpkg.com/leaflet@1.3.1/dist/leaflet.css").attr("integrity","sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==").attr("crossorigin","");this.headerAdded=true}r=s.map(v+"-tiles-layer",{attributionControl:false,zoomSnap:0,zoomControl:false}).setView(a([0,0]),n(P.level()));var t=null,e=null;switch(F.attr.tiles){case"cartodb-positron":t="https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";e="abcd";break}if(t&&e){s.tileLayer(t,{subdomains:e}).addTo(r)}i()}function i(){if(r===null){return}t.style("width",F.attr.width+"px").style("height",F.attr.height+"px");setTimeout(function(){r.invalidateSize();r.setView(a([0,0]),n(P.level()),{animate:false})},200)}function o(t){if(r===null){return}r.setView(a([-t.x/t.k-.5*(t.k-1)*F.attr.width/t.k,-t.y/t.k-.5*(t.k-1)*F.attr.height/t.k]),n(t.k),true)}return{_build:e,_style:i,_getLatLon:a,_getZoom:n,_zoom:o}}();var m=function(){var n=F.widget.append("div").attr("id",v+"-dynamic-layers").style("z-index",99).style("position","absolute").style("pointer-events","none");var M={};function t(){return Object.keys(M)}function e(t){var r=F.utils.encode(t);if(!M.hasOwnProperty(r)){M[r]=function(){var t=n.append("svg").attr("id",v+"-dynamic-layer-"+r).attr("width",F.attr.width+"px").attr("height",F.attr.height+"px").style("position","absolute").style("pointer-events","none").append("g");var a=[];function e(t){a.push({elem:t,birth:(new Date).getTime()/1e3})}setInterval(function(){var e=(new Date).getTime()/1e3;var r=[];a.forEach(function(t){if(e-t.birth>10){t.elem.transition().duration(700).style("opacity",0).on("end",function(){A.select(this).remove()})}else{r.push(t)}});a=r},2e3);return{g:t,append:e}}();return true}else{return false}}function r(){n.style("width",F.attr.width+"px").style("height",F.attr.height+"px");for(var t in M){if(M.hasOwnProperty(t)){M[t].g.attr("width",F.attr.width+"px").attr("height",F.attr.height+"px")}}}function a(t){var e=F.utils.encode(t);if(M.hasOwnProperty(e)){M[e].g.html("");return true}else{return false}}function i(t){var e=F.utils.encode(t);if(e&&M.hasOwnProperty(e)){for(var r in M){if(M.hasOwnProperty(r)){M[a].g.transition().duration(200).style("opacity",e===r?1:0)}}}else{for(var a in M){if(M.hasOwnProperty(a)){M[a].g.transition().duration(200).style("opacity",1)}}}return b}var o={circle:function(t,e,r,a,n,i){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof r!=="number"||isNaN(r)||r<=0)return false;var o=F.utils.encode(t);if(M.hasOwnProperty(o)){var s=r/P.level();var l=C._project(e);var u=M[o].g.append("circle").attr("class","circle").attr("cx",l[0]).attr("cy",l[1]).attr("r",s).style("fill",a);M[o].append(u);u.transition().duration(n?n:700).ease(A.easeExp).attr("r",0).on("end",function(){i&&i();A.select(this).remove()});return true}else{return false}},arrow:function(t,e,r,a,n,i,o){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof a!=="number")return false;var s=F.utils.encode(t);if(M.hasOwnProperty(s)){var l=100;var u=null;var c=null;var d=new j.Vector2(C._project(e));var f=new j.Vector2(C._project(r));var p=a/P.level();var h=p*2;var y=p*5;u=M[s].g.append("path").style("fill","none").style("stroke",n).style("stroke-width",p).attr("d","M"+d.x()+","+d.y());c=M[s].g.append("path").style("fill",n).style("stroke","none");var g=new j.LatLon(e).toVec();var m=new j.LatLon(r).toVec();var x=g.cross(m).cross(g).length(1);var v=Math.acos(g.dot(m));var b=1;var w=d;var k=(typeof i==="number"?i:700)/l;var z=setInterval(function(){var t=new j.Vector2(C._project(g.multiply(Math.cos((b+1)*v/l)).add(x.multiply(Math.sin((b+1)*v/l))).toLatLon().toArray()));u.attr("d",u.attr("d")+(t.sub(w).length()<.5*F.attr.width?"L":"M")+t.x()+","+t.y());if(t.sub(w).length()<.5*F.attr.width){var e=t.sub(w).length(1);var r=e.angle(e.angle()+Math.PI/2).multiply(h);var a=t.sub(r);var n=t.add(r);var i=t.add(e.multiply(y));c.attr("d","M"+a.x()+","+a.y()+"L"+n.x()+","+n.y()+"L"+i.x()+","+i.y()+"Z")}if(t.sub(f).length()>y){b++;w=t}else{clearInterval(z);e=f.sub(t).length(1);r=e.angle(e.angle()+Math.PI/2).multiply(h);a=f.sub(e.multiply(y)).sub(r);n=f.sub(e.multiply(y)).add(r);c.transition().duration(k).attr("d","M"+a.x()+","+a.y()+"L"+n.x()+","+n.y()+"L"+f.x()+","+f.y()+"Z").on("end",function(){o&&o();u.transition().duration(1e3).style("opacity",0).on("end",function(){A.select(this).remove()});A.select(this).transition().duration(1e3).style("opacity",0).on("end",function(){A.select(this).remove()})})}},k);return true}else{return false}}};function s(t){for(var e in M){if(M.hasOwnProperty(e)){M[e].g.attr("transform",t)}}}return{_style:r,_zoom:s,get:t,add:e,highlight:i,erase:a,draw:o}}();this.dynamicLayer={get:m.get,add:m.add,highlight:m.highlight,erase:m.erase,draw:m.draw};var w=function(){var t=F.widget.append("svg").attr("id",v+"-touch-layer").attr("width",F.attr.width+"px").attr("height",F.attr.height+"px").style("position","absolute").style("pointer-events","none");var l=t.append("g");function e(t,e,r,a,n,i){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var o=r/P.level();var s=C._project(e);l.append("circle").attr("id",v+"-touch-layer-"+t).attr("cx",s[0]).attr("cy",s[1]).attr("r",o).style("fill",null).style("opacity",0).style("pointer-events","all").on("mouseover",function(t,e){if(a)a(t,e)}).on("mouseleave",function(t,e){if(n)n(t,e)}).on("click",function(t,e){if(i)i(t,e)});return true}function r(t){var e=l.select("#"+t);if(e.empty())return false;else{e.remove();return true}}function a(){t.style("width",F.attr.width+"px").style("height",F.attr.height+"px");l.style("width",F.attr.width+"px").style("height",F.attr.height+"px")}function n(t){l.attr("transform",t)}function i(){l.html("")}return{_style:a,_zoom:n,add:e,remove:r,erase:i}}();this.touchLayer={add:w.add,remove:w.remove,erase:w.erase};F.render.build=function(){x._build(function(){C._build();g._build();F.attr.ready&&F.attr.ready()})};F.render.update=function(){C._update()};F.render.style=function(){F.widget.style("background-color",F.attr.backgroundColor).style("pointer-events",null);P.init();C._style();g._style();y._style();m._style();w._style();r._mark()}}t.prototype=Object.create(a.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.MultiBarChart=e(t.d3,t.du.Widget)}})(this,function(y,a){"use strict";function t(t,e){var u=a.call(this,t,"multibarchart","svg",e);u.attr.add(this,"barWidth",false);u.attr.add(this,"sortByX",false);u.attr.add(this,"xDomain",null);var c={};var f=[];var l={};var d=null;var p=false;var h={};this.data=function(t){f=t?t.map(function(t){return{name:t.name,values:t.values.map(function(t){return{x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}})}}):undefined;return this};this.highlight=function(t,e){if(!p)u.utils.highlight(this,c,".bar",t,e);return this};this.highlightRange=function(t,e){if(!p)u.utils.highlightRange(this,c,".bar",t,e);return this};function r(e,t){var r=f.filter(function(t){return t.name===e})[0];if(!r){return null}var a=y.bisector(function(t){return t.x}).left;var n=a(r.values,start);var i=a(r.values,end);if(n===null||i===null){return null}var o=r.values[n].x,s=r.values[n].y,l=r.values[i].x,u=r.values[i].y;var c=s<u?o:l;var d=s<u?u:s;return{start:{x:o,y:s},end:{x:l,y:u},corner:{x:c,y:d}}}this.addMarker=function(t,e,r,a,n,i){if(h.hasOwnProperty(t)){return null}var o=c.g.append("g").attr("class","marker");var s=i&&["start","middle","end"].indexOf(i)>-1?i:"start";o.append("line").attr("class","horizontal").attr("x1",c.scale.x.range()[0]).attr("y1",c.scale.y(e)).attr("x2",c.scale.x.range()[1]).attr("y2",c.scale.y(e)).style("stroke",n||u.attr.fontColor).style("stroke-dasharray","3 3").style("stroke-width",1);o.append("text").attr("x",c.scale.x.range()[0]+(a||0)*(c.scale.x.range()[1]-c.scale.x.range()[0])).attr("y",c.scale.y(e)).attr("dy",-5).attr("text-anchor","start").style("fill",n||u.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").style("text-anchor",s).text(r);var l={g:o,update:function(t){o.select(".horizontal").transition().duration(t).attr("x1",c.scale.x.range()[0]).attr("y1",c.scale.y(e)).attr("x2",c.scale.x.range()[1]).attr("y2",c.scale.y(e));o.select("text").transition().duration(t).attr("x",c.scale.x.range()[0]+(a||0)*(c.scale.x.range()[1]-c.scale.x.range()[0])).attr("y",c.scale.y(e))}};h[t]=l;return l};this.removeMarker=function(t){if(h.hasOwnProperty(t)){h[t].g.remove();delete h[t];return true}return false};u.utils.tooltip=function(){if(!d){return null}var r=d.x;var t=f.map(function(t){var e=t.values.filter(function(t){return t.x===r});return{name:t.name,color:l[t.name],value:e.length>0?u.attr.tooltipYFormat(e[0].y):"n/a"}});return{title:u.attr.tooltipXFormat(r),content:{type:"plots",data:t}}};u.render.build=function(){c=u.utils.standardAxis();c.plots={}};u.render.update=function(t){var e=[];if(u.attr.xDomain){e=u.attr.xDomain}else if(typeof f!=="undefined"&&f.length>0){e=f.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x})}var r=0;if(typeof f!=="undefined"&&f.length>0){r=y.max(f.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}))}if(r===0){r=1}if(u.attr.sortByX){e.sort(function(t,e){return t.localeCompare(e)})}c.scale={x:u.utils.scale(e,[0,u.attr.innerWidth],"band"),y:u.utils.scale([0,r],[u.attr.innerHeight,0])};c.axisFn.x.tickFormat(u.attr.xTickFormat);c.axes.x.transition().duration(t).call(c.axisFn.x.tickValues(u.attr.xTicks).scale(c.scale.x));c.axisFn.y.tickFormat(u.attr.yTickFormat);c.axes.y.transition().duration(t).call(c.axisFn.y.tickValues(u.attr.yTicks).scale(c.scale.y));if(typeof f==="undefined"||f.length===0){return}l=u.utils.colors(f?f.map(function(t){return t.name}):null);c.plots.groups=c.g.selectAll(".bar-group").data(f,function(t){return t.name});c.plots.groups.exit().transition().duration(t).remove();var a=c.plots.groups.enter().append("g").attr("class",function(t){return"bar-group "+u.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent");c.plots.groups=a.merge(c.plots.groups).each(function(){p=true});c.plots.groups.transition().duration(t).style("fill-opacity",u.attr.opacity).style("fill",function(t){return l[t.name]}).on("end",function(){p=false});var n=f.length>0?c.scale.x.bandwidth():1,i=n*u.attr.barWidth,o=n*(1-u.attr.barWidth)/2;c.plots.bars=c.plots.groups.selectAll(".bar").data(function(e,r){return e.values.map(function(t){return{name:e.name,n:f.length,i:r,x:t.x,y:t.y}})});c.plots.bars.exit().transition().duration(t).style("opacity",0).remove();c.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+u.utils.encode(t.name)}).style("opacity",0).attr("x",function(t){return c.scale.x(t.x)+o+i*t.i/t.n}).attr("y",u.attr.height-u.attr.margins.top-u.attr.margins.bottom).attr("width",function(t){return i/t.n}).attr("height",0).merge(c.plots.bars).on("mouseover",function(t){d=t;u.attr.mouseover&&u.attr.mouseover(t.name)}).on("mouseleave",function(t){d=null;u.attr.mouseleave&&u.attr.mouseleave(t.name)}).on("click",function(t){u.attr.click&&u.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("x",function(t){return c.scale.x(t.x)+o+i*t.i/t.n}).attr("y",function(t){return c.scale.y(t.y)}).attr("width",function(t){return i/t.n}).attr("height",function(t){return u.attr.height-u.attr.margins.top-u.attr.margins.bottom-c.scale.y(t.y)});for(var s in h){if(h.hasOwnProperty(s)){h[s].update(t)}}};u.render.style=function(){c.g.attr("width",u.attr.innerWidth+"px").attr("height",u.attr.innerHeight+"px").attr("transform","translate("+u.attr.margins.left+","+u.attr.margins.top+")").style("pointer-events","all");c.axisFn.x.tickFormat(u.attr.xTickFormat);c.axes.x.attr("transform","translate(0,"+u.attr.innerHeight+")");c.axisFn.y.tickFormat(u.attr.yTickFormat);c.axes.y.attr("transform","translate(0,"+1+")");c.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");c.labels.x.attr("x",u.attr.innerWidth+"px").attr("y",u.attr.innerHeight+2.8*u.attr.fontSize+"px").style("fill",u.attr.fontColor).style("font-size",u.attr.fontSize+"px").text(u.attr.xLabel);c.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",u.attr.fontColor).style("font-size",u.attr.fontSize+"px").text(u.attr.yLabel)}}t.prototype=Object.create(a.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Picture=e(t.d3,t.du.Widget)}})(this,function(t,r){"use strict";function e(t,e){var n=r.call(this,t,"picture","div",e);n.attr.add(this,"src","");var i={};var o=null;n.render.build=function(){i.g=n.widget.append("div").style("width",n.attr.width>0?n.attr.width:null).style("height",n.attr.height>0?n.attr.height:null).style("position","relative").style("pointer-events","all");o=new Image;o.onload=function(){var t=o.width/o.height;var e=n.attr.width/n.attr.height;var r=t>e?n.attr.width:n.attr.height*t;var a=t<e?n.attr.height:n.attr.width/t;i.g.style("background-image","url("+n.attr.src+")").style("background-repeat","none").style("background-size",r+"px "+a+"px").style("width",r+"px").style("height",a+"px").style("margin-left",(n.attr.width-r)/2+"px").style("margin-top",(n.attr.height-a)/2+"px").on("mouseover",function(){n.attr.mouseover&&n.attr.mouseover(o)}).on("mouseleave",function(){n.attr.mouseleave&&n.attr.mouseleave(o)}).on("click",function(){n.attr.click&&n.attr.click(o)})}};n.render.style=function(){if(n.attr.src){o.src=n.attr.src}}}e.prototype=Object.create(r.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.PieChart=e(t.d3,t.du.Widget)}})(this,function(m,r){"use strict";function t(t,e){var o=r.call(this,t,"piechart","svg",e);o.attr.add(this,"innerRadius",0,"dim");o.attr.add(this,"outerRadius",50,"dim");o.attr.add(this,"ticks",false);var s={};var l=[];var u={};var c=null;var d=false;function f(t){return t.data?t.data.name:""}function p(t,e,r,a){var n;return(n=i(t,e,r,a))?{startAngle:n.endAngle,endAngle:n.endAngle}:(n=h(t,e,r,a))?{startAngle:n.startAngle,endAngle:n.startAngle}:null}function i(t,e,r,a){var n=e.length;while(--t>=0){var i=a(r[t]);for(var o=0;o<n;++o){if(a(e[o])===i)return e[o]}}}function h(t,e,r,a){var n=r.length,i=e.length;while(++t<n){var o=a(r[t]);for(var s=0;s<i;++s){if(a(e[s])===o)return e[s]}}}function y(t){var e=m.interpolate(this._current,t);this._current=e(0);return function(t){return s.arc(e(t))}}function g(t){var e=m.interpolate(this._current,t);this._current=e(0);return function(t){return"translate("+s.arcLabel.centroid(e(t))+")"}}this.data=function(t){l=t;return this};this.highlight=function(t,e){if(!d){o.utils.highlight(this,s,"path",t,e);o.utils.highlight(this,s,"text",t,e)}return this};o.utils.tooltip=function(){return c?{title:c.name,stripe:o.attr.colors[c.name],content:{type:"metrics",data:[{label:"value:",value:o.attr.tooltipYFormat(c.value)},{label:"fraction:",value:(100*c.value/m.sum(l,function(t){return t.value})).toFixed(1)+"%"}]}}:null};o.render.build=function(){s.g=o.widget.append("g");s.label=s.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};o.render.update=function(t){s.arc=m.arc().outerRadius(o.attr.outerRadius-o.attr.margins.left).innerRadius(o.attr.innerRadius);s.arcLabel=m.arc().outerRadius(.5*(o.attr.innerRadius+o.attr.outerRadius-o.attr.margins.left)).innerRadius(.5*(o.attr.innerRadius+o.attr.outerRadius-o.attr.margins.left));var e=m.pie().value(function(t){return t.value}).sort(null);u=o.utils.colors(l?l.map(function(t){return t.name}):null);var r=s.g.selectAll(".slice");var a=s.g.selectAll(".label");var n=r.data(),i=e(l);r=r.data(i,f);r.exit().datum(function(t,e){return p(e,i,n,f)||t}).transition().duration(t).attrTween("d",y).remove();r.enter().append("path").attr("class",function(t){return"slice "+o.utils.encode(t.data.name)}).each(function(t,e){this._current=p(e,n,i,f)||t}).style("pointer-events","all").style("fill",function(t){return u[t.data.name]}).merge(r).each(function(){d=true}).on("mouseover",function(t){c=t.data;o.attr.mouseover&&o.attr.mouseover(t.data.name)}).on("mouseleave",function(t){c=null;o.attr.mouseleave&&o.attr.mouseleave(t.data.name)}).on("click",function(t){o.attr.click&&o.attr.click(t.data.name)}).transition().duration(t).style("opacity",1).style("fill",function(t){return u[t.data.name]}).attrTween("d",y).on("end",function(){d=false});a=a.data(i,f);a.exit().datum(function(t,e){return p(e,i,n,f)||t}).transition().duration(t).style("opacity",0).attrTween("transform",g).remove();a.enter().append("text").attr("class",function(t){return"label "+o.utils.encode(t.data.name)}).each(function(t,e){this._current=p(e,n,i,f)||t}).merge(a).attr("dy","0.35em").style("text-anchor","middle").style("pointer-events","none").attr("fill",o.attr.fontColor).text(function(t){return o.attr.tickFormat(100*t.data.value/m.sum(i,function(t){return t.value}))}).transition().duration(t).attrTween("transform",g)};o.render.style=function(){o.attr.colors=o.utils.colors(l?l.map(function(t){return t.name}):null);var t=o.attr.outerRadius-o.attr.margins.left;o.attr.width=2*o.attr.outerRadius;o.attr.height=2*o.attr.outerRadius;o.widget.style("width",o.attr.width+"px").style("height",o.attr.height+"px");s.g.attr("transform","translate("+o.attr.outerRadius+","+o.attr.outerRadius+")");s.label.attr("transform","translate(0,"+o.attr.outerRadius+")").style("width",10+2*o.attr.outerRadius+"px").style("font-size",Math.min(16,o.attr.outerRadius*.4)+"px").style("fill",o.attr.fontColor).text(o.attr.label)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ProgressBar=e(t.d3,t.du.Widget)}})(this,function(t,n){"use strict";function e(t,e){var r=n.call(this,t,"progressbar","div",e);r.attr.add(this,"trackColor","transparent");r.attr.add(this,"thickness",1);r.attr.add(this,"align","center");r.attr.add(this,"percentage",0);var a={};r.render.build=function(){a.g=r.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");a.container=a.g.append("div").style("display","table-cell").style("vertical-align","middle").style("pointer-events","none").style("height","100%");a.label=a.container.append("div").style("display","block").style("margin-bottom","2px").style("pointer-events","none");a.barTrack=a.container.append("div").style("display","block").style("width","100%").style("bottom","0").style("background-color",r.attr.trackColor);a.bar=a.barTrack.append("div").style("display","block").style("float","left").style("width","0%").style("height","100%")};r.render.update=function(t){a.bar.transition().duration(t).style("width",r.attr.percentage+"%")};r.render.style=function(){a.container.style("text-align",r.attr.align);a.label.style("color",r.attr.fontColor).style("height",r.attr.fontSize+"px").style("line-height",r.attr.fontSize+"px").style("font-size",r.attr.fontSize+"px").text(r.attr.label);a.barTrack.style("height",r.attr.thickness+"px");a.bar.style("background-color",r.attr.fontColor)}}e.prototype=Object.create(n.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ScatterPlot=e(t.d3,t.du.Widget)}})(this,function(c,r){"use strict";function t(t,e){var n=r.call(this,t,"scatterplot","svg",e);n.attr.add(this,"opacity",.4);var i={};var o=[];var s={};var l=null;var u=false;this.data=function(t){o=t;return this};this.highlight=function(t,e){if(!u)n.utils.highlight(this,i,".dot-group",t,e);return this};this.highlightRange=function(t,e){if(!u)n.utils.highlightRange(this,i,".dot",t,e);return this};n.utils.tooltip=function(t){if(!t){this.tt&&this.tt.remove();this.tt=null;return null}var e=l.find(t[0],t[1],10);if(!e){this.tt&&this.tt.remove();this.tt=null;return null}this.tt=this.tt||i.g.append("circle");this.tt.attr("r",6).attr("cx",e.data[0]).attr("cy",e.data[1]).style("pointer-events","none").style("stroke",n.attr.stroke).style("fill",s[e.data.name]);return{title:e.data.name,stripe:s[e.data.name],content:{type:"metrics",data:[{label:n.attr.xLabel+":",value:n.attr.tooltipXFormat(e.data[0])},{label:n.attr.yLabel+":",value:n.attr.tooltipXFormat(e.data[1])}]}}};n.render.build=function(){i=n.utils.standardAxis();i.plots={}};n.render.update=function(t){i.scale={x:n.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,n.attr.innerWidth]),y:n.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[n.attr.innerHeight,0])};i.axes.x.transition().duration(t).call(i.axisFn.x.tickValues(n.attr.xTicks).scale(i.scale.x));i.axes.y.transition().duration(t).call(i.axisFn.y.tickValues(n.attr.yTicks).scale(i.scale.y));s=n.utils.colors(o?o.map(function(t){return t.name}):null);i.plots.groups=i.g.selectAll(".dot-group").data(o,function(t){return t.name});i.plots.groups.exit().transition().duration(t).style("opacity",0).remove();var e=i.plots.groups.enter().append("g").attr("class",function(t){return"dot-group "+n.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent");i.plots.groups=e.merge(i.plots.groups).each(function(){u=true}).on("mouseover",function(t){n.attr.mouseover&&n.attr.mouseover(t.name)}).on("mouseleave",function(t){n.attr.mouseleave&&n.attr.mouseleave(t.name)}).on("click",function(t){n.attr.click&&n.attr.click(t.name)});i.plots.groups.transition().duration(t).style("fill-opacity",n.attr.opacity).style("fill",function(t){return s[t.name]}).on("end",function(){u=false});i.plots.dots=i.plots.groups.selectAll(".dot").data(function(t){return t.values});i.plots.dots.exit().transition().duration(t).style("opacity",0).remove();i.plots.dots.enter().append("circle").attr("class","dot").style("opacity",0).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)}).merge(i.plots.dots).transition().duration(t).style("opacity",1).attr("r",3).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)});var a=[];o.forEach(function(r){r.values.forEach(function(t){var e=[i.scale.x(t.x),i.scale.y(t.y)];e.name=r.name;a.push(e)})});var r=c.voronoi().extent([[-1,-1],[n.attr.width+1,n.attr.height+1]]);l=r(a)};n.render.style=function(){n.attr.colors=n.utils.colors(o[0]?c.keys(o[0].y):null);i.g.attr("width",n.attr.innerWidth+"px").attr("height",n.attr.innerHeight+"px").attr("transform","translate("+n.attr.margins.left+","+n.attr.margins.top+")").style("pointer-events","all");i.axisFn.x.tickFormat(n.attr.xTickFormat);i.axes.x.attr("transform","translate(0,"+n.attr.innerHeight+")");i.axisFn.y.tickFormat(n.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",n.attr.innerWidth+"px").attr("y",n.attr.innerHeight+2.8*n.attr.fontSize+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.SemiCircularGauge=e(t.d3,t.du.Widget)}})(this,function(i,f){"use strict";function t(t,e){var s=f.call(this,t,"semicirculargauge","svg",e);s.attr.add(this,"min",0);s.attr.add(this,"max",1);s.attr.add(this,"segments",4);s.attr.add(this,"gap",6);s.attr.add(this,"thickness",.2);var o={};var l=null;var a=null;var u=0;var r=undefined;function c(){var t=s.attr.gap*Math.PI/180,e=Math.PI-(s.attr.segments-1)*t,r=e/s.attr.segments;var a=s.attr.innerWidth/2,n=a*s.attr.thickness;var i=a*.1,o=a-1.5*n;return{angles:{gap:t,segment:r},sizes:{radius:a,thickness:n},needle:{width:i,length:o,angle:Math.acos(i/o)}}}function d(t,e){var r=[-t.needle.length*Math.cos(e),-t.needle.length*Math.sin(e)],a=[t.needle.width*Math.cos(e-t.needle.angle),t.needle.width*Math.sin(e-t.needle.angle)],n=[t.needle.width*Math.cos(e+t.needle.angle),t.needle.width*Math.sin(e+t.needle.angle)];return"M0,0L"+a.join(",")+"L"+r.join(",")+"L"+n.join(",")+"Z"}function n(t,e){if(t===null){o.needlePointer.attr("d","");return}var r=c();var a=this;var n=l(u);var i=l(t);o.needlePointer.transition().duration(e).tween("progress",function(){return function(t){var e=n+(i-n)*t;return o.needlePointer.attr("d",d.call(a,r,e))}}).on("end",function(){u=t})}this.position=function(t){r=t;return this};s.render.build=function(){l=i.scaleLinear().domain([s.attr.min,s.attr.max]).range([0,Math.PI]).clamp(true);o.g=s.widget.append("g");a=i.interpolateHsl(s.attr.colors?s.attr.colors[0]:"#e41a1c",s.attr.colors?s.attr.colors[1]:"#4daf4a");o.segments=[];var t=c();for(var e=0;e<s.attr.segments;e++){var r=i.arc().outerRadius(t.sizes.radius).innerRadius(t.sizes.radius-t.sizes.thickness).startAngle(-Math.PI/2+e*(t.angles.segment+t.angles.gap)).endAngle(-Math.PI/2+(e+1)*(t.angles.segment+t.angles.gap)-t.angles.gap);o.segments.push(o.g.append("path").attr("d",r).style("fill",a(e/(s.attr.segments-1))))}o.needle=o.g.append("g").style("fill",s.attr.fontSize);o.needleCenter=o.needle.append("circle").attr("cx",0).attr("cy",0).attr("r",t.needle.width+"px");o.needlePointer=o.needle.append("path");n(0,0)};s.render.update=function(t){l=i.scaleLinear().domain([s.attr.min,s.attr.max]).range([0,Math.PI]).clamp(true);a=i.interpolateHsl(s.attr.colors?s.attr.colors[0]:"#e41a1c",s.attr.colors?s.attr.colors[1]:"#4daf4a");if(typeof r!=="undefined"){n(r,t);r=undefined}};s.render.style=function(){s.widget.style("width",s.attr.width+"px");s.widget.style("height",s.attr.height+"px");o.g.attr("transform","translate("+s.attr.width/2+","+.5*(s.attr.height+s.attr.innerWidth/2)+")")}}t.prototype=Object.create(f.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Slider=e(t.d3,t.du.Widget)}})(this,function(c,d){"use strict";function t(t,e){var a=d.call(this,t,"slider","svg",e);a.attr.add(this,"min",0);a.attr.add(this,"max",1);a.attr.add(this,"step",0);a.attr.add(this,"callback",null);a.attr.add(this,"track",false);a.attr.add(this,"fillColor","black");a.attr.add(this,"thickness",8);a.attr.add(this,"trackColor","#ddd");var n={};var r={right:20,left:20};var i=false;var o=[];var s=null;var l=null;function u(t){n.handle.attr("cx",s(t));n.valueTrack.attr("x2",s(t))}this.position=function(t){l=t;return this};a.render.build=function(){o=[a.attr.min,a.attr.max];s=c.scaleLinear().domain(o).range([0,a.attr.width-r.left-r.right]).clamp(true);if(a.attr.step){i=true;o=[];for(var t=a.attr.min;t<=a.attr.max;t+=a.attr.step){o.push(t)}s=c.scalePoint().domain(o).range([0,a.attr.width-r.left-r.right])}n.g=a.widget.append("g").attr("transform","translate("+r.left+",20)");n.track=n.g.append("line").attr("stroke-linecap","round").attr("stroke",a.attr.trackColor).attr("stroke-width",a.attr.thickness+"px").attr("x1",s.range()[0]).attr("x2",s.range()[1]);n.overlay=n.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","stroke").style("cursor","pointer").style("stroke","transparent").style("stroke-width","50px").call(c.drag().on("start drag",function(){n.handle.style("fill",a.attr.fillColor).style("stroke-width","2px").style("stroke","white");var t=null;if(i){var r=c.event.x;t=o.reduce(function(t,e){return Math.abs(s(e)-r)<Math.abs(s(t)-r)?e:t})}else{t=s.invert(c.event.x)}n.handle.attr("cx",s(t));n.valueTrack.attr("x2",s(t));a.attr.callback&&a.attr.callback(t)}).on("end",function(){n.handle.style("fill","white").style("stroke-width","1px").style("stroke",a.attr.trackColor)}));n.axis=n.g.insert("g",".track-overlay").attr("font-family","inherit").attr("transform","translate(0,"+20+")").style("font-size","10px");n.ticks=n.axis.selectAll("text").data(i?o:s.ticks(5)).enter().append("text").attr("x",s).attr("text-anchor","middle").attr("font-family","inherit").text(function(t){return t});n.valueTrack=n.g.insert("line",".track-overlay").attr("x1",s.range()[0]).attr("x2",s.range()[0]).attr("stroke-linecap","round").style("stroke-width",a.attr.thickness+"px").style("stroke",a.attr.fillColor);n.handle=n.g.insert("circle",".track-overlay").attr("r",a.attr.thickness).style("fill","white").style("stroke-width","1px").style("stroke",a.attr.trackColor)};a.render.update=function(){if(l!==null){u(l);l=null}};a.render.style=function(){a.widget.style("width",a.attr.width+"px");a.widget.style("height",50+"px");s.range([0,a.attr.width-r.left-r.right]);n.track.attr("x1",s.range()[0]).attr("x2",s.range()[1]);n.overlay.attr("x1",s.range()[0]).attr("x2",s.range()[1]);n.ticks.attr("x",s).attr("font-size",a.attr.fontSize+"px").attr("fill",a.attr.fontColor)}}t.prototype=Object.create(d.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Status=e(t.d3,t.du.Widget)}})(this,function(t,n){"use strict";function e(t,e){var r=n.call(this,t,"status","div",e);r.attr.add(this,"value","");var a={};r.render.build=function(){a.g=r.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");a.label=a.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","25%").style("pointer-events","none").text(r.attr.label);a.status=a.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","75%").style("text-align","right").style("pointer-events","none")};r.render.style=function(){r.widget.style("font-size",r.attr.fontSize+"px").style("pointer-events","none");for(var t in r.attr.margins){if(r.attr.margins.hasOwnProperty(t)){r.widget.style("margin-"+t,r.attr.margins[t]+"px")}}for(t in r.attr.borders){if(r.attr.borders.hasOwnProperty(t)){r.widget.style("border-"+t,r.attr.borders[t])}}a.label.style("color",r.attr.fontColor).style("font-weight",r.attr.fontWeight);a.status.style("color",r.attr.fontColor).style("font-weight",r.attr.fontWeight).text(r.attr.value)}}e.prototype=Object.create(n.prototype);return e});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.TrackPad=e(t.d3,t.du.Widget)}})(this,function(i,o){"use strict";function t(t,e){var r=o.call(this,t,"slider","svg",e);r.attr.add(this,"xRange",[0,1]);r.attr.add(this,"yRange",[0,1]);r.attr.add(this,"callback",null);r.attr.add(this,"guide",false);var a={};var n=null;r.render.build=function(){n={x:i.scaleLinear().domain(r.attr.xRange).range([0,r.attr.width-r.attr.margins.left-r.attr.margins.right]).clamp(true),y:i.scaleLinear().domain(r.attr.yRange).range([0,r.attr.height-r.attr.margins.top-r.attr.margins.bottom]).clamp(true)};a.g=r.widget.append("g").attr("transform","translate("+r.attr.margins.left+",20)");a.track=a.g.append("rect").attr("rx","3").attr("ry","3").attr("x",n.x.range()[0]).attr("y",n.y.range()[0]).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom+"px");a.inset=a.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("fill","white").style("opacity",.9).attr("rx","2.5").attr("ry","2.5").attr("x",n.x.range()[0]+.5).attr("y",n.y.range()[0]+.5).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right-1+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom-1+"px");if(r.attr.guide){a.guide={h:a.g.append("line").attr("x1",n.x.range()[0]).attr("y1",n.y.range()[0]).attr("x2",n.x.range()[1]).attr("y2",n.y.range()[0]).attr("stroke-dasharray","3, 6").style("stroke",r.attr.fontColor).style("stroke-width","1px"),v:a.g.append("line").attr("x1",n.x.range()[0]).attr("y1",n.y.range()[0]).attr("x2",n.x.range()[0]).attr("y2",n.y.range()[1]).attr("stroke-dasharray","3, 6").style("stroke-width","1px")}}a.overlay=a.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","all").style("cursor","pointer").style("fill","transparent").call(i.drag().on("start drag",function(){a.handle.style("fill",r.attr.fontColor).style("stroke-width","2px").style("stroke","white");var t=n.x.invert(i.event.x),e=n.y.invert(i.event.y);a.handle.attr("cx",n.x(t)).attr("cy",n.y(e));if(a.guide){a.guide.h.attr("x1",n.x.range()[0]).attr("y1",n.y(e)).attr("x2",n.x.range()[1]).attr("y2",n.y(e));a.guide.v.attr("x1",n.x(t)).attr("y1",n.y.range()[0]).attr("x2",n.x(t)).attr("y2",n.y.range()[1])}r.attr.callback&&r.attr.callback(t,e)}).on("end",function(){a.handle.style("fill","white").style("stroke-width","1px").style("stroke",r.attr.fontColor)}));a.axis={x:a.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none"),y:a.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none")};a.handle=a.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",7)};r.render.style=function(){r.widget.style("width",r.attr.width+"px");r.widget.style("height",r.attr.height+"px");n.x.range([0,r.attr.width-r.attr.margins.left-r.attr.margins.right]);n.y.range([0,r.attr.height-r.attr.margins.top-r.attr.margins.bottom]);a.track.style("fill",r.attr.fontColor).attr("x",n.x.range()[0]).attr("y",n.y.range()[0]).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom+"px");a.inset.attr("x",n.x.range()[0]+.5).attr("y",n.y.range()[0]+.5).attr("width",r.attr.width-r.attr.margins.left-r.attr.margins.right-1+"px").attr("height",r.attr.height-r.attr.margins.top-r.attr.margins.bottom-1+"px");if(r.attr.guide){a.guide.h.style("stroke",r.attr.fontColor);a.guide.v.style("stroke",r.attr.fontColor)}a.overlay.attr("x",n.x.range()[0]-r.attr.margins.left+10).attr("y",n.y.range()[0]-r.attr.margins.top+10).attr("width",r.attr.width-20+"px").attr("height",r.attr.height-20+"px");a.axis.x.attr("transform","translate(-1,"+(r.attr.height-r.attr.margins.bottom-30)+")").call(i.axisBottom().ticks(5).scale(n.x));a.axis.y.call(i.axisLeft().ticks(5).scale(n.y));a.g.selectAll("path").style("fill","none").style("stroke","none");a.g.selectAll(".tick > line").style("fill","none").style("stroke","none");a.g.selectAll("text").attr("font-size",r.attr.fontSize+"px").attr("fill",r.attr.fontColor);a.handle.style("stroke",r.attr.fontColor)}}t.prototype=Object.create(o.prototype);return t});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","d3-contour","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.TrajectoryPlot=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(a,t){var c=e.call(this,a,"trajectoryplot","svg",t);c.attr.add(this,"boundary",[0,1,0,1]);c.attr.add(this,"maxLength",10);c.attr.add(this,"fadeExp",0);c.attr.add(this,"animate",false);c.attr.add(this,"showHead",false);var d={};var n=[];var f=null;var p=null;var i=false;var h={};var o={};this.background=function(t){o=t;return this};this.data=function(t){n=t.map(function(a){return{name:a.name,values:a.values.sort(function(t,e){return t.t-e.t}).filter(function(t,e){return e>=a.values.length-c.attr.maxLength}).map(function(t,e,r){return{name:a.name,t:t.t,x:t.x,y:t.y,r:Math.exp(-c.attr.fadeExp*(1-e/r.length)),last:e===r.length-1}})}});return this};this.highlight=function(t,e){if(!i)c.utils.highlight(this,d,".trajectory",t,e);return this};this.addMarker=function(e,r,a,t,n){var i="marker-"+c.utils.encode(e);if(h.hasOwnProperty(i)){return null}var o=t?t/2:7;var s=d.g.select(".trajectory."+r).append("g").attr("class","marker marker-"+i+" "+c.utils.encode(r));var l=s.append("circle").attr("cx",d.scale.x(a[0])+2).attr("cy",d.scale.y(a[1])).attr("r",c.attr.animate?1.5*o:o).style("stroke-width","2px").style("stroke","white").style("fill",p[r]).style("pointer-events","all").on("mouseover",function(){f={key:r,name:e,type:"marker",info:n};c.attr.mouseover&&c.attr.mouseover(r)}).on("mouseleave",function(){f=null;c.attr.mouseleave&&c.attr.mouseleave(r)}).on("click",function(){c.attr.click&&c.attr.click(r)});if(c.attr.animate){l.transition().duration(700).attr("r",o)}var u={name:e,key:r,g:s,update:function(t){l.on("mouseover",function(){f={key:r,name:e,type:"marker",info:n};c.attr.mouseover&&c.attr.mouseover(r)}).on("mouseleave",function(){f=null;c.attr.mouseleave&&c.attr.mouseleave(r)}).on("click",function(){c.attr.click&&c.attr.click(r)}).transition().duration(t).attr("cx",d.scale.x(a[0])+2).attr("cy",d.scale.y(a[1])).style("fill",p[this.key])}};h[i]=u;return u};this.removeMarker=function(t){var e="marker-"+c.utils.encode(t);if(h.hasOwnProperty(e)){h[e].g.remove();delete h[e];return true}return false};this.getMarkers=function(){return Object.values(h).map(function(t){return t.name})};c.utils.tooltip=function(t){if(!t||f===null){f=null;return null}switch(f.type){case"marker":return{title:f.info.title,stripe:p[f.key],content:{type:"metrics",data:[{label:f.info.content}]}};default:return null}};c.render.build=function(){d=c.utils.standardAxis();d.plots={};d.backgroundPattern=d.g.append("defs").append("pattern").attr("id","trajectory-background-"+c.utils.encode(a)).attr("patternUnits","userSpaceOnUse").attr("width",c.attr.innerWidth).attr("height",c.attr.innerHeight);d.backgroundImage=d.backgroundPattern.append("image").attr("xlink:href",o!==null?o.path:null).attr("preserveAspectRatio","none").attr("x",1).attr("y",0).attr("width",c.attr.innerWidth+"px").attr("height",c.attr.innerHeight+"px");d.background=d.g.append("rect").attr("x",1).attr("y",0).attr("width",c.attr.innerWidth+"px").attr("height",c.attr.innerHeight+"px").attr("stroke","none").attr("fill",o.path?"url(#"+"trajectory-background-"+c.utils.encode(a)+")":"none").style("opacity",o!==null?o.opacity:null)};c.render.update=function(t){d.scale={x:c.utils.scale([c.attr.boundary[0],c.attr.boundary[1]],[0,c.attr.innerWidth]),y:c.utils.scale([c.attr.boundary[2],c.attr.boundary[3]],[c.attr.innerHeight,0])};d.axes.x.transition().duration(t).call(d.axisFn.x.tickValues(c.attr.xTicks).scale(d.scale.x));d.axes.y.transition().duration(t).call(d.axisFn.y.tickValues(c.attr.yTicks).scale(d.scale.y));p=c.utils.colors(n?n.map(function(t){return t.name}):null);d.plots.trajectories=d.g.selectAll(".trajectory").data(n,function(t){return t.name});d.plots.trajectories.exit().transition().duration(t).style("opacity",0).remove();var e=d.plots.trajectories.enter().append("g").attr("class",function(t){return"trajectory "+c.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke-linecap","round").style("color",function(t){return p[t.name]});d.plots.trajectories=e.merge(d.plots.trajectories).each(function(){i=true});d.plots.trajectories.transition().duration(t).style("opacity",1).on("end",function(){i=false});if(c.attr.showHead){d.plots.position=d.plots.trajectories.selectAll(".position").data(function(t){return t.values.slice(-1)},function(){return 0});d.plots.position.exit().transition().duration(t).style("opacity",0).remove();d.plots.position.enter().append("circle").attr("class","position").attr("cx",function(t){return d.scale.x(t.x)}).attr("cy",function(t){return d.scale.y(t.y)}).attr("r",c.attr.animate?10:1).style("stroke","none").style("fill","currentColor").style("pointer-events","none").merge(d.plots.position).transition().duration(t).attr("r",3).attr("cx",function(t){return d.scale.x(t.x)}).attr("cy",function(t){return d.scale.y(t.y)})}d.plots.movements=d.plots.trajectories.selectAll(".movement").data(function(r){return r.values.map(function(t,e){return e>0?[r.values[e-1],t]:null}).filter(function(t){return t!==null})},function(t){return t[0].t});d.plots.movements.exit().transition().duration(t).attr("x1",function(t){return d.scale.x(t[1].x)}).attr("y1",function(t){return d.scale.y(t[1].y)}).style("opacity",0).remove();d.plots.movements.enter().append("line").attr("class",function(t){return"movement movement-"+t[0].t+"-"+t[1].t}).style("stroke-width","2px").style("stroke","currentColor").style("fill","none").attr("x1",function(t){return d.scale.x(t[0].x)}).attr("y1",function(t){return d.scale.y(t[0].y)}).attr("x2",function(t){return d.scale.x(t[0].x)}).attr("y2",function(t){return d.scale.y(t[0].y)}).style("pointer-events","none").merge(d.plots.movements).transition().duration(t).attr("x1",function(t){return d.scale.x(t[0].x)}).attr("y1",function(t){return d.scale.y(t[0].y)}).attr("x2",function(t){return d.scale.x(t[1].x)}).attr("y2",function(t){return d.scale.y(t[1].y)}).style("opacity",function(t){return(t[0].r+t[1].r)/2});d.plots.fakeMovements=d.plots.trajectories.selectAll(".fake-movement").data(function(r){return r.values.map(function(t,e){return e>0?[r.values[e-1],t]:null}).filter(function(t){return t!==null})},function(t){return t[0].t});d.plots.fakeMovements.exit().remove();d.plots.fakeMovements.enter().append("line").attr("class",function(t){return"fake-movement fake-movement-"+t[0].t+"-"+t[1].t}).style("stroke-width","8px").style("stroke","transparent").style("fill","none").attr("x1",function(t){return d.scale.x(t[0].x)}).attr("y1",function(t){return d.scale.y(t[0].y)}).attr("x2",function(t){return d.scale.x(t[1].x)}).attr("y2",function(t){return d.scale.y(t[1].y)}).merge(d.plots.fakeMovements).transition().duration(t).attr("x1",function(t){return d.scale.x(t[0].x)}).attr("y1",function(t){return d.scale.y(t[0].y)}).attr("x2",function(t){return d.scale.x(t[1].x)}).attr("y2",function(t){return d.scale.y(t[1].y)});for(var r in h){if(h.hasOwnProperty(r)){h[r].update(t)}}if(o!==null){d.backgroundImage.attr("xlink:href",o.path?o.path:null);d.background.attr("fill",o.path?"url(#"+"trajectory-background-"+c.utils.encode(a)+")":"none").style("opacity",o.opacity?o.opacity:null);o=null}};c.render.style=function(){d.g.attr("width",c.attr.innerWidth+"px").attr("height",c.attr.innerHeight+"px").attr("transform","translate("+c.attr.margins.left+","+c.attr.margins.top+")").style("pointer-events","all");d.axisFn.x.tickFormat(c.attr.xTickFormat);d.axes.x.attr("transform","translate(0,"+c.attr.innerHeight+")");d.axisFn.y.tickFormat(c.attr.yTickFormat);d.axes.y.attr("transform","translate(0,"+1+")");d.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");d.labels.x.attr("x",c.attr.innerWidth+"px").attr("y",c.attr.innerHeight+2.5*c.attr.fontSize+"px").attr("fill",c.attr.fontColor).style("font-size",c.attr.fontSize+"px").text(c.attr.xLabel);d.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",c.attr.fontColor).style("font-size",c.attr.fontSize+"px").text(c.attr.yLabel);d.backgroundPattern.attr("width",c.attr.innerWidth).attr("height",c.attr.innerHeight);d.backgroundImage.attr("width",c.attr.innerWidth+"px").attr("height",c.attr.innerHeight+"px");d.background.attr("width",c.attr.innerWidth+"px").attr("height",c.attr.innerHeight+"px")}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ViolinPlot=e(t.d3,t.du.Widget)}})(this,function(h,r){"use strict";function t(t,e){var u=r.call(this,t,"violinplot","svg",e);function c(r,e){return function(t){return e.map(function(e){return{x:e,y:h.mean(t,function(t){return r(e-t)})}})}}function d(e){return function(t){return Math.abs(t/=e)<=1?.75*(1-t*t)/e:0}}var a={};var n=[];var i=null;var f=0;var p=1;var o={};var s=false;this.data=function(t){var e=t.reduce(function(t,e){return t.concat(e.values)},[]);f=h.min(e);p=h.max(e);n=t.map(function(t){var e=t.values.sort(h.ascending),r=h.min(e),a=h.max(e),n=h.quantile(e,.25),i=h.quantile(e,.75),o=.2*(a-r);var s=c(d(.05*(a-r)),h.range(21).map(function(t){return(a-r+2*o)*t/20+(r-o)}));var l=s(t.values);return{name:t.name,scale:{x:h.scaleLinear().domain([f,p]).range([u.attr.innerHeight,0]),y:h.scaleLinear().range([10,0]).domain([0,h.max(l,function(t){return t.y})])},values:{min:r,max:a,mean:h.mean(e),median:h.median(e),q1:n,q3:i,data:l}}});return this};this.highlight=function(t,e){if(!s)u.utils.highlight(this,a,".violin",t,e);return this};u.utils.tooltip=function(){return i?{title:i.name,stripe:o[i.name],content:{type:"metrics",data:[{label:"min/max:",value:i.values.min.toPrecision(3)+"/"+i.values.max.toPrecision(3)},{label:"mean:",value:i.values.mean.toPrecision(3)},{label:"median:",value:i.values.median.toPrecision(3)},{label:"Q1:",value:i.values.q1.toPrecision(3)},{label:"Q3:",value:i.values.q3.toPrecision(3)}]}}:null};u.render.build=function(){a=u.utils.standardAxis();a.plots={}};u.render.update=function(t){a.scale={x:u.utils.scale(n.map(function(t){return t.name}).reverse(),[u.attr.innerWidth,0],"point"),y:u.utils.scale(n.map(function(t){return[t.values.min-.1*(t.values.max-t.values.min),t.values.max+.1*(t.values.max-t.values.min)]}).reduce(function(t,e){return t.concat(e)},[]),[u.attr.innerHeight,0])};a.axes.x.transition().duration(t).call(a.axisFn.x.tickValues(u.attr.xTicks).scale(a.scale.x));a.axes.y.transition().duration(t).call(a.axisFn.y.tickValues(u.attr.yTicks).scale(a.scale.y));o=u.utils.colors(n?n.map(function(t){return t.name}):null);a.plots.groups=a.g.selectAll(".box-group").data(n,function(t){return t.name});a.plots.groups.exit().style("opacity",0).remove();var e=a.plots.groups.enter().append("g").attr("class",function(t){return"box-group "+u.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var r=e.merge(a.plots.groups).each(function(){s=true}).attr("transform",function(t){return"translate("+a.scale.x(t.name)+",0)"}).on("mouseover",function(t){i=t;u.attr.mouseover&&u.attr.mouseover(t.name)}).on("mouseleave",function(t){i=null;u.attr.mouseleave&&u.attr.mouseleave(t.name)}).on("click",function(t){u.attr.click&&u.attr.click(t.name)});r.transition().duration(t).attr("transform",function(t){return"translate("+a.scale.x(t.name)+",0)"}).style("opacity",1).style("fill-opacity",.3).style("fill",function(t){return o[t.name]}).style("stroke",function(t){return o[t.name]}).on("end",function(){s=false});e.append("path").attr("transform","rotate(90) translate(0,-"+(10+.5)+")");r.select("path").transition().duration(t).attr("d",function(e){e.scale.x.range([u.attr.innerHeight,0]);var t=h.area().curve(h.curveBasis).x(function(t){return e.scale.x(Math.min(p,Math.max(f,t.x)))}).y0(function(t){return e.scale.y(-t.y)}).y1(function(t){return e.scale.y(t.y)});return t(e.values.data)}).attr("transform","rotate(90) translate(0,-"+(10+.5)+")")};u.render.style=function(){a.g.style("width",u.attr.innerWidth+"px").style("height",u.attr.innerHeight+"px").attr("transform","translate("+u.attr.margins.left+","+u.attr.margins.top+")").style("pointer-events","all");a.axes.x.attr("transform","translate(0,"+u.attr.innerHeight+")");a.axisFn.y.tickFormat(u.attr.yTickFormat);a.axes.y.attr("transform","translate(0,"+1+")");a.labels.x.attr("x",u.attr.innerWidth+"px").attr("y",u.attr.innerHeight+2.8*u.attr.fontSize+"px").attr("fill",u.attr.fontColor).style("font-size",u.attr.fontSize+"px").text(u.attr.xLabel);a.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",u.attr.fontColor).style("font-size",u.attr.fontSize+"px").text(u.attr.yLabel)}}t.prototype=Object.create(r.prototype);return t});