(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("lodash"))}else if(typeof define==="function"&&define.amd){define(["_","exports"],e)}else{t.du=t.du||{};t.du.data=e(t._)}})(this,function(t){"use strict";var e={si:function(){var t="yzafpnÎ¼m kMGTPEZY";var e=(t.length-1)/2;var r=e;var n=-e;function a(a){if(a===null||a===undefined||isNaN(a))return"N/A";if(a===0)return"0";var i=Math.abs(a);var o=Math.max(Math.min(parseInt(Math.floor(Math.log(i)/Math.log(1e3))),r),n);var s=i/Math.pow(1e3,o);return(a<0?"-":"")+(o===n||o===r?s.toExponential(2):s.toPrecision(3)).replace(/e\+0$/,"")+t.charAt(e+o).trim()}return a}(),idfy:function(t){return t?t.replace(/ /g,"__"):""},namify:function(t){return t?t.replace(/__/g," "):""}};var r={sum:function(e,r,n){var a={};var i=[];if(Array.isArray(n)){i=n}else{i=[n]}var o=i.length;e.forEach(function(t){var e=[];i.forEach(function(r){if(t.hasOwnProperty(r)){e.push(t[r])}});if(e.length!==o)return;var n=e.join(".");if(!a.hasOwnProperty(n))a[n]=+t[r];else a[n]+=+t[r]});var s=[];t.forOwn(a,function(t,e){s.push({key:e,value:t})});return s.sort(function(t,e){return e.value-t.value})}};var n={Histogram:function(e){var r=e?e:[];this.set=function(t){r=t;return this};function n(){return t.cloneDeep(r)}function a(t,e){r.push({x:t,y:e,index:r.length});return this}function i(t){r.forEach(function(e){e.y*=t});return this}function o(){var t=d3.sum(r,function(t){return t.y});r.forEach(function(e){e.y/=t});return this}function s(t){r.sort(function(e,r){return t?r.x-e.x:e.x-r.x});return this}function l(t){r.sort(function(e,r){return t?r.y-e.y:e.y-r.y});return this}function u(){r.sort(function(t,e){return t.index-e.index});return this}return{set:set,get:n,add:a,scale:i,normalize:o,sortByX:s,sortByY:l,unsort:u}},TimeSeries:function(e){var r=[];function n(t){r=[];var n=0;if(t!==null){var a=new Date(t);while(a<=new Date){r.push({x:new Date(a),y:{}});e.forEach(function(t){r[n].y[t]=0});a.setDate(a.getDate()+1);n++}}return this}function a(t,e,n,a){r[t].x=e;r[t].y[n]+=a}function i(t,e){if(!t)return r;else{var n=e?e:0;return r.slice(-n-t,-n)}}function o(e,n){if(r.length<1)return{};var a={};t.forOwn(r[0].y,function(t,e){a[e]=0});i(e?e:1,n).forEach(function(e){t.forOwn(r[0].y,function(t,r){a[r]+=e.y[r]})});return a}function s(e,n){var a=0;if(r.length>0){var o=i(e,n);t.forOwn(r[0].y,function(t,e){a=Math.max(d3.max(o,function(t){return t.y.hasOwnProperty(e)?t.y[e]:0}),a)})}return a}function l(e){if(r.length<1)return{};var n=o(1,e);var a=o(2,e);var i={};t.forOwn(r[0].y,function(t,e){a[e]-=n[e];if(a[e]>=10&&n[e]>0){i[e]=(n[e]-a[e])/a[e]}});return i}function u(e,r){var n=o(e,r);var a=0;t.forOwn(n,function(t){a+=t});t.forOwn(n,function(t,e){n[e]/=a>0?a:1});return n}return{clear:n,update:a,sub:i,sum:o,peak:s,trend:l,yDist:u}},Table:function(e){var r=[];var n=[];if(e){r=t.cloneDeep(e);r.forEach(function(t,e){n.push(e)})}function a(t,e){var n=[];r.forEach(function(r){var a;if(typeof e==="string"){a=r[e]}else{a={};e.forEach(function(t){a[t]=r[t]})}n.push({x:r[t],y:a})});return n}function i(t,e){var n=null;switch(typeof e){case"number":var a=d3.min(r,function(r){return Math.abs((e-r[t])/e)});n=r.filter(function(r){return Math.abs((r[t]-e)/e)<=a*1.01});break;case"string":default:n=r.filter(function(r){return r[t]===e})}return new du.data.structures.Table(n)}function o(t){r.sort(function(e,r){return e[t]-r[t]});return this}function s(){var t=[];n.forEach(function(e){t.push(r[e])});r=t}return{slice:a,segment:i,sort:o,unsort:s}}};return{format:e,explore:r,structures:n}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.rest=e(t.d3)}})(this,function(t){"use strict";var e=function(e){function r(r,n,a,i,o){var s=e;var l=t.keys(r).sort();if(l.length>0){s+="?"+l[0]+"="+r[l[0]]}for(var u=1;u<l.length;u++){s+="&"+l[u]+"="+r[l[u]]}n(s).on("beforesend",function(t){if(o){for(var e in o){if(t.hasOwnProperty(e))t[e]=o[e]}}}).get(function(t,e){if(t){if(i)i(t);return}if(a)a(e)})}function n(e,n,a,i){r(e,t.json,n,a,i)}function a(e,n,a,i){r(e,t.csv,n,a,i)}return{json:n,csv:a}};return{Rest:e}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.signals=e()}})(this,function(){"use strict";var t={};function e(e,r){if(!t.hasOwnProperty(e))t[e]=[];for(var n=0;n<t[e].length;n++){if(t[e][n]===r){return}}t[e].push(r)}function r(t,r){if(typeof t==="string"){e(t,r)}else{if(t.constructor===Array){for(var n=0;n<t.length;n++){e(t[n],r)}}}}function n(e,r){var n=t[e];if(n!==undefined&&n!==null&&n.length>0){for(var a=0;a<n.length;a++){n[a](r)}}}return{subscribe:r,emit:n}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.log=e()}})(this,function(){"use strict";var t={error:"error",e:"error",warning:"warning",w:"warning",info:"info",i:"info",debug:"debug",d:"debug"};var e="info";var r=new Date;function n(t,e){return new Array(e-(""+t).length+1).join("0")+t}function a(){var t=new Date-r;return n(Math.floor(t/36e5),2)+":"+n(Math.floor(t%36e5/6e4),2)+":"+n(Math.floor(t%6e4/1e3),2)+"."+n(t%1e3,3)}function i(r){if(t.hasOwnProperty(r.toLowerCase())){e=r}}function o(t,r){if(e==="debug")console.debug("DEBUG ["+a()+"] "+t+": "+r)}function s(t,r){if(e==="info"||e==="debug")console.info("INFO  ["+a()+"] "+t+": "+r)}function l(t,r){if(e==="warning"||e==="info"||e==="debug")console.warn("WARN  ["+a()+"] "+t+": "+r)}function u(t,r){if(e==="error"||e==="warning"||e==="info"||e==="debug")console.error("ERROR ["+a()+"] "+t+": "+r)}return{severity:i,d:o,i:s,w:l,e:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.version=e()}})(this,function(){"use strict";var t="data/version.json";var e="du-version";var r=false;function n(t){if(typeof t!=="string"){return{major:0,minor:0,patch:1}}var e=t.split(".");return{major:e.length>0?+e[0]:0,minor:e.length>1?+e[1]:0,patch:e.length>2?+e[2]:1}}function a(t,e){var r=n(e),a=n(t);return a.major>r.major||a.major===r.major&&a.minor>r.minor||a.major===r.major&&a.minor===r.minor&&a.patch>r.patch}function i(e){t=e}function o(n,i){var s="0.0.1";d3.json(t,function(t,r){if(!t&&r.hasOwnProperty("version")&&typeof r.version==="string"){s=r.version}try{var i=localStorage.getItem(e);if(i===null)i="0.0.1";if(a(s,i)){localStorage.setItem(e,s);if(n)n(s,i)}}catch(t){console.error("MissingDOMException: there is no DOM, could not check version")}});if(i&&!r){r=true;setInterval(function(){o(n,false)},1810001)}}function s(){try{var t=localStorage.getItem(e);if(t===null){t="0.0.1";localStorage.setItem(e,t)}}catch(t){console.error("MissingDOMException: there is no DOM, could not read version")}return t}s();return{file:i,current:s,check:o}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.user=e(t.d3)}})(this,function(t){"use strict";var e=function(){var e=[];try{window.addEventListener("load",function(){t.select("body").on("keydown",function(){var r=String.fromCharCode(t.event.keyCode);if(!r)return;for(var n=0;n<e.length;n++){if(e[n]._check(r)){e.forEach(function(t){t._reset()});break}}})})}catch(t){console.error("No DOM, could not attach event listener")}function r(t,r){e.push(this);var n=t.toLowerCase();this._index=0;this._reset=function(){this._index=0};this._check=function(t){if(t.toLowerCase()===n.charAt(this._index)){this._index++}else{this._index=0}if(this._index===n.length){r();return true}return false}}return r}();var r=0;setInterval(function(){r+=1e4},1e4);try{window.addEventListener("load",function(){t.select("body").on("mousemove",function(){r=0})})}catch(t){console.error("No DOM, could not attach event listener")}function n(t,e){setInterval(function(){if(r>t){e()}},t)}function a(t){window.onblur=t}function i(t){window.onfocus=t}function o(){t.select("svg").style("pointer-events",null)}function s(){try{t.select("svg").style("pointer-events","none")}catch(t){console.error("No DOM, could not attach event listener")}}function l(){try{t.select("body").attr("oncontextmenu","return false;")}catch(t){console.error("No DOM, could not hide context menu")}}var u={egg:function(t,r){new e(t,r)},feature:function(t,r,n){new e("enable"+t,r);new e("disable"+t,n)}};return{enable:o,disable:s,noContext:l,idle:n,leave:a,enter:i,cheats:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";var r=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function n(n,a,i,o){var s;var l="du-widget-"+a+"-"+n;try{if(o){s=t.select(o).append(i).attr("id",l).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{s=t.select("body").append(i).attr("id",l).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var u={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,r,n,a){u[e]=r;t[e]=function(r){if(a){a(r)}else{u[e]=r}return t};if(typeof n==="string"&&u._categories.hasOwnProperty(n)){u._categories[n].push(e)}}};u.add(this,"relative",false);u.add(this,"x",0,"dim",function(t,e){u.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.xDim=e});u.add(this,"y",0,"dim",function(t,e){u.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.yDim=e});u.add(this,"width",200,"dim");u.add(this,"height",150,"dim");u.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){u.margins[e]=t})}else{e.forOwn(t,function(e,r){u.margins[r]=t[r]})}});u.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){u.borders[e]=t})}e.forOwn(t,function(e,r){u.borders[r]=t[r]})});u.add(this,"fontColor","black");u.add(this,"fontSize",10,"dim");u.add(this,"fontWeight","normal");u.add(this,"label",null);u.add(this,"xLabel",null);u.add(this,"yLabel",null);u.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"xTickAngle",null);u.add(this,"yMin",0);u.add(this,"mouseover",null);u.add(this,"mouseleave",null);u.add(this,"click",null);u.add(this,"colors",null);u.add(this,"tooltip",false);var c=function(){function n(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function a(r,n){if(r===null||r===undefined||r.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var a=[];l=[];if(typeof r[0].x==="number"){a=[t.min(r,function(t){return t.x}),t.max(r,function(t){return t.x})]}else{var i=[],o=[];e.forOwn(r[0].y,function(e,n){i.push(t.min(r,function(t){return t.x[n]}));o.push(t.max(r,function(t){return t.x[n]}))});a=[t.min(i),t.max(o)]}if(typeof r[0].x==="number"||typeof r[0].x==="string"){var s={};var l=[];r.forEach(function(t){if(!s.hasOwnProperty(t.x)){s[t.x]=1;l.push(t.x)}})}var u=[];if(typeof r[0].y==="number"){u=[t.min(r,function(t){return t.y}),t.max(r,function(t){return t.y})]}else{var c=[],d=[];e.forOwn(r[0].y,function(e,n){c.push(t.min(r,function(t){return t.y[n]}));d.push(t.max(r,function(t){return t.y[n]}))});u=[t.min(c),t.max(d)]}var f={x:[null,null],y:[null,null]};if(n){e.forOwn(f,function(t,e){[0,1].forEach(function(r){t[r]=n.hasOwnProperty(e)&&n[e][r]!==null?n[e][r]:t[r]})})}return{x:{min:f.x[0]!==null?f.x[0]:a[0],max:f.x[1]!==null?f.x[1]:a[1],domain:l.filter(function(t){return(!f.x[0]||t>=f.x[0])&&(!f.x[1]||t<=f.x[1])})},y:{min:f.y[0]!==null?f.y[0]:u[0],max:f.y[1]!==null?f.y[1]:u[1],domain:[]}}}function i(e,r,n,a){function i(e,r){var n=null;if(typeof e){switch(e){case"number":default:n=t.scaleLinear().domain([r.min,r.max]);break;case"time":n=t.scaleTime().domain([r.min,r.max]);break;case"string":n=t.scaleBand().domain(r.domain).padding(.1);break}}return n}return{x:i(a&&a.x?a.x.type:"number",e.x).range(a&&a.x&&a.x.reverse?[r,0]:[0,r]),y:i(a&&a.y?a.y.type:"number",e.y).range(a&&a.y&&a.y.reverse?[0,n]:[n,0])}}function o(e,r,a,i,o){if(r!==null){if(typeof i==="string"){r.g.selectAll(a).transition();r.g.selectAll(a).transition().duration(o?o:0).style("opacity",function(){return t.select(this).classed(n(i))?1:.1})}else{r.g.selectAll(a).transition();r.g.selectAll(a).transition().duration(o?o:0).style("opacity",1)}}return e}function s(e){if(e===null||e===undefined){return{}}if(e.length>0){if(u.colors===null||u.colors===undefined){return e.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,n){t[e]=r[n%18];return t},{})}if(typeof u.colors==="string"){var n=t.scaleLinear().domain([0,e.length]).range([u.colors,"#fff"]).interpolate(t.interpolateRgb);return e.reduce(function(t,e,r){t[e]=n(r);return t},{})}return u.colors}}return{encode:n,boundary:a,scale:i,highlight:o,colors:s}}();function d(){var e="du-widgets-plot-tooltip";var r=t.mouse(s.node());var n=t.event.pageX;var a=t.event.pageY;var i=s.node().getBoundingClientRect();if(n<i.left+u.margins.left||n>i.right-u.margins.right||a<i.top+u.margins.top||a>i.bottom-u.margins.bottom){t.select("#"+e).style("opacity",0).html("");c.tooltip();return}var o=t.select("#"+e);if(t.select("#"+e).empty()){var l=t.color(u.fontColor);l.opacity=.3;o=t.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("border","solid 1px "+l).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",u.fontColor).style("pointer-events","none").style("left",(i.left+i.right)/2+"px").style("top",(i.top+i.bottom)/2+"px")}var d=c.tooltip([r[0]-u.margins.left,r[1]-u.margins.top]);if(!d){t.select("#"+e).style("opacity",0).html("");c.tooltip();return}o.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").style("border-bottom","solid 1px "+u.fontColor).text(d.title);d.plots.sort(function(t,e){return t.id.localeCompare(e.id)}).forEach(function(t){var e=o.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");e.append("div").style("position","relative").style("width","10px").style("height","10px").style("float","left").style("background-color",t.color);e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)});var f=o.node().getBoundingClientRect();var h=f.width;var p=f.height;var y=n+20;var g=a+20;if(y<i.left+u.margins.left+10){y+=u.margins.left+10}else if(y+h>i.right-u.margins.right){y-=h+30}if(g<i.top+u.margins.top+10){g+=u.margins.top+10}else if(g+p>i.bottom-u.margins.bottom){g-=p+30}o.style("opacity",1).transition();o.transition().duration(200).ease(t.easeLinear).style("left",y+"px").style("top",g+"px")}this.id=function(){return l};this.describe=function(e){var r=null;s.on("contextmenu",function(){t.event.preventDefault();if(r===null){r=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(r!==null){r.remove();r=null}});return this};this.placeholder=function(e){var r=300;var a="du-widget-placeholder-"+n;if(e){s.transition().duration(r).style("opacity",0);if(t.select("#"+a).empty()){var i=o?o:"body";t.select(i).append("div").attr("id",a).style("position","absolute").style("width",u.width+"px").style("height",u.height+"px").style("line-height",u.height+"px").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",u.fontWeight).style("font-size",u.fontSize).style("color",u.fontColor).style("opacity",0).html(e).transition().duration(r).style("opacity",1)}}else{s.transition().duration();s.transition().duration(r).style("opacity",1);var l=t.select("#"+a);if(!l.empty()){l.remove()}}return this};var f={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){f.build&&f.build(e);this._isBuilt=true}f.update&&f.update(e);if(u.relative){s.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{s.style("position","absolute").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim)}s.style("width",u.width+"px").style("height",u.height+"px");s.style("pointer-events",u.tooltip&&c.tooltip?"all":null).on("mousemove",function(){u.tooltip&&c.tooltip&&d()});s.selectAll(".axis path").style("fill","none").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");s.selectAll(".tick > line").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");s.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",u.fontSize+"px").style("fill",u.fontColor);s.style("font-family","inherit");s.selectAll("g").attr("font-family","inherit");f.style&&f.style();s.style("display","block");return this};this.remove=function(){s.remove()};return{widget:s,attr:u,utils:c,render:f}}return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.AreaChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(n,a){var i=r.call(this,n,"areachart","svg",a);i.attr.add(this,"xType","number");i.attr.add(this,"opacity",.4);var o={};var s=[];this.data=function(t,r){var n=r||1;s=t.sort(function(t,e){return t.x-e.x}).map(function(t){var r={x:t.x,y:{}};e.forOwn(t.y,function(t,e){r.y[e]=t/n});return r});return this};this.highlight=function(t,e){return i.utils.highlight(this,o,".area",t,e)};i.utils.tooltip=function(r){var n=t.bisector(function(t){return o.scale.x(t.x)}).left;var a=r?n(s,r[0]):null;if(a===null){e.forOwn(this.tt,function(t){t.remove()});this.tt=null;return}else{this.tt=this.tt||{};var l=this.tt}var u=s[a-1]?s[a-1]:s[a];var c=s[a]?s[a]:s[a-1];var d=r[0]-u.x>c.x-r[0]?c:u;var f=[];e.forOwn(d.y,function(t,e){f.push({id:e,color:i.attr.colors[e],value:t.toPrecision(6)});l[e]=l[e]||o.g.append("circle");l[e].attr("r",4).attr("cx",o.scale.x(s[a].x)+1).attr("cy",o.scale.y(s[a].y[e])+1).style("fill",i.attr.colors[e])});return{title:i.attr.xLabel+": "+d.x,plots:f}};i.render.build=function(){o.g=i.widget.append("g");o.axisFn={x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)};o.axes={x:o.g.append("g").attr("class","x axis"),y:o.g.append("g").attr("class","y axis")};o.labels={x:o.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:o.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};i.render.update=function(r){o.scale=i.utils.scale(i.utils.boundary(s),i.attr.width-i.attr.margins.left-i.attr.margins.right,i.attr.height-i.attr.margins.top-i.attr.margins.bottom,{x:{type:i.attr.xType}});o.axes.x.transition().duration(r).call(o.axisFn.x.scale(o.scale.x));o.axes.y.transition().duration(r).call(o.axisFn.y.scale(o.scale.y));if(s.length>0){if(o.areas===undefined){o.areas={};e.forOwn(s[0].y,function(t,e){o.areas[e]=o.g.append("path").attr("class","area "+i.utils.encode(e)).style("shape-rendering","geometricPrecision")})}e.forOwn(s[0].y,function(e,n){var a=t.area().x(function(t){return o.scale.x(t.x)+1}).y0(i.attr.height-i.attr.margins.top-i.attr.margins.bottom).y1(function(t){return o.scale.y(t.y[n])});o.g.select(".area."+i.utils.encode(n)).transition().duration(r).attr("d",a(s))})}};i.render.style=function(){i.attr.colors=i.utils.colors(s[0]?t.keys(s[0].y):null);var r=i.attr.width-i.attr.margins.left-i.attr.margins.right,n=i.attr.height-i.attr.margins.top-i.attr.margins.bottom;o.g.attr("width",r+"px").attr("height",n+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");o.axes.x.attr("transform","translate(0,"+n+")");o.axisFn.y.tickFormat(i.attr.yTickFormat);o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",r+"px").attr("y",n+2.2*i.attr.fontSize+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.yLabel);e.forOwn(o.areas,function(t,e){o.areas[e].style("fill-opacity",i.attr.opacity).style("fill",i.attr.colors[e]).on("mouseover",function(){i.attr.mouseover&&i.attr.mouseover(e)}).on("mouseleave",function(){i.attr.mouseleave&&i.attr.mouseleave(e)}).on("click",function(){i.attr.click&&i.attr.click(e)})})}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BarChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(n,a){var i=r.call(this,n,"barchart","svg",a);i.attr.add(this,"vertical",false);var o={};var s=[];this.data=function(t){s=[];e.forOwn(t,function(t,e){s.push({x:e,y:t})});s.sort(function(t,e){return t.x.localeCompare(e.x)});return this};this.highlight=function(t,e){return i.utils.highlight(this,o,".bar",t,e)};i.utils.tooltip=function(e){var r=i.attr.vertical?1:0;var n=t.bisector(function(t){return o.scale.x(t.x)}).right;var a=e?n(s,e[r]):null;if(a===null){return}var l=s[a-1]?s[a-1]:s[a];var u=s[a]?s[a]:s[a-1];var c=e[r]-l.x>u.x-e[r]?u:l;return{title:i.attr.xLabel+": "+c.x,plots:[{id:c.x,color:i.attr.colors[c.x],value:c.y.toPrecision(6)}]}};i.render.build=function(){o.g=i.widget.append("g");o.axisFn={x:t.axisBottom().ticks(4),y:t.axisLeft().ticks(4)};o.axes={x:o.g.append("g").attr("class","x axis"),y:o.g.append("g").attr("class","y axis")};o.labels={x:o.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:o.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};i.render.update=function(t){if(i.attr.vertical){o.scale=i.utils.scale(i.utils.boundary(s,{y:[0,null]}),i.attr.height-i.attr.margins.top-i.attr.margins.bottom,i.attr.width-i.attr.margins.left-i.attr.margins.right,{x:{type:"string"},y:{reverse:true}})}else{o.scale=i.utils.scale(i.utils.boundary(s,{y:[0,null]}),i.attr.width-i.attr.margins.left-i.attr.margins.right,i.attr.height-i.attr.margins.top-i.attr.margins.bottom,{x:{type:"string"}})}o.axes.x.transition().duration(t).call(o.axisFn.x.scale(i.attr.vertical?o.scale.y:o.scale.x));o.axes.y.transition().duration(t).call(o.axisFn.y.scale(i.attr.vertical?o.scale.x:o.scale.y));if(s.length>0){if(o.bars===undefined){o.bars=o.g.selectAll(".bar").data(s).enter().append("rect").attr("class",function(t){return"bar "+i.utils.encode(t.x)}).style("pointer-events","all").style("stroke","none").style("shape-rendering","geometricPrecision");if(i.attr.vertical){o.bars.attr("x",1).attr("width",0)}else{o.bars.attr("y",i.attr.height-i.attr.margins.top-i.attr.margins.bottom-1).attr("height",0)}}o.bars.data(s);if(i.attr.vertical){o.bars.attr("y",function(t){return o.scale.x(t.x)}).attr("height",o.scale.x.bandwidth()).transition().duration(t).attr("x",1).attr("width",function(t){return o.scale.y(t.y)})}else{o.bars.attr("x",function(t){return o.scale.x(t.x)}).attr("width",o.scale.x.bandwidth()).transition().duration(t).attr("y",function(t){return o.scale.y(t.y)}).attr("height",function(t){return i.attr.height-i.attr.margins.top-i.attr.margins.bottom-o.scale.y(t.y)})}}};i.render.style=function(){i.attr.colors=i.utils.colors(s?s.map(function(t){return t.x}):null);var t=i.attr.width-i.attr.margins.left-i.attr.margins.right,e=i.attr.height-i.attr.margins.top-i.attr.margins.bottom;o.g.style("width",t+"px").style("height",e+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");if(i.attr.vertical){o.axisFn.x.tickFormat(i.attr.yTickFormat)}else{o.axisFn.y.tickFormat(i.attr.yTickFormat)}o.axes.x.attr("transform","translate(0,"+e+")");o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(i.attr.vertical){o.g.selectAll(".y.axis .tick > line").style("display","none")}if(typeof i.attr.xTickAngle==="number"){o.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+i.attr.xTickAngle+")").style("text-anchor","start")}o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",t+"px").attr("y",e+2.2*i.attr.fontSize+"px").style("font-size",i.attr.fontSize+"px").style("fill",i.attr.fontColor).text(i.attr.vertical?i.attr.yLabel:i.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",i.attr.fontSize+"px").style("fill",i.attr.fontColor).text(i.attr.vertical?i.attr.xLabel:i.attr.yLabel);if(o.bars!==undefined){o.bars.style("fill",function(t){return typeof i.attr.colors==="string"?i.attr.colors:i.attr.colors[t.x]});if(i.attr.mouseover){o.bars.on("mouseover",function(t){i.attr.mouseover&&i.attr.mouseover(t.x)});o.g.selectAll("."+(i.attr.vertical?"y":"x")+".axis .tick").on("mouseover",function(t,e){i.attr.mouseover&&i.attr.mouseover(s[e].x)})}if(i.attr.mouseleave){o.bars.on("mouseleave",function(t){i.attr.mouseleave&&i.attr.mouseleave(t.x)});o.g.selectAll("."+(i.attr.vertical?"y":"x")+".axis .tick").on("mouseleave",function(t,e){i.attr.mouseleave&&i.attr.mouseleave(s[e].x)})}if(i.attr.click){o.bars.on("click",function(t){i.attr.click&&i.attr.click(t.x)});o.g.selectAll("."+(i.attr.vertical?"y":"x")+".axis .tick").on("click",function(t,e){i.attr.click&&i.attr.click(s[e].x)})}}}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BubbleChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(e,n){var a=r.call(this,e,"bubblechart","svg",n);a.attr.add(this,"scale",1);var i={};var o=[];var s=null;this.data=function(t){o=t;return this};this.highlight=function(t,e){return a.utils.highlight(this,i,".bubble",t,e)};a.utils.tooltip=function(){return s?{title:s.name,plots:[{id:"",color:a.attr.colors[s.name],value:"("+s.x.toPrecision(3)+",&nbsp;"+s.y.toPrecision(3)+")"}]}:null};a.render.build=function(){i.g=a.widget.append("g");i.axisFn={x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)};i.axes={x:i.g.append("g").attr("class","x axis"),y:i.g.append("g").attr("class","y axis")};i.labels={x:i.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:i.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};a.render.update=function(e){var r=t.max(o,function(t){return a.attr.scale*t.size});var n=a.utils.boundary(o);n.x.min-=r;n.x.max+=r;n.y.min-=r;n.y.max+=r;i.scale=a.utils.scale(n,a.attr.width-a.attr.margins.left-a.attr.margins.right,a.attr.height-a.attr.margins.top-a.attr.margins.bottom,{x:{type:a.attr.xType}});i.axes.x.transition().duration(e).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(e).call(i.axisFn.y.scale(i.scale.y));if(o.length>0){if(i.bubbles===undefined){i.bubbles=i.g.selectAll(".bubble").data(o).enter().append("circle").attr("class",function(t){return"bubble "+a.utils.encode(t.name)}).attr("r",function(t){return a.attr.scale*t.size}).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)}).style("stroke","none").style("shape-rendering","geometricPrecision")}i.bubbles.data(o).transition().duration(e).attr("r",function(t){return a.attr.scale*t.size}).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)})}};a.render.style=function(){a.attr.colors=a.utils.colors(o?o.map(function(t){return t.name}):null);var t=a.attr.width-a.attr.margins.left-a.attr.margins.right,e=a.attr.height-a.attr.margins.top-a.attr.margins.bottom;i.g.attr("width",t+"px").attr("height",e+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axes.x.attr("transform","translate(0,"+e+")");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",t+"px").attr("y",e+2.2*a.attr.fontSize+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel);i.bubbles.style("fill",function(t){return a.attr.colors[t.name]}).style("stroke",a.attr.stroke).on("mouseover",function(t){s=t;a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){s=null;a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)})}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ChordChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"chordchart","svg",n);a.attr.add(this,"radius",100,"dim");a.attr.add(this,"thickness",10,"dim");a.attr.add(this,"ticks",false);a.attr.add(this,"invert",false);var i={};var o=[];var s=null;var l=t.map();var u=t.map();var c=10;var d=null;this.data=function(e){l.clear();u.clear();o=[];var r=0,n=0;e.forEach(function(t){if(!l.has(n=t.source)){u.set(r,n);l.set(n,r++)}if(!l.has(n=t.target)){u.set(r,n);l.set(n,r++)}});e.forEach(function(t){var e=l.get(t.source),n=l.get(t.target),a=o[e];if(!a){a=o[e]=[];for(var i=0;i<r;i++)a[i]=0}a[n]=t.value;if(!o[n]){o[n]=[];for(i=0;i<r;i++)o[n][i]=0}});c=t.max(u.values(),function(t){return t.length});return this};function f(t){return t.source.index<t.target.index?t.source.index+"-"+t.target.index:t.target.index+"-"+t.source.index}function h(e){var r=t.map();if(e){e.groups.forEach(function(t){r.set(t.index,t)})}return function(e){var n;var a=r.get(e.index);if(a){n=t.interpolate(a,e)}else{var o={startAngle:e.startAngle,endAngle:e.startAngle};n=t.interpolate(o,e)}return function(t){return i.arc(n(t))}}}function p(e){var r=t.map();if(e){e.forEach(function(t){r.set(f(t),t)})}return function(n){var a;var o=r.get(f(n));if(o){if(n.source.index!==o.source.index){o={source:o.target,target:o.source}}a=t.interpolate(o,n)}else{if(e){var s=e.groups.filter(function(t){return t.index===n.source.index||t.index===n.target.index});o={source:s[0],target:s[1]||s[0]};if(o.source&&n.source.index!==o.source.index){o={source:o.target,target:o.source}}}else o=n;var l=o.source?o.source.startAngle:0;var u=o.target?o.target.startAngle:0;var c={source:{startAngle:l,endAngle:l},target:{startAngle:u,endAngle:u}};a=t.interpolate(c,n)}return function(t){return i.ribbonFn(a(t))}}}this.highlight=function(t,e){return a.utils.highlight(this,i,".ribbon",t,e)};a.utils.tooltip=function(){if(!s){return null}var e=o[l.get(s.name)];return s?{title:s.name,plots:e.map(function(r,n){return{color:a.attr.colors[u.get(n)],value:100*r/t.sum(e)}}).sort(function(t,e){return e.value-t.value}).map(function(t){return{id:"",color:t.color,value:t.value.toFixed(1)+"%"}})}:null};a.render.build=function(){i.g=a.widget.append("g");i.chordFn=t.chord().padAngle(.05).sortGroups(t.descending).sortSubgroups(t.descending);i.arc=t.arc();i.ribbonFn=t.ribbon();i.label=i.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};a.render.update=function(t){a.attr.colors=a.utils.colors(l?l.keys():null);var e=a.attr.radius-a.attr.thickness-a.attr.margins.left,r=a.attr.radius-a.attr.margins.left;if(i.groups)i.groups.transition();if(i.newGroups)i.newGroups.transition();if(i.ribbons)i.ribbons.transition();if(i.newRibbons)i.newRibbons.transition();i.chord=i.chordFn(o);i.arc.innerRadius(e).outerRadius(r);i.groups=i.g.selectAll(".group").data(i.chord.groups,function(t){return t.index});i.newGroups=i.groups.enter().append("g").each(function(t){t.name=u.get(t.index)}).attr("class","group").style("pointer-events","all").on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){s=null;a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).on("mousemove",function(t){s=t});i.newGroups.append("path").attr("id",function(t){return"group"+t.index}).style("fill",function(t){return a.attr.colors[t.name]}).transition().duration(t).attrTween("d",h(d));if(a.attr.ticks){i.newGroups.append("text").attr("xlink:href",function(t){return"#group"+t.index}).attr("dy",".35em").text(function(t){return t.name}).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(a.attr.radius-a.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}i.groups.exit().transition().duration(t).style("opacity",0).remove();i.groups.select("path").each(function(t){t.name=u.get(t.index)}).attr("d",i.arc).transition().duration(t).style("fill",function(t){return a.attr.colors[t.name]}).attrTween("d",h(d));if(a.attr.ticks){i.groups.select("text").transition().duration(t).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(a.attr.radius-a.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}i.ribbonFn.radius(e);i.ribbons=i.g.selectAll(".ribbon").data(i.chord,f);i.newRibbons=i.ribbons.enter().append("path").each(function(t){t.source.name=u.get(t.source.index);t.target.name=u.get(t.target.index)}).attr("class",function(t){return"ribbon "+a.utils.encode(t.source.name)}).style("pointer-events","all").style("fill",function(t){return a.attr.colors[a.attr.invert?t.source.name:t.target.name]}).style("stroke-width","1px").style("fill-opacity",.8).style("stroke-opacity",.8).style("stroke","white");i.newRibbons.transition().duration(t).attrTween("d",p(null));i.ribbons.exit().transition().duration(t).style("opacity",0).remove();i.ribbons.each(function(t){t.source.name=u.get(t.source.index);t.target.name=u.get(t.target.index)}).attr("class",function(t){return"ribbon "+a.utils.encode(t.source.name)}).transition().duration(t).style("fill",function(t){return a.attr.colors[a.attr.invert?t.source.name:t.target.name]}).attrTween("d",p(d));d=i.chord};a.render.style=function(){a.attr.width=2*a.attr.radius;a.attr.height=2*a.attr.radius;a.widget.style("width",a.attr.width+"px").style("height",a.attr.height+"px");i.g.attr("transform","translate("+a.attr.radius+","+a.attr.radius+")");if(a.attr.ticks){i.newGroups.selectAll("text").style("font-size",a.attr.fontSize*.8+"px").style("font-weight",a.attr.fontWeight).style("fill",a.attr.fontColor)}i.label.attr("transform","translate(0,"+a.attr.radius+")").style("width",2*(a.attr.radius+a.attr.thickness)+"px").attr("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.label)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Grid=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"grid","div",n);var i=a.attr.x;var o=a.attr.y;var s=1;var l=1;var u=[];var c=[];var d=false;function f(){u.forEach(function(t){t.forEach(function(t){if(t){t.remove()}})});u=[];for(var t=0;t<l;t++){u.push([]);for(var e=0;e<s;e++){u[t].push(null)}}}this.x=function(t,e){a.attr.x=e!=="%"?t:window.innerWidth*t/100;i=a.attr.x;return this};this.y=function(t,e){a.attr.y=e!=="%"?t:window.innerHeight*t/100;o=a.attr.y;return this};this.rows=function(t){s=t;f();return this};this.cols=function(t){l=t;f();return this};this.show=function(t){if(t){d=true;a.widget.style("box-shadow","0 0 1px black inset");for(var e=1;e<s;e++){a.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*a.attr.height/s-1.5+"px").style("width",a.attr.width+"px").style("height","3px").style("background-color","white")}for(var r=1;r<l;r++){a.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*a.attr.width/l-1.5+"px").style("top","0").style("width","3px").style("height",a.attr.height+"px").style("background-color","white")}for(e=1;e<s;e++){a.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*a.attr.height/s-.5+"px").style("width",a.attr.width+"px").style("height","1px").style("background-color","black")}for(r=1;r<l;r++){a.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*a.attr.width/l-.5+"px").style("top","0").style("width","1px").style("height",a.attr.height+"px").style("background-color","black")}}else{d=false;a.widget.style("border",null);a.widget.selectAll(".grid-border-h").remove();a.widget.selectAll(".grid-border-v").remove()}return this};this.add=function(e,r,i,o,d){if(r<0||o<1||r+o>l||i<0||d<1||i+d>s){e.remove();return null}for(var f=r;f<r+o;f++){if(u[f]){for(var h=i;h<i+d;h++){if(u[f][h]){e.remove();return null}}}}c.push({x:r,y:i,width:o,height:d,widget:e});for(f=r;f<r+o;f++){for(h=i;h<i+d;h++){u[f][h]=e}}t.select("#"+this.id()).node().appendChild(t.select("#"+e.id()).node());e.x(r*a.attr.width/l+a.attr.x+a.attr.margins.left).y(i*a.attr.height/s+a.attr.y+t.select(n).attr("top")+a.attr.margins.left).width(o*a.attr.width/l-2*a.attr.margins.left).height(d*a.attr.height/s-2*a.attr.margins.left).render();return e};this.get=function(t,e){if(u[e]&&u[e][t]){return u[e][t].widget}else{return null}};a.render.style=function(){a.widget.style("position","absolute").style(a.attr.x>0?"left":"right",Math.abs(a.attr.x)+a.attr.xDim).style(a.attr.y>0?"top":"bottom",Math.abs(a.attr.y)+a.attr.yDim).style("width",a.attr.width+"px").style("height",a.attr.height+"px");a.widget.selectAll(".grid-border-h").style("top",function(){return t.select(this).attr("data-y")*a.attr.height/s-1+"px"}).style("width",a.attr.width+"px");a.widget.selectAll(".grid-border-v").style("left",function(){return t.select(this).attr("data-x")*a.attr.width/l-1+"px"}).style("height",a.attr.height+"px");c.forEach(function(t){t.widget.x(t.x*a.attr.width/l+a.attr.x+a.attr.margins.left).y(t.y*a.attr.height/s+a.attr.y+a.attr.margins.left).width(t.width*a.attr.width/l-2*a.attr.margins.left).height(t.height*a.attr.height/s-2*a.attr.margins.left).render(0)})}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Hint=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";var r=function(){var r={};function n(){for(var t in r){if(r.hasOwnProperty(t)){delete r[t]}}r={}}function a(a,i){var o="du-widgets-hint-";var s=o+a;var l=o+"css";var u=o+"class";if(r.hasOwnProperty(s)){return r[s]}else{var c=e.call(this,a,"hint","div",i);var d=this}c.attr.add(this,"text","");c.attr.add(this,"pin",false);try{if(t.select("#"+l).empty()){t.select("head").append("style").attr("id",l).text("."+u+":after{content:' ';position:absolute;width:0;height:0;left:20.5px;bottom:-10px;border:7px solid;border-color:#000 transparent transparent #000;}")}window.addEventListener("mousemove",function(){t.selectAll("."+u+".removable").remove();n()})}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}c.render.build=function(){c.widget.attr("class",u).style("position","absolute").style("display","block").style("padding","15px").style("text-align","center").style("line-height","1.1em").style("background-color","black").style("border-radius","4px").style("color","white").style("font-size","0.9em").style("font-weight","bold").style("pointer-events","none");if(!c.attr.pin){c.widget.classed("removable",true)}};c.render.style=function(t){c.widget.style("width","auto").style("height",null).html(c.attr.text);if(!r[s]){c.widget.style("opacity",0).transition().duration(t).style("opacity",1);if(!c.attr.pin){r[s]=d}}}}return a}();r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"histogram","svg",n);a.attr.add(this,"min",null);a.attr.add(this,"max",null);a.attr.add(this,"bin",null);a.attr.add(this,"normalize",false);var i={};var o=[];var s=[];this.data=function(t){o=t.sort(function(t,e){return+t-e});return this};this.highlight=function(t,e){return a.utils.highlight(this,i,".bar",t,e)};a.utils.tooltip=function(e){var r=t.bisector(function(t){return i.scale.x(t.x0)}).right;var n=e?r(s,e[0]):null;if(n===null){return}var o=s[n-1]?s[n-1]:s[n];var l=s[n]?s[n]:s[n-1];var u=e[0]-o.x>l.x-e[0]?l:o;return{title:a.attr.xLabel+": ["+u.x0.toPrecision(3)+", "+u.x1.toPrecision(3)+"]",plots:[{id:"",color:a.attr.colors[0],value:u.length.toPrecision(6)}]}};a.render.build=function(){i.g=a.widget.append("g");i.axisFn={x:t.axisBottom().ticks(4),y:t.axisLeft().ticks(4)};i.axes={x:i.g.append("g").attr("class","x axis"),y:i.g.append("g").attr("class","y axis")};i.labels={x:i.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:i.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};a.render.update=function(e){if(o.length===0){return}var r=typeof a.attr.min==="number"?a.attr.min:o[0];var n=typeof a.attr.max==="number"?a.attr.max:o[o.length-1];var l=a.attr.bin;if(l===null){var u=(o.length+1)/4,c=Math.floor(u),d=Math.ceil(u),f=u-c,h=f*o[c]+(1-f)*o[d];var p=3*(o.length+1)/4,y=Math.floor(p),g=Math.ceil(p),x=p-y,m=x*o[y]+(1-x)*o[g];l=2*(m-h)/Math.pow(o.length,1/3)}var v=[];var w=Math.ceil((n-r)/l);for(var b=0;b<=w;b++){v.push(r+b*l)}var k=a.attr.normalize?o.length:1;s=t.histogram().domain([r,r+w*l]).thresholds(v)(o);var O=t.max(s,function(t){return t.length/k});i.scale=a.utils.scale({x:{min:r,max:r+w*l,domain:[r,n]},y:{min:0,max:O,domain:[0,O]}},a.attr.width-a.attr.margins.left-a.attr.margins.right,a.attr.height-a.attr.margins.top-a.attr.margins.bottom);i.axes.x.transition().duration(e).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(e).call(i.axisFn.y.scale(i.scale.y));if(o.length>0){if(i.bars===undefined){i.bars=i.g.selectAll(".bar").data(s).enter().append("rect").attr("class",function(t,e){return"bar bin-"+e}).style("pointer-events","all").style("stroke","none").style("shape-rendering","geometricPrecision");i.bars.attr("y",a.attr.height-a.attr.margins.top-a.attr.margins.bottom-1).attr("height",0)}i.bars.data(s);i.bars.attr("x",function(t){return i.scale.x(t.x0)+2}).attr("width",function(t){return Math.abs(i.scale.x(t.x1-t.x0)-2)}).transition().duration(e).attr("y",function(t){return a.attr.margins.top-a.attr.margins.top+i.scale.y(t.length/k)}).attr("height",function(t){return a.attr.height-a.attr.margins.top-a.attr.margins.bottom-i.scale.y(t.length/k)})}};a.render.style=function(){a.attr.colors=a.utils.colors([0]);var t=a.attr.width-a.attr.margins.left-a.attr.margins.right,e=a.attr.height-a.attr.margins.top-a.attr.margins.bottom;i.g.style("width",t+"px").style("height",e+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.x.attr("transform","translate(0,"+e+")");i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof a.attr.xTickAngle==="number"){i.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+a.attr.xTickAngle+")").style("text-anchor","start")}i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",t+"px").attr("y",e+2.2*a.attr.fontSize+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.yLabel);if(i.bars!==undefined){i.bars.style("fill",a.attr.colors[0]).on("mouseover",function(t,e){a.attr.mouseover&&a.attr.mouseover("bin-"+e)}).on("mouseleave",function(t,e){a.attr.mouseleave&&a.attr.mouseleave("bin-"+e)}).on("click",function(t,e){a.attr.click&&a.attr.click("bin-"+e)})}}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.InfoBox=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";var r=function(){var r=null;function n(){if(r){r.remove()}var n=e.call(this,"infobox","infobox","div");r=n.widget;n.attr.add(this,"content","");n.attr.add(this,"backgroundColor","#fff");var a=null;var i=null;n.render.build=function(e){n.widget.style("display","none").style("opacity",0).on("click",function(){t.select(this).transition().duration(e).style("opacity",0).on("end",function(){r.remove()})});a=n.widget.append("div").style("position","absolute").style("top",0).style("left","50%").style("width","50%").style("padding","20px").style("margin-left","calc(-25% - 10px)").style("margin-top","100px").style("box-shadow","1px 1px 4px grey").style("border-radius","3px");i=a.append("div").style("padding","10px").style("min-height","100px").style("font-size","14pt").style("text-align","left").style("overflow","scroll")};n.render.style=function(){var e=t.color("white");n.widget.style("width","100%").style("height","100%").style("top","0").style("left","0").style("pointer-events","all").style("background-color","rgba("+e.rgb().r+","+e.rgb().g+","+e.rgb().b+",0.9)");a.style("background-color",n.attr.backgroundColor);i.style("color",n.attr.fontColor).html(n.attr.content);n.widget.style("display","block").transition().duration(400).style("opacity",1)}}return n}();r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Label=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"label","div",r);n.attr.add(this,"align","center");var a={};n.render.build=function(){a.g=n.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");a.label=a.g.append("div").style("display","table-cell").style("vertical-align","middle").style("pointer-events","none").html(n.attr.label)};n.render.style=function(){a.label.style("color",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").style("font-weight",n.attr.fontWeight).style("text-align",n.attr.align)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","_","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Legend=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(t,n){var a=r.call(this,t,"legend","div",n);a.attr.add(this,"labels",[]);a.attr.add(this,"twoColumns",false);var i={};this.highlight=function(t,e){return a.utils.highlight(this,i,".legend-entry",t,e)};a.render.build=function(){i.g=a.widget.append("div").style("display","block").style("position","relative");i.legends={};a.attr.labels.forEach(function(t){var e=i.g.append("div").attr("class","legend-entry "+a.utils.encode(t)).style("display","inline-block").style("position","relative").style("width","100%").style("margin-bottom","6px").style("vertical-align","top").style("pointer-event","all");var r=e.append("div").style("display","inline-block").style("position","relative").style("float","left");var n=e.append("div").style("display","inline-block").style("position","relative").style("float","right").text(t);i.legends[t]={g:e,square:r,text:n}})};a.render.style=function(){a.attr.colors=a.utils.colors(a.attr.labels);i.g.style("width",a.attr.width+"px").style("height",a.attr.height+"px").style("pointer-events","all");e.forOwn(i.legends,function(t,e){t.g.style("width",a.attr.twoColumns?"50%":"100%");t.square.style("width",.7*a.attr.fontSize+"px").style("height",.7*a.attr.fontSize+"px").style("margin",.15*a.attr.fontSize+"px "+.15*a.attr.fontSize+"px").style("background-color",a.attr.colors[e]);if(a.attr.mouseover){t.square.style("cursor","pointer").on("mouseover",function(){a.attr.mouseover(e)})}if(a.attr.mouseleave){t.square.on("mouseleave",function(){a.attr.mouseleave(e)})}if(a.attr.click){t.square.style("cursor","pointer").on("click",function(){a.attr.click(e)})}t.text.style("width","calc(100% - "+1.2*a.attr.fontSize+"px)").style("line-height",a.attr.fontSize+"px").style("cursor",a.attr.mouseover||a.attr.click?"pointer":null).on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(e)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(e)}).on("click",function(){a.attr.click&&a.attr.click(e)})})}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.LineChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(n,a){var i=r.call(this,n,"linechart","svg",a);i.attr.add(this,"xType","number");i.attr.add(this,"legend",false);var o={};var s=[];var l=1;var u={};this.data=function(t,r){var n=r||1;s=t.sort(function(t,e){return t.x-e.x}).map(function(t){var r={x:t.x,y:{}};e.forOwn(t.y,function(t,e){r.y[e]=t/n});if(t.dy){r.dy={};e.forOwn(t.dy,function(t,e){r.dy[e]=t/n})}return r});if(typeof r==="number"&&r>0)l=r;return this};this.highlight=function(t,e){i.utils.highlight(this,o,".line",t,e);i.utils.highlight(this,o,".error",t,e);i.utils.highlight(this,o,".marker",t,e);return this};var c=this.highlight;this.addMarker=function(t,e,r,n,a){if(u.hasOwnProperty(t)){return null}var l=s.filter(function(t){return t.x-r===0})[0];if(!l||!l.hasOwnProperty("y")||!l.y.hasOwnProperty(e))return null;var c=l.y[e];var d=s.filter(function(t){return t.x-n===0})[0];if(!d||!d.hasOwnProperty("y")||!d.y.hasOwnProperty(e))return null;var f=d.y[e];var h=typeof i.attr.colors==="string"?i.attr.colors:i.attr.colors[e];var p=c<f?r:n;var y=c<f?f:c;var g={start:{x:r,y:c},end:{x:n,y:f},corner:{x:p,y:y},g:o.g.append("g").attr("class","marker "+i.utils.encode(e))};g.g.append("line").attr("class","horizontal").attr("x1",o.scale.x(r)+2).attr("y1",o.scale.y(y)).attr("x2",o.scale.x(n)+2).attr("y2",o.scale.y(y)).style("stroke",h).style("stroke-dasharray","3 3").style("stroke-width",1);g.g.append("line").attr("class","vertical").attr("x1",o.scale.x(p)+2).attr("y1",o.scale.y(c)).attr("x2",o.scale.x(p)+2).attr("y2",o.scale.y(f)).style("stroke",h).style("stroke-dasharray","3 3").style("stroke-width",1);g.g.append("circle").attr("class","start").attr("cx",o.scale.x(r)+2).attr("cy",o.scale.y(c)).attr("r",4).style("stroke","none").style("fill",h);g.g.append("circle").attr("class","end").attr("cx",o.scale.x(n)+2).attr("cy",o.scale.y(f)).attr("r",4).style("stroke","none").style("fill",h);g.g.append("text").attr("x",o.scale.x(p)+2).attr("y",o.scale.y(y)).attr("dy",-5).attr("text-anchor",c<f?"start":"end").style("fill",i.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").text(a);u[t]=g;return g};this.removeMarker=function(t){if(u.hasOwnProperty(t)){u[t].g.remove();delete u[t];return true}return false};i.utils.tooltip=function(r){var n=t.bisector(function(t){return o.scale.x(t.x)}).left;var a=r?n(s,r[0]):null;if(a===null){e.forOwn(this.tt,function(t){t.remove()});this.tt=null;return}else{this.tt=this.tt||{};var l=this.tt}var u=s[a-1]?s[a-1]:s[a];var c=s[a]?s[a]:s[a-1];var d=r[0]-u.x>c.x-r[0]?c:u;var f=[];e.forOwn(d.y,function(t,e){f.push({id:e,color:i.attr.colors[e],value:t.toPrecision(6)});l[e]=l[e]||o.g.append("circle");l[e].attr("r",4).attr("cx",o.scale.x(s[a].x)+2).attr("cy",o.scale.y(s[a].y[e])).style("fill",i.attr.colors[e])});return{title:i.attr.xLabel+": "+d.x,plots:f}};i.render.build=function(){o.g=i.widget.append("g");o.axisFn={x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)};o.axes={x:o.g.append("g").attr("class","x axis"),y:o.g.append("g").attr("class","y axis")};o.labels={x:o.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:o.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)};if(i.attr.legend){var r=o.g.append("g").attr("class","legend");var n=0;e.forOwn(o.lines,function(t,e){var a=r.append("g").style("cursor","pointer").on("mouseover",function(){c(e)}).on("mouseleave",function(){c()});a.append("rect").attr("x",i.attr.width*.8).attr("y",n).attr("width",i.attr.fontSize).attr("height",i.attr.fontSize).style("fill",typeof i.attr.colors==="string"?i.attr.colors:i.attr.colors[e]).style("stroke","none");a.append("text").attr("x",i.attr.width*.83).attr("y",n).attr("dy",.8*i.attr.fontSize).attr("text-anchor","start").style("fill",i.attr.fontColor).attr("font-family","inherit").attr("font-size",i.attr.fontSize+"px").text(e);n+=i.attr.height*.08})}};i.render.update=function(r){var n=i.utils.boundary(s,{y:[i.attr.yMin,null]});o.scale=i.utils.scale(n,i.attr.width-i.attr.margins.left-i.attr.margins.right,i.attr.height-i.attr.margins.top-i.attr.margins.bottom,{x:{type:i.attr.xType}});o.axes.x.transition().duration(r).call(o.axisFn.x.scale(o.scale.x));o.axes.y.transition().duration(r).call(o.axisFn.y.scale(o.scale.y));if(s.length>0){if(o.lines===undefined){o.errors={};e.forOwn(s[0].y,function(t,e){o.errors[e]=o.g.append("path").attr("class","error "+i.utils.encode(e)).style("fill-opacity",.2).style("stroke-width","0px").style("shape-rendering","geometricPrecision")});o.lines={};e.forOwn(s[0].y,function(t,e){o.lines[e]=o.g.append("path").attr("class","line "+i.utils.encode(e)).style("fill","none").style("stroke-width","2px").style("shape-rendering","geometricPrecision")})}e.forOwn(s[0].y,function(e,a){if(s[0].hasOwnProperty("dy")&&s[0].dy.hasOwnProperty(a)){var i=t.area().x(function(t){return o.scale.x(t.x)+2}).y0(function(t){return o.scale.y(Math.max(t.y[a]-t.dy[a],n.y.min))}).y1(function(t){return o.scale.y(Math.min(t.y[a]+t.dy[a],n.y.max))});o.errors[a].transition().duration(r).attr("d",i(s))}var l=t.line().x(function(t){return o.scale.x(t.x)+2}).y(function(t){return o.scale.y(t.y[a])});o.lines[a].transition().duration(r).attr("d",l(s))})}};i.render.style=function(){i.attr.colors=i.utils.colors(s[0]?t.keys(s[0].y):null);var r=i.attr.width-i.attr.margins.left-i.attr.margins.right,n=i.attr.height-i.attr.margins.top-i.attr.margins.bottom;o.g.attr("width",r+"px").attr("height",n+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");o.axes.x.attr("transform","translate(0,"+n+")");o.axisFn.y.tickFormat(i.attr.yTickFormat);o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",r+"px").attr("y",n+2.2*i.attr.fontSize+"px").style("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.yLabel);e.forOwn(o.errors,function(t,e){o.errors[e].style("fill",typeof i.attr.colors==="string"?i.attr.colors:i.attr.colors[e]).on("mouseover",function(){i.attr.mouseover&&i.attr.mouseover(e)}).on("mouseleave",function(){i.attr.mouseleave&&i.attr.mouseleave(e)}).on("click",function(){i.attr.click&&i.attr.click(e)})});e.forOwn(o.lines,function(t,e){o.lines[e].style("stroke",typeof i.attr.colors==="string"?i.attr.colors:i.attr.colors[e]).on("mouseover",function(){i.attr.mouseover&&i.attr.mouseover(e)}).on("mouseleave",function(){i.attr.mouseleave&&i.attr.mouseleave(e)}).on("click",function(){i.attr.click&&i.attr.click(e)})});e.forOwn(u,function(t){t.g.select(".horizontal").attr("x1",o.scale.x(t.start.x)+2).attr("y1",o.scale.y(t.corner.y)).attr("x2",o.scale.x(t.end.x)+2).attr("y2",o.scale.y(t.corner.y));t.g.select(".vertical").attr("x1",o.scale.x(t.corner.x)+2).attr("y1",o.scale.y(t.start.y)).attr("x2",o.scale.x(t.corner.x)+2).attr("y2",o.scale.y(t.end.y));t.g.select(".start").attr("cx",o.scale.x(t.start.x)+2).attr("cy",o.scale.y(t.start.y));t.g.select(".end").attr("cx",o.scale.x(t.end.x)+2).attr("cy",o.scale.y(t.end.y));t.g.select("text").attr("x",o.scale.x(t.corner.x)+2).attr("y",o.scale.y(t.corner.y)).attr("text-anchor",t.start.y<t.end.y?"start":"end").style("fill",i.attr.fontColor)})}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("topojson"),require("leaflet"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","_","topojson","leaflet","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Map=e(t.d3,t._,t.topojson,t.L,t.du.Widget)}})(this,function(t,e,r,n,a){"use strict";var i=function(t){var e=t||[1,0];this.x=function(){return e[0]};this.y=function(){return e[1]};this.length=function(t){var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]);if(typeof t==="number"){var n=t/r;return new i(e.map(function(t){return t*n}))}return r};this.angle=function(t){var r=Math.atan2(e[1],e[0]);if(typeof t==="number"){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return new i([n*Math.cos(t),n*Math.sin(t)])}return r};this.toArray=function(){return[e[0],e[1]]};this.map=function(t){return new i(t(e))};this.add=function(t){return new i([e[0]+t.x(),e[1]+t.y()])};this.sub=function(t){return new i([e[0]-t.x(),e[1]-t.y()])};this.mult=function(t){return new i(e.map(function(e){return e*t}))}};var o=function(t){var e=t||[1,0,0];this.x=function(){return e[0]};this.y=function(){return e[1]};this.z=function(){return e[2]};this.length=function(t){var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(typeof t==="number"){return new o(e.map(function(e){return e*t/r}))}return r};this.toLatLon=function(){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return new s([Math.asin(e[2]/t),Math.atan2(e[1],e[0])].map(function(t){return t*180/Math.PI}))};this.add=function(t){return new o([e[0]+t.x(),e[1]+t.y(),e[2]+t.z()])};this.mult=function(t){return new o(e.map(function(e){return e*t}))};this.dot=function(t){return e[0]*t.x()+e[1]*t.y()+e[2]*t.z()};this.cross=function(t){return new o([e[1]*t.z()-e[2]*t.y(),e[2]*t.x()-e[0]*t.z(),e[0]*t.y()-e[1]*t.x()])}};var s=function(t){var e=t||[0,0];this.toArray=function(){return[e[0],e[1]]};this.toVec=function(){var t=e[0]*Math.PI/180,r=e[1]*Math.PI/180;var n=Math.cos(t);return new o([n*Math.cos(r),n*Math.sin(r),Math.sin(t)])}};function l(o,l){var u="du-widgets-map";var c=a.call(this,o,"map","div",l);var d=this;c.attr.add(this,"resource",null);c.attr.add(this,"centerX",0);c.attr.add(this,"centerY",0);c.attr.add(this,"backgroundColor","white");c.attr.add(this,"foregroundColor","black");c.attr.add(this,"borderColor","white");c.attr.add(this,"outClick",null);c.attr.add(this,"tiles",null);c.attr.add(this,"noZoom",false);c.attr.add(this,"ready",null);var f=function(){var e=null;var n=null;var a=t.map();function i(i){t.json(c.attr.resource,function(o,s){e=r.feature(s.paths,s.paths["objects"]["countries"]).features;e.filter(function(t){return s.info.some(function(e){if(t.id===e.id)return t.name=e.name})}).sort(function(t,e){return t.name.localeCompare(e.name)});n=t.map();s.info.forEach(function(t){n.set(t.name,{name:t.name,capital:t.capital,population:t.population})});e.forEach(function(t,e){a.set(t.name,e)});i&&i()})}function o(t){return a.has(t)?a.get(t):null}function s(){return e.map(function(t){return{id:t.id,name:t.name}})}function l(t){return t&&n.has(t)?n.get(t).capital:n.values().map(function(t){return{name:t.name,capital:t.capital}})}function u(t){return t&&n.has(t)?n.get(t).population:n.values().map(function(t){return{name:t.name,population:t.population}})}function d(t,e){var r,n,a,i,o,s=t[0],l=t[1],u=false;for(var c=0,d=e.length-1;c<e.length;d=c++){r=e[c][0];a=e[c][1];n=e[d][0];i=e[d][1];o=a>l!==i>l&&s<(n-r)*(l-a)/(i-a)+r;if(o)u=!u}return u}function h(t,e){var r=f._id(t);if(r){var n=y._project(e);var a=f._paths()[r].svg.areas;for(var i=0;i<a.length;i++){if(d(n,a[i])){return true}}}return false}return{_paths:function(){return e},_id:o,_build:i,get:s,capital:l,population:u,containsGeoLoc:h}}();this.countries={get:f.get,capital:f.capital,population:f.population,containsGeoLoc:f.containsGeoLoc};var h=function(){var t={};function r(t,e){return c.utils.encode(t)+"__"+c.utils.encode(e)}function n(e){if(e&&t.hasOwnProperty(e)){return Object.keys(t[e])}else{return Object.keys(t)}}function a(e,r){if(!t.hasOwnProperty(e)){t[e]=r;return true}else{return false}}function i(n){if(t.hasOwnProperty(n)){e.forOwn(t[n],function(t,e){var a=r(n,e);t.forEach(function(t){if(typeof f._id(t)==="number"){y._select(t).classed(a,false)}})});return true}else{return false}}function o(){e.forOwn(t,function(t,n){e.forOwn(t,function(t,e){var a=r(n,e);t.forEach(function(t){if(typeof f._id(t)==="number"){y._select(t).classed(a,true)}})})})}return{get:n,add:a,remove:i,selector:r,_mark:o}}();this.clustering={get:h.get,add:h.add,remove:h.remove,selector:h.selector};var p=function(){var e=128;var r=.3;var n={};var a=t.zoomIdentity;var i=1;var o=t.zoom().scaleExtent([1,e]).on("zoom",h);function s(t){return a.apply(t)}function l(t){return a.invert(t)}function u(){return i}function d(){o.translateExtent([[-r*c.attr.width,-r*c.attr.height],[(1+r)*c.attr.width,(1+r)*c.attr.height]])}function f(t,e){n[t]=e}function h(){if(c.attr.noZoom){return}var e=t.event.transform.k;n.map.paths.style("stroke-width",.5/e+"px");n.map.paths.attr("transform",t.event.transform);x._zoom(t.event.transform);g._zoom(t.event.transform);m._zoom(t.event.transform);v._zoom(t.event.transform);if(t.event&&t.event.transform){a=t.zoomIdentity.translate(t.event.transform.x,t.event.transform.y).scale(t.event.transform.k);i=t.event.transform.k}}function p(){n.map.svg.transition().duration(1e3).call(o.transform,t.zoomIdentity)}function y(r){var a=r[1][0]-r[0][0],i=r[1][1]-r[0][1],s=(r[0][0]+r[1][0])/2,l=(r[0][1]+r[1][1])/2,u=Math.max(1,Math.min(e,.8/Math.max(a/c.attr.width,i/c.attr.height))),d=[c.attr.width/2-u*s,c.attr.height/2-u*l];n.map.svg.transition().duration(1e3).call(o.transform,t.zoomIdentity.translate(d[0],d[1]).scale(u))}function w(){return a}return{init:d,setLayer:f,zoom:o,reset:p,click:y,transform:s,invert:l,level:u,current:w}}();var y=function(){var e=c.widget.append("svg").attr("id",u+"-map-layer").style("position","absolute").call(p.zoom);var r=e.append("rect").attr("id","water").style("position","absolute").style("width","100%").style("height","100%").style("fill","transparent").style("top",0).style("left",0);var n=e.append("g").attr("id","land");var a=null;var i=t.geoMercator().precision(.1);var o=t.geoPath().projection(i);var s=null;function l(t){return i([t[1],t[0]])}function h(t){return i.invert(t).reverse()}function y(){f._paths().forEach(function(t){t.svg.center=o.centroid(t)})}function g(){f._paths().forEach(function(e){var r=[];var n=[];var a=e.geometry.coordinates;if(a.length===1){a[0].forEach(function(t){var a=i(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))})}else{a.forEach(function(t){t[0].forEach(function(t){var a=i(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))});if(t.length>1){t.forEach(function(t){var a=i(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))})}})}e.svg.width=t.max(r)*2;e.svg.height=t.max(n)*2})}function x(){f._paths().forEach(function(t){t.svg.areas=null;if(t.geometry.coordinates.length===1){var e=[];t.geometry.coordinates[0].forEach(function(t){e.push(i(t))});t.svg.areas=[e]}else{t.svg.areas=[];t.geometry.coordinates.forEach(function(e){var r=[];if(e.length>1){e.forEach(function(t){r.push(i(t))})}else{e[0].forEach(function(t){r.push(i(t))})}t.svg.areas.push(r)})}})}function m(){a=n.selectAll("path").data(f._paths()).enter().append("path").attr("class",function(t){return"country-"+f._id(t.name)}).style("stroke-width","0.5px").style("cursor","pointer");v();w()}function v(){if(a===null){return}i.scale(c.attr.width/(2*Math.PI)).translate([c.attr.width/2+c.attr.centerX,c.attr.height/2+c.attr.centerY]);o=t.geoPath().projection(i);f._paths().forEach(function(t){t.svg={}});y();g();x()}function w(){if(a===null){return}e.attr("width",c.attr.width+"px").attr("height",c.attr.height+"px");r.style("fill",c.attr.backgroundColor).style("width",c.attr.width+"px").style("height",c.attr.height+"px").on("click",function(){p.reset();a.classed("focus",false).style("fill",function(t){return c.attr.colors&&c.attr.colors[t.name]?c.attr.colors[t.name]:c.attr.foregroundColor});if(c.attr.outClick)c.attr.outClick()});a.attr("d",o).style("fill",function(t){return c.attr.colors&&c.attr.colors[t.name]?c.attr.colors[t.name]:c.attr.foregroundColor}).style("stroke",c.attr.borderColor).style("cursor","pointer").on("mouseover",function(e,r){t.select(this).style("fill",t.color(c.attr.colors&&c.attr.colors[e.name]?c.attr.colors[e.name]:c.attr.foregroundColor).brighter());c.attr.mouseover&&c.attr.mouseover(e.name)}).on("mouseleave",function(e,r){var n=t.select(this);var a=t.color(c.attr.colors&&c.attr.colors[e.name]?c.attr.colors[e.name]:c.attr.foregroundColor);n.style("fill",n.classed("focus")?a.brighter():a);c.attr.mouseleave&&c.attr.mouseleave(e.name)}).on("click",function(e,r){var n=t.select(this);var i=n.classed("focus");if(i)p.reset();else{p.click(o.bounds(e))}a.classed("focus",function(t){return t===e?!i:false}).style("fill",function(t){return c.attr.colors&&c.attr.colors[t.name]?c.attr.colors[t.name]:c.attr.foregroundColor});var s=t.color(c.attr.colors&&c.attr.colors[e.name]?c.attr.colors[e.name]:c.attr.foregroundColor);n.style("fill",!i?s.brighter():s);c.attr.click&&c.attr.click(e.name)});p.setLayer("map",{svg:e,paths:a,labels:s})}function b(t){if(typeof t==="string"){return f._id(t)?n.select("path.country-"+f._id(t)):n.selectAll("path."+c.utils.encode(t))}else{return a}}function k(t){a.style("opacity",t?t:1);return d}function O(e,r,n){b(e).transition().duration(n?n:0).style("fill",function(n){var a=c.attr.colors&&c.attr.colors[n.name]?c.attr.colors[n.name]:c.attr.foregroundColor;return typeof r==="string"?r:typeof e==="string"?t.color(a).brighter():a});return d}return{_select:b,_project:l,_invert:h,_build:m,_update:v,_style:w,dim:k,highlight:O}}();this.dim=y.dim;this.highlight=y.highlight;var g=function(){var t=c.widget.append("div").attr("id",u+"-static-layers").style("position","absolute").style("pointer-events","none").style("width",c.attr.width+"px").style("height",c.attr.height+"px");var r={};function n(t,e,r){return[e[0]*t[0]+r[0],e[1]*t[1]+r[1]]}function a(){return Object.keys(r)}function o(e){var a=c.utils.encode(e);if(!r.hasOwnProperty(a)){r[a]=function(){var e=t.append("canvas").attr("id",u+"-static-layer-"+a).attr("width",c.attr.width+"px").attr("height",c.attr.height+"px").style("position","absolute").style("pointer-events","none");var r=e.node().getContext("2d");var o=[];function s(t,e){f[t](e);o.push({type:t,params:e});return true}function l(t,e){var r=[1/t,1/t],a=[c.attr.centerX*(t-1)/t,(c.attr.height*(t-e)/2+c.attr.centerY*(t-1))/t];o.forEach(function(t){switch(t.type){case"dot":case"circle":t.params.pos=n(t.params.pos,r,a);break;case"arrow":for(var e=0;e<t.params.segments.length;e++){t.params.segments[e]=new i(n(t.params.segments[e].toArray(),r,a))}break}})}function d(){o=[]}var f={dot:function(t,e){if(t.color)r.fillStyle=t.color;var n=t.size/(e?p.level():1);var a=!e?p.transform(t.pos):t.pos;r.fillRect(a[0]-n/2,a[1]-n/2,n,n)},circle:function(t,e){if(t.color)r.fillStyle=t.color;var n=t.radius/(e?p.level():1);var a=!e?p.transform(t.pos):t.pos;r.beginPath();r.arc(a[0],a[1],n,0,2*Math.PI,false);r.fill()},arrow:function(t,e){if(t.color)r.strokeStyle=t.color;var n=t.width/(e?p.level():1);var a=[];t.segments.forEach(function(t){a.push(!e?t.map(p.transform):t)});var i=n*2;var o=n*5;var s=a[a.length-2];var l=a[a.length-1];var u=l.sub(s).length(o);r.beginPath();r.lineWidth=n;r.lineJoin="round";r.moveTo(a[0].x(),a[0].y());for(var d=1;d<a.length-1;d++){if(a[d].sub(a[d-1]).length()<.6*c.attr.width)r.lineTo(a[d].x(),a[d].y());else r.moveTo(a[d].x(),a[d].y())}var f=l.sub(u.length(.5*o));r.lineTo(f.x(),f.y());r.stroke();var h=u.angle(u.angle()+Math.PI/2).length(i);var y=l.sub(u).sub(h);var g=l.sub(u).add(h);r.beginPath();r.moveTo(y.x(),y.y());r.lineTo(g.x(),g.y());r.lineTo(l.x(),l.y());r.closePath();r.fillStyle=t.color;r.fill()}};function h(){var t=p.invert([0,0]);var e=p.invert([c.attr.width,c.attr.height]);var r={xMin:t[0],xMax:e[0],yMin:t[1],yMax:e[1]};o.forEach(function(t){if(t.params.pos&&(t.params.pos[0]<r.xMin||t.params.pos[0]>r.xMax||t.params.pos[1]<r.yMin||t.params.pos[1]>r.yMax)){return}f[t.type](t.params,true)})}return{g:e,canvas:r,rescaleContent:l,clearContent:d,append:s,render:h}}();return true}else{return false}}function l(){var n=parseFloat(t.style("width"))/c.attr.width;var a=parseFloat(t.style("height"))/c.attr.height;t.style("width",c.attr.width+"px").style("height",c.attr.height+"px");e.forOwn(r,function(t){t.g.attr("width",c.attr.width+"px").attr("height",c.attr.height+"px");t.rescaleContent(n,a);t.render()});b(p.current())}function f(t){var e=c.utils.encode(t);if(r.hasOwnProperty(e)){r[e].canvas.clearRect(0,0,c.attr.width,c.attr.height);r[e].clearContent();return true}else{return false}}function h(){e.forOwn(r,function(t){t.canvas.save();t.canvas.clearRect(0,0,c.attr.width,c.attr.height)})}function x(t){var n=c.utils.encode(t);if(n&&r.hasOwnProperty(n)){e.forOwn(r,function(t,e){t.g.transition().duration(100).style("opacity",n===e?1:0)})}else{e.forOwn(r,function(t){t.g.transition().duration(100).style("opacity",1)})}return d}function m(t){e.forOwn(r,function(e){e.render(t)})}function v(){e.forOwn(r,function(t){t.canvas.restore()})}var w={dot:function(t,e,n,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var i=c.utils.encode(t);return r.hasOwnProperty(i)&&r[i].append("dot",{pos:y._project(e),size:n,color:a})},circle:function(t,e,n,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof n!=="number"||isNaN(n)||n<=0)return false;var i=c.utils.encode(t);return r.hasOwnProperty(i)&&r[i].append("circle",{pos:y._project(e),radius:n,color:a})},arrow:function(t,e,n,a,o){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!n||n.length<2||typeof n[0]!=="number"||typeof n[1]!=="number")return false;if(typeof a!=="number")return false;var l=c.utils.encode(t);if(r.hasOwnProperty(l)){var u=new s(e).toVec(),d=new s(n).toVec(),f=u.cross(d).cross(u).length(1),h=Math.acos(u.dot(d));var p=1,g=100,x=a*5,m=new i(y._project(e)),v=new i(y._project(n)),w=m,b=[w];do{var k=new i(y._project(u.mult(Math.cos((p+1)*h/g)).add(f.mult(Math.sin((p+1)*h/g))).toLatLon().toArray()));p++;w=k;b.push(k)}while(p<g&&k.sub(v).length()>x);b.push(v);r[l].append("arrow",{segments:b,width:a,color:o});return true}else{return false}}};function b(t){g._clear();e.forOwn(r,function(e){e.canvas.translate(t.x,t.y);e.canvas.scale(t.k,t.k)});g._render(t.k);g._restore()}return{_style:l,_zoom:b,_clear:h,_restore:v,_render:m,get:a,add:o,highlight:x,erase:f,draw:w}}();this.staticLayer={get:g.get,add:g.add,erase:g.erase,highlight:g.highlight,draw:g.draw};var x=function(){var e=c.widget.append("div").attr("id",u+"-tiles-layer").style("position","absolute").style("pointer-events","none").style("z-index",99).style("opacity",.5).style("width",c.attr.width+"px").style("height",c.attr.height+"px");var r=null;function a(t){return y._invert([t[0]-.5*c.attr.width,t[1]+.5*c.attr.height])}function i(t){return Math.log(.00391382924*t*c.attr.width)/Math.log(2)}function o(){if(c.attr.tiles===null){return}if(!this.headerAdded){t.select("head").append("link").attr("rel","stylesheet").attr("href","https://unpkg.com/leaflet@1.3.1/dist/leaflet.css").attr("integrity","sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==").attr("crossorigin","");this.headerAdded=true}r=n.map(u+"-tiles-layer",{attributionControl:false,zoomSnap:0,zoomControl:false}).setView(a([0,0]),i(p.level()));var e=null,o=null;switch(c.attr.tiles){case"cartodb-positron":e="https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";o="abcd";break}if(e&&o){n.tileLayer(e,{subdomains:o}).addTo(r)}}function s(){if(r===null){return}e.style("width",c.attr.width+"px").style("height",c.attr.height+"px");r.invalidateSize()}function l(t){if(r===null){return}r.setView(a([-t.x/t.k-.5*(t.k-1)*c.attr.width/t.k,-t.y/t.k-.5*(t.k-1)*c.attr.height/t.k]),i(t.k),true)}return{_build:o,_style:s,_getLatLon:a,_getZoom:i,_zoom:l}}();var m=function(){var r=c.widget.append("div").attr("id",u+"-dynamic-layers").style("position","absolute").style("pointer-events","none");var n={};function a(){return Object.keys(n)}function o(e){var a=c.utils.encode(e);if(!n.hasOwnProperty(a)){n[a]=function(){var e=r.append("svg").attr("id",u+"-dynamic-layer-"+a).attr("width",c.attr.width+"px").attr("height",c.attr.height+"px").style("position","absolute").style("pointer-events","none").append("g");var n=[];function i(t){n.push({elem:t,birth:(new Date).getTime()/1e3})}setInterval(function(){var e=(new Date).getTime()/1e3;var r=[];n.forEach(function(n){if(e-n.birth>10){n.elem.transition().duration(700).style("opacity",0).on("end",function(){t.select(this).remove()})}else{r.push(n)}});n=r},2e3);return{g:e,append:i}}();return true}else{return false}}function l(){r.style("width",c.attr.width+"px").style("height",c.attr.height+"px");e.forOwn(n,function(t){t.g.attr("width",c.attr.width+"px").attr("height",c.attr.height+"px")})}function f(t){var e=c.utils.encode(t);if(n.hasOwnProperty(e)){n[e].g.html("");return true}else{return false}}function h(t){var r=c.utils.encode(t);if(r&&n.hasOwnProperty(r)){e.forOwn(n,function(t,e){t.g.transition().duration(200).style("opacity",r===e?1:0)})}else{e.forOwn(n,function(t){t.g.transition().duration(200).style("opacity",1)})}return d}var g={circle:function(e,r,a,i,o,s){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof a!=="number"||isNaN(a)||a<=0)return false;var l=c.utils.encode(e);if(n.hasOwnProperty(l)){var u=a/p.level();var d=y._project(r);var f=n[l].g.append("circle").attr("class","circle").attr("cx",d[0]).attr("cy",d[1]).attr("r",u).style("fill",i);n[l].append(f);f.transition().duration(o?o:700).ease(t.easeExp).attr("r",0).on("end",function(){s&&s();t.select(this).remove()});return true}else{return false}},arrow:function(e,r,a,o,l,u,d){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(!a||a.length<2||typeof a[0]!=="number"||typeof a[1]!=="number")return false;if(typeof o!=="number")return false;var f=c.utils.encode(e);if(n.hasOwnProperty(f)){var h=100;var g=null;var x=null;var m=new i(y._project(r));var v=new i(y._project(a));var w=o/p.level();var b=w*2;var k=w*5;g=n[f].g.append("path").style("fill","none").style("stroke",l).style("stroke-width",w).attr("d","M"+m.x()+","+m.y());x=n[f].g.append("path").style("fill",l).style("stroke","none");var O=new s(r).toVec();var _=new s(a).toVec();var M=O.cross(_).cross(O).length(1);var z=Math.acos(O.dot(_));var C=1;var P=m;var A=(typeof u==="number"?u:700)/h;var j=setInterval(function(){var e=new i(y._project(O.mult(Math.cos((C+1)*z/h)).add(M.mult(Math.sin((C+1)*z/h))).toLatLon().toArray()));g.attr("d",g.attr("d")+(e.sub(P).length()<.5*c.attr.width?"L":"M")+e.x()+","+e.y());if(e.sub(P).length()<.5*c.attr.width){var r=e.sub(P).length(1);var n=r.angle(r.angle()+Math.PI/2).mult(b);var a=e.sub(n);var o=e.add(n);var s=e.add(r.mult(k));x.attr("d","M"+a.x()+","+a.y()+"L"+o.x()+","+o.y()+"L"+s.x()+","+s.y()+"Z")}if(e.sub(v).length()>k){C++;P=e}else{clearInterval(j);r=v.sub(e).length(1);n=r.angle(r.angle()+Math.PI/2).mult(b);a=v.sub(r.mult(k)).sub(n);o=v.sub(r.mult(k)).add(n);x.transition().duration(A).attr("d","M"+a.x()+","+a.y()+"L"+o.x()+","+o.y()+"L"+v.x()+","+v.y()+"Z").on("end",function(){d&&d();g.transition().duration(1e3).style("opacity",0).on("end",function(){t.select(this).remove()});t.select(this).transition().duration(1e3).style("opacity",0).on("end",function(){t.select(this).remove()})})}},A);return true}else{return false}}};function x(t){e.forOwn(n,function(e){e.g.attr("transform",t)})}return{_style:l,_zoom:x,get:a,add:o,highlight:h,erase:f,draw:g}}();this.dynamicLayer={get:m.get,add:m.add,highlight:m.highlight,erase:m.erase,draw:m.draw};var v=function(){var t=c.widget.append("svg").attr("id",u+"-touch-layer").attr("width",c.attr.width+"px").attr("height",c.attr.height+"px").style("position","absolute").style("pointer-events","none");var e=t.append("g");function r(t,r,n,a,i,o){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;var s=n/p.level();var l=y._project(r);e.append("circle").attr("id",u+"-touch-layer-"+t).attr("cx",l[0]).attr("cy",l[1]).attr("r",s).style("fill",null).style("opacity",0).style("pointer-events","all").on("mouseover",function(t,e){if(a)a(t,e)}).on("mouseleave",function(t,e){if(i)i(t,e)}).on("click",function(t,e){if(o)o(t,e)});return true}function n(t){var r=e.select("#"+t);if(r.empty())return false;else{r.remove();return true}}function a(){t.style("width",c.attr.width+"px").style("height",c.attr.height+"px");e.style("width",c.attr.width+"px").style("height",c.attr.height+"px")}function i(t){e.attr("transform",t)}function o(){e.html("")}return{_style:a,_zoom:i,add:r,remove:n,erase:o}}();this.touchLayer={add:v.add,remove:v.remove,erase:v.erase};c.render.build=function(){f._build(function(){y._build();x._build();c.attr.ready&&c.attr.ready()})};c.render.update=function(){y._update()};c.render.style=function(){c.widget.style("background-color",c.attr.backgroundColor).style("pointer-events",null);p.init();y._style();g._style();m._style();x._style();v._style();h._mark()}}l.prototype=Object.create(a.prototype);return l});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Picture=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"picture","div",r);n.attr.add(this,"src","");var a={};var i=null;n.render.build=function(){a.g=n.widget.append("div").style("width",n.attr.width>0?n.attr.width:null).style("height",n.attr.height>0?n.attr.height:null).style("position","relative").style("pointer-events","all");i=new Image;i.onload=function(){var t=i.width/i.height;var e=n.attr.width/n.attr.height;var r=t>e?n.attr.width:n.attr.height*t;var o=t<e?n.attr.height:n.attr.width/t;a.g.style("background-image","url("+n.attr.src+")").style("background-repeat","none").style("background-size",r+"px "+o+"px").style("width",r+"px").style("height",o+"px").style("margin-left",(n.attr.width-r)/2+"px").style("margin-top",(n.attr.height-o)/2+"px").on("mouseover",function(){n.attr.mouseover&&n.attr.mouseover(i)}).on("mouseleave",function(){n.attr.mouseleave&&n.attr.mouseleave(i)}).on("click",function(){n.attr.click&&n.attr.click(i)})}};n.render.style=function(){if(n.attr.src){i.src=n.attr.src}}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.PieChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(n,a){var i=r.call(this,n,"piechart","svg",a);i.attr.add(this,"innerRadius",0,"dim");i.attr.add(this,"outerRadius",50,"dim");i.attr.add(this,"ticks",false);var o={};var s=[];var l=null;this.data=function(t){s=[];e.forOwn(t,function(t,e){s.push({name:e,value:t})});s.sort(function(t,e){return e.value-t.value});return this};this.highlight=function(t,e){i.utils.highlight(this,o,"path",t,e);i.utils.highlight(this,o,"text",t,e);return this};i.utils.tooltip=function(){return l?{title:l.name,plots:[{id:"",color:i.attr.colors[l.name],value:(100*l.value/t.sum(s,function(t){return t.value})).toFixed(1)+"%&nbsp;("+l.value+")"}]}:null};i.render.build=function(){o.g=i.widget.append("g");o.label=o.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white");o.arc=t.arc();o.pie=t.pie().value(function(t){return t.value}).sort(null);o.arcs=o.g.selectAll(".arc").data(o.pie(s)).enter().append("g").attr("class","arc");o.paths=o.arcs.append("path").attr("class",function(t){return i.utils.encode(t.data.name)}).style("shape-rendering","geometricPrecision").style("pointer-events","all").each(function(t){this._current=t});if(i.attr.ticks){o.labelArc=t.arc();o.ticks=o.arcs.append("text").attr("class",function(t){return i.utils.encode(t.data.name)}).style("text-anchor","middle").attr("dy","0.35em").each(function(t){this._current=t})}};i.render.update=function(e){o.arcs.datum(s);o.paths.data(o.pie(s)).transition().duration(e).attrTween("d",function(e){var r=t.interpolate(this._current,e);this._current=r(0);return function(t){return o.arc(r(t))}});if(i.attr.ticks){o.ticks.data(o.pie(s)).text(function(e){return i.attr.tickFormat(100*e.data.value/t.sum(s,function(t){return t.value}))}).transition().duration(e).attrTween("transform",function(e){var r=t.interpolate(this._current,e);this._current=r(0);return function(t){return"translate("+o.labelArc.centroid(r(t))+")"}})}};i.render.style=function(){i.attr.colors=i.utils.colors(s?s.map(function(t){return t.name}):null);var t=i.attr.outerRadius-i.attr.margins.left;i.attr.width=2*i.attr.outerRadius;i.attr.height=2*i.attr.outerRadius;i.widget.style("width",i.attr.width+"px").style("height",i.attr.height+"px");o.g.attr("transform","translate("+i.attr.outerRadius+","+i.attr.outerRadius+")");o.arc.outerRadius(t).innerRadius(i.attr.innerRadius);o.paths.attr("d",o.arc).attr("fill",function(t){return i.attr.colors[t.data.name]});if(i.attr.ticks){o.labelArc.outerRadius(.5*(i.attr.innerRadius+t)).innerRadius(.5*(i.attr.innerRadius+t));o.ticks.attr("d",o.labelArc).attr("fill",i.attr.fontColor)}o.label.attr("transform","translate(0,"+i.attr.outerRadius+")").style("width",10+2*i.attr.outerRadius+"px").style("font-size",Math.min(16,i.attr.outerRadius*.4)+"px").style("fill",i.attr.fontColor).text(i.attr.label);o.paths.on("mouseover",function(t){i.attr.mouseover&&i.attr.mouseover(t.data.name)}).on("mouseleave",function(t){i.attr.mouseleave&&i.attr.mouseleave(t.data.name)}).on("click",function(t){i.attr.click&&i.attr.click(t.data.name)}).on("mousemove",function(t){l=t.data})}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ScatterPlot=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(n,a){var i=r.call(this,n,"scatterplot","svg",a);i.attr.add(this,"opacity",.4);i.attr.add(this,"stroke","white");var o={};var s=[];var l=null;this.data=function(t){s=t;return this};this.highlight=function(t,e){return i.utils.highlight(this,o,".dot",t,e)};i.utils.tooltip=function(t){if(!t){e.forOwn(this.tt,function(t){t&&t.remove()});this.tt=null;return null}else{this.tt=this.tt||{};var r=this.tt}var n=[];e.forOwn(s[0].x,function(e,a){var s=l[a].find(t[0],t[1],10);if(!s){r[a]&&r[a].remove();r[a]=null;return}r[a]=r[a]||o.g.append("circle");r[a].attr("r",6).attr("cx",s.data[0]).attr("cy",s.data[1]).style("pointer-events","none").style("stroke",i.attr.stroke).style("fill",i.attr.colors[a]);n.push({id:a,color:i.attr.colors[a],value:o.scale.x.invert(s.data[0]).toPrecision(3)+":&nbsp;"+o.scale.y.invert(s.data[1]).toPrecision(3)})});return n.length>0?{title:i.attr.xLabel,plots:n}:null};i.render.build=function(){o.g=i.widget.append("g");o.axisFn={x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)};o.axes={x:o.g.append("g").attr("class","x axis"),y:o.g.append("g").attr("class","y axis")};o.labels={x:o.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:o.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};i.render.update=function(r){o.scale=i.utils.scale(i.utils.boundary(s),i.attr.width-i.attr.margins.left-i.attr.margins.right,i.attr.height-i.attr.margins.top-i.attr.margins.bottom,{x:{type:i.attr.xType}});o.axes.x.transition().duration(r).call(o.axisFn.x.scale(o.scale.x));o.axes.y.transition().duration(r).call(o.axisFn.y.scale(o.scale.y));if(s.length>0){if(o.dots===undefined){o.dots={};e.forOwn(s[0].x,function(t,e){o.dots[e]=o.g.selectAll(".dot."+i.utils.encode(e)).data(s.map(function(t){return{x:t.x[e],y:t.y[e]}})).enter().append("circle").attr("class","dot "+i.utils.encode(e)).attr("r",3).attr("cx",function(t){return o.scale.x(t.x)}).attr("cy",function(t){return o.scale.y(t.y)}).style("stroke-width","0.5px").style("shape-rendering","geometricPrecision")})}e.forOwn(s[0].x,function(t,e){o.dots[e].transition().duration(r).attr("cx",function(t){return o.scale.x(t.x)}).attr("cy",function(t){return o.scale.y(t.y)})});var n=t.voronoi().extent([[-1,-1],[i.attr.width+1,i.attr.height+1]]);l={};e.forOwn(s[0].x,function(t,e){l[e]=n(s.map(function(t){return[o.scale.x(t.x[e]),o.scale.y(t.y[e])]}))})}};i.render.style=function(){i.attr.colors=i.utils.colors(s[0]?t.keys(s[0].y):null);var r=i.attr.width-i.attr.margins.left-i.attr.margins.right,n=i.attr.height-i.attr.margins.top-i.attr.margins.bottom;o.g.attr("width",r+"px").attr("height",n+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");o.axes.x.attr("transform","translate(0,"+n+")");o.axisFn.y.tickFormat(i.attr.yTickFormat);o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",r+"px").attr("y",n+2.2*i.attr.fontSize+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.yLabel);e.forOwn(o.dots,function(t,e){o.dots[e].style("fill-opacity",i.attr.opacity).style("fill",i.attr.colors[e]).style("stroke",i.attr.stroke).on("mouseover",function(){i.attr.mouseover&&i.attr.mouseover(e)}).on("mouseleave",function(){i.attr.mouseleave&&i.attr.mouseleave(e)}).on("click",function(){i.attr.click&&i.attr.click(e)})})}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Slider=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"slider","svg",n);a.attr.add(this,"min",0);a.attr.add(this,"max",1);a.attr.add(this,"step",0);a.attr.add(this,"callback",null);var i={};var o={right:20,left:20};var s=false;var l=[];var u=null;a.render.build=function(){l=[a.attr.min,a.attr.max];u=t.scaleLinear().domain(l).range([0,a.attr.width-o.left-o.right]).clamp(true);if(a.attr.step){s=true;l=[];for(var e=a.attr.min;e<=a.attr.max;e+=a.attr.step){l.push(e)}u=t.scalePoint().domain(l).range([0,a.attr.width-o.left-o.right])}i.g=a.widget.append("g").attr("transform","translate("+o.left+",20)");i.track=i.g.append("line").attr("stroke-linecap","round").attr("stroke",a.attr.fontColor).attr("stroke-width","9px").attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.inset=i.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("stroke","white").style("opacity",.9).style("stroke-width","8px");i.overlay=i.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","stroke").style("cursor","pointer").style("stroke","transparent").style("stroke-width","50px").call(t.drag().on("start drag",function(){var e=null;if(s){var r=t.event.x;e=l.reduce(function(t,e){return Math.abs(u(e)-r)<Math.abs(u(t)-r)?e:t})}else{e=u.invert(t.event.x)}i.handle.attr("cx",u(e));a.attr.callback&&a.attr.callback(e)}));i.axis=i.g.insert("g",".track-overlay").style("font-size","10px").attr("font-family","inherit").attr("transform","translate(0,"+18+")");i.ticks=i.axis.selectAll("text").data(s?l:u.ticks(5)).enter().append("text").attr("x",u).attr("text-anchor","middle").attr("font-family","inherit").text(function(t){return t});i.handle=i.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",8)};a.render.style=function(){a.widget.style("width",a.attr.width+"px");a.widget.style("height",50+"px");u.range([0,a.attr.width-o.left-o.right]);i.track.attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.inset.attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.overlay.attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.ticks.attr("x",u).attr("font-size",a.attr.fontSize+"px").attr("fill",a.attr.fontColor);i.handle.style("stroke",a.attr.fontColor)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Status=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(t,n){var a=r.call(this,t,"status","div",n);a.attr.add(this,"value","");var i={};a.render.build=function(){i.g=a.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");i.label=i.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","25%").style("pointer-events","none").text(a.attr.label);i.status=i.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","75%").style("text-align","right").style("pointer-events","none")};a.render.style=function(){a.widget.style("font-size",a.attr.fontSize+"px").style("pointer-events","none");e.forOwn(a.attr.margins,function(t,e){a.widget.style("margin-"+e,t+"px")});e.forOwn(a.attr.borders,function(t,e){a.widget.style("border-"+e,t)});i.label.style("color",a.attr.fontColor).style("font-weight",a.attr.fontWeight);i.status.style("color",a.attr.fontColor).style("font-weight",a.attr.fontWeight).text(a.attr.value)}}n.prototype=Object.create(r.prototype);return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.TrackPad=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"slider","svg",n);a.attr.add(this,"xRange",[0,1]);a.attr.add(this,"yRange",[0,1]);a.attr.add(this,"callback",null);a.attr.add(this,"guide",false);var i={};var o=null;a.render.build=function(){o={x:t.scaleLinear().domain(a.attr.xRange).range([0,a.attr.width-a.attr.margins.left-a.attr.margins.right]).clamp(true),y:t.scaleLinear().domain(a.attr.yRange).range([0,a.attr.height-a.attr.margins.top-a.attr.margins.bottom]).clamp(true)};i.g=a.widget.append("g").attr("transform","translate("+a.attr.margins.left+",20)");i.track=i.g.append("rect").attr("rx","3").attr("ry","3").attr("x",o.x.range()[0]).attr("y",o.y.range()[0]).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom+"px");i.inset=i.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("fill","white").style("opacity",.9).attr("rx","2.5").attr("ry","2.5").attr("x",o.x.range()[0]+.5).attr("y",o.y.range()[0]+.5).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right-1+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom-1+"px");if(a.attr.guide){i.guide={h:i.g.append("line").attr("x1",o.x.range()[0]).attr("y1",o.y.range()[0]).attr("x2",o.x.range()[1]).attr("y2",o.y.range()[0]).attr("stroke-dasharray","3, 6").style("stroke",a.attr.fontColor).style("stroke-width","1px"),v:i.g.append("line").attr("x1",o.x.range()[0]).attr("y1",o.y.range()[0]).attr("x2",o.x.range()[0]).attr("y2",o.y.range()[1]).attr("stroke-dasharray","3, 6").style("stroke-width","1px")}}i.overlay=i.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","all").style("cursor","pointer").style("fill","transparent").call(t.drag().on("start drag",function(){var e=o.x.invert(t.event.x),r=o.y.invert(t.event.y);i.handle.attr("cx",o.x(e)).attr("cy",o.y(r));if(i.guide){i.guide.h.attr("x1",o.x.range()[0]).attr("y1",o.y(r)).attr("x2",o.x.range()[1]).attr("y2",o.y(r));i.guide.v.attr("x1",o.x(e)).attr("y1",o.y.range()[0]).attr("x2",o.x(e)).attr("y2",o.y.range()[1])}a.attr.callback&&a.attr.callback(e,r)}));i.axis={x:i.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none"),y:i.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none")};i.handle=i.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",7)};a.render.style=function(){a.widget.style("width",a.attr.width+"px");a.widget.style("height",a.attr.height+"px");o.x.range([0,a.attr.width-a.attr.margins.left-a.attr.margins.right]);o.y.range([0,a.attr.height-a.attr.margins.top-a.attr.margins.bottom]);i.track.style("fill",a.attr.fontColor).attr("x",o.x.range()[0]).attr("y",o.y.range()[0]).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom+"px");i.inset.attr("x",o.x.range()[0]+.5).attr("y",o.y.range()[0]+.5).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right-1+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom-1+"px");if(a.attr.guide){i.guide.h.style("stroke",a.attr.fontColor);i.guide.v.style("stroke",a.attr.fontColor)}i.overlay.attr("x",o.x.range()[0]-a.attr.margins.left+10).attr("y",o.y.range()[0]-a.attr.margins.top+10).attr("width",a.attr.width-20+"px").attr("height",a.attr.height-20+"px");i.axis.x.attr("transform","translate(-1,"+(a.attr.height-a.attr.margins.bottom-30)+")").call(t.axisBottom().ticks(5).scale(o.x));i.axis.y.call(t.axisLeft().ticks(5).scale(o.y));i.g.selectAll("path").style("fill","none").style("stroke","none");i.g.selectAll(".tick > line").style("fill","none").style("stroke","none");i.g.selectAll("text").attr("font-size",a.attr.fontSize+"px").attr("fill",a.attr.fontColor);i.handle.style("stroke",a.attr.fontColor)}}r.prototype=Object.create(e.prototype);return r});