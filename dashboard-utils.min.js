(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";var r=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function n(n,i,a,l){var o;var s="du-widget-"+i+"-"+n;try{if(l){o=t.select(l).append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{o=t.select("body").append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var c={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,r,n,i){c[e]=r;t[e]=function(r){if(i){i(r)}else{c[e]=r}return t};if(typeof n==="string"&&c._categories.hasOwnProperty(n)){c._categories[n].push(e)}}};c.add(this,"relative",false);c.add(this,"x",0,"dim",function(t,e){c.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)c.xDim=e});c.add(this,"y",0,"dim",function(t,e){c.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)c.yDim=e});c.add(this,"width",200,"dim");c.add(this,"height",150,"dim");c.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){c.margins[e]=t})}else{e.forOwn(t,function(e,r){c.margins[r]=t[r]})}});c.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){c.borders[e]=t})}e.forOwn(t,function(e,r){c.borders[r]=t[r]})});c.add(this,"fontColor","black");c.add(this,"fontSize",10,"dim");c.add(this,"fontWeight","normal");c.add(this,"label",null);c.add(this,"xLabel",null);c.add(this,"yLabel",null);c.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});c.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});c.add(this,"xTickAngle",null);c.add(this,"yMin",0);c.add(this,"mouseover",null);c.add(this,"mouseleave",null);c.add(this,"click",null);c.add(this,"colors",null);c.add(this,"tooltip",false);var y=function(){function n(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function i(r,n){if(r===null||r===undefined||r.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var i=[t.min(r,function(t){return t.x}),t.max(r,function(t){return t.x})];var a={};var l=[];r.forEach(function(t){if(!a.hasOwnProperty(t.x)){a[t.x]=1;l.push(t.x)}});var o=[];if(typeof r[0].y==="number"){o=[t.min(r,function(t){return t.y}),t.max(r,function(t){return t.y})]}else{var s=[],c=[];e.forOwn(r[0].y,function(e,n){s.push(t.min(r,function(t){return t.y[n]}));c.push(t.max(r,function(t){return t.y[n]}))});o=[t.min(s),t.max(c)]}var y={x:[null,null],y:[null,null]};if(n){e.forOwn(y,function(t,e){[0,1].forEach(function(r){t[r]=n.hasOwnProperty(e)&&n[e][r]!==null?n[e][r]:t[r]})})}return{x:{min:y.x[0]!==null?y.x[0]:i[0],max:y.x[1]!==null?y.x[1]:i[1],domain:l.filter(function(t){return(!y.x[0]||t>=y.x[0])&&(!y.x[1]||t<=y.x[1])})},y:{min:y.y[0]!==null?y.y[0]:o[0],max:y.y[1]!==null?y.y[1]:o[1],domain:[]}}}function a(e,r,n,i){function a(e,r){var n=null;if(typeof e){switch(e){case"number":default:n=t.scaleLinear().domain([r.min,r.max]);break;case"time":n=t.scaleTime().domain([r.min,r.max]);break;case"string":n=t.scaleBand().domain(r.domain).padding(.1);break}}return n}return{x:a(i&&i.x?i.x.type:"number",e.x).range(i&&i.x&&i.x.reverse?[r,0]:[0,r]),y:a(i&&i.y?i.y.type:"number",e.y).range(i&&i.y&&i.y.reverse?[0,n]:[n,0])}}function l(e,r,i,a,l){if(r!==null){if(typeof a==="string"){r.g.selectAll(i).transition();r.g.selectAll(i).transition().duration(l?l:0).style("opacity",function(){return t.select(this).classed(n(a))?1:.1})}else{r.g.selectAll(i).transition();r.g.selectAll(i).transition().duration(l?l:0).style("opacity",1)}}return e}function o(e){if(e===null||e===undefined){return{}}if(e.length>0){if(c.colors===null||c.colors===undefined){return e.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,n){t[e]=r[n%18];return t},{})}if(typeof c.colors==="string"){var n=t.scaleLinear().domain([0,e.length]).range([c.colors,"#fff"]).interpolate(t.interpolateRgb);return e.reduce(function(t,e,r){t[e]=n(r);return t},{})}return c.colors}}return{encode:n,boundary:i,scale:a,highlight:l,colors:o}}();function d(){var e="du-widgets-plot-tooltip";var r=t.mouse(o.node());var n=t.event.pageX;var i=t.event.pageY;var a=o.node().getBoundingClientRect();if(n<a.left+c.margins.left||n>a.right-c.margins.right||i<a.top+c.margins.top||i>a.bottom-c.margins.bottom){t.select("#"+e).style("opacity",0).html("");y.tooltip();return}var l=t.select("#"+e);if(t.select("#"+e).empty()){var s=t.color(c.fontColor);s.opacity=.3;l=t.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("border","solid 1px "+s).style("padding","5px").style("font-family","Courier").style("font-size","0.7em").style("color",c.fontColor).style("pointer-events","none").style("left",(a.left+a.right)/2+"px").style("top",(a.top+a.bottom)/2+"px")}l.html(y.tooltip([r[0]-c.margins.left,r[1]-c.margins.top]));var d=l.node().getBoundingClientRect();var f=d.width;var u=d.height;var p=n+20;var h=i+20;if(p<a.left+c.margins.left+10){p+=c.margins.left+10}else if(p+f>a.right-c.margins.right){p-=c.margins.right+f-10}if(h<a.top+c.margins.top+10){h+=c.margins.top+10}else if(h+u>a.bottom-c.margins.bottom){h-=c.margins.bottom+u-10}l.style("opacity",1).transition();l.transition().duration(200).ease(t.easeLinear).style("left",p+"px").style("top",h+"px")}this.id=function(){return s};this.describe=function(e){var r=null;o.on("contextmenu",function(){t.event.preventDefault();if(r===null){r=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(r!==null){r.remove();r=null}});return this};this.placeholder=function(e){var r=300;var i="du-widget-placeholder-"+n;if(e){o.transition().duration(r).style("opacity",0);if(t.select("#"+i).empty()){var a=l?l:"body";t.select(a).append("div").attr("id",i).style("position","absolute").style("width",c.width+"px").style("height",c.height+"px").style("line-height",c.height+"px").style(c.x>=0?"left":"right",Math.abs(c.x)+c.xDim).style(c.y>=0?"top":"bottom",Math.abs(c.y)+c.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",c.fontWeight).style("font-size",c.fontSize).style("color",c.fontColor).style("opacity",0).html(e).transition().duration(r).style("opacity",1)}}else{o.transition().duration();o.transition().duration(r).style("opacity",1);var s=t.select("#"+i);if(!s.empty()){s.remove()}}return this};var f={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){f.build&&f.build(e);this._isBuilt=true}f.update&&f.update(e);if(c.relative){o.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{o.style("position","absolute").style(c.x>=0?"left":"right",Math.abs(c.x)+c.xDim).style(c.y>=0?"top":"bottom",Math.abs(c.y)+c.yDim)}o.style("width",c.width+"px").style("height",c.height+"px");o.style("pointer-events",c.tooltip&&y.tooltip?"all":null).on("mousemove",function(){c.tooltip&&y.tooltip&&d()});o.selectAll(".axis path").style("fill","none").style("stroke",c.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > line").style("stroke",c.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",c.fontSize+"px").style("fill",c.fontColor);o.style("font-family","inherit");o.selectAll("g").attr("font-family","inherit");f.style&&f.style();o.style("display","block");return this};this.remove=function(){o.remove()};return{widget:o,attr:c,utils:y,render:f}}return n});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.LineChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function n(n,i){var a=r.call(this,n,"linechart","svg",i);a.attr.add(this,"xType","number");a.attr.add(this,"legend",false);var l={};var o=[];var s=1;var c={};this.data=function(t,r){var n=r||1;o=t.sort(function(t,e){return t.x-e.x}).map(function(t){var r={x:t.x,y:{}};e.forOwn(t.y,function(t,e){r.y[e]=t/n});if(t.dy){r.dy={};e.forOwn(t.dy,function(t,e){r.dy[e]=t/n})}return r});if(typeof r==="number"&&r>0)s=r;return this};this.highlight=function(t,e){a.utils.highlight(this,l,".line",t,e);a.utils.highlight(this,l,".error",t,e);a.utils.highlight(this,l,".marker",t,e);return this};var y=this.highlight;this.addMarker=function(t,e,r,n,i){if(c.hasOwnProperty(t)){return null}var s=o.filter(function(t){return t.x-r===0})[0];if(!s||!s.hasOwnProperty("y")||!s.y.hasOwnProperty(e))return null;var y=s.y[e];var d=o.filter(function(t){return t.x-n===0})[0];if(!d||!d.hasOwnProperty("y")||!d.y.hasOwnProperty(e))return null;var f=d.y[e];var u=typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[e];var p=y<f?r:n;var h=y<f?f:y;var x={start:{x:r,y:y},end:{x:n,y:f},corner:{x:p,y:h},g:l.g.append("g").attr("class","marker "+a.utils.encode(e))};x.g.append("line").attr("class","horizontal").attr("x1",l.scale.x(r)+2).attr("y1",l.scale.y(h)).attr("x2",l.scale.x(n)+2).attr("y2",l.scale.y(h)).style("stroke",u).style("stroke-dasharray","3 3").style("stroke-width",1);x.g.append("line").attr("class","vertical").attr("x1",l.scale.x(p)+2).attr("y1",l.scale.y(y)).attr("x2",l.scale.x(p)+2).attr("y2",l.scale.y(f)).style("stroke",u).style("stroke-dasharray","3 3").style("stroke-width",1);x.g.append("circle").attr("class","start").attr("cx",l.scale.x(r)+2).attr("cy",l.scale.y(y)).attr("r",4).style("stroke","none").style("fill",u);x.g.append("circle").attr("class","end").attr("cx",l.scale.x(n)+2).attr("cy",l.scale.y(f)).attr("r",4).style("stroke","none").style("fill",u);x.g.append("text").attr("x",l.scale.x(p)+2).attr("y",l.scale.y(h)).attr("dy",-5).attr("text-anchor",y<f?"start":"end").style("fill",a.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").text(i);c[t]=x;return x};this.removeMarker=function(t){if(c.hasOwnProperty(t)){c[t].g.remove();delete c[t];return true}return false};a.utils.tooltip=function(r){var n=t.bisector(function(t){return l.scale.x(t.x)}).left;var i=r?n(o,r[0]):null;if(!i||i<0||i>=o.length){e.forOwn(this.tt,function(t){t.remove()});this.tt=null;return}else{this.tt=this.tt||{};var s=this.tt}var c=o[i-1]?o[i-1]:o[i];var y=o[i]?o[i]:o[i-1];var d=r[0]-c.x>y.x-r[0]?y:c;var f=t.select(document.createElement("div"));f.append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").style("border-bottom","solid 1px "+a.attr.fontColor).text(a.attr.xLabel+": "+d.x);e.forOwn(d.y,function(t,e){var r=f.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");r.append("div").style("position","relative").style("width","10px").style("height","10px").style("float","left").style("background-color",a.attr.colors[e]);r.append("div").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").text(t.toPrecision(6));s[e]=s[e]||l.g.append("circle");s[e].attr("r",4).attr("cx",l.scale.x(o[i].x)+2).attr("cy",l.scale.y(o[i].y[e])).style("fill",a.attr.colors[e])});return f.node().innerHTML};a.render.build=function(){l.g=a.widget.append("g");l.axisFn={x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)};l.axes={x:l.g.append("g").attr("class","x axis"),y:l.g.append("g").attr("class","y axis")};l.labels={x:l.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:l.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)};if(a.attr.legend){var r=l.g.append("g").attr("class","legend");var n=0;e.forOwn(l.lines,function(t,e){var i=r.append("g").style("cursor","pointer").on("mouseover",function(){y(e)}).on("mouseleave",function(){y()});i.append("rect").attr("x",a.attr.width*.8).attr("y",n).attr("width",a.attr.fontSize).attr("height",a.attr.fontSize).style("fill",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[e]).style("stroke","none");i.append("text").attr("x",a.attr.width*.83).attr("y",n).attr("dy",.8*a.attr.fontSize).attr("text-anchor","start").style("fill",a.attr.fontColor).attr("font-family","inherit").attr("font-size",a.attr.fontSize+"px").text(e);n+=a.attr.height*.08})}};a.render.update=function(r){var n=a.utils.boundary(o,{y:[a.attr.yMin,null]});l.scale=a.utils.scale(n,a.attr.width-a.attr.margins.left-a.attr.margins.right,a.attr.height-a.attr.margins.top-a.attr.margins.bottom,{x:{type:a.attr.xType}});l.axes.x.transition().duration(r).call(l.axisFn.x.scale(l.scale.x));l.axes.y.transition().duration(r).call(l.axisFn.y.scale(l.scale.y));if(o.length>0){if(l.lines===undefined){l.errors={};e.forOwn(o[0].y,function(t,e){l.errors[e]=l.g.append("path").attr("class","error "+a.utils.encode(e)).style("fill-opacity",.2).style("stroke-width","0px").style("shape-rendering","geometricPrecision")});l.lines={};e.forOwn(o[0].y,function(t,e){l.lines[e]=l.g.append("path").attr("class","line "+a.utils.encode(e)).style("fill","none").style("stroke-width","2px").style("shape-rendering","geometricPrecision")})}e.forOwn(o[0].y,function(e,i){if(o[0].hasOwnProperty("dy")&&o[0].dy.hasOwnProperty(i)){var a=t.area().x(function(t){return l.scale.x(t.x)+2}).y0(function(t){return l.scale.y(Math.max(t.y[i]-t.dy[i],n.y.min))}).y1(function(t){return l.scale.y(Math.min(t.y[i]+t.dy[i],n.y.max))});l.errors[i].transition().duration(r).attr("d",a(o))}var s=t.line().x(function(t){return l.scale.x(t.x)+2}).y(function(t){return l.scale.y(t.y[i])});l.lines[i].transition().duration(r).attr("d",s(o))})}};a.render.style=function(){a.attr.colors=a.utils.colors(o[0]?t.keys(o[0].y):null);var r=a.attr.width-a.attr.margins.left-a.attr.margins.right,n=a.attr.height-a.attr.margins.top-a.attr.margins.bottom;l.g.attr("width",r+"px").attr("height",n+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");l.axes.x.attr("transform","translate(0,"+n+")");l.axisFn.y.tickFormat(a.attr.yTickFormat);l.axes.y.attr("transform","translate(0,"+1+")");l.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");l.labels.x.attr("x",r+"px").attr("y",n+35+"px").style("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);l.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel);e.forOwn(l.errors,function(t,e){l.errors[e].style("fill",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[e]).on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(e)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(e)}).on("click",function(){a.attr.click&&a.attr.click(e)})});e.forOwn(l.lines,function(t,e){l.lines[e].style("stroke",typeof a.attr.colors==="string"?a.attr.colors:a.attr.colors[e]).on("mouseover",function(){a.attr.mouseover&&a.attr.mouseover(e)}).on("mouseleave",function(){a.attr.mouseleave&&a.attr.mouseleave(e)}).on("click",function(){a.attr.click&&a.attr.click(e)})});e.forOwn(c,function(t){t.g.select(".horizontal").attr("x1",l.scale.x(t.start.x)+2).attr("y1",l.scale.y(t.corner.y)).attr("x2",l.scale.x(t.end.x)+2).attr("y2",l.scale.y(t.corner.y));t.g.select(".vertical").attr("x1",l.scale.x(t.corner.x)+2).attr("y1",l.scale.y(t.start.y)).attr("x2",l.scale.x(t.corner.x)+2).attr("y2",l.scale.y(t.end.y));t.g.select(".start").attr("cx",l.scale.x(t.start.x)+2).attr("cy",l.scale.y(t.start.y));t.g.select(".end").attr("cx",l.scale.x(t.end.x)+2).attr("cy",l.scale.y(t.end.y));t.g.select("text").attr("x",l.scale.x(t.corner.x)+2).attr("y",l.scale.y(t.corner.y)).attr("text-anchor",t.start.y<t.end.y?"start":"end").style("fill",a.attr.fontColor)})}}n.prototype=Object.create(r.prototype);return n});