(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("lodash"))}else if(typeof define==="function"&&define.amd){define(["_","exports"],e)}else{t.du=t.du||{};t.du.data=e(t._)}})(this,function(t){"use strict";var e={si:function(){var t="yzafpnÎ¼m kMGTPEZY";var e=(t.length-1)/2;var r=e;var n=-e;function a(a){if(a===null||a===undefined||isNaN(a))return"N/A";if(a===0)return"0";var i=Math.abs(a);var o=Math.max(Math.min(parseInt(Math.floor(Math.log(i)/Math.log(1e3))),r),n);var s=i/Math.pow(1e3,o);return(a<0?"-":"")+(o===n||o===r?s.toExponential(2):s.toPrecision(3)).replace(/e\+0$/,"")+t.charAt(e+o).trim()}return a}(),idfy:function(t){return t?t.replace(/ /g,"__"):""},namify:function(t){return t?t.replace(/__/g," "):""}};var r={sum:function(e,r,n){var a={};var i=[];if(Array.isArray(n)){i=n}else{i=[n]}var o=i.length;e.forEach(function(t){var e=[];i.forEach(function(r){if(t.hasOwnProperty(r)){e.push(t[r])}});if(e.length!==o)return;var n=e.join(".");if(!a.hasOwnProperty(n))a[n]=+t[r];else a[n]+=+t[r]});var s=[];t.forOwn(a,function(t,e){s.push({key:e,value:t})});return s.sort(function(t,e){return e.value-t.value})}};var n={Histogram:function(e){var r=e?e:[];this.set=function(t){r=t;return this};function n(){return t.cloneDeep(r)}function a(t,e){r.push({x:t,y:e,index:r.length});return this}function i(t){r.forEach(function(e){e.y*=t});return this}function o(){var t=d3.sum(r,function(t){return t.y});r.forEach(function(e){e.y/=t});return this}function s(t){r.sort(function(e,r){return t?r.x-e.x:e.x-r.x});return this}function l(t){r.sort(function(e,r){return t?r.y-e.y:e.y-r.y});return this}function u(){r.sort(function(t,e){return t.index-e.index});return this}return{set:set,get:n,add:a,scale:i,normalize:o,sortByX:s,sortByY:l,unsort:u}},TimeSeries:function(e){var r=[];function n(t){r=[];var n=0;if(t!==null){var a=new Date(t);while(a<=new Date){r.push({x:new Date(a),y:{}});e.forEach(function(t){r[n].y[t]=0});a.setDate(a.getDate()+1);n++}}return this}function a(t,e,n,a){r[t].x=e;r[t].y[n]+=a}function i(t,e){if(!t)return r;else{var n=e?e:0;return r.slice(-n-t,-n)}}function o(e,n){if(r.length<1)return{};var a={};t.forOwn(r[0].y,function(t,e){a[e]=0});i(e?e:1,n).forEach(function(e){t.forOwn(r[0].y,function(t,r){a[r]+=e.y[r]})});return a}function s(e,n){var a=0;if(r.length>0){var o=i(e,n);t.forOwn(r[0].y,function(t,e){a=Math.max(d3.max(o,function(t){return t.y.hasOwnProperty(e)?t.y[e]:0}),a)})}return a}function l(e){if(r.length<1)return{};var n=o(1,e);var a=o(2,e);var i={};t.forOwn(r[0].y,function(t,e){a[e]-=n[e];if(a[e]>=10&&n[e]>0){i[e]=(n[e]-a[e])/a[e]}});return i}function u(e,r){var n=o(e,r);var a=0;t.forOwn(n,function(t){a+=t});t.forOwn(n,function(t,e){n[e]/=a>0?a:1});return n}return{clear:n,update:a,sub:i,sum:o,peak:s,trend:l,yDist:u}},Table:function(e){var r=[];var n=[];if(e){r=t.cloneDeep(e);r.forEach(function(t,e){n.push(e)})}function a(t,e){var n=[];r.forEach(function(r){var a;if(typeof e==="string"){a=r[e]}else{a={};e.forEach(function(t){a[t]=r[t]})}n.push({x:r[t],y:a})});return n}function i(t,e){var n=null;switch(typeof e){case"number":var a=d3.min(r,function(r){return Math.abs((e-r[t])/e)});n=r.filter(function(r){return Math.abs((r[t]-e)/e)<=a*1.01});break;case"string":default:n=r.filter(function(r){return r[t]===e})}return new du.data.structures.Table(n)}function o(t){r.sort(function(e,r){return e[t]-r[t]});return this}function s(){var t=[];n.forEach(function(e){t.push(r[e])});r=t}return{slice:a,segment:i,sort:o,unsort:s}}};return{format:e,explore:r,structures:n}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.math=t.du.math||{};t.du.math.la=e()}})(this,function(){"use strict";var t=function(e){var r=e||[1,0];this.x=function(){return r[0]};this.y=function(){return r[1]};this.length=function(e){var n=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(typeof e==="number"){var a=e/n;return new t(r.map(function(t){return t*a}))}return n};this.angle=function(e){var n=Math.atan2(r[1],r[0]);if(typeof e==="number"){var a=Math.sqrt(r[0]*r[0]+r[1]*r[1]);return new t([a*Math.cos(e),a*Math.sin(e)])}return n};this.toArray=function(){return[r[0],r[1]]};this.map=function(e){return new t(e(r))};this.add=function(e){return new t([r[0]+e.x(),r[1]+e.y()])};this.sub=function(e){return new t([r[0]-e.x(),r[1]-e.y()])};this.multiply=function(e){return new t(r.map(function(t){return t*e}))}};var e=function(t){var n=t||[1,0,0];this.x=function(){return n[0]};this.y=function(){return n[1]};this.z=function(){return n[2]};this.length=function(t){var r=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);if(typeof t==="number"){return new e(n.map(function(e){return e*t/r}))}return r};this.toLatLon=function(){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);return new r([Math.asin(n[2]/t),Math.atan2(n[1],n[0])].map(function(t){return t*180/Math.PI}))};this.add=function(t){return new e([n[0]+t.x(),n[1]+t.y(),n[2]+t.z()])};this.multiply=function(t){return new e(n.map(function(e){return e*t}))};this.dot=function(t){return n[0]*t.x()+n[1]*t.y()+n[2]*t.z()};this.cross=function(t){return new e([n[1]*t.z()-n[2]*t.y(),n[2]*t.x()-n[0]*t.z(),n[0]*t.y()-n[1]*t.x()])}};var r=function(t){var e=t||[0,0];this.toArray=function(){return[e[0],e[1]]};this.toVec=function(){var t=e[0]*Math.PI/180,r=e[1]*Math.PI/180;var n=Math.cos(t);return new t.Vector3([n*Math.cos(r),n*Math.sin(r),Math.sin(t)])}};return{Vector2:t,Vector3:e,LatLon:r}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.rest=e(t.d3)}})(this,function(t){"use strict";var e=function(e){function r(r,n,a,i,o){var s=e;var l=t.keys(r).sort();if(l.length>0){s+="?"+l[0]+"="+r[l[0]]}for(var u=1;u<l.length;u++){s+="&"+l[u]+"="+r[l[u]]}n(s).on("beforesend",function(t){if(o){for(var e in o){if(t.hasOwnProperty(e))t[e]=o[e]}}}).get(function(t,e){if(t){if(i)i(t);return}if(a)a(e)})}function n(e,n,a,i){r(e,t.json,n,a,i)}function a(e,n,a,i){r(e,t.csv,n,a,i)}return{json:n,csv:a}};return{Rest:e}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.signals=e()}})(this,function(){"use strict";var t={};function e(e,r){if(!t.hasOwnProperty(e))t[e]=[];for(var n=0;n<t[e].length;n++){if(t[e][n]===r){return}}t[e].push(r)}function r(t,r){if(typeof t==="string"){e(t,r)}else{if(t.constructor===Array){for(var n=0;n<t.length;n++){e(t[n],r)}}}}function n(e,r){var n=t[e];if(n!==undefined&&n!==null&&n.length>0){for(var a=0;a<n.length;a++){n[a](r)}}}return{subscribe:r,emit:n}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.log=e()}})(this,function(){"use strict";var t={error:"error",e:"error",warning:"warning",w:"warning",info:"info",i:"info",debug:"debug",d:"debug"};var e="info";var r=new Date;function n(t,e){return new Array(e-(""+t).length+1).join("0")+t}function a(){var t=new Date-r;return n(Math.floor(t/36e5),2)+":"+n(Math.floor(t%36e5/6e4),2)+":"+n(Math.floor(t%6e4/1e3),2)+"."+n(t%1e3,3)}function i(r){if(t.hasOwnProperty(r.toLowerCase())){e=r}}function o(t,r){if(e==="debug")console.debug("DEBUG ["+a()+"] "+t+": "+r)}function s(t,r){if(e==="info"||e==="debug")console.info("INFO  ["+a()+"] "+t+": "+r)}function l(t,r){if(e==="warning"||e==="info"||e==="debug")console.warn("WARN  ["+a()+"] "+t+": "+r)}function u(t,r){if(e==="error"||e==="warning"||e==="info"||e==="debug")console.error("ERROR ["+a()+"] "+t+": "+r)}return{severity:i,d:o,i:s,w:l,e:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(["exports"],e)}else{t.du=t.du||{};t.du.system=t.du.system||{};t.du.system.version=e()}})(this,function(){"use strict";var t="data/version.json";var e="du-version";var r=false;function n(t){if(typeof t!=="string"){return{major:0,minor:0,patch:1}}var e=t.split(".");return{major:e.length>0?+e[0]:0,minor:e.length>1?+e[1]:0,patch:e.length>2?+e[2]:1}}function a(t,e){var r=n(e),a=n(t);return a.major>r.major||a.major===r.major&&a.minor>r.minor||a.major===r.major&&a.minor===r.minor&&a.patch>r.patch}function i(e){t=e}function o(n,i){var s="0.0.1";d3.json(t,function(t,r){if(!t&&r.hasOwnProperty("version")&&typeof r.version==="string"){s=r.version}try{var i=localStorage.getItem(e);if(i===null)i="0.0.1";if(a(s,i)){localStorage.setItem(e,s);if(n)n(s,i)}}catch(t){console.error("MissingDOMException: there is no DOM, could not check version")}});if(i&&!r){r=true;setInterval(function(){o(n,false)},1810001)}}function s(){try{var t=localStorage.getItem(e);if(t===null){t="0.0.1";localStorage.setItem(e,t)}}catch(t){console.error("MissingDOMException: there is no DOM, could not read version")}return t}s();return{file:i,current:s,check:o}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"))}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.user=e(t.d3)}})(this,function(t){"use strict";var e=function(){var e=[];try{window.addEventListener("load",function(){t.select("body").on("keydown",function(){var r=String.fromCharCode(t.event.keyCode);if(!r)return;for(var n=0;n<e.length;n++){if(e[n]._check(r)){e.forEach(function(t){t._reset()});break}}})})}catch(t){console.error("No DOM, could not attach event listener")}function r(t,r){e.push(this);var n=t.toLowerCase();this._index=0;this._reset=function(){this._index=0};this._check=function(t){if(t.toLowerCase()===n.charAt(this._index)){this._index++}else{this._index=0}if(this._index===n.length){r();return true}return false}}return r}();var r=0;setInterval(function(){r+=1e4},1e4);try{window.addEventListener("load",function(){t.select("body").on("mousemove",function(){r=0})})}catch(t){console.error("No DOM, could not attach event listener")}function n(t,e){setInterval(function(){if(r>t){e()}},t)}function a(t){window.onblur=t}function i(t){window.onfocus=t}function o(){t.select("svg").style("pointer-events",null)}function s(){try{t.select("svg").style("pointer-events","none")}catch(t){console.error("No DOM, could not attach event listener")}}function l(){try{t.select("body").attr("oncontextmenu","return false;")}catch(t){console.error("No DOM, could not hide context menu")}}var u={egg:function(t,r){new e(t,r)},feature:function(t,r,n){new e("enable"+t,r);new e("disable"+t,n)}};return{enable:o,disable:s,noContext:l,idle:n,leave:a,enter:i,cheats:u}});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3)}})(this,function(t){"use strict";var e=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function r(r,n,a,i){var o;var s="du-widget-"+n+"-"+r;try{if(i){o=t.select(i).append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{o=t.select("body").append(a).attr("id",s).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var l={xDim:"px",yDim:"px",fontWeight:"normal",innerWidth:200,innerHeight:150,_categories:{dim:[]},add:function(t,e,r,n,a){l[e]=r;t[e]=function(r){if(a){a(r)}else{l[e]=r}return t};if(typeof n==="string"&&l._categories.hasOwnProperty(n)){l._categories[n].push(e)}}};l.add(this,"relative",false);l.add(this,"x",0,"dim",function(t,e){l.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)l.xDim=e});l.add(this,"y",0,"dim",function(t,e){l.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)l.yDim=e});l.add(this,"width",200,"dim",function(t){l.width=t;l.innerWidth=l.width-l.margins.left-l.margins.right});l.add(this,"height",150,"dim",function(t){l.height=t;l.innerHeight=l.height-l.margins.top-l.margins.bottom});l.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){l.margins[e]=t})}else{for(var e in t){if(t.hasOwnProperty(e)){l.margins[e]=t[e]}}}l.innerWidth=l.width-l.margins.left-l.margins.right;l.innerHeight=l.height-l.margins.top-l.margins.bottom});l.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){l.borders[e]=t})}for(var e in t){if(t.hasOwnProperty(e)){l.borders[e]=t[e]}}});l.add(this,"fontColor","black");l.add(this,"fontSize",10,"dim");l.add(this,"fontWeight","normal");l.add(this,"label",null);l.add(this,"xLabel",null);l.add(this,"yLabel",null);l.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});l.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});l.add(this,"xTickAngle",null);l.add(this,"yMin",0);l.add(this,"mouseover",null);l.add(this,"mouseleave",null);l.add(this,"click",null);l.add(this,"colors",null);l.add(this,"tooltip",false);var u=function(){var t=[];function e(e){return{remain:t.reduce(function(t,r){return e.indexOf(r)>-1?t.concat(r):t},[]),exit:t.reduce(function(t,r){return e.indexOf(r)===-1?t.concat(r):t},[]),enter:e.forEach(function(e,r){return t.indexOf(r)===-1?e.concat(r):e},[])}}return{update:e}}();var c=function(){function r(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function n(){var e=o.append("g");return{g:e,axisFn:{x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)},axes:{x:e.append("g").attr("class","x axis"),y:e.append("g").attr("class","y axis")},labels:{x:e.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:e.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}}}function a(e,r,n){if(!e||e.length<1){return t.scaleLinear().domain([0,1]).range(r)}var a;switch(n){case undefined:case"linear":a=t.scaleLinear().domain([t.min(e),t.max(e)]);break;case"band":a=t.scaleBand().domain(e).padding(.1);break;case"point":a=t.scalePoint().domain(e).padding(.5)}return a.range(r)}function i(e,n,a,i,o){if(n!==null){if(typeof i==="string"){n.g.selectAll(a).transition();n.g.selectAll(a).transition().duration(o?o:0).style("opacity",function(){return t.select(this).classed(r(i))?1:.1})}else{n.g.selectAll(a).transition();n.g.selectAll(a).transition().duration(o?o:0).style("opacity",1)}}return e}function s(r){if(r===null||r===undefined){return{}}if(r.length>0){if(l.colors===null||l.colors===undefined){return r.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,r,n){t[r]=e[n%18];return t},{})}if(typeof l.colors==="string"){var n=t.scaleLinear().domain([0,r.length]).range([l.colors,"#fff"]).interpolate(t.interpolateRgb);return r.reduce(function(t,e,r){t[e]=n(r);return t},{})}return l.colors}}return{encode:r,standardAxis:n,scale:a,highlight:i,colors:s}}();this.id=function(){return s};this.describe=function(e){var r=null;o.on("contextmenu",function(){t.event.preventDefault();if(r===null){r=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(r!==null){r.remove();r=null}});return this};this.placeholder=function(e){var n=300;var a="du-widget-placeholder-"+r;if(e){o.transition().duration(n).style("opacity",0);if(t.select("#"+a).empty()){var s=i?i:"body";t.select(s).append("div").attr("id",a).style("position","absolute").style("width",l.width+"px").style("height",l.height+"px").style("line-height",l.height+"px").style(l.x>=0?"left":"right",Math.abs(l.x)+l.xDim).style(l.y>=0?"top":"bottom",Math.abs(l.y)+l.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",l.fontWeight).style("font-size",l.fontSize).style("color",l.fontColor).style("opacity",0).html(e).transition().duration(n).style("opacity",1)}}else{o.transition().duration();o.transition().duration(n).style("opacity",1);var u=t.select("#"+a);if(!u.empty()){u.remove()}}return this};function d(){var e="du-widgets-plot-tooltip";var r=t.mouse(o.node());var n=t.event.pageX;var a=t.event.pageY;var i=o.node().getBoundingClientRect();if(n<i.left+l.margins.left||n>i.right-l.margins.right||a<i.top+l.margins.top||a>i.bottom-l.margins.bottom){t.select("#"+e).style("opacity",0).html("");c.tooltip();return}var s=t.select("#"+e);if(t.select("#"+e).empty()){var u=t.color(l.fontColor);u.opacity=.3;s=t.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("box-shadow","0 0 3px "+u).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",l.fontColor).style("pointer-events","none").style("left",(i.left+i.right)/2+"px").style("top",(i.top+i.bottom)/2+"px")}var d=c.tooltip([r[0]-l.margins.left,r[1]-l.margins.top]);if(!d){t.select("#"+e).style("opacity",0).html("");c.tooltip();return}s.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(d.title);s.style("border-left",d.stripe?"solid 2px "+d.stripe:null);switch(d.content.type){case"metrics":d.content.data.forEach(function(t){var e=s.append("div").style("position","relative").style("display","block").style("width","auto").style("height","10px").style("margin","5px");e.append("div").style("position","relative").style("float","left").style("color","#888").html(t.label);e.append("div").style("position","relative").style("float","right").style("margin-left","10px").html(t.value)});break;case"plots":d.content.data.sort(function(t,e){return t.name.localeCompare(e.name)}).forEach(function(t){var e=s.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");e.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background-color",t.color);e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)});break}var f=s.node().getBoundingClientRect();var p=f.width;var h=f.height;var y=n+20;var g=a+20;if(y+p>i.right-l.margins.right-5){y-=p+40}if(g+h>i.bottom-l.margins.bottom-5){g=i.bottom-l.margins.bottom-10-h}s.style("opacity",1).transition();s.transition().duration(200).ease(t.easeLinear).style("left",y+"px").style("top",g+"px")}var f={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){f.build&&f.build();this._isBuilt=true}f.update&&f.update(e);if(l.relative){o.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{o.style("position","absolute").style(l.x>=0?"left":"right",Math.abs(l.x)+l.xDim).style(l.y>=0?"top":"bottom",Math.abs(l.y)+l.yDim)}o.style("width",l.width+"px").style("height",l.height+"px");o.style("pointer-events",l.tooltip&&c.tooltip?"all":null).on("mousemove",function(){l.tooltip&&c.tooltip&&d()});o.selectAll(".axis path").style("fill","none").style("stroke",l.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > line").style("stroke",l.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",l.fontSize+"px").style("fill",l.fontColor);o.style("font-family","inherit");o.selectAll("g").attr("font-family","inherit");f.style&&f.style();o.style("display","block");return this};this.remove=function(){o.remove()};return{widget:o,attr:l,data:u,utils:c,render:f}}return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.AreaChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"areachart","svg",n);a.attr.add(this,"opacity",.3);var i={};var o=[];var s={};var l=false;this.data=function(t){o=t.map(function(t){return{name:t.name,values:t.values.sort(function(t,e){return t.x-e.x})}});return this};this.highlight=function(t,e){if(!l)a.utils.highlight(this,i,".area",t,e);return this};a.utils.tooltip=function(e){var r=t.bisector(function(t){return i.scale.x(t.x)}).left;var n=e?o.map(function(t){return r(t.values,e[0])}):null;if(n===null){for(var l in this.tt){if(this.tt.hasOwnProperty(l))this.tt[l].remove()}this.tt=null;return}else{this.tt=this.tt||{};var u=this.tt}var c=o.map(function(t,r){var a=n[r];var o=t.values;var l=o[a-1]?o[a-1]:o[a];var c=o[a]?o[a]:o[a-1];var d=e[0]-l.x>c.x-e[0]?c:l;u[t.name]=u[t.name]||i.g.append("circle");u[t.name].attr("r",4).attr("cx",i.scale.x(d.x)+1).attr("cy",i.scale.y(d.y)+1).style("fill",s[t.name]);return{name:t.name,color:s[t.name],value:d.y.toPrecision(6)}});return{title:a.attr.xLabel+": "+i.scale.x.invert(e[0]).toFixed(2),content:{type:"plots",data:c}}};a.render.build=function(){i=a.utils.standardAxis();i.plots={}};a.render.update=function(e){i.scale={x:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,a.attr.innerWidth]),y:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[a.attr.innerHeight,0])};var r=t.area().x(function(t){return i.scale.x(t.x)+1}).y0(a.attr.height-a.attr.margins.top-a.attr.margins.bottom).y1(function(t){return i.scale.y(t.y)});i.axes.x.transition().duration(e).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(e).call(i.axisFn.y.scale(i.scale.y));s=a.utils.colors(o?o.map(function(t){return t.name}):null);i.plots.areas=i.g.selectAll(".area").data(o,function(t){return t.name});i.plots.areas.exit().transition().duration(e).style("opacity",0).remove();i.plots.areas.enter().append("path").attr("class",function(t){return"area "+a.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("stroke","none").style("fill","transparent").merge(i.plots.areas).each(function(){l=true}).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).transition().duration(e).style("opacity",1).attr("d",function(t){return r(t.values)}).style("fill-opacity",a.attr.opacity).style("fill",function(t){return s[t.name]}).on("end",function(){l=false})};a.render.style=function(){i.g.attr("width",a.attr.innerWidth+"px").attr("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BarChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"barchart","svg",n);a.attr.add(this,"vertical",false);var i={};var o=[];var s={};var l=false;this.data=function(t){o=t;return this};this.highlight=function(t,e){if(!l)a.utils.highlight(this,i,".bar",t,e);return this};a.utils.tooltip=function(e){var r=a.attr.vertical?1:0;var n=t.bisector(function(t){return i.scale.x(t.name)}).right;var s=e?n(o,e[r]):null;if(s===null){return}var l=o[s-1]?o[s-1]:o[s];var u=o[s]?o[s]:o[s-1];var c=e[r]-l.name>u.name-e[r]?u:l;return{title:c.name,stripe:a.attr.colors[c.name],content:{type:"metrics",data:[{label:a.attr.yLabel+":",value:c.value.toPrecision(6)}]}}};a.render.build=function(){i=a.utils.standardAxis();i.plots={}};a.render.update=function(e){i.scale={x:a.utils.scale(o.map(function(t){return t.name}).reverse(),[a.attr.vertical?a.attr.innerHeight:a.attr.innerWidth,0],"band"),y:a.utils.scale([0,t.max(o,function(t){return t.value})],a.attr.vertical?[0,a.attr.innerWidth]:[a.attr.innerHeight,0])};i.axes.x.transition().duration(e).call(i.axisFn.x.scale(a.attr.vertical?i.scale.y:i.scale.x));i.axes.y.transition().duration(e).call(i.axisFn.y.scale(a.attr.vertical?i.scale.x:i.scale.y));s=a.utils.colors(o?o.map(function(t){return t.name}):null);i.plots.bars=i.g.selectAll(".bar").data(o,function(t){return t.name});i.plots.bars.exit().transition().duration(e).style("opacity",0).remove();var r=i.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+a.utils.encode(t.name)}).style("fill",function(t){return s[t.name]}).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none");if(a.attr.vertical){r.attr("y",function(t){return i.scale.x(t.name)}).attr("height",i.scale.x.bandwidth()).attr("x",1).attr("width",0)}else{r.attr("x",function(t){return i.scale.x(t.name)}).attr("width",i.scale.x.bandwidth()).attr("y",a.attr.height-a.attr.margins.top-a.attr.margins.bottom).attr("height",0)}var n=r.merge(i.plots.bars).each(function(){l=true}).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)});if(a.attr.vertical){n=n.transition().duration(e).attr("y",function(t){return i.scale.x(t.name)}).attr("height",i.scale.x.bandwidth()).attr("x",1).attr("width",function(t){return i.scale.y(t.value)})}else{n=n.transition().duration(e).attr("x",function(t){return i.scale.x(t.name)}).attr("width",i.scale.x.bandwidth()).attr("y",function(t){return i.scale.y(t.value)}).attr("height",function(t){return a.attr.height-a.attr.margins.top-a.attr.margins.bottom-i.scale.y(t.value)})}n.style("opacity",1).style("fill",function(t){return s[t.name]}).on("end",function(){l=false})};a.render.style=function(){i.g.style("width",a.attr.innerWidth+"px").style("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");if(a.attr.vertical){i.axisFn.x.tickFormat(a.attr.yTickFormat)}else{i.axisFn.y.tickFormat(a.attr.yTickFormat)}i.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(a.attr.vertical){i.g.selectAll(".y.axis .tick > line").style("display","none")}if(typeof a.attr.xTickAngle==="number"){i.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+a.attr.xTickAngle+")").style("text-anchor","start")}i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.vertical?a.attr.yLabel:a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.vertical?a.attr.xLabel:a.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BoxPlot=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"boxplot","svg",n);var i={};var o=[];var s=null;var l={};var u=false;this.data=function(e){o=e.map(function(e){var r=e.values.sort(t.ascending),n=t.min(r),a=t.max(r),i=t.quantile(r,.25),o=t.quantile(r,.75),s=o-i;var l=[],u=[];e.values.filter(function(t){return t<i-1.5*s||t>o+1.5*s}).forEach(function(t){if(t<i-3*s||t>o+3*s){u.push(t)}else{l.push(t)}});return{name:e.name,values:{min:n,max:a,mean:t.mean(r),median:t.median(r),q1:i,q3:o,whiskers:{lower:Math.max(n,i-1.5*s),upper:Math.min(a,o+1.5*s)},outliers:{mild:l,extreme:u}}}});return this};this.highlight=function(t,e){if(!u)a.utils.highlight(this,i,".box",t,e);return this};a.utils.tooltip=function(){return s?{title:s.name,stripe:a.attr.colors[s.name],content:{type:"metrics",data:[{label:"min/max:",value:s.values.min.toPrecision(3)+"/"+s.values.max.toPrecision(3)},{label:"mean:",value:s.values.mean.toPrecision(3)},{label:"median:",value:s.values.median.toPrecision(3)},{label:"Q1:",value:s.values.q1.toPrecision(3)},{label:"Q3:",value:s.values.q3.toPrecision(3)},{label:"mild outliers:",value:s.values.outliers.mild.length},{label:"extreme outliers:",value:s.values.outliers.extreme.length}]}}:null};a.render.build=function(){i=a.utils.standardAxis();i.plots={}};a.render.update=function(t){i.scale={x:a.utils.scale(o.map(function(t){return t.name}).reverse(),[a.attr.innerWidth,0],"point"),y:a.utils.scale(o.map(function(t){return[t.values.min-.1*(t.values.max-t.values.min),t.values.max+.1*(t.values.max-t.values.min)]}).reduce(function(t,e){return t.concat(e)},[]),[a.attr.innerHeight,0])};i.axes.x.transition().duration(t).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(t).call(i.axisFn.y.scale(i.scale.y));l=a.utils.colors(o?o.map(function(t){return t.name}):null);i.plots.groups=i.g.selectAll(".box-group").data(o,function(t){return t.name});i.plots.groups.exit().style("opacity",0).remove();var e=i.plots.groups.enter().append("g").attr("class",function(t){return"box-group "+a.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var r=e.merge(i.plots.groups).each(function(){u=true}).on("mouseover",function(t){s=t;a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){s=null;a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)});r.transition().duration(t).style("opacity",1).style("fill-opacity",a.attr.opacity).style("fill",function(t){return l[t.name]}).style("stroke",function(t){return l[t.name]}).on("end",function(){u=false});e.append("rect").attr("class","body").attr("x",function(t){return i.scale.x(t.name)-10}).attr("y",function(t){return i.scale.y(t.values.q3)}).attr("width",20).attr("height",function(t){return i.scale.y(t.values.q1)-i.scale.y(t.values.q3)}).style("rx","2px").style("ry","2px").style("fill-opacity",.3).style("stroke-width","1px");r.select(".body").transition().duration(t).attr("x",function(t){return i.scale.x(t.name)-10}).attr("y",function(t){return i.scale.y(t.values.q3)}).attr("width",20).attr("height",function(t){return i.scale.y(t.values.q1)-i.scale.y(t.values.q3)});e.append("line").attr("class","median").attr("x1",function(t){return i.scale.x(t.name)-10}).attr("x2",function(t){return i.scale.x(t.name)+10}).attr("y1",function(t){return i.scale.y(t.values.median)}).attr("y2",function(t){return i.scale.y(t.values.median)}).style("stroke-width","2px").style("fill-opacity",.8);r.select(".median").transition().duration(t).attr("x1",function(t){return i.scale.x(t.name)-10}).attr("x2",function(t){return i.scale.x(t.name)+10}).attr("y1",function(t){return i.scale.y(t.values.median)}).attr("y2",function(t){return i.scale.y(t.values.median)});e.append("path").attr("class","lower-whisker").attr("d",function(t){return"M"+i.scale.x(t.name)+","+i.scale.y(t.values.q1)+"L"+i.scale.x(t.name)+","+i.scale.y(t.values.whiskers.lower)+"M"+(i.scale.x(t.name)-8)+","+i.scale.y(t.values.whiskers.lower)+"L"+(i.scale.x(t.name)+8)+","+i.scale.y(t.values.whiskers.lower)});r.select(".lower-whisker").transition().duration(t).attr("d",function(t){return"M"+i.scale.x(t.name)+","+i.scale.y(t.values.q1)+"L"+i.scale.x(t.name)+","+i.scale.y(t.values.whiskers.lower)+"M"+(i.scale.x(t.name)-8)+","+i.scale.y(t.values.whiskers.lower)+"L"+(i.scale.x(t.name)+8)+","+i.scale.y(t.values.whiskers.lower)});e.append("path").attr("class","upper-whisker").attr("d",function(t){return"M"+i.scale.x(t.name)+","+i.scale.y(t.values.q3)+"L"+i.scale.x(t.name)+","+i.scale.y(t.values.whiskers.upper)+"M"+(i.scale.x(t.name)-8)+","+i.scale.y(t.values.whiskers.upper)+"L"+(i.scale.x(t.name)+8)+","+i.scale.y(t.values.whiskers.upper)});r.select(".upper-whisker").transition().duration(t).attr("d",function(t){return"M"+i.scale.x(t.name)+","+i.scale.y(t.values.q3)+"L"+i.scale.x(t.name)+","+i.scale.y(t.values.whiskers.upper)+"M"+(i.scale.x(t.name)-8)+","+i.scale.y(t.values.whiskers.upper)+"L"+(i.scale.x(t.name)+8)+","+i.scale.y(t.values.whiskers.upper)});r.selectAll(".mild-outlier").transition().duration(t).style("opacity",0).remove();var n=r.selectAll(".mild-outlier").data(function(t){return t.values.outliers.mild.map(function(e){return{x:t.name,y:e}})});n.enter().append("circle").attr("class","mild-outlier").attr("r",2.5).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)}).attr("stroke","none").style("opacity",0).transition().duration(t).style("opacity",1);r.selectAll(".extreme-outlier").transition().duration(t).style("opacity",0).remove();var c=r.selectAll(".extreme-outlier").data(function(t){return t.values.outliers.extreme.map(function(e){return{x:t.name,y:e}})});c.enter().append("circle").attr("class","extreme-outlier").attr("r",2).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)}).attr("fill","none").attr("stroke-width","0.5px").style("opacity",0).transition().duration(t).style("opacity",1)};a.render.style=function(){a.attr.colors=a.utils.colors(o?o.map(function(t){return t.name}):null);i.g.style("width",a.attr.innerWidth+"px").style("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BubbleChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"bubblechart","svg",r);n.attr.add(this,"scale",1);n.attr.add(this,"sizeLabel","size");var a={};var i=[];var o={};var s=null;var l=false;this.data=function(t){i=t.map(function(t){return{name:t.name,values:{x:t.x,y:t.y,size:t.size}}});return this};this.highlight=function(t,e){if(!l)n.utils.highlight(this,a,".bubble",t,e);return this};n.utils.tooltip=function(){return s?{title:s.name,stripe:n.attr.colors[s.name],content:{type:"metrics",data:[{label:n.attr.xLabel+":",value:s.values.x.toPrecision(4)},{label:n.attr.yLabel+":",value:s.values.y.toPrecision(4)},{label:n.attr.sizeLabel+":",value:s.values.size.toFixed(1)}]}}:null};n.render.build=function(){a=n.utils.standardAxis();a.plots={}};n.render.update=function(t){a.scale={x:n.utils.scale(i.map(function(t){return[t.values.x-1.1*n.attr.scale*t.values.size,t.values.x+1.1*n.attr.scale*t.values.size]}).reduce(function(t,e){return t.concat(e)},[]),[0,n.attr.innerWidth]),y:n.utils.scale(i.map(function(t){return[t.values.y-1.1*n.attr.scale*t.values.size,t.values.y+1.1*n.attr.scale*t.values.size]}).reduce(function(t,e){return t.concat(e)},[]),[n.attr.innerHeight,0])};a.axes.x.transition().duration(t).call(a.axisFn.x.scale(a.scale.x));a.axes.y.transition().duration(t).call(a.axisFn.y.scale(a.scale.y));o=n.utils.colors(i?i.map(function(t){return t.name}):null);a.plots.bubbles=a.g.selectAll(".bubble").data(i,function(t){return t.name});a.plots.bubbles.exit().transition().duration(t).style("opacity",0).remove();a.plots.bubbles.enter().append("circle").attr("class",function(t){return"bubble "+n.utils.encode(t.name)}).attr("cx",function(t){return a.scale.x(t.values.x)}).attr("cy",function(t){return a.scale.y(t.values.y)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent").merge(a.plots.bubbles).each(function(){l=true}).on("mouseover",function(t){s=t;n.attr.mouseover&&n.attr.mouseover(t.name)}).on("mouseleave",function(t){s=null;n.attr.mouseleave&&n.attr.mouseleave(t.name)}).on("click",function(t){n.attr.click&&n.attr.click(t.name)}).transition().duration(t).attr("r",function(t){return n.attr.scale*t.values.size}).attr("cx",function(t){return a.scale.x(t.values.x)}).attr("cy",function(t){return a.scale.y(t.values.y)}).style("opacity",1).style("fill",function(t){return o[t.name]}).on("end",function(){l=false})};n.render.style=function(){a.g.attr("width",n.attr.innerWidth+"px").attr("height",n.attr.innerHeight+"px").attr("transform","translate("+n.attr.margins.left+","+n.attr.margins.top+")").style("pointer-events","all");a.axes.x.attr("transform","translate(0,"+n.attr.innerHeight+")");a.axisFn.y.tickFormat(n.attr.yTickFormat);a.axes.y.attr("transform","translate(0,"+1+")");a.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");a.labels.x.attr("x",n.attr.innerWidth+"px").attr("y",n.attr.innerHeight+2.2*n.attr.fontSize+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.xLabel);a.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ChordChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"chordchart","svg",n);a.attr.add(this,"radius",100,"dim");a.attr.add(this,"thickness",10,"dim");a.attr.add(this,"ticks",false);a.attr.add(this,"invert",false);var i={};var o=[];var s=null;var l=t.map();var u=t.map();var c=10;var d=null;var f=false;this.data=function(e){l.clear();u.clear();o=[];var r=0,n=0;e.forEach(function(t){if(!l.has(n=t.source)){u.set(r,n);l.set(n,r++)}if(!l.has(n=t.target)){u.set(r,n);l.set(n,r++)}});e.forEach(function(t){var e=l.get(t.source),n=l.get(t.target),a=o[e];if(!a){a=o[e]=[];for(var i=0;i<r;i++)a[i]=0}a[n]=t.value;if(!o[n]){o[n]=[];for(i=0;i<r;i++)o[n][i]=0}});c=t.max(u.values(),function(t){return t.length});return this};function p(t){return t.source.index<t.target.index?t.source.index+"-"+t.target.index:t.target.index+"-"+t.source.index}function h(e){var r=t.map();if(e){e.groups.forEach(function(t){r.set(t.index,t)})}return function(e){var n;var a=r.get(e.index);if(a){n=t.interpolate(a,e)}else{var o={startAngle:e.startAngle,endAngle:e.startAngle};n=t.interpolate(o,e)}return function(t){return i.arc(n(t))}}}function y(e){var r=t.map();if(e){e.forEach(function(t){r.set(p(t),t)})}return function(n){var a;var o=r.get(p(n));if(o){if(n.source.index!==o.source.index){o={source:o.target,target:o.source}}a=t.interpolate(o,n)}else{if(e){var s=e.groups.filter(function(t){return t.index===n.source.index||t.index===n.target.index});o={source:s[0],target:s[1]||s[0]};if(o.source&&n.source.index!==o.source.index){o={source:o.target,target:o.source}}}else o=n;var l=o.source?o.source.startAngle:0;var u=o.target?o.target.startAngle:0;var c={source:{startAngle:l,endAngle:l},target:{startAngle:u,endAngle:u}};a=t.interpolate(c,n)}return function(t){return i.ribbonFn(a(t))}}}this.highlight=function(t,e){if(!f)a.utils.highlight(this,i,".ribbon",t,e);return this};a.utils.tooltip=function(){if(!s){return null}var e=o[l.get(s.name)];return s?{title:s.name,stripe:a.attr.colors[s.name],content:{type:"metrics",data:e.map(function(r,n){return{name:u.get(n),value:100*r/t.sum(e)}}).sort(function(t,e){return e.value-t.value}).map(function(t){return{label:t.name,value:t.value.toFixed(1)+"%"}})}}:null};a.render.build=function(){i.g=a.widget.append("g");i.chordFn=t.chord().padAngle(.05).sortGroups(t.descending).sortSubgroups(t.descending);i.arc=t.arc();i.ribbonFn=t.ribbon();i.label=i.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};a.render.update=function(t){a.attr.colors=a.utils.colors(l?l.keys():null);var e=a.attr.radius-a.attr.thickness-a.attr.margins.left,r=a.attr.radius-a.attr.margins.left;if(i.groups)i.groups.transition();if(i.newGroups)i.newGroups.transition();if(i.ribbons)i.ribbons.transition();if(i.newRibbons)i.newRibbons.transition();i.chord=i.chordFn(o);i.arc.innerRadius(e).outerRadius(r);i.groups=i.g.selectAll(".group").data(i.chord.groups,function(t){return t.index});i.groups.exit().transition().duration(t).style("opacity",0).remove();i.newGroups=i.groups.enter().append("g").each(function(t){t.name=u.get(t.index)}).attr("class","group").style("pointer-events","all");i.newGroups.merge(i.groups).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){s=null;a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).on("mousemove",function(t){s=t});i.newGroups.append("path").attr("id",function(t){return"group"+t.index}).style("fill",function(t){return a.attr.colors[t.name]}).transition().duration(t).attrTween("d",h(d));if(a.attr.ticks){i.newGroups.append("text").attr("xlink:href",function(t){return"#group"+t.index}).attr("dy",".35em").text(function(t){return t.name}).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(a.attr.radius-a.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}i.groups.select("path").each(function(t){t.name=u.get(t.index)}).attr("d",i.arc).transition().duration(t).each(function(){f=true}).style("opacity",1).style("fill",function(t){return a.attr.colors[t.name]}).attrTween("d",h(d)).on("end",function(){f=false});if(a.attr.ticks){i.groups.select("text").transition().duration(t).attr("transform",function(t){t.angle=(t.startAngle+t.endAngle)/2;return"rotate("+(t.angle*180/Math.PI-90)+")"+" translate("+(a.attr.radius-a.attr.margins.left+5)+")"+(t.angle>Math.PI?" rotate(180)":" rotate(0)")}).attr("text-anchor",function(t){return t.angle>Math.PI?"end":"begin"})}i.ribbonFn.radius(e);i.ribbons=i.g.selectAll(".ribbon").data(i.chord,p);i.newRibbons=i.ribbons.enter().append("path").each(function(t){t.source.name=u.get(t.source.index);t.target.name=u.get(t.target.index)}).attr("class",function(t){return"ribbon "+a.utils.encode(t.source.name)}).style("pointer-events","all").style("fill",function(t){return a.attr.colors[a.attr.invert?t.source.name:t.target.name]}).style("stroke-width","1px").style("fill-opacity",.8).style("stroke-opacity",.8).style("stroke","white");i.newRibbons.transition().duration(t).attrTween("d",y(null));i.ribbons.exit().transition().duration(t).style("opacity",0).remove();i.ribbons.each(function(t){t.source.name=u.get(t.source.index);t.target.name=u.get(t.target.index)}).attr("class",function(t){return"ribbon "+a.utils.encode(t.source.name)}).transition().duration(t).style("opacity",1).style("fill",function(t){return a.attr.colors[a.attr.invert?t.source.name:t.target.name]}).attrTween("d",y(d));d=i.chord};a.render.style=function(){a.attr.width=2*a.attr.radius;a.attr.height=2*a.attr.radius;a.widget.style("width",a.attr.width+"px").style("height",a.attr.height+"px");i.g.attr("transform","translate("+a.attr.radius+","+a.attr.radius+")");if(a.attr.ticks){i.newGroups.selectAll("text").style("font-size",a.attr.fontSize*.8+"px").style("font-weight",a.attr.fontWeight).style("fill",a.attr.fontColor)}i.label.attr("transform","translate(0,"+a.attr.radius+")").style("width",2*(a.attr.radius+a.attr.thickness)+"px").attr("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.label)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Grid=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"grid","div",n);var i=a.attr.x;var o=a.attr.y;var s=1;var l=1;var u=[];var c=[];var d=false;function f(){u.forEach(function(t){t.forEach(function(t){if(t){t.remove()}})});u=[];for(var t=0;t<l;t++){u.push([]);for(var e=0;e<s;e++){u[t].push(null)}}}this.x=function(t,e){a.attr.x=e!=="%"?t:window.innerWidth*t/100;i=a.attr.x;return this};this.y=function(t,e){a.attr.y=e!=="%"?t:window.innerHeight*t/100;o=a.attr.y;return this};this.rows=function(t){s=t;f();return this};this.cols=function(t){l=t;f();return this};this.show=function(t){if(t){d=true;a.widget.style("box-shadow","0 0 1px black inset");for(var e=1;e<s;e++){a.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*a.attr.height/s-1.5+"px").style("width",a.attr.width+"px").style("height","3px").style("background-color","white")}for(var r=1;r<l;r++){a.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*a.attr.width/l-1.5+"px").style("top","0").style("width","3px").style("height",a.attr.height+"px").style("background-color","white")}for(e=1;e<s;e++){a.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*a.attr.height/s-.5+"px").style("width",a.attr.width+"px").style("height","1px").style("background-color","black")}for(r=1;r<l;r++){a.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*a.attr.width/l-.5+"px").style("top","0").style("width","1px").style("height",a.attr.height+"px").style("background-color","black")}}else{d=false;a.widget.style("border",null);a.widget.selectAll(".grid-border-h").remove();a.widget.selectAll(".grid-border-v").remove()}return this};this.add=function(e,r,i,o,d){if(r<0||o<1||r+o>l||i<0||d<1||i+d>s){e.remove();return null}for(var f=r;f<r+o;f++){if(u[f]){for(var p=i;p<i+d;p++){if(u[f][p]){e.remove();return null}}}}c.push({x:r,y:i,width:o,height:d,widget:e});for(f=r;f<r+o;f++){for(p=i;p<i+d;p++){u[f][p]=e}}t.select("#"+this.id()).node().appendChild(t.select("#"+e.id()).node());e.x(r*a.attr.width/l+a.attr.x+a.attr.margins.left).y(i*a.attr.height/s+a.attr.y+t.select(n).attr("top")+a.attr.margins.left).width(o*a.attr.width/l-2*a.attr.margins.left).height(d*a.attr.height/s-2*a.attr.margins.left).render();return e};this.get=function(t,e){if(u[e]&&u[e][t]){return u[e][t].widget}else{return null}};a.render.style=function(){a.widget.style("position","absolute").style(a.attr.x>0?"left":"right",Math.abs(a.attr.x)+a.attr.xDim).style(a.attr.y>0?"top":"bottom",Math.abs(a.attr.y)+a.attr.yDim).style("width",a.attr.width+"px").style("height",a.attr.height+"px");a.widget.selectAll(".grid-border-h").style("top",function(){return t.select(this).attr("data-y")*a.attr.height/s-1+"px"}).style("width",a.attr.width+"px");a.widget.selectAll(".grid-border-v").style("left",function(){return t.select(this).attr("data-x")*a.attr.width/l-1+"px"}).style("height",a.attr.height+"px");c.forEach(function(t){t.widget.x(t.x*a.attr.width/l+a.attr.x+a.attr.margins.left).y(t.y*a.attr.height/s+a.attr.y+a.attr.margins.left).width(t.width*a.attr.width/l-2*a.attr.margins.left).height(t.height*a.attr.height/s-2*a.attr.margins.left).render(0)})}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Hint=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";var r=function(){var r={};function n(){for(var t in r){if(r.hasOwnProperty(t)){delete r[t]}}r={}}function a(a,i){var o="du-widgets-hint-";var s=o+a;var l=o+"css";var u=o+"class";if(r.hasOwnProperty(s)){return r[s]}else{var c=e.call(this,a,"hint","div",i);var d=this}c.attr.add(this,"text","");c.attr.add(this,"pin",false);try{if(t.select("#"+l).empty()){t.select("head").append("style").attr("id",l).text("."+u+":after{content:' ';position:absolute;width:0;height:0;left:20.5px;bottom:-10px;border:7px solid;border-color:#000 transparent transparent #000;}")}window.addEventListener("mousemove",function(){t.selectAll("."+u+".removable").remove();n()})}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}c.render.build=function(){c.widget.attr("class",u).style("position","absolute").style("display","block").style("padding","15px").style("text-align","center").style("line-height","1.1em").style("background-color","black").style("border-radius","4px").style("color","white").style("font-size","0.9em").style("font-weight","bold").style("pointer-events","none");if(!c.attr.pin){c.widget.classed("removable",true)}};c.render.style=function(t){c.widget.style("width","auto").style("height",null).html(c.attr.text);if(!r[s]){c.widget.style("opacity",0).transition().duration(t).style("opacity",1);if(!c.attr.pin){r[s]=d}}}}return a}();r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"histogram","svg",n);a.attr.add(this,"min",null);a.attr.add(this,"max",null);a.attr.add(this,"bin",null);a.attr.add(this,"normalize",false);var i={};var o=[];var s=[];var l={};var u=false;this.data=function(t){o=t.sort(function(t,e){return t-e});return this};this.highlight=function(t,e){if(!u)a.utils.highlight(this,i,".bar",t,e);return this};a.utils.tooltip=function(e){var r=t.bisector(function(t){return i.scale.x(t.values.x0)}).right;var n=e?r(s,e[0]):null;if(n===null){return}var a=s[n-1]?s[n-1]:s[n];var o=s[n]?s[n]:s[n-1];var l=e[0]-a.x>o.x-e[0]?o:a;return{title:l.name,content:{type:"metrics",data:[{label:"min:",value:l.values.x0.toPrecision(3)},{label:"max:",value:l.values.x1.toPrecision(3)},{label:"count:",value:l.values.length},{label:"fraction:",value:(100*l.values.length/t.sum(s,function(t){return t.values.length})).toFixed(2)+"%"}]}}};a.render.build=function(){i=a.utils.standardAxis();i.plots={}};a.render.update=function(e){if(o.length===0){return}var r=typeof a.attr.min==="number"?a.attr.min:o[0];var n=typeof a.attr.max==="number"?a.attr.max:o[o.length-1];var c=a.attr.bin;if(c===null){c=2*(t.quantile(o,.75)-t.quantile(o,.25))/Math.pow(o.length,1/3)}var d=[];var f=Math.ceil((n-r)/c);for(var p=0;p<=f;p++){d.push(r+p*c)}var h=a.attr.normalize?o.length:1;s=t.histogram().domain([r,r+f*c]).thresholds(d)(o).map(function(t,e){return{name:"bin "+e,values:t}});i.scale={x:a.utils.scale([r,r+f*c],[0,a.attr.innerWidth]),y:a.utils.scale([0,t.max(s,function(t){return t.values.length/h})],[a.attr.innerHeight,0])};i.axes.x.transition().duration(e).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(e).call(i.axisFn.y.scale(i.scale.y));l=a.utils.colors(s?s.map(function(t){return t.name}):null);i.plots.bars=i.g.selectAll(".bar").data(s,function(t){return t.name});i.plots.bars.exit().transition().duration(e).style("height",0).remove();i.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+a.utils.encode(t.name)}).attr("x",function(t){return i.scale.x(t.values.x0)+1}).attr("y",a.attr.height-a.attr.margins.top-a.attr.margins.bottom-1).attr("width",function(t){return Math.max(0,Math.abs(i.scale.x(t.values.x1)-i.scale.x(t.values.x0))-2)}).attr("height",0).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none").style("fill",function(){return l[s[0].name]}).merge(i.plots.bars).each(function(){u=true}).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).transition().duration(e).attr("x",function(t){return i.scale.x(t.values.x0)+1}).attr("y",function(t){return a.attr.margins.top-a.attr.margins.top+i.scale.y(t.values.length/h)}).attr("width",function(t){return Math.max(0,Math.abs(i.scale.x(t.values.x1)-i.scale.x(t.values.x0))-2)}).attr("height",function(t){return a.attr.height-a.attr.margins.top-a.attr.margins.bottom-i.scale.y(t.values.length/h)}).style("opacity",1).style("fill",function(){return l[s[0].name]}).on("end",function(){u=false})};a.render.style=function(){i.g.style("width",a.attr.innerWidth+"px").style("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof a.attr.xTickAngle==="number"){i.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+a.attr.xTickAngle+")").style("text-anchor","start")}i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",a.attr.fontSize+"px").style("fill",a.attr.fontColor).text(a.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.InfoBox=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";var r=function(){var r=null;function n(){if(r){r.remove()}var n=e.call(this,"infobox","infobox","div");r=n.widget;n.attr.add(this,"content","");n.attr.add(this,"backgroundColor","#fff");var a=null;var i=null;n.render.build=function(e){n.widget.style("display","none").style("opacity",0).on("click",function(){t.select(this).transition().duration(e).style("opacity",0).on("end",function(){r.remove()})});a=n.widget.append("div").style("position","absolute").style("top",0).style("left","50%").style("width","50%").style("padding","20px").style("margin-left","calc(-25% - 10px)").style("margin-top","100px").style("box-shadow","1px 1px 4px grey").style("border-radius","3px");i=a.append("div").style("padding","10px").style("min-height","100px").style("font-size","14pt").style("text-align","left").style("overflow","scroll")};n.render.style=function(){var e=t.color("white");n.widget.style("width","100%").style("height","100%").style("top","0").style("left","0").style("pointer-events","all").style("background-color","rgba("+e.rgb().r+","+e.rgb().g+","+e.rgb().b+",0.9)");a.style("background-color",n.attr.backgroundColor);i.style("color",n.attr.fontColor).html(n.attr.content);n.widget.style("display","block").transition().duration(400).style("opacity",1)}}return n}();r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Label=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"label","div",r);n.attr.add(this,"align","center");var a={};n.render.build=function(){a.g=n.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");a.label=a.g.append("div").style("display","table-cell").style("vertical-align","middle").style("pointer-events","none").html(n.attr.label)};n.render.style=function(){a.label.style("color",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").style("font-weight",n.attr.fontWeight).style("text-align",n.attr.align)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Legend=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"legend","div",r);n.attr.add(this,"labels",[]);n.attr.add(this,"twoColumns",false);var a={};this.highlight=function(t,e){return n.utils.highlight(this,a,".legend-entry",t,e)};n.render.build=function(){a.g=n.widget.append("div").style("display","block").style("position","relative");a.legends={};n.attr.labels.forEach(function(t){var e=a.g.append("div").attr("class","legend-entry "+n.utils.encode(t)).style("display","inline-block").style("position","relative").style("width","100%").style("margin-bottom","6px").style("vertical-align","top").style("pointer-event","all");var r=e.append("div").style("display","inline-block").style("position","relative").style("float","left");var i=e.append("div").style("display","inline-block").style("position","relative").style("float","right").text(t);a.legends[t]={g:e,square:r,text:i}})};n.render.style=function(){n.attr.colors=n.utils.colors(n.attr.labels);a.g.style("width",n.attr.width+"px").style("height",n.attr.height+"px").style("pointer-events","all");for(var t in a.legends){if(a.legends.hasOwnProperty(t)){(function(t){var e=a.legends[t];e.g.style("width",n.attr.twoColumns?"50%":"100%");e.square.style("width",.7*n.attr.fontSize+"px").style("height",.7*n.attr.fontSize+"px").style("margin",.15*n.attr.fontSize+"px "+.15*n.attr.fontSize+"px").style("background-color",n.attr.colors[t]);if(n.attr.mouseover){e.square.style("cursor","pointer").on("mouseover",function(){n.attr.mouseover(t)})}if(n.attr.mouseleave){e.square.on("mouseleave",function(){n.attr.mouseleave(t)})}if(n.attr.click){e.square.style("cursor","pointer").on("click",function(){n.attr.click(t)})}e.text.style("width","calc(100% - "+1.2*n.attr.fontSize+"px)").style("line-height",n.attr.fontSize+"px").style("cursor",n.attr.mouseover||n.attr.click?"pointer":null).on("mouseover",function(){n.attr.mouseover&&n.attr.mouseover(t)}).on("mouseleave",function(){n.attr.mouseleave&&n.attr.mouseleave(t)}).on("click",function(){n.attr.click&&n.attr.click(t)})})(t)}}}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.LineChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"linechart","svg",n);a.attr.add(this,"xType","number");var i={};var o=[];var s=false;var l={};var u={};this.data=function(t){o=t.map(function(t){return{name:t.name,values:t.values.sort(function(t,e){return t.x-e.x}).map(function(t){return{x:t.x,y:t.y,dy:t.dy||0}})}});return this};this.highlight=function(t,e){if(!s){a.utils.highlight(this,i,".line",t,e);a.utils.highlight(this,i,".error",t,e);a.utils.highlight(this,i,".marker",t,e)}return this};function c(e,r,n){var a=o.filter(function(t){return t.name===e})[0];if(!a){return null}var i=t.bisector(function(t){return t.x}).left;var s=i(a.values,r);var l=i(a.values,n);if(s===null||l===null){return null}var u=a.values[s].x,c=a.values[s].y,d=a.values[l].x,f=a.values[l].y;var p=c<f?u:d;var h=c<f?f:c;return{start:{x:u,y:c},end:{x:d,y:f},corner:{x:p,y:h}}}this.addMarker=function(t,e,r,n,o){if(u.hasOwnProperty(t)){return null}var s=c(e,r,n);var d=i.g.append("g").attr("class","marker "+a.utils.encode(e));d.append("line").attr("class","horizontal").attr("x1",i.scale.x(s.start.x)+2).attr("y1",i.scale.y(s.corner.y)).attr("x2",i.scale.x(s.end.x)+2).attr("y2",i.scale.y(s.corner.y)).style("stroke",l[e]).style("stroke-dasharray","3 3").style("stroke-width",1);d.append("line").attr("class","vertical").attr("x1",i.scale.x(s.corner.x)+2).attr("y1",i.scale.y(s.start.y)).attr("x2",i.scale.x(s.corner.x)+2).attr("y2",i.scale.y(s.end.y)).style("stroke",l[e]).style("stroke-dasharray","3 3").style("stroke-width",1);d.append("circle").attr("class","start").attr("cx",i.scale.x(s.start.x)+2).attr("cy",i.scale.y(s.start.y)).attr("r",4).style("stroke","none").style("fill",l[e]);d.append("circle").attr("class","end").attr("cx",i.scale.x(s.end.x)+2).attr("cy",i.scale.y(s.end.y)).attr("r",4).style("stroke","none").style("fill",l[e]);d.append("text").attr("x",i.scale.x(s.corner.x)+2).attr("y",i.scale.y(s.corner.y)).attr("dy",-5).attr("text-anchor",s.start.y<s.end.y?"start":"end").style("fill",a.attr.fontColor).style("font-family","inherit").style("font-size","0.9em").text(o);var f={key:e,g:d,update:function(t){var o=c(e,r,n);d.select(".horizontal").transition().duration(t).attr("x1",i.scale.x(o.start.x)+2).attr("y1",i.scale.y(o.corner.y)).attr("x2",i.scale.x(o.end.x)+2).attr("y2",i.scale.y(o.corner.y)).style("stroke",l[this.key]);d.select(".vertical").transition().duration(t).attr("x1",i.scale.x(o.corner.x)+2).attr("y1",i.scale.y(o.start.y)).attr("x2",i.scale.x(o.corner.x)+2).attr("y2",i.scale.y(o.end.y)).style("stroke",l[this.key]);d.select(".start").transition().duration(t).attr("cx",i.scale.x(o.start.x)+2).attr("cy",i.scale.y(o.start.y)).style("fill",l[this.key]);d.select(".end").transition().duration(t).attr("cx",i.scale.x(o.end.x)+2).attr("cy",i.scale.y(o.end.y)).style("fill",l[this.key]);d.select("text").transition().duration(t).attr("x",i.scale.x(o.corner.x)+2).attr("y",i.scale.y(o.corner.y)).attr("text-anchor",o.start.y<o.end.y?"start":"end").style("fill",a.attr.fontColor)}};u[t]=f;return f};this.removeMarker=function(t){if(u.hasOwnProperty(t)){u[t].g.remove();delete u[t];return true}return false};a.utils.tooltip=function(e){var r=t.bisector(function(t){return i.scale.x(t.x)}).left;var n=e?o.map(function(t){return r(t.values,e[0])}):null;if(n===null){for(var s in this.tt){if(this.tt.hasOwnProperty(s))this.tt[s].remove()}this.tt=null;return}else{this.tt=this.tt||{};var u=this.tt}var c=o.map(function(t,r){var a=n[r];var o=t.values;var s=o[a-1]?o[a-1]:o[a];var c=o[a]?o[a]:o[a-1];var d=e[0]-s.x>c.x-e[0]?c:s;u[t.name]=u[t.name]||i.g.append("circle");u[t.name].attr("cx",i.scale.x(d.x)+2).attr("cy",i.scale.y(d.y)).attr("r",4).style("fill",l[t.name]);return{name:t.name,color:l[t.name],value:d.y.toPrecision(6)}});return{title:a.attr.xLabel+": "+i.scale.x.invert(e[0]).toFixed(2),content:{type:"plots",data:c}}};a.render.build=function(){i=a.utils.standardAxis();i.plots={}};a.render.update=function(e){i.scale={x:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,a.attr.innerWidth]),y:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[a.attr.innerHeight,0])};var r=t.line().x(function(t){return i.scale.x(t.x)+2}).y(function(t){return i.scale.y(t.y)});var n=t.area().x(function(t){return i.scale.x(t.x)+2}).y0(function(t){return i.scale.y(Math.max(t.y-t.dy,0))}).y1(function(t){return i.scale.y(Math.min(t.y+t.dy,i.scale.y.domain()[1]))});i.axes.x.transition().duration(e).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(e).call(i.axisFn.y.scale(i.scale.y));l=a.utils.colors(o?o.map(function(t){return t.name}):null);i.plots.errors=i.g.selectAll(".error").data(o,function(t){return t.name});i.plots.errors.exit().transition().duration(e).style("opacity",0).remove();i.plots.errors=i.plots.errors.enter().append("path").attr("class",function(t){return"error "+a.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("stroke","none").style("fill","transparent").merge(i.plots.errors).each(function(){s=true}).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).transition().duration(e).attr("d",function(t){return n(t.values)}).style("opacity",1).style("fill-opacity",.2).style("fill",function(t){return l[t.name]});i.plots.lines=i.g.selectAll(".line").data(o,function(t){return t.name});i.plots.lines.exit().transition().duration(e).style("opacity",0).remove();i.plots.lines.enter().append("path").attr("class",function(t){return"line "+a.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","none").merge(i.plots.lines).each(function(){s=true}).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).transition().duration(e).style("opacity",1).attr("d",function(t){return r(t.values)}).style("stroke-width","2px").style("stroke",function(t){return l[t.name]}).on("end",function(){s=false});for(var c in u){if(u.hasOwnProperty(c)){u[c].update(e)}}};a.render.style=function(){i.g.attr("width",a.attr.innerWidth+"px").attr("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").style("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("topojson"),require("leaflet"),require("./math.la"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","_","topojson","leaflet","src/math.la","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Map=e(t.d3,t._,t.topojson,t.L,t.du.math.la,t.du.Widget)}})(this,function(t,e,r,n,a,i){"use strict";function o(o,s){var l="du-widgets-map";var u=i.call(this,o,"map","div",s);var c=this;u.attr.add(this,"resource",null);u.attr.add(this,"centerX",0);u.attr.add(this,"centerY",0);u.attr.add(this,"backgroundColor","white");u.attr.add(this,"foregroundColor","black");u.attr.add(this,"borderColor","white");u.attr.add(this,"outClick",null);u.attr.add(this,"tiles",null);u.attr.add(this,"noZoom",false);u.attr.add(this,"ready",null);var d=function(){var e=null;var n=null;var a=t.map();function i(i){t.json(u.attr.resource,function(o,s){e=r.feature(s.paths,s.paths["objects"]["countries"]).features;e.filter(function(t){return s.info.some(function(e){if(t.id===e.id)return t.name=e.name})}).sort(function(t,e){return t.name.localeCompare(e.name)});n=t.map();s.info.forEach(function(t){n.set(t.name,{name:t.name,capital:t.capital,population:t.population})});e.forEach(function(t,e){a.set(t.name,e)});i&&i()})}function o(t){return a.has(t)?a.get(t):null}function s(){return e.map(function(t){return{id:t.id,name:t.name}})}function l(t){return t&&n.has(t)?n.get(t).capital:n.values().map(function(t){return{name:t.name,capital:t.capital}})}function c(t){return t&&n.has(t)?n.get(t).population:n.values().map(function(t){return{name:t.name,population:t.population}})}function f(t,e){var r,n,a,i,o,s=t[0],l=t[1],u=false;for(var c=0,d=e.length-1;c<e.length;d=c++){r=e[c][0];a=e[c][1];n=e[d][0];i=e[d][1];o=a>l!==i>l&&s<(n-r)*(l-a)/(i-a)+r;if(o)u=!u}return u}function p(t,e){var r=d._id(t);if(r){var n=h._project(e);var a=d._paths()[r].svg.areas;for(var i=0;i<a.length;i++){if(f(n,a[i])){return true}}}return false}return{_paths:function(){return e},_id:o,_build:i,get:s,capital:l,population:c,containsGeoLoc:p}}();this.countries={get:d.get,capital:d.capital,population:d.population,containsGeoLoc:d.containsGeoLoc};var f=function(){var t={};function r(t,e){return u.utils.encode(t)+"__"+u.utils.encode(e)}function n(e){if(e&&t.hasOwnProperty(e)){return Object.keys(t[e])}else{return Object.keys(t)}}function a(e,r){if(!t.hasOwnProperty(e)){t[e]=r;return true}else{return false}}function i(n){if(t.hasOwnProperty(n)){e.forOwn(t[n],function(t,e){var a=r(n,e);t.forEach(function(t){if(typeof d._id(t)==="number"){h._select(t).classed(a,false)}})});return true}else{return false}}function o(){e.forOwn(t,function(t,n){e.forOwn(t,function(t,e){var a=r(n,e);t.forEach(function(t){if(typeof d._id(t)==="number"){h._select(t).classed(a,true)}})})})}return{get:n,add:a,remove:i,selector:r,_mark:o}}();this.clustering={get:f.get,add:f.add,remove:f.remove,selector:f.selector};var p=function(){var e=128;var r=.3;var n={};var a=t.zoomIdentity;var i=1;var o=t.zoom().scaleExtent([1,e]).on("zoom",p);function s(t){return a.apply(t)}function l(t){return a.invert(t)}function c(){return i}function d(){o.translateExtent([[-r*u.attr.width,-r*u.attr.height],[(1+r)*u.attr.width,(1+r)*u.attr.height]])}function f(t,e){n[t]=e}function p(){if(u.attr.noZoom){return}var e=t.event.transform.k;n.map.paths.style("stroke-width",.5/e+"px");n.map.paths.attr("transform",t.event.transform);g._zoom(t.event.transform);y._zoom(t.event.transform);m._zoom(t.event.transform);v._zoom(t.event.transform);if(t.event&&t.event.transform){a=t.zoomIdentity.translate(t.event.transform.x,t.event.transform.y).scale(t.event.transform.k);i=t.event.transform.k}}function h(){n.map.svg.transition().duration(1e3).call(o.transform,t.zoomIdentity)}function x(r){var a=r[1][0]-r[0][0],i=r[1][1]-r[0][1],s=(r[0][0]+r[1][0])/2,l=(r[0][1]+r[1][1])/2,c=Math.max(1,Math.min(e,.8/Math.max(a/u.attr.width,i/u.attr.height))),d=[u.attr.width/2-c*s,u.attr.height/2-c*l];n.map.svg.transition().duration(1e3).call(o.transform,t.zoomIdentity.translate(d[0],d[1]).scale(c))}function b(){return a}return{init:d,setLayer:f,zoom:o,reset:h,click:x,transform:s,invert:l,level:c,current:b}}();var h=function(){var e=u.widget.append("svg").attr("id",l+"-map-layer").style("position","absolute").call(p.zoom);var r=e.append("rect").attr("id","water").style("position","absolute").style("width","100%").style("height","100%").style("fill","transparent").style("top",0).style("left",0);var n=e.append("g").attr("id","land");var a=null;var i=t.geoMercator().precision(.1);var o=t.geoPath().projection(i);var s=null;function f(t){return i([t[1],t[0]])}function h(t){return i.invert(t).reverse()}function y(){d._paths().forEach(function(t){t.svg.center=o.centroid(t)})}function g(){d._paths().forEach(function(e){var r=[];var n=[];var a=e.geometry.coordinates;if(a.length===1){a[0].forEach(function(t){var a=i(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))})}else{a.forEach(function(t){t[0].forEach(function(t){var a=i(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))});if(t.length>1){t.forEach(function(t){var a=i(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))})}})}e.svg.width=t.max(r)*2;e.svg.height=t.max(n)*2})}function m(){d._paths().forEach(function(t){t.svg.areas=null;if(t.geometry.coordinates.length===1){var e=[];t.geometry.coordinates[0].forEach(function(t){e.push(i(t))});t.svg.areas=[e]}else{t.svg.areas=[];t.geometry.coordinates.forEach(function(e){var r=[];if(e.length>1){e.forEach(function(t){r.push(i(t))})}else{e[0].forEach(function(t){r.push(i(t))})}t.svg.areas.push(r)})}})}function v(){a=n.selectAll("path").data(d._paths()).enter().append("path").attr("class",function(t){return"country-"+d._id(t.name)}).style("stroke-width","0.5px").style("cursor","pointer");x();b()}function x(){if(a===null){return}i.scale(u.attr.width/(2*Math.PI)).translate([u.attr.width/2+u.attr.centerX,u.attr.height/2+u.attr.centerY]);o=t.geoPath().projection(i);d._paths().forEach(function(t){t.svg={}});y();g();m()}function b(){if(a===null){return}e.attr("width",u.attr.width+"px").attr("height",u.attr.height+"px");r.style("fill",u.attr.backgroundColor).style("width",u.attr.width+"px").style("height",u.attr.height+"px").on("click",function(){p.reset();a.classed("focus",false).style("fill",function(t){return u.attr.colors&&u.attr.colors[t.name]?u.attr.colors[t.name]:u.attr.foregroundColor});if(u.attr.outClick)u.attr.outClick()});a.attr("d",o).style("fill",function(t){return u.attr.colors&&u.attr.colors[t.name]?u.attr.colors[t.name]:u.attr.foregroundColor}).style("stroke",u.attr.borderColor).style("cursor","pointer").on("mouseover",function(e,r){t.select(this).style("fill",t.color(u.attr.colors&&u.attr.colors[e.name]?u.attr.colors[e.name]:u.attr.foregroundColor).brighter());u.attr.mouseover&&u.attr.mouseover(e.name)}).on("mouseleave",function(e,r){var n=t.select(this);var a=t.color(u.attr.colors&&u.attr.colors[e.name]?u.attr.colors[e.name]:u.attr.foregroundColor);n.style("fill",n.classed("focus")?a.brighter():a);u.attr.mouseleave&&u.attr.mouseleave(e.name)}).on("click",function(e,r){var n=t.select(this);var i=n.classed("focus");if(i)p.reset();else{p.click(o.bounds(e))}a.classed("focus",function(t){return t===e?!i:false}).style("fill",function(t){return u.attr.colors&&u.attr.colors[t.name]?u.attr.colors[t.name]:u.attr.foregroundColor});var s=t.color(u.attr.colors&&u.attr.colors[e.name]?u.attr.colors[e.name]:u.attr.foregroundColor);n.style("fill",!i?s.brighter():s);u.attr.click&&u.attr.click(e.name)});p.setLayer("map",{svg:e,paths:a,labels:s})}function w(t){if(typeof t==="string"){return d._id(t)?n.select("path.country-"+d._id(t)):n.selectAll("path."+u.utils.encode(t))}else{return a}}function k(t){a.style("opacity",t?t:1);return c}function M(e,r,n){w(e).transition().duration(n?n:0).style("fill",function(n){var a=u.attr.colors&&u.attr.colors[n.name]?u.attr.colors[n.name]:u.attr.foregroundColor;return typeof r==="string"?r:typeof e==="string"?t.color(a).brighter():a});return c}return{_select:w,_project:f,_invert:h,_build:v,_update:x,_style:b,dim:k,highlight:M}}();this.dim=h.dim;this.highlight=h.highlight;var y=function(){var t=u.widget.append("div").attr("id",l+"-static-layers").style("position","absolute").style("pointer-events","none").style("width",u.attr.width+"px").style("height",u.attr.height+"px");var r={};function n(t,e,r){return[e[0]*t[0]+r[0],e[1]*t[1]+r[1]]}function i(){return Object.keys(r)}function o(e){var i=u.utils.encode(e);if(!r.hasOwnProperty(i)){r[i]=function(){var e=t.append("canvas").attr("id",l+"-static-layer-"+i).attr("width",u.attr.width+"px").attr("height",u.attr.height+"px").style("position","absolute").style("pointer-events","none");var r=e.node().getContext("2d");var o=[];function s(t,e){f[t](e);o.push({type:t,params:e});return true}function c(t,e){var r=[1/t,1/t],i=[u.attr.centerX*(t-1)/t,(u.attr.height*(t-e)/2+u.attr.centerY*(t-1))/t];o.forEach(function(t){switch(t.type){case"dot":case"circle":t.params.pos=n(t.params.pos,r,i);break;case"arrow":for(var e=0;e<t.params.segments.length;e++){t.params.segments[e]=new a.Vector2(n(t.params.segments[e].toArray(),r,i))}break}})}function d(){o=[]}var f={dot:function(t,e){if(t.color)r.fillStyle=t.color;var n=t.size/(e?p.level():1);var a=!e?p.transform(t.pos):t.pos;r.fillRect(a[0]-n/2,a[1]-n/2,n,n)},circle:function(t,e){if(t.color)r.fillStyle=t.color;var n=t.radius/(e?p.level():1);var a=!e?p.transform(t.pos):t.pos;r.beginPath();r.arc(a[0],a[1],n,0,2*Math.PI,false);r.fill()},arrow:function(t,e){if(t.color)r.strokeStyle=t.color;var n=t.width/(e?p.level():1);var a=[];t.segments.forEach(function(t){a.push(!e?t.map(p.transform):t)});var i=n*2;var o=n*5;var s=a[a.length-2];var l=a[a.length-1];var c=l.sub(s).length(o);r.beginPath();r.lineWidth=n;r.lineJoin="round";r.moveTo(a[0].x(),a[0].y());for(var d=1;d<a.length-1;d++){if(a[d].sub(a[d-1]).length()<.6*u.attr.width)r.lineTo(a[d].x(),a[d].y());else r.moveTo(a[d].x(),a[d].y())}var f=l.sub(c.length(.5*o));r.lineTo(f.x(),f.y());r.stroke();var h=c.angle(c.angle()+Math.PI/2).length(i);var y=l.sub(c).sub(h);var g=l.sub(c).add(h);r.beginPath();r.moveTo(y.x(),y.y());r.lineTo(g.x(),g.y());r.lineTo(l.x(),l.y());r.closePath();r.fillStyle=t.color;r.fill()}};function h(){var t=p.invert([0,0]);var e=p.invert([u.attr.width,u.attr.height]);var r={xMin:t[0],xMax:e[0],yMin:t[1],yMax:e[1]};o.forEach(function(t){if(t.params.pos&&(t.params.pos[0]<r.xMin||t.params.pos[0]>r.xMax||t.params.pos[1]<r.yMin||t.params.pos[1]>r.yMax)){return}f[t.type](t.params,true)})}return{g:e,canvas:r,rescaleContent:c,clearContent:d,append:s,render:h}}();return true}else{return false}}function s(){var n=parseFloat(t.style("width"))/u.attr.width;var a=parseFloat(t.style("height"))/u.attr.height;t.style("width",u.attr.width+"px").style("height",u.attr.height+"px");e.forOwn(r,function(t){t.g.attr("width",u.attr.width+"px").attr("height",u.attr.height+"px");t.rescaleContent(n,a);t.render()});b(p.current())}function d(t){var e=u.utils.encode(t);if(r.hasOwnProperty(e)){r[e].canvas.clearRect(0,0,u.attr.width,u.attr.height);r[e].clearContent();return true}else{return false}}function f(){e.forOwn(r,function(t){t.canvas.save();t.canvas.clearRect(0,0,u.attr.width,u.attr.height)})}function g(t){var n=u.utils.encode(t);if(n&&r.hasOwnProperty(n)){e.forOwn(r,function(t,e){t.g.transition().duration(100).style("opacity",n===e?1:0)})}else{e.forOwn(r,function(t){t.g.transition().duration(100).style("opacity",1)})}return c}function m(t){e.forOwn(r,function(e){e.render(t)})}function v(){e.forOwn(r,function(t){t.canvas.restore()})}var x={dot:function(t,e,n,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var i=u.utils.encode(t);return r.hasOwnProperty(i)&&r[i].append("dot",{pos:h._project(e),size:n,color:a})},circle:function(t,e,n,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof n!=="number"||isNaN(n)||n<=0)return false;var i=u.utils.encode(t);return r.hasOwnProperty(i)&&r[i].append("circle",{pos:h._project(e),radius:n,color:a})},arrow:function(t,e,n,i,o){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!n||n.length<2||typeof n[0]!=="number"||typeof n[1]!=="number")return false;if(typeof i!=="number")return false;var s=u.utils.encode(t);if(r.hasOwnProperty(s)){var l=new a.LatLon(e).toVec(),c=new a.LatLon(n).toVec(),d=l.cross(c).cross(l).length(1),f=Math.acos(l.dot(c));var p=1,y=100,g=i*5,m=new a.Vector2(h._project(e)),v=new a.Vector2(h._project(n)),x=m,b=[x];do{var w=new a.Vector2(h._project(l.multiply(Math.cos((p+1)*f/y)).add(d.multiply(Math.sin((p+1)*f/y))).toLatLon().toArray()));p++;x=w;b.push(w)}while(p<y&&w.sub(v).length()>g);b.push(v);r[s].append("arrow",{segments:b,width:i,color:o});return true}else{return false}}};function b(t){y._clear();e.forOwn(r,function(e){e.canvas.translate(t.x,t.y);e.canvas.scale(t.k,t.k)});y._render(t.k);y._restore()}return{_style:s,_zoom:b,_clear:f,_restore:v,_render:m,get:i,add:o,highlight:g,erase:d,draw:x}}();this.staticLayer={get:y.get,add:y.add,erase:y.erase,highlight:y.highlight,draw:y.draw};var g=function(){var e=u.widget.append("div").attr("id",l+"-tiles-layer").style("position","absolute").style("pointer-events","none").style("z-index",99).style("opacity",.5).style("width",u.attr.width+"px").style("height",u.attr.height+"px");var r=null;function a(t){return h._invert([t[0]-.5*u.attr.width,t[1]+.5*u.attr.height])}function i(t){return Math.log(.00391382924*t*u.attr.width)/Math.log(2)}function o(){if(u.attr.tiles===null){return}if(!this.headerAdded){t.select("head").append("link").attr("rel","stylesheet").attr("href","https://unpkg.com/leaflet@1.3.1/dist/leaflet.css").attr("integrity","sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==").attr("crossorigin","");this.headerAdded=true}r=n.map(l+"-tiles-layer",{attributionControl:false,zoomSnap:0,zoomControl:false}).setView(a([0,0]),i(p.level()));var e=null,o=null;switch(u.attr.tiles){case"cartodb-positron":e="https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";o="abcd";break}if(e&&o){n.tileLayer(e,{subdomains:o}).addTo(r)}}function s(){if(r===null){return}e.style("width",u.attr.width+"px").style("height",u.attr.height+"px");r.invalidateSize()}function c(t){if(r===null){return}r.setView(a([-t.x/t.k-.5*(t.k-1)*u.attr.width/t.k,-t.y/t.k-.5*(t.k-1)*u.attr.height/t.k]),i(t.k),true)}return{_build:o,_style:s,_getLatLon:a,_getZoom:i,_zoom:c}}();var m=function(){var r=u.widget.append("div").attr("id",l+"-dynamic-layers").style("position","absolute").style("pointer-events","none");var n={};function i(){return Object.keys(n)}function o(e){var a=u.utils.encode(e);if(!n.hasOwnProperty(a)){n[a]=function(){var e=r.append("svg").attr("id",l+"-dynamic-layer-"+a).attr("width",u.attr.width+"px").attr("height",u.attr.height+"px").style("position","absolute").style("pointer-events","none").append("g");var n=[];function i(t){n.push({elem:t,birth:(new Date).getTime()/1e3})}setInterval(function(){var e=(new Date).getTime()/1e3;var r=[];n.forEach(function(n){if(e-n.birth>10){n.elem.transition().duration(700).style("opacity",0).on("end",function(){t.select(this).remove()})}else{r.push(n)}});n=r},2e3);return{g:e,append:i}}();return true}else{return false}}function s(){r.style("width",u.attr.width+"px").style("height",u.attr.height+"px");e.forOwn(n,function(t){t.g.attr("width",u.attr.width+"px").attr("height",u.attr.height+"px")})}function d(t){var e=u.utils.encode(t);if(n.hasOwnProperty(e)){n[e].g.html("");return true}else{return false}}function f(t){var r=u.utils.encode(t);if(r&&n.hasOwnProperty(r)){e.forOwn(n,function(t,e){t.g.transition().duration(200).style("opacity",r===e?1:0)})}else{e.forOwn(n,function(t){t.g.transition().duration(200).style("opacity",1)})}return c}var y={circle:function(e,r,a,i,o,s){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof a!=="number"||isNaN(a)||a<=0)return false;var l=u.utils.encode(e);if(n.hasOwnProperty(l)){var c=a/p.level();var d=h._project(r);var f=n[l].g.append("circle").attr("class","circle").attr("cx",d[0]).attr("cy",d[1]).attr("r",c).style("fill",i);n[l].append(f);f.transition().duration(o?o:700).ease(t.easeExp).attr("r",0).on("end",function(){s&&s();t.select(this).remove()});return true}else{return false}},arrow:function(e,r,i,o,s,l,c){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(!i||i.length<2||typeof i[0]!=="number"||typeof i[1]!=="number")return false;if(typeof o!=="number")return false;var d=u.utils.encode(e);if(n.hasOwnProperty(d)){var f=100;var y=null;var g=null;var m=new a.Vector2(h._project(r));var v=new a.Vector2(h._project(i));var x=o/p.level();var b=x*2;var w=x*5;y=n[d].g.append("path").style("fill","none").style("stroke",s).style("stroke-width",x).attr("d","M"+m.x()+","+m.y());g=n[d].g.append("path").style("fill",s).style("stroke","none");var k=new a.LatLon(r).toVec();var M=new a.LatLon(i).toVec();var z=k.cross(M).cross(k).length(1);var A=Math.acos(k.dot(M));var P=1;var O=m;var _=(typeof l==="number"?l:700)/f;var C=setInterval(function(){var e=new a.Vector2(h._project(k.multiply(Math.cos((P+1)*A/f)).add(z.multiply(Math.sin((P+1)*A/f))).toLatLon().toArray()));y.attr("d",y.attr("d")+(e.sub(O).length()<.5*u.attr.width?"L":"M")+e.x()+","+e.y());if(e.sub(O).length()<.5*u.attr.width){var r=e.sub(O).length(1);var n=r.angle(r.angle()+Math.PI/2).multiply(b);var i=e.sub(n);var o=e.add(n);var s=e.add(r.multiply(w));g.attr("d","M"+i.x()+","+i.y()+"L"+o.x()+","+o.y()+"L"+s.x()+","+s.y()+"Z")}if(e.sub(v).length()>w){P++;O=e}else{clearInterval(C);r=v.sub(e).length(1);n=r.angle(r.angle()+Math.PI/2).multiply(b);i=v.sub(r.multiply(w)).sub(n);o=v.sub(r.multiply(w)).add(n);g.transition().duration(_).attr("d","M"+i.x()+","+i.y()+"L"+o.x()+","+o.y()+"L"+v.x()+","+v.y()+"Z").on("end",function(){c&&c();y.transition().duration(1e3).style("opacity",0).on("end",function(){t.select(this).remove()});t.select(this).transition().duration(1e3).style("opacity",0).on("end",function(){t.select(this).remove()})})}},_);return true}else{return false}}};function g(t){e.forOwn(n,function(e){e.g.attr("transform",t)})}return{_style:s,_zoom:g,get:i,add:o,highlight:f,erase:d,draw:y}}();this.dynamicLayer={get:m.get,add:m.add,highlight:m.highlight,erase:m.erase,draw:m.draw};var v=function(){var t=u.widget.append("svg").attr("id",l+"-touch-layer").attr("width",u.attr.width+"px").attr("height",u.attr.height+"px").style("position","absolute").style("pointer-events","none");var e=t.append("g");function r(t,r,n,a,i,o){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;var s=n/p.level();var u=h._project(r);e.append("circle").attr("id",l+"-touch-layer-"+t).attr("cx",u[0]).attr("cy",u[1]).attr("r",s).style("fill",null).style("opacity",0).style("pointer-events","all").on("mouseover",function(t,e){if(a)a(t,e)}).on("mouseleave",function(t,e){if(i)i(t,e)}).on("click",function(t,e){if(o)o(t,e)});return true}function n(t){var r=e.select("#"+t);if(r.empty())return false;else{r.remove();return true}}function a(){t.style("width",u.attr.width+"px").style("height",u.attr.height+"px");e.style("width",u.attr.width+"px").style("height",u.attr.height+"px")}function i(t){e.attr("transform",t)}function o(){e.html("")}return{_style:a,_zoom:i,add:r,remove:n,erase:o}}();this.touchLayer={add:v.add,remove:v.remove,erase:v.erase};u.render.build=function(){d._build(function(){h._build();g._build();u.attr.ready&&u.attr.ready()})};u.render.update=function(){h._update()};u.render.style=function(){u.widget.style("background-color",u.attr.backgroundColor).style("pointer-events",null);p.init();h._style();y._style();m._style();g._style();v._style();f._mark()}}o.prototype=Object.create(i.prototype);return o});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Picture=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"picture","div",r);n.attr.add(this,"src","");var a={};var i=null;n.render.build=function(){a.g=n.widget.append("div").style("width",n.attr.width>0?n.attr.width:null).style("height",n.attr.height>0?n.attr.height:null).style("position","relative").style("pointer-events","all");i=new Image;i.onload=function(){var t=i.width/i.height;var e=n.attr.width/n.attr.height;var r=t>e?n.attr.width:n.attr.height*t;var o=t<e?n.attr.height:n.attr.width/t;a.g.style("background-image","url("+n.attr.src+")").style("background-repeat","none").style("background-size",r+"px "+o+"px").style("width",r+"px").style("height",o+"px").style("margin-left",(n.attr.width-r)/2+"px").style("margin-top",(n.attr.height-o)/2+"px").on("mouseover",function(){n.attr.mouseover&&n.attr.mouseover(i)}).on("mouseleave",function(){n.attr.mouseleave&&n.attr.mouseleave(i)}).on("click",function(){n.attr.click&&n.attr.click(i)})}};n.render.style=function(){if(n.attr.src){i.src=n.attr.src}}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.PieChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"piechart","svg",n);a.attr.add(this,"innerRadius",0,"dim");a.attr.add(this,"outerRadius",50,"dim");a.attr.add(this,"ticks",false);var i={};var o=[];var s={};var l=null;var u=false;function c(t){return t.data?t.data.name:""}function d(t,e,r,n){var a;return(a=f(t,e,r,n))?{startAngle:a.endAngle,endAngle:a.endAngle}:(a=p(t,e,r,n))?{startAngle:a.startAngle,endAngle:a.startAngle}:null}function f(t,e,r,n){var a=e.length;while(--t>=0){var i=n(r[t]);for(var o=0;o<a;++o){if(n(e[o])===i)return e[o]}}}function p(t,e,r,n){var a=r.length,i=e.length;while(++t<a){var o=n(r[t]);for(var s=0;s<i;++s){if(n(e[s])===o)return e[s]}}}function h(e){var r=t.interpolate(this._current,e);this._current=r(0);return function(t){return i.arc(r(t))}}function y(e){var r=t.interpolate(this._current,e);this._current=r(0);return function(t){return"translate("+i.arcLabel.centroid(r(t))+")"}}this.data=function(t){o=t;return this};this.highlight=function(t,e){if(!u){a.utils.highlight(this,i,"path",t,e);a.utils.highlight(this,i,"text",t,e)}return this};a.utils.tooltip=function(){return l?{title:l.name,stripe:a.attr.colors[l.name],content:{type:"metrics",data:[{label:"value:",value:l.value.toFixed(6)},{label:"fraction:",value:(100*l.value/t.sum(o,function(t){return t.value})).toFixed(1)+"%"}]}}:null};a.render.build=function(){i.g=a.widget.append("g");i.label=i.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white")};a.render.update=function(e){i.arc=t.arc().outerRadius(a.attr.outerRadius-a.attr.margins.left).innerRadius(a.attr.innerRadius);i.arcLabel=t.arc().outerRadius(.5*(a.attr.innerRadius+a.attr.outerRadius-a.attr.margins.left)).innerRadius(.5*(a.attr.innerRadius+a.attr.outerRadius-a.attr.margins.left));var r=t.pie().value(function(t){return t.value}).sort(null);s=a.utils.colors(o?o.map(function(t){return t.name}):null);var n=i.g.selectAll(".slice");var f=i.g.selectAll(".label");var p=n.data(),g=r(o);n=n.data(g,c);n.exit().datum(function(t,e){return d(e,g,p,c)||t}).transition().duration(e).attrTween("d",h).remove();n.enter().append("path").attr("class",function(t){return"slice "+a.utils.encode(t.data.name)}).each(function(t,e){this._current=d(e,p,g,c)||t}).style("pointer-events","all").style("fill",function(t){return s[t.data.name]}).merge(n).each(function(){u=true}).on("mouseover",function(t){l=t.data;a.attr.mouseover&&a.attr.mouseover(t.data.name)}).on("mouseleave",function(t){l=null;a.attr.mouseleave&&a.attr.mouseleave(t.data.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.data.name)}).transition().duration(e).style("opacity",1).style("fill",function(t){return s[t.data.name]}).attrTween("d",h).on("end",function(){u=false});f=f.data(g,c);f.exit().datum(function(t,e){return d(e,g,p,c)||t}).transition().duration(e).style("opacity",0).attrTween("transform",y).remove();f.enter().append("text").attr("class",function(t){return"label "+a.utils.encode(t.data.name)}).each(function(t,e){this._current=d(e,p,g,c)||t}).merge(f).attr("dy","0.35em").style("text-anchor","middle").style("pointer-events","none").attr("fill",a.attr.fontColor).text(function(e){return a.attr.tickFormat(100*e.data.value/t.sum(g,function(t){return t.value}))}).transition().duration(e).attrTween("transform",y)};a.render.style=function(){a.attr.colors=a.utils.colors(o?o.map(function(t){return t.name}):null);var t=a.attr.outerRadius-a.attr.margins.left;a.attr.width=2*a.attr.outerRadius;a.attr.height=2*a.attr.outerRadius;a.widget.style("width",a.attr.width+"px").style("height",a.attr.height+"px");i.g.attr("transform","translate("+a.attr.outerRadius+","+a.attr.outerRadius+")");i.label.attr("transform","translate(0,"+a.attr.outerRadius+")").style("width",10+2*a.attr.outerRadius+"px").style("font-size",Math.min(16,a.attr.outerRadius*.4)+"px").style("fill",a.attr.fontColor).text(a.attr.label)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ProgressBar=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"progressbar","div",r);var a={};this.percentage=function(t){a.bar.style("width",t+"%");return this};n.render.build=function(){a.g=n.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");a.container=a.g.append("div").style("display","table-cell").style("vertical-align","middle").style("pointer-events","none").style("height","50px");a.label=a.container.append("div").style("display","block").style("text-align","center").style("pointer-events","none");a.barTrack=a.container.append("div").style("display","block").style("width","100%").style("height","1px").style("bottom","0");a.bar=a.barTrack.append("div").style("display","block").style("float","left").style("width","43%").style("height","100%").style("background-color","dodgerblue")};n.render.style=function(){a.label.style("color",n.attr.fontColor).text(n.attr.label);a.bar.style("background-color",n.attr.fontColor)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ScatterPlot=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"scatterplot","svg",n);a.attr.add(this,"opacity",.4);var i={};var o=[];var s={};var l=null;var u=false;this.data=function(t){o=t;return this};this.highlight=function(t,e){if(!u)a.utils.highlight(this,i,".dot-group",t,e);return this};a.utils.tooltip=function(t){if(!t){this.tt&&this.tt.remove();this.tt=null;return null}var e=l.find(t[0],t[1],10);if(!e){this.tt&&this.tt.remove();this.tt=null;return}this.tt=this.tt||i.g.append("circle");this.tt.attr("r",6).attr("cx",e.data[0]).attr("cy",e.data[1]).style("pointer-events","none").style("stroke",a.attr.stroke).style("fill",s[e.data.name]);return{title:e.data.name,stripe:s[e.data.name],content:{type:"metrics",data:[{label:a.attr.xLabel+":",value:e.data[0].toPrecision(4)},{label:a.attr.yLabel+":",value:e.data[1].toPrecision(4)}]}}};a.render.build=function(){i=a.utils.standardAxis();i.plots={}};a.render.update=function(e){i.scale={x:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,a.attr.innerWidth]),y:a.utils.scale(o.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}),[a.attr.innerHeight,0])};i.axes.x.transition().duration(e).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(e).call(i.axisFn.y.scale(i.scale.y));s=a.utils.colors(o?o.map(function(t){return t.name}):null);i.plots.groups=i.g.selectAll(".dot-group").data(o,function(t){return t.name});i.plots.groups.exit().transition().duration(e).remove();var r=i.plots.groups.enter().append("g").attr("class",function(t){return"dot-group "+a.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent");i.plots.groups=r.merge(i.plots.groups).each(function(){u=true}).on("mouseover",function(t){a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)});i.plots.groups.transition().duration(e).style("fill-opacity",a.attr.opacity).style("fill",function(t){return s[t.name]}).on("end",function(){u=false});i.plots.dots=i.plots.groups.selectAll(".dot").data(function(t){return t.values});i.plots.dots.exit().transition().duration(e).style("opacity",0).remove();i.plots.dots.enter().append("circle").attr("class","dot").style("opacity",0).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)}).merge(i.plots.dots).transition().duration(e).style("opacity",1).attr("r",3).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)});var n=[];o.forEach(function(t){t.values.forEach(function(e){var r=[i.scale.x(e.x),i.scale.y(e.y)];r.name=t.name;n.push(r)})});var c=t.voronoi().extent([[-1,-1],[a.attr.width+1,a.attr.height+1]]);l=c(n)};a.render.style=function(){a.attr.colors=a.utils.colors(o[0]?t.keys(o[0].y):null);i.g.attr("width",a.attr.innerWidth+"px").attr("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");i.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");i.axisFn.y.tickFormat(a.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Slider=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"slider","svg",n);a.attr.add(this,"min",0);a.attr.add(this,"max",1);a.attr.add(this,"step",0);a.attr.add(this,"callback",null);var i={};var o={right:20,left:20};var s=false;var l=[];var u=null;a.render.build=function(){l=[a.attr.min,a.attr.max];u=t.scaleLinear().domain(l).range([0,a.attr.width-o.left-o.right]).clamp(true);if(a.attr.step){s=true;l=[];for(var e=a.attr.min;e<=a.attr.max;e+=a.attr.step){l.push(e)}u=t.scalePoint().domain(l).range([0,a.attr.width-o.left-o.right])}i.g=a.widget.append("g").attr("transform","translate("+o.left+",20)");i.track=i.g.append("line").attr("stroke-linecap","round").attr("stroke",a.attr.fontColor).attr("stroke-width","9px").attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.inset=i.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("stroke","white").style("opacity",.9).style("stroke-width","8px");i.overlay=i.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","stroke").style("cursor","pointer").style("stroke","transparent").style("stroke-width","50px").call(t.drag().on("start drag",function(){var e=null;if(s){var r=t.event.x;e=l.reduce(function(t,e){return Math.abs(u(e)-r)<Math.abs(u(t)-r)?e:t})}else{e=u.invert(t.event.x)}i.handle.attr("cx",u(e));a.attr.callback&&a.attr.callback(e)}));i.axis=i.g.insert("g",".track-overlay").style("font-size","10px").attr("font-family","inherit").attr("transform","translate(0,"+18+")");i.ticks=i.axis.selectAll("text").data(s?l:u.ticks(5)).enter().append("text").attr("x",u).attr("text-anchor","middle").attr("font-family","inherit").text(function(t){return t});i.handle=i.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",8)};a.render.style=function(){a.widget.style("width",a.attr.width+"px");a.widget.style("height",50+"px");u.range([0,a.attr.width-o.left-o.right]);i.track.attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.inset.attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.overlay.attr("x1",u.range()[0]).attr("x2",u.range()[1]);i.ticks.attr("x",u).attr("font-size",a.attr.fontSize+"px").attr("fill",a.attr.fontColor);i.handle.style("stroke",a.attr.fontColor)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Status=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var n=e.call(this,t,"status","div",r);n.attr.add(this,"value","");var a={};n.render.build=function(){a.g=n.widget.append("div").style("position","absolute").style("width","100%").style("height","100%").style("display","table");a.label=a.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","25%").style("pointer-events","none").text(n.attr.label);a.status=a.g.append("div").style("display","table-cell").style("position","relative").style("vertical-align","middle").style("width","75%").style("text-align","right").style("pointer-events","none")};n.render.style=function(){n.widget.style("font-size",n.attr.fontSize+"px").style("pointer-events","none");for(var t in n.attr.margins){if(n.attr.margins.hasOwnProperty(t)){n.widget.style("margin-"+t,n.attr.margins[t]+"px")}}for(t in n.attr.borders){if(n.attr.borders.hasOwnProperty(t)){n.widget.style("border-"+t,n.attr.borders[t])}}a.label.style("color",n.attr.fontColor).style("font-weight",n.attr.fontWeight);a.status.style("color",n.attr.fontColor).style("font-weight",n.attr.fontWeight).text(n.attr.value)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.TrackPad=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"slider","svg",n);a.attr.add(this,"xRange",[0,1]);a.attr.add(this,"yRange",[0,1]);a.attr.add(this,"callback",null);a.attr.add(this,"guide",false);var i={};var o=null;a.render.build=function(){o={x:t.scaleLinear().domain(a.attr.xRange).range([0,a.attr.width-a.attr.margins.left-a.attr.margins.right]).clamp(true),y:t.scaleLinear().domain(a.attr.yRange).range([0,a.attr.height-a.attr.margins.top-a.attr.margins.bottom]).clamp(true)};i.g=a.widget.append("g").attr("transform","translate("+a.attr.margins.left+",20)");i.track=i.g.append("rect").attr("rx","3").attr("ry","3").attr("x",o.x.range()[0]).attr("y",o.y.range()[0]).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom+"px");i.inset=i.track.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).style("fill","white").style("opacity",.9).attr("rx","2.5").attr("ry","2.5").attr("x",o.x.range()[0]+.5).attr("y",o.y.range()[0]+.5).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right-1+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom-1+"px");if(a.attr.guide){i.guide={h:i.g.append("line").attr("x1",o.x.range()[0]).attr("y1",o.y.range()[0]).attr("x2",o.x.range()[1]).attr("y2",o.y.range()[0]).attr("stroke-dasharray","3, 6").style("stroke",a.attr.fontColor).style("stroke-width","1px"),v:i.g.append("line").attr("x1",o.x.range()[0]).attr("y1",o.y.range()[0]).attr("x2",o.x.range()[0]).attr("y2",o.y.range()[1]).attr("stroke-dasharray","3, 6").style("stroke-width","1px")}}i.overlay=i.inset.select(function(){return this.parentNode.appendChild(this.cloneNode(true))}).attr("class","track-overlay").style("pointer-events","all").style("cursor","pointer").style("fill","transparent").call(t.drag().on("start drag",function(){var e=o.x.invert(t.event.x),r=o.y.invert(t.event.y);i.handle.attr("cx",o.x(e)).attr("cy",o.y(r));if(i.guide){i.guide.h.attr("x1",o.x.range()[0]).attr("y1",o.y(r)).attr("x2",o.x.range()[1]).attr("y2",o.y(r));i.guide.v.attr("x1",o.x(e)).attr("y1",o.y.range()[0]).attr("x2",o.x(e)).attr("y2",o.y.range()[1])}a.attr.callback&&a.attr.callback(e,r)}));i.axis={x:i.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none"),y:i.g.append("g").attr("class","x axis").style("font-family","inherit").style("fill","none")};i.handle=i.g.insert("circle",".track-overlay").style("fill","white").style("stroke-width","0.5px").attr("r",7)};a.render.style=function(){a.widget.style("width",a.attr.width+"px");a.widget.style("height",a.attr.height+"px");o.x.range([0,a.attr.width-a.attr.margins.left-a.attr.margins.right]);o.y.range([0,a.attr.height-a.attr.margins.top-a.attr.margins.bottom]);i.track.style("fill",a.attr.fontColor).attr("x",o.x.range()[0]).attr("y",o.y.range()[0]).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom+"px");i.inset.attr("x",o.x.range()[0]+.5).attr("y",o.y.range()[0]+.5).attr("width",a.attr.width-a.attr.margins.left-a.attr.margins.right-1+"px").attr("height",a.attr.height-a.attr.margins.top-a.attr.margins.bottom-1+"px");if(a.attr.guide){i.guide.h.style("stroke",a.attr.fontColor);i.guide.v.style("stroke",a.attr.fontColor)}i.overlay.attr("x",o.x.range()[0]-a.attr.margins.left+10).attr("y",o.y.range()[0]-a.attr.margins.top+10).attr("width",a.attr.width-20+"px").attr("height",a.attr.height-20+"px");i.axis.x.attr("transform","translate(-1,"+(a.attr.height-a.attr.margins.bottom-30)+")").call(t.axisBottom().ticks(5).scale(o.x));i.axis.y.call(t.axisLeft().ticks(5).scale(o.y));i.g.selectAll("path").style("fill","none").style("stroke","none");i.g.selectAll(".tick > line").style("fill","none").style("stroke","none");i.g.selectAll("text").attr("font-size",a.attr.fontSize+"px").attr("fill",a.attr.fontColor);i.handle.style("stroke",a.attr.fontColor)}}r.prototype=Object.create(e.prototype);return r});(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.ViolinPlot=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,n){var a=e.call(this,r,"violinplot","svg",n);function i(e,r){return function(n){return r.map(function(r){return{x:r,y:t.mean(n,function(t){return e(r-t)})}})}}function o(t){return function(e){return Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}}var s={};var l=[];var u=null;var c=0;var d=1;var f={};var p=false;this.data=function(e){var r=e.reduce(function(t,e){return t.concat(e.values)},[]);c=t.min(r);d=t.max(r);l=e.map(function(e){var r=e.values.sort(t.ascending),n=t.min(r),s=t.max(r),l=t.quantile(r,.25),u=t.quantile(r,.75),f=.2*(s-n);var p=i(o(.05*(s-n)),t.range(21).map(function(t){return(s-n+2*f)*t/20+(n-f)}));var h=p(e.values);return{name:e.name,scale:{x:t.scaleLinear().domain([c,d]).range([a.attr.innerHeight,0]),y:t.scaleLinear().range([10,0]).domain([0,t.max(h,function(t){return t.y})])},values:{min:n,max:s,mean:t.mean(r),median:t.median(r),q1:l,q3:u,data:h}}});return this};this.highlight=function(t,e){if(!p)a.utils.highlight(this,s,".violin",t,e);return this};a.utils.tooltip=function(){return u?{title:u.name,stripe:a.attr.colors[u.name],content:{type:"metrics",data:[{label:"min/max:",value:u.values.min.toPrecision(3)+"/"+u.values.max.toPrecision(3)},{label:"mean:",value:u.values.mean.toPrecision(3)},{label:"median:",value:u.values.median.toPrecision(3)},{label:"Q1:",value:u.values.q1.toPrecision(3)},{label:"Q3:",value:u.values.q3.toPrecision(3)}]}}:null};a.render.build=function(){s=a.utils.standardAxis();s.plots={}};a.render.update=function(e){s.scale={x:a.utils.scale(l.map(function(t){return t.name}).reverse(),[a.attr.innerWidth,0],"point"),y:a.utils.scale(l.map(function(t){return[t.values.min-.1*(t.values.max-t.values.min),t.values.max+.1*(t.values.max-t.values.min)]}).reduce(function(t,e){return t.concat(e)},[]),[a.attr.innerHeight,0])};s.axes.x.transition().duration(e).call(s.axisFn.x.scale(s.scale.x));s.axes.y.transition().duration(e).call(s.axisFn.y.scale(s.scale.y));f=a.utils.colors(l?l.map(function(t){return t.name}):null);s.plots.groups=s.g.selectAll(".box-group").data(l,function(t){return t.name});s.plots.groups.exit().style("opacity",0).remove();var r=s.plots.groups.enter().append("g").attr("class",function(t){return"box-group "+a.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var n=r.merge(s.plots.groups).each(function(){p=true}).on("mouseover",function(t){u=t;a.attr.mouseover&&a.attr.mouseover(t.name)}).on("mouseleave",function(t){u=null;a.attr.mouseleave&&a.attr.mouseleave(t.name)}).on("click",function(t){a.attr.click&&a.attr.click(t.name)}).attr("transform",function(t){return"translate("+s.scale.x(t.name)+",0)"});n.transition().duration(e).attr("transform",function(t){return"translate("+s.scale.x(t.name)+",0)"}).style("opacity",1).style("fill-opacity",.3).style("fill",function(t){return f[t.name]}).style("stroke",function(t){return f[t.name]}).on("end",function(){p=false});r.append("path").attr("transform","rotate(90) translate(0,-"+(10+.5)+")");n.select("path").transition().duration(e).attr("d",function(e){e.scale.x.range([a.attr.innerHeight,0]);var r=t.area().curve(t.curveBasis).x(function(t){return e.scale.x(Math.min(d,Math.max(c,t.x)))}).y0(function(t){return e.scale.y(-t.y)}).y1(function(t){return e.scale.y(t.y)});return r(e.values.data)}).attr("transform","rotate(90) translate(0,-"+(10+.5)+")")};a.render.style=function(){a.attr.colors=a.utils.colors(l?l.map(function(t){return t.name}):null);s.g.style("width",a.attr.innerWidth+"px").style("height",a.attr.innerHeight+"px").attr("transform","translate("+a.attr.margins.left+","+a.attr.margins.top+")").style("pointer-events","all");s.axes.x.attr("transform","translate(0,"+a.attr.innerHeight+")");s.axisFn.y.tickFormat(a.attr.yTickFormat);s.axes.y.attr("transform","translate(0,"+1+")");s.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");s.labels.x.attr("x",a.attr.innerWidth+"px").attr("y",a.attr.innerHeight+2.2*a.attr.fontSize+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.xLabel);s.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",a.attr.fontColor).style("font-size",a.attr.fontSize+"px").text(a.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});