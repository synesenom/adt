(function(e,t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],t)}else{e.du=e.du||{};e.du.widgets=e.du.widgets||{};e.du.widgets.SemiCircularGauge=t(e.d3,e.du.Widget)}})(this,function(i,c){"use strict";function e(e,t){var d=c.call(this,e,"semicirculargauge","svg",t);d.attr.add(this,"min",0);d.attr.add(this,"max",1);d.attr.add(this,"segments",4);d.attr.add(this,"gap",6);d.attr.add(this,"thickness",.2);var s={};var l=null;var a=null;var o=0;var n=undefined;function g(){var e=d.attr.gap*Math.PI/180,t=Math.PI-(d.attr.segments-1)*e,n=t/d.attr.segments;var a=d.attr.innerWidth/2,r=a*d.attr.thickness;var i=a*.1,s=a-1.5*r;return{angles:{gap:e,segment:n},sizes:{radius:a,thickness:r},needle:{width:i,length:s,angle:Math.acos(i/s)}}}function u(e,t){var n=[-e.needle.length*Math.cos(t),-e.needle.length*Math.sin(t)],a=[e.needle.width*Math.cos(t-e.needle.angle),e.needle.width*Math.sin(t-e.needle.angle)],r=[e.needle.width*Math.cos(t+e.needle.angle),e.needle.width*Math.sin(t+e.needle.angle)];return"M0,0L"+a.join(",")+"L"+n.join(",")+"L"+r.join(",")+"Z"}function r(e,t){if(e===null){s.needlePointer.attr("d","");return}var n=g();var a=this;var r=l(o);var i=l(e);s.needlePointer.transition().duration(t).tween("progress",function(){return function(e){var t=r+(i-r)*e;return s.needlePointer.attr("d",u.call(a,n,t))}}).on("end",function(){o=e})}this.position=function(e){n=e;return this};d.render.build=function(){l=i.scaleLinear().domain([d.attr.min,d.attr.max]).range([0,Math.PI]).clamp(true);s.g=d.widget.append("g");a=i.interpolateHsl(d.attr.colors?d.attr.colors[0]:"#e41a1c",d.attr.colors?d.attr.colors[1]:"#4daf4a");s.segments=[];var e=g();for(var t=0;t<d.attr.segments;t++){var n=i.arc().outerRadius(e.sizes.radius).innerRadius(e.sizes.radius-e.sizes.thickness).startAngle(-Math.PI/2+t*(e.angles.segment+e.angles.gap)).endAngle(-Math.PI/2+(t+1)*(e.angles.segment+e.angles.gap)-e.angles.gap);s.segments.push(s.g.append("path").attr("d",n).style("fill",a(t/(d.attr.segments-1))))}s.needle=s.g.append("g").style("fill",d.attr.fontSize);s.needleCenter=s.needle.append("circle").attr("cx",0).attr("cy",0).attr("r",e.needle.width+"px");s.needlePointer=s.needle.append("path");r(0,0)};d.render.update=function(e){l=i.scaleLinear().domain([d.attr.min,d.attr.max]).range([0,Math.PI]).clamp(true);a=i.interpolateHsl(d.attr.colors?d.attr.colors[0]:"#e41a1c",d.attr.colors?d.attr.colors[1]:"#4daf4a");if(typeof n!=="undefined"){r(n,e);n=undefined}};d.render.style=function(){d.widget.style("width",d.attr.width+"px");d.widget.style("height",d.attr.height+"px");s.g.attr("transform","translate("+d.attr.width/2+","+.5*(d.attr.height+d.attr.innerWidth/2)+")")}}e.prototype=Object.create(c.prototype);return e});