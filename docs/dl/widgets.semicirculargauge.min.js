(function(e,t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],t)}else{e.du=e.du||{};e.du.widgets=e.du.widgets||{};e.du.widgets.SemiCircularGauge=t(e.d3,e.du.Widget)}})(this,function(i,a){"use strict";function e(e,t){var s=a.call(this,e,"semicirculargauge","svg",t);s.attr.add(this,"min",0);s.attr.add(this,"max",1);s.attr.add(this,"segments",4);s.attr.add(this,"gap",6);s.attr.add(this,"thickness",.2);var d={};var l=null;var o=0;var n=undefined;function g(){var e=s.attr.gap*Math.PI/180,t=Math.PI-(s.attr.segments-1)*e,n=t/s.attr.segments;var a=s.attr.innerWidth/2,r=a*s.attr.thickness;var i=a*.1,d=a-1.5*r;return{angles:{gap:e,segment:n},sizes:{radius:a,thickness:r},needle:{width:i,length:d,angle:Math.acos(i/d)}}}function u(e,t){var n=[-e.needle.length*Math.cos(t),-e.needle.length*Math.sin(t)],a=[e.needle.width*Math.cos(t-e.needle.angle),e.needle.width*Math.sin(t-e.needle.angle)],r=[e.needle.width*Math.cos(t+e.needle.angle),e.needle.width*Math.sin(t+e.needle.angle)];return"M0,0L"+a.join(",")+"L"+n.join(",")+"L"+r.join(",")+"Z"}function r(e,t){if(e===null){d.needlePointer.attr("d","");return}var n=g();var a=this;var r=l(o);var i=l(e);d.needlePointer.transition().duration(t).tween("progress",function(){return function(e){var t=r+(i-r)*e;return d.needlePointer.attr("d",u.call(a,n,t))}}).on("end",function(){o=e})}this.position=function(e){n=e;return this};s.render.build=function(){l=i.scaleLinear().domain([s.attr.min,s.attr.max]).range([0,Math.PI]).clamp(true);d.g=s.widget.append("g");var e=i.interpolateHsl(s.attr.colors?s.attr.colors[0]:"#e41a1c",s.attr.colors?s.attr.colors[1]:"#4daf4a");d.segments=[];var t=g();for(var n=0;n<s.attr.segments;n++){var a=i.arc().outerRadius(t.sizes.radius).innerRadius(t.sizes.radius-t.sizes.thickness).startAngle(-Math.PI/2+n*(t.angles.segment+t.angles.gap)).endAngle(-Math.PI/2+(n+1)*(t.angles.segment+t.angles.gap)-t.angles.gap);d.segments.push(d.g.append("path").attr("d",a).style("fill",e(n/(s.attr.segments-1))))}d.needle=d.g.append("g").style("fill",s.attr.fontSize);d.needleCenter=d.needle.append("circle").attr("cx",0).attr("cy",0).attr("r",t.needle.width+"px");d.needlePointer=d.needle.append("path");r(0,0)};s.render.update=function(e){if(typeof n!=="undefined"){r(n,e);n=undefined}};s.render.style=function(){s.widget.style("width",s.attr.width+"px");s.widget.style("height",s.attr.height+"px");d.g.attr("transform","translate("+s.attr.width/2+","+.5*(s.attr.height+s.attr.innerWidth/2)+")")}}e.prototype=Object.create(a.prototype);return e});