(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.MultiBarChart=e(t.d3,t.du.Widget)}})(this,function(t,r){"use strict";function e(t,e){var o=r.call(this,t,"multibarchart","svg",e);o.attr.add(this,"barWidth",false);var s={};var l=[];var u={};var c=null;var p=false;this.data=function(t){l=t.map(function(t){return{name:t.name,values:t.values.sort(function(t,e){console.log(t.x,e.x);return t.x.localeCompare(e.x)}).map(function(t){return{x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}})}});return this};this.highlight=function(t,e){if(!p)o.utils.highlight(this,s,".bar",t,e);return this};o.utils.tooltip=function(){if(!c){return null}var r=c.x;var t=l.map(function(t){var e=t.values.filter(function(t){return t.x===r});return{name:t.name,color:u[t.name],value:e.length>0?o.attr.tooltipYFormat(e[0].y):"n/a"}});return{title:o.attr.tooltipXFormat(r),content:{type:"plots",data:t}}};o.render.build=function(){s=o.utils.standardAxis();s.plots={}};o.render.update=function(t){var n=l.slice();s.scale={x:o.utils.scale(n.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,o.attr.innerWidth],"band"),y:o.utils.scale(n.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}).concat([0]),[o.attr.innerHeight,0])};s.axes.x.transition().duration(t).call(s.axisFn.x.scale(s.scale.x));s.axes.y.transition().duration(t).call(s.axisFn.y.scale(s.scale.y));u=o.utils.colors(l?l.map(function(t){return t.name}):null);s.plots.groups=s.g.selectAll(".bar-group").data(l,function(t){return t.name});s.plots.groups.exit().transition().duration(t).remove();var e=s.plots.groups.enter().append("g").attr("class",function(t){return"bar-group "+o.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent");s.plots.groups=e.merge(s.plots.groups).each(function(){p=true});s.plots.groups.transition().duration(t).style("fill-opacity",o.attr.opacity).style("fill",function(t){return u[t.name]}).on("end",function(){p=false});var r=l.length>0?s.scale.x.bandwidth():1,a=r*o.attr.barWidth,i=r*(1-o.attr.barWidth)/2;s.plots.bars=s.plots.groups.selectAll(".bar").data(function(e,r){return e.values.map(function(t){return{name:e.name,n:n.length,i:r,x:t.x,y:t.y}})});s.plots.bars.exit().transition().duration(t).style("opacity",0).remove();s.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+o.utils.encode(t.name)}).style("opacity",0).attr("x",function(t){return s.scale.x(t.x)+i+a*t.i/t.n}).attr("y",o.attr.height-o.attr.margins.top-o.attr.margins.bottom).attr("width",function(t){return a/t.n}).attr("height",0).merge(s.plots.bars).on("mouseover",function(t){c=t;o.attr.mouseover&&o.attr.mouseover(t.name)}).on("mouseleave",function(t){c=null;o.attr.mouseleave&&o.attr.mouseleave(t.name)}).on("click",function(t){o.attr.click&&o.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("x",function(t){return s.scale.x(t.x)+i+a*t.i/t.n}).attr("y",function(t){return s.scale.y(t.y)}).attr("width",function(t){return a/t.n}).attr("height",function(t){return o.attr.height-o.attr.margins.top-o.attr.margins.bottom-s.scale.y(t.y)})};o.render.style=function(){s.g.attr("width",o.attr.innerWidth+"px").attr("height",o.attr.innerHeight+"px").attr("transform","translate("+o.attr.margins.left+","+o.attr.margins.top+")").style("pointer-events","all");s.axisFn.x.tickFormat(o.attr.xTickFormat);s.axes.x.attr("transform","translate(0,"+o.attr.innerHeight+")");s.axisFn.y.tickFormat(o.attr.yTickFormat);s.axes.y.attr("transform","translate(0,"+1+")");s.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");s.labels.x.attr("x",o.attr.innerWidth+"px").attr("y",o.attr.innerHeight+2.2*o.attr.fontSize+"px").style("fill",o.attr.fontColor).style("font-size",o.attr.fontSize+"px").text(o.attr.xLabel);s.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",o.attr.fontColor).style("font-size",o.attr.fontSize+"px").text(o.attr.yLabel)}}e.prototype=Object.create(r.prototype);return e});