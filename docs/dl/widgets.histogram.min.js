(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=e(t.d3,t.du.Widget)}})(this,function(h,a){"use strict";function t(t,e){var u=a.call(this,t,"histogram","svg",e);u.attr.add(this,"min",null);u.attr.add(this,"max",null);u.attr.add(this,"bin",null);u.attr.add(this,"binnedData",false);u.attr.add(this,"normalize",false);var c={};var x=[];var f=[];var m={};var d=false;this.data=function(t){x=t;return this};this.highlight=function(t,e){if(!d)u.utils.highlight(this,c,".bar",t,e);return this};u.utils.tooltip=function(t){var e=h.bisector(function(t){return c.scale.x(t.values.x0)}).right;var a=t?e(f,t[0]):null;if(a===null){return}var r=f[a-1]?f[a-1]:f[a];var n=f[a]?f[a]:f[a-1];var i=t[0]-r.x1>n.x0-t[0]?n:r;return{title:i.name,content:{type:"metrics",data:[{label:"min:",value:i.values.x0.toPrecision(3)},{label:"max:",value:i.values.x1.toPrecision(3)},{label:"count:",value:i.values.size.toPrecision(2)},{label:"fraction:",value:(100*i.values.size/h.sum(f,function(t){return t.values.size})).toFixed(2)+"%"}]}}};u.render.build=function(){c=u.utils.standardAxis();c.plots={}};u.render.update=function(t){if(x.length===0){return}else{var e=u.attr.binnedData?x.sort(function(t,e){return t.x-e.x}):x.sort(function(t,e){return t-e})}if(u.attr.binnedData){var a=h.min(e,function(t){return t.x});var r=e[1].x-e[0].x;var n=e.length;f=e.map(function(t,e){var a={x0:t.x,x1:t.x+r,size:t.y};return{name:"bin "+e,values:a}});var i=u.attr.normalize?e.reduce(function(t,e){return t+e.y},0):1}else{a=typeof u.attr.min==="number"?u.attr.min:e[0];var s=typeof u.attr.max==="number"?u.attr.max:e[e.length-1];r=typeof u.attr.bin==="number"?u.attr.bin:2*(h.quantile(e,.75)-h.quantile(e,.25))/Math.pow(e.length,1/3);var l=[];n=Math.ceil((s-a)/r);for(var o=0;o<=n;o++){l.push(a+o*r)}i=u.attr.normalize?e.length:1;f=h.histogram().domain([a,a+n*r]).thresholds(l)(e).map(function(t,e){t.size=t.length;return{name:"bin "+e,values:t}})}c.scale={x:u.utils.scale([a,a+n*r],[0,u.attr.innerWidth]),y:u.utils.scale([0,h.max(f,function(t){return t.values.size/i})],[u.attr.innerHeight,0])};c.axes.x.transition().duration(t).call(c.axisFn.x.tickValues(u.attr.xTicks).scale(c.scale.x));c.axes.y.transition().duration(t).call(c.axisFn.y.tickValues(u.attr.yTicks).scale(c.scale.y));m=u.utils.colors(f?f.map(function(t){return t.name}):null);c.plots.bars=c.g.selectAll(".bar").data(f,function(t){return t.name});c.plots.bars.exit().transition().duration(t).style("height",0).remove();c.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+u.utils.encode(t.name)}).attr("x",function(t){return c.scale.x(t.values.x0)+1}).attr("y",u.attr.height-u.attr.margins.top-u.attr.margins.bottom-1).attr("width",function(t){return Math.max(0,Math.abs(c.scale.x(t.values.x1)-c.scale.x(t.values.x0))-2)}).attr("height",0).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none").style("fill",function(){return m[f[0].name]}).merge(c.plots.bars).each(function(){d=true}).on("mouseover",function(t){u.attr.mouseover&&u.attr.mouseover(t.name)}).on("mouseleave",function(t){u.attr.mouseleave&&u.attr.mouseleave(t.name)}).on("click",function(t){u.attr.click&&u.attr.click(t.name)}).transition().duration(t).attr("x",function(t){return c.scale.x(t.values.x0)+1}).attr("y",function(t){return u.attr.margins.top-u.attr.margins.top+c.scale.y(t.values.size/i)}).attr("width",function(t){return Math.max(0,Math.abs(c.scale.x(t.values.x1)-c.scale.x(t.values.x0))-2)}).attr("height",function(t){return u.attr.height-u.attr.margins.top-u.attr.margins.bottom-c.scale.y(t.values.size/i)}).style("opacity",1).style("fill",function(){return m[f[0].name]}).on("end",function(){d=false})};u.render.style=function(){c.g.style("width",u.attr.innerWidth+"px").style("height",u.attr.innerHeight+"px").attr("transform","translate("+u.attr.margins.left+","+u.attr.margins.top+")").style("pointer-events","all");c.axisFn.x.tickFormat(u.attr.xTickFormat);c.axisFn.y.tickFormat(u.attr.yTickFormat);c.axes.x.attr("transform","translate(0,"+u.attr.innerHeight+")");c.axes.y.attr("transform","translate(0,"+1+")");c.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof u.attr.xTickAngle==="number"){c.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+u.attr.xTickAngle+")").style("text-anchor","start")}c.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");c.labels.x.attr("x",u.attr.innerWidth+"px").attr("y",u.attr.innerHeight+2.2*u.attr.fontSize+"px").style("font-size",u.attr.fontSize+"px").style("fill",u.attr.fontColor).text(u.attr.xLabel);c.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",u.attr.fontSize+"px").style("fill",u.attr.fontColor).text(u.attr.yLabel)}}t.prototype=Object.create(a.prototype);return t});