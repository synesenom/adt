(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";function i(i,n,l,s){var o;try{if(s){o=t.select(s).append(l).attr("id","du-widget-"+n+"-"+i).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{o=t.select("body").append(l).attr("id","du-widget-"+n+"-"+i).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var r={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,i,n,l){r[e]=i;t[e]=function(i){if(l){l(i)}else{r[e]=i}return t};if(typeof n==="string"&&r._categories.hasOwnProperty(n)){r._categories[n].push(e)}}};r.add(this,"relative",false);r.add(this,"resize",1);r.add(this,"x",0,"dim",function(t,e){r.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)r.xDim=e});r.add(this,"y",0,"dim",function(t,e){r.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)r.yDim=e});r.add(this,"width",200,"dim");r.add(this,"height",150,"dim");r.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){r.margins[e]=t})}else{for(var e in t){if(r.margins.hasOwnProperty(e))r.margins[e]=t[e]}}});r.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){for(var e in t){if(r.borders.hasOwnProperty(e))r.borders[e]=t[e]}});r.add(this,"fontColor","black");r.add(this,"fontSize",10);r.add(this,"fontWeight","normal");r.add(this,"label",null);r.add(this,"xLabel",null);r.add(this,"yLabel",null);r.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});r.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});r.add(this,"xTickAngle",null);r.add(this,"yMin",0);r.add(this,"mouseover",null);r.add(this,"mouseleave",null);r.add(this,"click",null);r.add(this,"colors","#888");var a=function(){function i(t){if(!t)return"";return t.replace(/ /g,"__")}function n(i,n){if(i===null||i===undefined||i.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var l=[t.min(i,function(t){return t.x}),t.max(i,function(t){return t.x})];var s={};var o=[];i.forEach(function(t){if(!s.hasOwnProperty(t.x)){s[t.x]=1;o.push(t.x)}});var r=[];if(typeof i[0].y==="number"){r=[t.min(i,function(t){return t.y}),t.max(i,function(t){return t.y})]}else{var a=[],d=[];e.forOwn(i[0].y,function(e,n){a.push(t.min(i,function(t){return t.y[n]}));d.push(t.max(i,function(t){return t.y[n]}))});r=[t.min(a),t.max(d)]}var u={x:[null,null],y:[null,null]};if(n){e.forOwn(u,function(t,e){[0,1].forEach(function(i){t[i]=n.hasOwnProperty(e)&&n[e][i]!==null?n[e][i]:t[i]})})}return{x:{min:u.x[0]!==null?u.x[0]:l[0],max:u.x[1]!==null?u.x[1]:l[1],domain:o.filter(function(t){return(!u.x[0]||t>=u.x[0])&&(!u.x[1]||t<=u.x[1])})},y:{min:u.y[0]!==null?u.y[0]:r[0],max:u.y[1]!==null?u.y[1]:r[1],domain:[]}}}function l(e,i,n,l){function s(e,i){var n=null;if(typeof e){switch(e){case"number":default:n=t.scaleLinear().domain([i.min,i.max]);break;case"time":n=t.scaleTime().domain([i.min,i.max]);break;case"string":n=t.scaleBand().domain(i.domain).padding(.1);break}}return n}return{x:s(l&&l.x?l.x.type:"number",e.x).range(l&&l.x&&l.x.reverse?[i,0]:[0,i]),y:s(l&&l.y?l.y.type:"number",e.y).range(l&&l.y&&l.y.reverse?[0,n]:[n,0])}}function s(e,n,l,s){if(e!==null){if(typeof l==="string"){e.g.selectAll(n).transition().duration(s?s:0).style("opacity",function(){return t.select(this).classed(i(l))?1:.1})}else{e.g.selectAll(n).transition().duration(s?s:0).style("opacity",1)}}}return{encode:i,boundary:n,scale:l,highlight:s}}();this.setClass=function(t){o.attr("class",t);return this};var d={build:function(){},update:function(){},style:function(){}};this.render=function(t){var i=typeof t==="number"?t:500;if(typeof r.resize==="number"){r._categories.dim.forEach(function(t){if(t==="resize"||!r.hasOwnProperty(t))return;switch(typeof r[t]){case"number":if((t!=="x"||r.xDim!=="%")&&(t!=="y"||r.yDim!=="%"))r[t]*=r.resize;break;case"object":e.forOwn(r[t],function(e,i){if(typeof e==="number"){r[t][i]*=r.resize}});break;default:break}});r.resize=null}if(!this._isBuilt){d.build(i);this._isBuilt=true}d.update(i);if(r.relative){o.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{o.style("position","absolute").style(r.x>=0?"left":"right",Math.abs(r.x)+r.xDim).style(r.y>=0?"top":"bottom",Math.abs(r.y)+r.yDim)}o.style("width",r.width+"px").style("height",r.height+"px");o.selectAll(".axis path").style("fill","none").style("stroke",r.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > line").style("stroke",r.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");o.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",r.fontSize+"px").style("fill",r.fontColor);o.style("font-family","inherit");o.selectAll("g").attr("font-family","inherit");d.style();o.style("display","block");return this};this.describe=function(e){var i=null;o.on("contextmenu",function(){t.event.preventDefault();if(i===null){i=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").html(e);setTimeout(function(){if(i!==null){i.transition().duration(2e3).style("opacity",0).on("end",function(){t.select(this).remove();i=null})}},15e3)}}).on("mouseleave",function(){if(i!==null){i.remove();i=null}});return this};this.placeholder=function(e){var n=300;var l="du-widget-placeholder-"+i;if(e){o.transition().duration(n).style("opacity",0);if(t.select("#"+l).empty()){var a=s?s:"body";t.select(a).append("div").attr("id",l).style("position","absolute").style("width",r.width+"px").style("height",r.height+"px").style("line-height",r.height+"px").style(r.x>=0?"left":"right",Math.abs(r.x)+r.xDim).style(r.y>=0?"top":"bottom",Math.abs(r.y)+r.yDim).style("text-align","center").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",r.fontWeight).style("font-size",r.fontSize).style("color",r.fontColor).style("opacity",0).html(e).transition().duration(n).style("opacity",1)}}else{o.transition().duration();o.transition().duration(n).style("opacity",1);var d=t.select("#"+l);if(!d.empty()){d.remove()}}};this.remove=function(){o.remove()};return{widget:o,attr:r,utils:a,render:d}}return i});