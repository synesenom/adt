(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","_","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3,t._)}})(this,function(t,e){"use strict";var n=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function i(i,o,l,r){var s;var a="du-widget-"+o+"-"+i;try{if(r){s=t.select(r).append(l).attr("id",a).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{s=t.select("body").append(l).attr("id",a).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var u={xDim:"px",yDim:"px",fontWeight:"normal",_categories:{dim:[]},add:function(t,e,n,i,o){u[e]=n;t[e]=function(n){if(o){o(n)}else{u[e]=n}return t};if(typeof i==="string"&&u._categories.hasOwnProperty(i)){u._categories[i].push(e)}}};u.add(this,"relative",false);u.add(this,"resize",1);u.add(this,"x",0,"dim",function(t,e){u.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.xDim=e});u.add(this,"y",0,"dim",function(t,e){u.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)u.yDim=e});u.add(this,"width",200,"dim");u.add(this,"height",150,"dim");u.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){u.margins[e]=t})}else{e.forOwn(t,function(e,n){u.margins[n]=t[n]})}});u.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){u.borders[e]=t})}e.forOwn(t,function(e,n){u.borders[n]=t[n]})});u.add(this,"fontColor","black");u.add(this,"fontSize",10);u.add(this,"fontWeight","normal");u.add(this,"label",null);u.add(this,"xLabel",null);u.add(this,"yLabel",null);u.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});u.add(this,"xTickAngle",null);u.add(this,"yMin",0);u.add(this,"mouseover",null);u.add(this,"mouseleave",null);u.add(this,"click",null);u.add(this,"colors",null);u.add(this,"tooltip",false);var d=function(){function i(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function o(n,i){if(n===null||n===undefined||n.length<1){return{x:{min:0,max:1,domain:[.5]},y:{min:0,max:1,domain:[]}}}var o=[t.min(n,function(t){return t.x}),t.max(n,function(t){return t.x})];var l={};var r=[];n.forEach(function(t){if(!l.hasOwnProperty(t.x)){l[t.x]=1;r.push(t.x)}});var s=[];if(typeof n[0].y==="number"){s=[t.min(n,function(t){return t.y}),t.max(n,function(t){return t.y})]}else{var a=[],u=[];e.forOwn(n[0].y,function(e,i){a.push(t.min(n,function(t){return t.y[i]}));u.push(t.max(n,function(t){return t.y[i]}))});s=[t.min(a),t.max(u)]}var d={x:[null,null],y:[null,null]};if(i){e.forOwn(d,function(t,e){[0,1].forEach(function(n){t[n]=i.hasOwnProperty(e)&&i[e][n]!==null?i[e][n]:t[n]})})}return{x:{min:d.x[0]!==null?d.x[0]:o[0],max:d.x[1]!==null?d.x[1]:o[1],domain:r.filter(function(t){return(!d.x[0]||t>=d.x[0])&&(!d.x[1]||t<=d.x[1])})},y:{min:d.y[0]!==null?d.y[0]:s[0],max:d.y[1]!==null?d.y[1]:s[1],domain:[]}}}function l(e,n,i,o){function l(e,n){var i=null;if(typeof e){switch(e){case"number":default:i=t.scaleLinear().domain([n.min,n.max]);break;case"time":i=t.scaleTime().domain([n.min,n.max]);break;case"string":i=t.scaleBand().domain(n.domain).padding(.1);break}}return i}return{x:l(o&&o.x?o.x.type:"number",e.x).range(o&&o.x&&o.x.reverse?[n,0]:[0,n]),y:l(o&&o.y?o.y.type:"number",e.y).range(o&&o.y&&o.y.reverse?[0,i]:[i,0])}}function r(e,n,o,l,r){if(n!==null){if(typeof l==="string"){n.g.selectAll(o).transition();n.g.selectAll(o).transition().duration(r?r:0).style("opacity",function(){return t.select(this).classed(i(l))?1:.1})}else{n.g.selectAll(o).transition();n.g.selectAll(o).transition().duration(r?r:0).style("opacity",1)}}return e}function s(e){if(e===null||e===undefined){return{}}if(e.length>0){if(u.colors===null||u.colors===undefined){return e.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,i){t[e]=n[i%18];return t},{})}if(typeof u.colors==="string"){var i=t.scaleLinear().domain([0,e.length]).range([u.colors,"#fff"]).interpolate(t.interpolateRgb);return e.reduce(function(t,e,n){t[e]=i(n);return t},{})}return u.colors}}return{encode:i,boundary:o,scale:l,highlight:r,colors:s}}();function f(e){var n="du-widgets-plot-tooltip";var i=t.event.pageX;var o=t.event.pageY;var l=s.node().getBoundingClientRect();if(typeof e!=="string"||e===""||i<l.left+u.margins.left||i>l.right-u.margins.right||o<l.top+u.margins.top||o>l.bottom-u.margins.bottom){t.select("#"+n).style("opacity",0).html("");return}var r=t.select("#"+n);if(t.select("#"+n).empty()){var a=t.color(u.fontColor);a.opacity=.3;r=t.select("body").append("div").attr("id",n).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-radius","2px").style("border","solid 1px "+a).style("padding","5px").style("font-family","Courier").style("font-size","0.7em").style("color",u.fontColor).style("pointer-events","none").style("left",(l.left+l.right)/2+"px").style("top",(l.top+l.bottom)/2+"px")}r.html(e);var d=r.node().getBoundingClientRect();var f=d.width;var y=d.height;var c=i+20;var p=o+20;if(c<l.left+u.margins.left+10){c+=u.margins.left+10}else if(c+f>l.right-u.margins.right){c-=u.margins.right+f-10}if(p<l.top+u.margins.top+10){p+=u.margins.top+10}else if(p+y>l.bottom-u.margins.bottom){p-=u.margins.bottom+y-10}r.style("opacity",1).transition();r.transition().duration(200).ease(t.easeLinear).style("left",c+"px").style("top",p+"px")}this.id=function(){return a};var y={build:null,update:null,style:null};this.render=function(n){var i=typeof n==="number"?n:500;if(typeof u.resize==="number"){u._categories.dim.forEach(function(t){if(t==="resize"||!u.hasOwnProperty(t))return;switch(typeof u[t]){case"number":if((t!=="x"||u.xDim!=="%")&&(t!=="y"||u.yDim!=="%"))u[t]*=u.resize;break;case"object":e.forOwn(u[t],function(e,n){if(typeof e==="number"){u[t][n]*=u.resize}});break;default:break}});u.resize=null}if(!this._isBuilt){y.build&&y.build(i);this._isBuilt=true}y.update&&y.update(i);if(u.relative){s.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{s.style("position","absolute").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim)}s.style("width",u.width+"px").style("height",u.height+"px");if(d.tooltip!==undefined){s.style("pointer-events",u.tooltip?"all":null).on("mouseenter",function(){var e=t.mouse(s.node());u.tooltip&&f(d.tooltip([e[0]-u.margins.left,e[1]-u.margins.top]))}).on("mousemove",function(){var e=t.mouse(s.node());u.tooltip&&f(d.tooltip([e[0]-u.margins.left,e[1]-u.margins.top]))}).on("mouseleave",function(){u.tooltip&&f()})}s.selectAll(".axis path").style("fill","none").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");s.selectAll(".tick > line").style("stroke",u.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");s.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",u.fontSize+"px").style("fill",u.fontColor);s.style("font-family","inherit");s.selectAll("g").attr("font-family","inherit");y.style&&y.style();s.style("display","block");return this};this.describe=function(e){var n=null;s.on("contextmenu",function(){t.event.preventDefault();if(n===null){n=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e);setTimeout(function(){if(n!==null){n.transition().duration(2e3).style("opacity",0).on("end",function(){t.select(this).remove();n=null})}},15e3)}}).on("mouseleave",function(){if(n!==null){n.remove();n=null}});return this};this.placeholder=function(e){var n=300;var o="du-widget-placeholder-"+i;if(e){s.transition().duration(n).style("opacity",0);if(t.select("#"+o).empty()){var l=r?r:"body";t.select(l).append("div").attr("id",o).style("position","absolute").style("width",u.width+"px").style("height",u.height+"px").style("line-height",u.height+"px").style(u.x>=0?"left":"right",Math.abs(u.x)+u.xDim).style(u.y>=0?"top":"bottom",Math.abs(u.y)+u.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",u.fontWeight).style("font-size",u.fontSize).style("color",u.fontColor).style("opacity",0).html(e).transition().duration(n).style("opacity",1)}}else{s.transition().duration();s.transition().duration(n).style("opacity",1);var a=t.select("#"+o);if(!a.empty()){a.remove()}}return this};this.remove=function(){s.remove()};return{widget:s,attr:u,utils:d,render:y}}return i});