(function(r,n){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=n(require("lodash.clonedeep"))}else if(typeof define==="function"&&define.amd){define(["cloneDeep","exports"],n)}else{r.du=r.du||{};r.du.data=n(r.cloneDeep)}})(this,function(s){"use strict";var r={si:function(){var u="yzafpnÎ¼m kMGTPEZY";var i=(u.length-1)/2;var a=i;var o=-i;function r(r){if(r===null||r===undefined||isNaN(r))return"N/A";if(r===0)return"0";var n=Math.abs(r);var t=Math.max(Math.min(parseInt(Math.floor(Math.log(n)/Math.log(1e3))),a),o);var e=n/Math.pow(1e3,t);return(r<0?"-":"")+(t===o||t===a?e.toExponential(2):e.toPrecision(3)).replace(/e\+0$/,"")+u.charAt(i+t).trim()}return r}(),idfy:function(r){return r?r.replace(/ /g,"__"):""},namify:function(r){return r?r.replace(/__/g," "):""}};var n={sum:function(r,e,n){var u={};var i=[];if(Array.isArray(n)){i=n}else{i=[n]}var a=i.length;r.forEach(function(n){var t=[];i.forEach(function(r){if(n.hasOwnProperty(r)){t.push(n[r])}});if(t.length!==a)return;var r=t.join(".");if(!u.hasOwnProperty(r))u[r]=+n[e];else u[r]+=+n[e]});var t=[];for(var o in u){if(u.hasOwnProperty(o)){t.push({key:o,value:u[o]})}}return t.sort(function(r,n){return n.value-r.value})}};var t={Histogram:function(r){var e=r?r:[];this.set=function(r){e=r;return this};function n(){return s(e)}function t(r,n){e.push({x:r,y:n,index:e.length});return this}function u(n){e.forEach(function(r){r.y*=n});return this}function i(){var n=d3.sum(e,function(r){return r.y});e.forEach(function(r){r.y/=n});return this}function a(t){e.sort(function(r,n){return t?n.x-r.x:r.x-n.x});return this}function o(t){e.sort(function(r,n){return t?n.y-r.y:r.y-n.y});return this}function f(){e.sort(function(r,n){return r.index-n.index});return this}return{set:set,get:n,add:t,scale:u,normalize:i,sortByX:a,sortByY:o,unsort:f}},TimeSeries:function(e){var i=[];function r(r){i=[];var n=0;if(r!==null){var t=new Date(r);while(t<=new Date){i.push({x:new Date(t),y:{}});e.forEach(function(r){i[n].y[r]=0});t.setDate(t.getDate()+1);n++}}return this}function n(r,n,t,e){i[r].x=n;i[r].y[t]+=e}function a(r,n){if(!r)return i;else{var t=n?n:0;return i.slice(-t-r,-t)}}function o(r,n){if(i.length<1)return{};var t={};for(var e in i[0].y){if(i[0].y.hasOwnProperty(e)){t[e]=0}}a(r?r:1,n).forEach(function(r){for(var n in i[0].y){if(i[0].y.hasOwnProperty(n)){t[n]+=r.y[n]}}});return t}function t(r,n){var t=0;if(i.length>0){var e=a(r,n);for(var u in i[0].y){if(i[0].y.hasOwnProperty(u)){t=Math.max(d3.max(e,function(r){return r.y.hasOwnProperty(u)?r.y[u]:0}),t)}}}return t}function u(r){if(i.length<1)return{};var n=o(1,r);var t=o(2,r);var e={};for(var u in i[0].y){if(i[0].y.hasOwnProperty(u)){t[u]-=n[u];if(t[u]>=10&&n[u]>0){e[u]=(n[u]-t[u])/t[u]}}}return e}function f(r,n){var t=o(r,n);var e=0;for(var u in t){if(t.hasOwnProperty(u)){e+=t[u]}}for(u in t){if(t.hasOwnProperty(u)){t[u]/=e>0?e:1}}return t}return{clear:r,update:n,sub:a,sum:o,peak:t,trend:u,yDist:f}},Table:function(r){var i=[];var t=[];if(r){i=s(r);i.forEach(function(r,n){t.push(n)})}function n(r,e){var u=[];i.forEach(function(n){var t;if(typeof e==="string"){t=n[e]}else{t={};e.forEach(function(r){t[r]=n[r]})}u.push({x:n[r],y:t})});return u}function e(n,t){var r=null;switch(typeof t){case"number":var e=d3.min(i,function(r){return Math.abs((t-r[n])/t)});r=i.filter(function(r){return Math.abs((r[n]-t)/t)<=e*1.01});break;case"string":default:r=i.filter(function(r){return r[n]===t})}return new du.data.structures.Table(r)}function u(t){i.sort(function(r,n){return r[t]-n[t]});return this}function a(){var n=[];t.forEach(function(r){n.push(i[r])});i=n}return{slice:n,segment:e,sort:u,unsort:a}}};return{format:r,explore:n,structures:t}});