(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BubbleChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,a){"use strict";function r(e,r){var n=a.call(this,e,"bubblechart","svg",r);n.attr.add(this,"scale",1);n.attr.add(this,"sizeLabel","size");var i={};var s=[];var l=null;this.data=function(t){s=t;return this};this.highlight=function(t,e){return n.utils.highlight(this,i,".bubble",t,e)};n.utils.tooltip=function(){return l?{title:l.name,stripe:n.attr.colors[l.name],content:{type:"metrics",data:[{label:n.attr.xLabel+":",value:l.x.toPrecision(4)},{label:n.attr.yLabel+":",value:l.y.toPrecision(4)},{label:n.attr.sizeLabel+":",value:l.size.toFixed(1)}]}}:null};n.render.build=function(){i.g=n.widget.append("g");i.axisFn={x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)};i.axes={x:i.g.append("g").attr("class","x axis"),y:i.g.append("g").attr("class","y axis")};i.labels={x:i.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:i.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};n.render.update=function(t){i.scale={x:n.utils.scale(s.map(function(t){return[t.x-1.1*n.attr.scale*t.size,t.x+1.1*n.attr.scale*t.size]}).reduce(function(t,e){return t.concat(e)},[]),[0,n.attr.innerWidth]),y:n.utils.scale(s.map(function(t){return[t.y-1.1*n.attr.scale*t.size,t.y+1.1*n.attr.scale*t.size]}).reduce(function(t,e){return t.concat(e)},[]),[n.attr.innerHeight,0])};i.axes.x.transition().duration(t).call(i.axisFn.x.scale(i.scale.x));i.axes.y.transition().duration(t).call(i.axisFn.y.scale(i.scale.y));if(s.length>0){if(i.bubbles===undefined){i.bubbles=i.g.selectAll(".bubble").data(s).enter().append("circle").attr("class",function(t){return"bubble "+n.utils.encode(t.name)}).attr("r",function(t){return n.attr.scale*t.size}).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)}).style("stroke","none").style("shape-rendering","geometricPrecision")}i.bubbles.data(s).transition().duration(t).attr("r",function(t){return n.attr.scale*t.size}).attr("cx",function(t){return i.scale.x(t.x)}).attr("cy",function(t){return i.scale.y(t.y)})}};n.render.style=function(){n.attr.colors=n.utils.colors(s?s.map(function(t){return t.name}):null);i.g.attr("width",n.attr.innerWidth+"px").attr("height",n.attr.innerHeight+"px").attr("transform","translate("+n.attr.margins.left+","+n.attr.margins.top+")").style("pointer-events","all");i.axes.x.attr("transform","translate(0,"+n.attr.innerHeight+")");i.axisFn.y.tickFormat(n.attr.yTickFormat);i.axes.y.attr("transform","translate(0,"+1+")");i.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");i.labels.x.attr("x",n.attr.innerWidth+"px").attr("y",n.attr.innerHeight+2.2*n.attr.fontSize+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.xLabel);i.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.yLabel);i.bubbles.style("fill",function(t){return n.attr.colors[t.name]}).style("stroke",n.attr.stroke).on("mouseover",function(t){l=t;n.attr.mouseover&&n.attr.mouseover(t.name)}).on("mouseleave",function(t){l=null;n.attr.mouseleave&&n.attr.mouseleave(t.name)}).on("click",function(t){n.attr.click&&n.attr.click(t.name)})}}r.prototype=Object.create(a.prototype);return r});