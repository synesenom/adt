(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Grid=e(t.d3,t.du.Widget)}})(this,function(u,s){"use strict";function t(t,l){var o=s.call(this,t,"grid","div",l);var r=o.attr.x;var i=o.attr.y;var h=1;var n=1;var g=[];var f=[];var a=false;function e(){g.forEach(function(t){t.forEach(function(t){if(t){t.remove()}})});g=[];for(var t=0;t<n;t++){g.push([]);for(var e=0;e<h;e++){g[t].push(null)}}}this.x=function(t,e){o.attr.x=e!=="%"?t:window.innerWidth*t/100;r=o.attr.x;return this};this.y=function(t,e){o.attr.y=e!=="%"?t:window.innerHeight*t/100;i=o.attr.y;return this};this.rows=function(t){h=t;e();return this};this.cols=function(t){n=t;e();return this};this.show=function(t){if(t){a=true;o.widget.style("box-shadow","0 0 1px black inset");for(var e=1;e<h;e++){o.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*o.attr.height/h-1.5+"px").style("width",o.attr.width+"px").style("height","3px").style("background-color","white")}for(var r=1;r<n;r++){o.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*o.attr.width/n-1.5+"px").style("top","0").style("width","3px").style("height",o.attr.height+"px").style("background-color","white")}for(e=1;e<h;e++){o.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*o.attr.height/h-.5+"px").style("width",o.attr.width+"px").style("height","1px").style("background-color","black")}for(r=1;r<n;r++){o.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*o.attr.width/n-.5+"px").style("top","0").style("width","1px").style("height",o.attr.height+"px").style("background-color","black")}}else{a=false;o.widget.style("border",null);o.widget.selectAll(".grid-border-h").remove();o.widget.selectAll(".grid-border-v").remove()}return this};this.add=function(t,e,r,i,a){if(e<0||i<1||e+i>n||r<0||a<1||r+a>h){t.remove();return null}for(var s=e;s<e+i;s++){if(g[s]){for(var d=r;d<r+a;d++){if(g[s][d]){t.remove();return null}}}}f.push({x:e,y:r,width:i,height:a,widget:t});for(s=e;s<e+i;s++){for(d=r;d<r+a;d++){g[s][d]=t}}u.select("#"+this.id()).node().appendChild(u.select("#"+t.id()).node());t.x(e*o.attr.width/n+o.attr.x+o.attr.margins.left).y(r*o.attr.height/h+o.attr.y+u.select(l).attr("top")+o.attr.margins.left).width(i*o.attr.width/n-2*o.attr.margins.left).height(a*o.attr.height/h-2*o.attr.margins.left).render();return t};this.get=function(t,e){if(g[e]&&g[e][t]){return g[e][t].widget}else{return null}};o.render.style=function(){o.widget.style("position","absolute").style(o.attr.x>0?"left":"right",Math.abs(o.attr.x)+o.attr.xDim).style(o.attr.y>0?"top":"bottom",Math.abs(o.attr.y)+o.attr.yDim).style("width",o.attr.width+"px").style("height",o.attr.height+"px");o.widget.selectAll(".grid-border-h").style("top",function(){return u.select(this).attr("data-y")*o.attr.height/h-1+"px"}).style("width",o.attr.width+"px");o.widget.selectAll(".grid-border-v").style("left",function(){return u.select(this).attr("data-x")*o.attr.width/n-1+"px"}).style("height",o.attr.height+"px");f.forEach(function(t){t.widget.x(t.x*o.attr.width/n+o.attr.x+o.attr.margins.left).y(t.y*o.attr.height/h+o.attr.y+o.attr.margins.left).width(t.width*o.attr.width/n-2*o.attr.margins.left).height(t.height*o.attr.height/h-2*o.attr.margins.left).render(0)})}}t.prototype=Object.create(s.prototype);return t});