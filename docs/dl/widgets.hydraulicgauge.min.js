(function(e,t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],t)}else{e.du=e.du||{};e.du.widgets=e.du.widgets||{};e.du.widgets.HydraulicGauge=t(e.d3,e.du.Widget)}})(this,function(s,a){"use strict";function e(e,t){var d=a.call(this,e,"hydraulicgauge","svg",t);d.attr.add(this,"min",0);d.attr.add(this,"max",1);d.attr.add(this,"segments",4);d.attr.add(this,"gap",6);d.attr.add(this,"thickness",.2);var i={};var l=null;var g=0;var n=null;function o(){var e=d.attr.gap*Math.PI/180,t=Math.PI-(d.attr.segments-1)*e,n=t/d.attr.segments;var a=d.attr.innerWidth/2,r=a*d.attr.thickness;var s=a*.1,i=a-1.5*r;return{angles:{gap:e,segment:n},sizes:{radius:a,thickness:r},needle:{width:s,length:i,angle:Math.acos(s/i)}}}function u(e,t){var n=[-e.needle.length*Math.cos(t),-e.needle.length*Math.sin(t)],a=[e.needle.width*Math.cos(t-e.needle.angle),e.needle.width*Math.sin(t-e.needle.angle)],r=[e.needle.width*Math.cos(t+e.needle.angle),e.needle.width*Math.sin(t+e.needle.angle)];return"M0,0L"+a.join(",")+"L"+n.join(",")+"L"+r.join(",")+"Z"}function r(e,t){var n=o();var a=this;var r=l(g);var s=l(e);i.needlePointer.transition().duration(t).tween("progress",function(){return function(e){var t=r+(s-r)*e;return i.needlePointer.attr("d",u.call(a,n,t))}}).on("end",function(){g=e})}this.position=function(e){n=e;return this};d.render.build=function(){l=s.scaleLinear().domain([d.attr.min,d.attr.max]).range([0,Math.PI]).clamp(true);i.g=d.widget.append("g");var e=s.interpolateHsl(d.attr.colors?d.attr.colors[0]:"#e41a1c",d.attr.colors?d.attr.colors[1]:"#4daf4a");i.segments=[];var t=o();for(var n=0;n<d.attr.segments;n++){var a=s.arc().outerRadius(t.sizes.radius).innerRadius(t.sizes.radius-t.sizes.thickness).startAngle(-Math.PI/2+n*(t.angles.segment+t.angles.gap)).endAngle(-Math.PI/2+(n+1)*(t.angles.segment+t.angles.gap)-t.angles.gap);i.segments.push(i.g.append("path").attr("class","gauge-segment").attr("d",a).style("fill",e(n/(d.attr.segments-1))))}i.needle=i.g.append("g").attr("class","gauge-needle").style("fill",d.attr.fontSize);i.needleCenter=i.needle.append("circle").attr("class","gauge-needle-center").attr("cx",0).attr("cy",0).attr("r",t.needle.width+"px");i.needlePointer=i.needle.append("path").attr("class","gauge-needle-pointer");r(0,0)};d.render.update=function(e){if(n!==null){r(n,e);n=null}};d.render.style=function(){d.widget.style("width",d.attr.width+"px");d.widget.style("height",d.attr.height+"px");i.g.attr("transform","translate("+d.attr.width/2+","+.5*(d.attr.height+d.attr.innerWidth/2)+")")}}e.prototype=Object.create(a.prototype);return e});