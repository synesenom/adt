(function(e,t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],t)}else{e.du=e.du||{};e.du.widgets=e.du.widgets||{};e.du.widgets.BoxPlot=t(e.d3,e._,e.du.Widget)}})(this,function(e,t,a){"use strict";function r(t,r){var n=a.call(this,t,"boxplot","svg",r);var l={};var s=[];var i=null;var u={};var o=false;this.data=function(t){s=t.map(function(t){var a=t.values.sort(e.ascending),r=e.min(a),n=e.max(a),l=e.quantile(a,.25),s=e.quantile(a,.75),i=s-l;var u=[],o=[];t.values.filter(function(e){return e<l-1.5*i||e>s+1.5*i}).forEach(function(e){if(e<l-3*i||e>s+3*i){o.push(e)}else{u.push(e)}});return{name:t.name,values:{min:r,max:n,mean:e.mean(a),median:e.median(a),q1:l,q3:s,whiskers:{lower:Math.max(r,l-1.5*i),upper:Math.min(n,s+1.5*i)},outliers:{mild:u,extreme:o}}}});return this};this.highlight=function(e,t){if(!o)n.utils.highlight(this,l,".box",e,t);return this};n.utils.tooltip=function(){return i?{title:i.name,stripe:n.attr.colors[i.name],content:{type:"metrics",data:[{label:"min/max:",value:i.values.min.toPrecision(3)+"/"+i.values.max.toPrecision(3)},{label:"mean:",value:i.values.mean.toPrecision(3)},{label:"median:",value:i.values.median.toPrecision(3)},{label:"Q1:",value:i.values.q1.toPrecision(3)},{label:"Q3:",value:i.values.q3.toPrecision(3)},{label:"mild outliers:",value:i.values.outliers.mild.length},{label:"extreme outliers:",value:i.values.outliers.extreme.length}]}}:null};n.render.build=function(){l=n.utils.standardAxis();l.plots={}};n.render.update=function(e){l.scale={x:n.utils.scale(s.map(function(e){return e.name}).reverse(),[n.attr.innerWidth,0],"point"),y:n.utils.scale(s.map(function(e){return[e.values.min-.1*(e.values.max-e.values.min),e.values.max+.1*(e.values.max-e.values.min)]}).reduce(function(e,t){return e.concat(t)},[]),[n.attr.innerHeight,0])};l.axes.x.transition().duration(e).call(l.axisFn.x.scale(l.scale.x));l.axes.y.transition().duration(e).call(l.axisFn.y.scale(l.scale.y));u=n.utils.colors(s?s.map(function(e){return e.name}):null);l.plots.groups=l.g.selectAll(".box-group").data(s,function(e){return e.name});l.plots.groups.exit().style("opacity",0).remove();var t=l.plots.groups.enter().append("g").attr("class",function(e){return"box-group "+n.utils.encode(e.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var a=t.merge(l.plots.groups).each(function(){o=true}).on("mouseover",function(e){i=e;n.attr.mouseover&&n.attr.mouseover(e.name)}).on("mouseleave",function(e){i=null;n.attr.mouseleave&&n.attr.mouseleave(e.name)}).on("click",function(e){n.attr.click&&n.attr.click(e.name)});a.transition().duration(e).style("opacity",1).style("fill-opacity",n.attr.opacity).style("fill",function(e){return u[e.name]}).style("stroke",function(e){return u[e.name]}).on("end",function(){o=false});t.append("rect").attr("class","body").attr("x",function(e){return l.scale.x(e.name)-10}).attr("y",function(e){return l.scale.y(e.values.q3)}).attr("width",20).attr("height",function(e){return l.scale.y(e.values.q1)-l.scale.y(e.values.q3)}).style("rx","2px").style("ry","2px").style("fill-opacity",.3).style("stroke-width","1px");a.select(".body").transition().duration(e).attr("x",function(e){return l.scale.x(e.name)-10}).attr("y",function(e){return l.scale.y(e.values.q3)}).attr("width",20).attr("height",function(e){return l.scale.y(e.values.q1)-l.scale.y(e.values.q3)});t.append("line").attr("class","median").attr("x1",function(e){return l.scale.x(e.name)-10}).attr("x2",function(e){return l.scale.x(e.name)+10}).attr("y1",function(e){return l.scale.y(e.values.median)}).attr("y2",function(e){return l.scale.y(e.values.median)}).style("stroke-width","2px").style("fill-opacity",.8);a.select(".median").transition().duration(e).attr("x1",function(e){return l.scale.x(e.name)-10}).attr("x2",function(e){return l.scale.x(e.name)+10}).attr("y1",function(e){return l.scale.y(e.values.median)}).attr("y2",function(e){return l.scale.y(e.values.median)});t.append("path").attr("class","lower-whisker").attr("d",function(e){return"M"+l.scale.x(e.name)+","+l.scale.y(e.values.q1)+"L"+l.scale.x(e.name)+","+l.scale.y(e.values.whiskers.lower)+"M"+(l.scale.x(e.name)-8)+","+l.scale.y(e.values.whiskers.lower)+"L"+(l.scale.x(e.name)+8)+","+l.scale.y(e.values.whiskers.lower)});a.select(".lower-whisker").transition().duration(e).attr("d",function(e){return"M"+l.scale.x(e.name)+","+l.scale.y(e.values.q1)+"L"+l.scale.x(e.name)+","+l.scale.y(e.values.whiskers.lower)+"M"+(l.scale.x(e.name)-8)+","+l.scale.y(e.values.whiskers.lower)+"L"+(l.scale.x(e.name)+8)+","+l.scale.y(e.values.whiskers.lower)});t.append("path").attr("class","upper-whisker").attr("d",function(e){return"M"+l.scale.x(e.name)+","+l.scale.y(e.values.q3)+"L"+l.scale.x(e.name)+","+l.scale.y(e.values.whiskers.upper)+"M"+(l.scale.x(e.name)-8)+","+l.scale.y(e.values.whiskers.upper)+"L"+(l.scale.x(e.name)+8)+","+l.scale.y(e.values.whiskers.upper)});a.select(".upper-whisker").transition().duration(e).attr("d",function(e){return"M"+l.scale.x(e.name)+","+l.scale.y(e.values.q3)+"L"+l.scale.x(e.name)+","+l.scale.y(e.values.whiskers.upper)+"M"+(l.scale.x(e.name)-8)+","+l.scale.y(e.values.whiskers.upper)+"L"+(l.scale.x(e.name)+8)+","+l.scale.y(e.values.whiskers.upper)});a.selectAll(".mild-outlier").transition().duration(e).style("opacity",0).remove();var r=a.selectAll(".mild-outlier").data(function(e){return e.values.outliers.mild.map(function(t){return{x:e.name,y:t}})});r.enter().append("circle").attr("class","mild-outlier").attr("r",2.5).attr("cx",function(e){return l.scale.x(e.x)}).attr("cy",function(e){return l.scale.y(e.y)}).attr("stroke","none").style("opacity",0).transition().duration(e).style("opacity",1);a.selectAll(".extreme-outlier").transition().duration(e).style("opacity",0).remove();var c=a.selectAll(".extreme-outlier").data(function(e){return e.values.outliers.extreme.map(function(t){return{x:e.name,y:t}})});c.enter().append("circle").attr("class","extreme-outlier").attr("r",2).attr("cx",function(e){return l.scale.x(e.x)}).attr("cy",function(e){return l.scale.y(e.y)}).attr("fill","none").attr("stroke-width","0.5px").style("opacity",0).transition().duration(e).style("opacity",1)};n.render.style=function(){n.attr.colors=n.utils.colors(s?s.map(function(e){return e.name}):null);l.g.style("width",n.attr.innerWidth+"px").style("height",n.attr.innerHeight+"px").attr("transform","translate("+n.attr.margins.left+","+n.attr.margins.top+")").style("pointer-events","all");l.axes.x.attr("transform","translate(0,"+n.attr.innerHeight+")");l.axisFn.y.tickFormat(n.attr.yTickFormat);l.axes.y.attr("transform","translate(0,"+1+")");l.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");l.labels.x.attr("x",n.attr.innerWidth+"px").attr("y",n.attr.innerHeight+2.2*n.attr.fontSize+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.xLabel);l.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",n.attr.fontColor).style("font-size",n.attr.fontSize+"px").text(n.attr.yLabel)}}r.prototype=Object.create(a.prototype);return r});