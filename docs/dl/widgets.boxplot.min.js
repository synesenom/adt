(function(e,t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],t)}else{e.du=e.du||{};e.du.widgets=e.du.widgets||{};e.du.widgets.BoxPlot=t(e.d3,e.du.Widget)}})(this,function(m,a){"use strict";function e(e,t){var l=a.call(this,e,"boxplot","svg",t);var s={};var i=[];var u=null;var o={};var c=false;this.data=function(e){i=e.map(function(e){var t=e.values.sort(m.ascending),a=m.min(t),r=m.max(t),n=m.quantile(t,.25),l=m.quantile(t,.75),s=l-n;var i=[],u=[];e.values.filter(function(e){return e<n-1.5*s||e>l+1.5*s}).forEach(function(e){if(e<n-3*s||e>l+3*s){u.push(e)}else{i.push(e)}});return{name:e.name,values:{min:a,max:r,mean:m.mean(t),median:m.median(t),q1:n,q3:l,whiskers:{lower:Math.max(a,n-1.5*s),upper:Math.min(r,l+1.5*s)},outliers:{mild:i,extreme:u}}}});return this};this.highlight=function(e,t){if(!c)l.utils.highlight(this,s,".box",e,t);return this};l.utils.tooltip=function(){return u?{title:u.name,stripe:l.attr.colors[u.name],content:{type:"metrics",data:[{label:"min/max:",value:u.values.min.toPrecision(3)+"/"+u.values.max.toPrecision(3)},{label:"mean:",value:u.values.mean.toPrecision(3)},{label:"median:",value:u.values.median.toPrecision(3)},{label:"Q1:",value:u.values.q1.toPrecision(3)},{label:"Q3:",value:u.values.q3.toPrecision(3)},{label:"mild outliers:",value:u.values.outliers.mild.length},{label:"extreme outliers:",value:u.values.outliers.extreme.length}]}}:null};l.render.build=function(){s=l.utils.standardAxis();s.plots={}};l.render.update=function(e){s.scale={x:l.utils.scale(i.map(function(e){return e.name}).reverse(),[l.attr.innerWidth,0],"point"),y:l.utils.scale(i.map(function(e){return[e.values.min-.1*(e.values.max-e.values.min),e.values.max+.1*(e.values.max-e.values.min)]}).reduce(function(e,t){return e.concat(t)},[]),[l.attr.innerHeight,0])};s.axes.x.transition().duration(e).call(s.axisFn.x.tickValues(l.attr.xTicks).scale(s.scale.x));s.axes.y.transition().duration(e).call(s.axisFn.y.tickValues(l.attr.yTicks).scale(s.scale.y));o=l.utils.colors(i?i.map(function(e){return e.name}):null);s.plots.groups=s.g.selectAll(".box-group").data(i,function(e){return e.name});s.plots.groups.exit().style("opacity",0).remove();var t=s.plots.groups.enter().append("g").attr("class",function(e){return"box-group "+l.utils.encode(e.name)}).style("shape-rendering","geometricPrecision").style("opacity",0).style("fill","transparent");var a=t.merge(s.plots.groups).each(function(){c=true}).on("mouseover",function(e){u=e;l.attr.mouseover&&l.attr.mouseover(e.name)}).on("mouseleave",function(e){u=null;l.attr.mouseleave&&l.attr.mouseleave(e.name)}).on("click",function(e){l.attr.click&&l.attr.click(e.name)});a.transition().duration(e).style("opacity",1).style("fill-opacity",l.attr.opacity).style("fill",function(e){return o[e.name]}).style("stroke",function(e){return o[e.name]}).on("end",function(){c=false});t.append("rect").attr("class","body").attr("x",function(e){return s.scale.x(e.name)-10}).attr("y",function(e){return s.scale.y(e.values.q3)}).attr("width",20).attr("height",function(e){return s.scale.y(e.values.q1)-s.scale.y(e.values.q3)}).style("rx","2px").style("ry","2px").style("fill-opacity",.3).style("stroke-width","1px");a.select(".body").transition().duration(e).attr("x",function(e){return s.scale.x(e.name)-10}).attr("y",function(e){return s.scale.y(e.values.q3)}).attr("width",20).attr("height",function(e){return s.scale.y(e.values.q1)-s.scale.y(e.values.q3)});t.append("line").attr("class","median").attr("x1",function(e){return s.scale.x(e.name)-10}).attr("x2",function(e){return s.scale.x(e.name)+10}).attr("y1",function(e){return s.scale.y(e.values.median)}).attr("y2",function(e){return s.scale.y(e.values.median)}).style("stroke-width","2px").style("fill-opacity",.8);a.select(".median").transition().duration(e).attr("x1",function(e){return s.scale.x(e.name)-10}).attr("x2",function(e){return s.scale.x(e.name)+10}).attr("y1",function(e){return s.scale.y(e.values.median)}).attr("y2",function(e){return s.scale.y(e.values.median)});t.append("path").attr("class","lower-whisker").attr("d",function(e){return"M"+s.scale.x(e.name)+","+s.scale.y(e.values.q1)+"L"+s.scale.x(e.name)+","+s.scale.y(e.values.whiskers.lower)+"M"+(s.scale.x(e.name)-8)+","+s.scale.y(e.values.whiskers.lower)+"L"+(s.scale.x(e.name)+8)+","+s.scale.y(e.values.whiskers.lower)});a.select(".lower-whisker").transition().duration(e).attr("d",function(e){return"M"+s.scale.x(e.name)+","+s.scale.y(e.values.q1)+"L"+s.scale.x(e.name)+","+s.scale.y(e.values.whiskers.lower)+"M"+(s.scale.x(e.name)-8)+","+s.scale.y(e.values.whiskers.lower)+"L"+(s.scale.x(e.name)+8)+","+s.scale.y(e.values.whiskers.lower)});t.append("path").attr("class","upper-whisker").attr("d",function(e){return"M"+s.scale.x(e.name)+","+s.scale.y(e.values.q3)+"L"+s.scale.x(e.name)+","+s.scale.y(e.values.whiskers.upper)+"M"+(s.scale.x(e.name)-8)+","+s.scale.y(e.values.whiskers.upper)+"L"+(s.scale.x(e.name)+8)+","+s.scale.y(e.values.whiskers.upper)});a.select(".upper-whisker").transition().duration(e).attr("d",function(e){return"M"+s.scale.x(e.name)+","+s.scale.y(e.values.q3)+"L"+s.scale.x(e.name)+","+s.scale.y(e.values.whiskers.upper)+"M"+(s.scale.x(e.name)-8)+","+s.scale.y(e.values.whiskers.upper)+"L"+(s.scale.x(e.name)+8)+","+s.scale.y(e.values.whiskers.upper)});a.selectAll(".mild-outlier").transition().duration(e).style("opacity",0).remove();var r=a.selectAll(".mild-outlier").data(function(t){return t.values.outliers.mild.map(function(e){return{x:t.name,y:e}})});r.enter().append("circle").attr("class","mild-outlier").attr("r",2.5).attr("cx",function(e){return s.scale.x(e.x)}).attr("cy",function(e){return s.scale.y(e.y)}).attr("stroke","none").style("opacity",0).transition().duration(e).style("opacity",1);a.selectAll(".extreme-outlier").transition().duration(e).style("opacity",0).remove();var n=a.selectAll(".extreme-outlier").data(function(t){return t.values.outliers.extreme.map(function(e){return{x:t.name,y:e}})});n.enter().append("circle").attr("class","extreme-outlier").attr("r",2).attr("cx",function(e){return s.scale.x(e.x)}).attr("cy",function(e){return s.scale.y(e.y)}).attr("fill","none").attr("stroke-width","0.5px").style("opacity",0).transition().duration(e).style("opacity",1)};l.render.style=function(){l.attr.colors=l.utils.colors(i?i.map(function(e){return e.name}):null);s.g.style("width",l.attr.innerWidth+"px").style("height",l.attr.innerHeight+"px").attr("transform","translate("+l.attr.margins.left+","+l.attr.margins.top+")").style("pointer-events","all");s.axes.x.attr("transform","translate(0,"+l.attr.innerHeight+")");s.axisFn.y.tickFormat(l.attr.yTickFormat);s.axes.y.attr("transform","translate(0,"+1+")");s.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");s.labels.x.attr("x",l.attr.innerWidth+"px").attr("y",l.attr.innerHeight+2.8*l.attr.fontSize+"px").attr("fill",l.attr.fontColor).style("font-size",l.attr.fontSize+"px").text(l.attr.xLabel);s.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",l.attr.fontColor).style("font-size",l.attr.fontSize+"px").text(l.attr.yLabel)}}e.prototype=Object.create(a.prototype);return e});