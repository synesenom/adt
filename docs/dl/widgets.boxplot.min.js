(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BoxPlot=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,a){"use strict";function r(r,l){var s=a.call(this,r,"boxplot","svg",l);var n={};var i=[];var o=null;this.data=function(e){i=[];e.forEach(function(e){var a=e.data.sort(t.ascending);var r=t.min(a),l=t.max(a),s=t.quantile(a,.25),n=t.quantile(a,.75),o=n-s;var c=[],u=[];e.data.filter(function(t){return t<s-1.5*o||t>n+1.5*o}).forEach(function(t){if(t<s-3*o||t>n+3*o){u.push(t)}else{c.push(t)}});i.push({name:e.name,min:r,max:l,mean:t.mean(a),median:t.median(a),q1:s,q3:n,whiskers:{lower:Math.max(r,s-1.5*o),upper:Math.min(l,n+1.5*o)},outliers:{mild:c,extreme:u}})});return this};this.highlight=function(t,e){return s.utils.highlight(this,n,".box",t,e)};s.utils.tooltip=function(){return o?{title:o.name,stripe:s.attr.colors[o.name],content:{type:"metrics",data:[{label:"min/max:",value:o.min.toPrecision(3)+"/"+o.max.toPrecision(3)},{label:"mean:",value:o.mean.toPrecision(3)},{label:"median:",value:o.median.toPrecision(3)},{label:"Q1:",value:o.q1.toPrecision(3)},{label:"Q3:",value:o.q3.toPrecision(3)},{label:"#mild outliers:",value:o.outliers.mild.length},{label:"#extreme outliers:",value:o.outliers.extreme.length}]}}:null};s.render.build=function(){n.g=s.widget.append("g");n.axisFn={x:t.axisBottom().ticks(5),y:t.axisLeft().ticks(5)};n.axes={x:n.g.append("g").attr("class","x axis"),y:n.g.append("g").attr("class","y axis")};n.labels={x:n.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:n.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};s.render.update=function(t){n.scale={x:s.utils.scale(i.map(function(t){return t.name}).reverse(),[s.attr.innerWidth,0],"point"),y:s.utils.scale(i.map(function(t){return[t.min-.1*(t.max-t.min),t.max+.1*(t.max-t.min)]}).reduce(function(t,e){return t.concat(e)},[]),[s.attr.innerHeight,0])};n.axes.x.transition().duration(t).call(n.axisFn.x.scale(n.scale.x));n.axes.y.transition().duration(t).call(n.axisFn.y.scale(n.scale.y));if(i.length>0){if(n.boxes===undefined){n.boxes={};i.forEach(function(t){var e=n.g.selectAll("."+s.utils.encode(t.name)).data([t]).enter().append("g").attr("class","box "+s.utils.encode(t.name));n.boxes[t.name]={g:e,body:e.append("rect").attr("x",n.scale.x(t.name)-10).attr("y",n.scale.y(t.q3)).attr("width",20).attr("height",n.scale.y(t.q1)-n.scale.y(t.q3)).style("rx","2px").style("ry","2px").style("fill-opacity",.3).style("stroke-width","1px"),median:e.append("line").attr("class","median").attr("x1",n.scale.x(t.name)-10).attr("x2",n.scale.x(t.name)+10).attr("y1",n.scale.y(t.median)).attr("y2",n.scale.y(t.median)).style("stroke-width","2px").style("fill-opacity",.8),whiskers:{lower:e.append("path").attr("d","M"+n.scale.x(t.name)+","+n.scale.y(t.q1)+"L"+n.scale.x(t.name)+","+n.scale.y(t.whiskers.lower)+"M"+(n.scale.x(t.name)-8)+","+n.scale.y(t.whiskers.lower)+"L"+(n.scale.x(t.name)+8)+","+n.scale.y(t.whiskers.lower)),upper:e.append("path").attr("d","M"+n.scale.x(t.name)+","+n.scale.y(t.q3)+"L"+n.scale.x(t.name)+","+n.scale.y(t.whiskers.upper)+"M"+(n.scale.x(t.name)-8)+","+n.scale.y(t.whiskers.upper)+"L"+(n.scale.x(t.name)+8)+","+n.scale.y(t.whiskers.upper))},outliers:{mild:e.append("g").attr("class","mild-outlier").selectAll(".mild-outlier").data(t.outliers.mild).enter().append("circle").attr("r",2.5).attr("cx",n.scale.x(t.name)).attr("cy",function(t){return n.scale.y(t)}).attr("stroke","none"),extreme:e.append("g").attr("class","extreme-outlier").selectAll(".extreme-outlier").data(t.outliers.extreme).enter().append("circle").attr("r",2).attr("cx",n.scale.x(t.name)).attr("cy",function(t){return n.scale.y(t)}).attr("fill","none").attr("stroke-width","0.5px")}}})}i.forEach(function(t){})}};s.render.style=function(){s.attr.colors=s.utils.colors(i?i.map(function(t){return t.name}):null);n.g.style("width",s.attr.innerWidth+"px").style("height",s.attr.innerHeight+"px").attr("transform","translate("+s.attr.margins.left+","+s.attr.margins.top+")").style("pointer-events","all");n.axes.x.attr("transform","translate(0,"+s.attr.innerHeight+")");n.axisFn.y.tickFormat(s.attr.yTickFormat);n.axes.y.attr("transform","translate(0,"+1+")");n.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");n.labels.x.attr("x",s.attr.innerWidth+"px").attr("y",s.attr.innerHeight+2.2*s.attr.fontSize+"px").attr("fill",s.attr.fontColor).style("font-size",s.attr.fontSize+"px").text(s.attr.xLabel);n.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",s.attr.fontColor).style("font-size",s.attr.fontSize+"px").text(s.attr.yLabel);e.forOwn(n.boxes,function(t,e){t.body.style("fill",s.attr.colors[e]).style("stroke",s.attr.colors[e]);t.whiskers.lower.style("stroke",s.attr.colors[e]);t.whiskers.upper.style("stroke",s.attr.colors[e]);t.median.style("fill",s.attr.colors[e]).style("stroke",s.attr.colors[e]);t.outliers.mild.style("fill",s.attr.colors[e]);t.outliers.extreme.style("stroke",s.attr.colors[e]);t.g.on("mouseover",function(t){o=t;s.attr.mouseover&&s.attr.mouseover(e)}).on("mouseleave",function(){o=null;s.attr.mouseleave&&s.attr.mouseleave(e)}).on("click",function(){s.attr.click&&s.attr.click(e)})})}}r.prototype=Object.create(a.prototype);return r});