(function(e,t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t(require("d3"),require("lodash"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],t)}else{e.du=e.du||{};e.du.widgets=e.du.widgets||{};e.du.widgets.BoxPlot=t(e.d3,e._,e.du.Widget)}})(this,function(e,t,a){"use strict";function r(r,s){var l=a.call(this,r,"boxplot","svg",s);var n={};var i=[];var o=null;this.data=function(t){i=[];t.forEach(function(t){var a=t.data.sort(e.ascending);var r=e.min(a),s=e.max(a),l=e.quantile(a,.25),n=e.quantile(a,.75),o=n-l;var c=[],x=[];t.data.filter(function(e){return e<l-1.5*o||e>n+1.5*o}).forEach(function(e){if(e<l-3*o||e>n+3*o){x.push(e)}else{c.push(e)}});i.push({name:t.name,min:r,max:s,mean:e.mean(a),median:e.median(a),q1:l,q3:n,whiskers:{lower:Math.max(r,l-1.5*o),upper:Math.min(s,n+1.5*o)},outliers:{mild:c,extreme:x}})});console.log(i);return this};this.highlight=function(e,t){return l.utils.highlight(this,n,".box",e,t)};l.utils.tooltip=function(){return o?{title:o.name,stripe:l.attr.colors[o.name],content:{type:"metrics",data:[{label:"min/max:",value:o.min.toPrecision(3)+"/"+o.max.toPrecision(3)},{label:"mean:",value:o.mean.toPrecision(3)},{label:"median:",value:o.median.toPrecision(3)},{label:"Q1:",value:o.q1.toPrecision(3)},{label:"Q3:",value:o.q3.toPrecision(3)},{label:"#mild outliers:",value:o.outliers.mild.length},{label:"#extreme outliers:",value:o.outliers.extreme.length}]}}:null};l.render.build=function(){n.g=l.widget.append("g");n.axisFn={x:e.axisBottom().ticks(5),y:e.axisLeft().ticks(5)};n.axes={x:n.g.append("g").attr("class","x axis"),y:n.g.append("g").attr("class","y axis")};n.labels={x:n.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:n.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};l.render.update=function(e){n.scale={x:l.utils.scale(i.map(function(e){return e.name}).reverse(),[l.attr.innerWidth,0],"point"),y:l.utils.scale(i.map(function(e){return[e.min-.1*(e.max-e.min),e.max+.1*(e.max-e.min)]}).reduce(function(e,t){return e.concat(t)},[]),[l.attr.innerHeight,0])};n.axes.x.transition().duration(e).call(n.axisFn.x.scale(n.scale.x));n.axes.y.transition().duration(e).call(n.axisFn.y.scale(n.scale.y));if(i.length>0){if(n.boxes===undefined){n.boxes={};i.forEach(function(e){var t=n.g.selectAll("."+l.utils.encode(e.name)).data([e]).enter().append("g").attr("class","box "+l.utils.encode(e.name));n.boxes[e.name]={g:t,body:t.append("rect").attr("x",n.scale.x(e.name)-10).attr("y",n.scale.y(e.q3)).attr("width",20).attr("height",n.scale.y(e.q1)-n.scale.y(e.q3)).style("rx","2px").style("ry","2px").style("fill-opacity",.3).style("stroke-width","1px"),median:t.append("line").attr("class","median").attr("x1",n.scale.x(e.name)-10).attr("x2",n.scale.x(e.name)+10).attr("y1",n.scale.y(e.median)).attr("y2",n.scale.y(e.median)).style("stroke-width","2px").style("fill-opacity",.8),whiskers:{lower:t.append("path").attr("d","M"+n.scale.x(e.name)+","+n.scale.y(e.q1)+"L"+n.scale.x(e.name)+","+n.scale.y(e.whiskers.lower)+"M"+(n.scale.x(e.name)-8)+","+n.scale.y(e.whiskers.lower)+"L"+(n.scale.x(e.name)+8)+","+n.scale.y(e.whiskers.lower)),upper:t.append("path").attr("d","M"+n.scale.x(e.name)+","+n.scale.y(e.q3)+"L"+n.scale.x(e.name)+","+n.scale.y(e.whiskers.upper)+"M"+(n.scale.x(e.name)-8)+","+n.scale.y(e.whiskers.upper)+"L"+(n.scale.x(e.name)+8)+","+n.scale.y(e.whiskers.upper))},outliers:{mild:t.append("g").attr("class","mild-outlier").selectAll(".mild-outlier").data(e.outliers.mild).enter().append("circle").attr("r",2.5).attr("cx",n.scale.x(e.name)).attr("cy",function(e){return n.scale.y(e)}).attr("stroke","none"),extreme:t.append("g").attr("class","extreme-outlier").selectAll(".extreme-outlier").data(e.outliers.extreme).enter().append("circle").attr("r",2).attr("cx",n.scale.x(e.name)).attr("cy",function(e){return n.scale.y(e)}).attr("fill","none").attr("stroke-width","0.5px")}}})}i.forEach(function(t){n.boxes[t.name].body.transition().duration(e).attr("x",n.scale.x(t.name)-10).attr("y",n.scale.y(t.q3)).attr("width",20).attr("height",n.scale.y(t.q1)-n.scale.y(t.q3));n.boxes[t.name].median.transition().duration(e).attr("x1",n.scale.x(t.name)-10).attr("x2",n.scale.x(t.name)+10).attr("y1",n.scale.y(t.median)).attr("y2",n.scale.y(t.median));n.boxes[t.name].whiskers.lower.transition().duration(e).attr("d","M"+n.scale.x(t.name)+","+n.scale.y(t.q1)+"L"+n.scale.x(t.name)+","+n.scale.y(t.whiskers.lower)+"M"+(n.scale.x(t.name)-8)+","+n.scale.y(t.whiskers.lower)+"L"+(n.scale.x(t.name)+8)+","+n.scale.y(t.whiskers.lower));n.boxes[t.name].whiskers.upper.transition().duration(e).attr("d","M"+n.scale.x(t.name)+","+n.scale.y(t.q3)+"L"+n.scale.x(t.name)+","+n.scale.y(t.whiskers.upper)+"M"+(n.scale.x(t.name)-8)+","+n.scale.y(t.whiskers.upper)+"L"+(n.scale.x(t.name)+8)+","+n.scale.y(t.whiskers.upper));n.boxes[t.name].outliers.mild.remove();n.boxes[t.name].outliers.mild=n.boxes[t.name].g.append("g").attr("class","mild-outlier").selectAll(".mild-outlier").data(t.outliers.mild).enter().append("circle").attr("r",2.5).attr("cx",n.scale.x(t.name)).attr("cy",function(e){return n.scale.y(e)}).style("stroke","none");n.boxes[t.name].outliers.extreme.remove();n.boxes[t.name].outliers.extreme=n.boxes[t.name].g.append("g").attr("class","extreme-outlier").selectAll(".extreme-outlier").data(t.outliers.extreme).enter().append("circle").attr("r",2).attr("cx",n.scale.x(t.name)).attr("cy",function(e){return n.scale.y(e)}).attr("fill","none").attr("stroke-width","0.5px")})}};l.render.style=function(){l.attr.colors=l.utils.colors(i?i.map(function(e){return e.name}):null);n.g.style("width",l.attr.innerWidth+"px").style("height",l.attr.innerHeight+"px").attr("transform","translate("+l.attr.margins.left+","+l.attr.margins.top+")").style("pointer-events","all");n.axes.x.attr("transform","translate(0,"+l.attr.innerHeight+")");n.axisFn.y.tickFormat(l.attr.yTickFormat);n.axes.y.attr("transform","translate(0,"+1+")");n.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");n.labels.x.attr("x",l.attr.innerWidth+"px").attr("y",l.attr.innerHeight+2.2*l.attr.fontSize+"px").attr("fill",l.attr.fontColor).style("font-size",l.attr.fontSize+"px").text(l.attr.xLabel);n.labels.y.attr("x",5+"px").attr("y",-5+"px").attr("fill",l.attr.fontColor).style("font-size",l.attr.fontSize+"px").text(l.attr.yLabel);t.forOwn(n.boxes,function(e,t){e.body.style("fill",l.attr.colors[t]).style("stroke",l.attr.colors[t]);e.whiskers.lower.style("stroke",l.attr.colors[t]);e.whiskers.upper.style("stroke",l.attr.colors[t]);e.median.style("fill",l.attr.colors[t]).style("stroke",l.attr.colors[t]);e.outliers.mild.style("fill",l.attr.colors[t]);e.outliers.extreme.style("stroke",l.attr.colors[t]);e.g.on("mouseover",function(e){o=e;l.attr.mouseover&&l.attr.mouseover(t)}).on("mouseleave",function(){o=null;l.attr.mouseleave&&l.attr.mouseleave(t)}).on("click",function(){l.attr.click&&l.attr.click(t)})})}}r.prototype=Object.create(a.prototype);return r});