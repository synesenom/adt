(function(n,r){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=r(require("lodash"))}else if(typeof define==="function"&&define.amd){define(["_","exports"],r)}else{n.du=n.du||{};n.du.data=r(n._)}})(this,function(n){"use strict";var r={si:function(){var n="yzafpnÎ¼m kMGTPEZY";var r=(n.length-1)/2;var t=r;var e=-r;function u(u){if(u===null||u===undefined||isNaN(u))return"N/A";if(u===0)return"0";var i=Math.abs(u);var o=Math.max(Math.min(parseInt(Math.floor(Math.log(i)/Math.log(1e3))),t),e);var f=i/Math.pow(1e3,o);return(u<0?"-":"")+(o===e||o===t?f.toExponential(2):f.toPrecision(3)).replace(/e\+0$/,"")+n.charAt(r+o).trim()}return u}(),idfy:function(n){return n?n.replace(/ /g,"__"):""},namify:function(n){return n?n.replace(/__/g," "):""}};var t={sum:function(r,t,e){var u={};var i=[];if(Array.isArray(e)){i=e}else{i=[e]}var o=i.length;r.forEach(function(n){var r=[];i.forEach(function(t){if(n.hasOwnProperty(t)){r.push(n[t])}});if(r.length!==o)return;var e=r.join(".");if(!u.hasOwnProperty(e))u[e]=+n[t];else u[e]+=+n[t]});var f=[];n.forOwn(u,function(n,r){f.push({key:r,value:n})});return f.sort(function(n,r){return r.value-n.value})}};var e={Histogram:function(r){var t=r?r:[];this.set=function(n){t=n;return this};function e(){return n.cloneDeep(t)}function u(n,r){t.push({x:n,y:r,index:t.length});return this}function i(n){t.forEach(function(r){r.y*=n});return this}function o(){var n=d3.sum(t,function(n){return n.y});t.forEach(function(r){r.y/=n});return this}function f(n){t.sort(function(r,t){return n?t.x-r.x:r.x-t.x});return this}function a(n){t.sort(function(r,t){return n?t.y-r.y:r.y-t.y});return this}function c(){t.sort(function(n,r){return n.index-r.index});return this}return{set:set,get:e,add:u,scale:i,normalize:o,sortByX:f,sortByY:a,unsort:c}},TimeSeries:function(r){var t=[];function e(n){t=[];var e=0;if(n!==null){var u=new Date(n);while(u<=new Date){t.push({x:new Date(u),y:{}});r.forEach(function(n){t[e].y[n]=0});u.setDate(u.getDate()+1);e++}}return this}function u(n,r,e,u){t[n].x=r;t[n].y[e]+=u}function i(n,r){if(!n)return t;else{var e=r?r:0;return t.slice(-e-n,-e)}}function o(r,e){if(t.length<1)return{};var u={};n.forOwn(t[0].y,function(n,r){u[r]=0});i(r?r:1,e).forEach(function(r){n.forOwn(t[0].y,function(n,t){u[t]+=r.y[t]})});return u}function f(r,e){var u=0;if(t.length>0){var o=i(r,e);n.forOwn(t[0].y,function(n,r){u=Math.max(d3.max(o,function(n){return n.y.hasOwnProperty(r)?n.y[r]:0}),u)})}return u}function a(r){if(t.length<1)return{};var e=o(1,r);var u=o(2,r);var i={};n.forOwn(t[0].y,function(n,r){u[r]-=e[r];if(u[r]>=10&&e[r]>0){i[r]=(e[r]-u[r])/u[r]}});return i}function c(r,t){var e=o(r,t);var u=0;n.forOwn(e,function(n){u+=n});n.forOwn(e,function(n,r){e[r]/=u>0?u:1});return e}return{clear:e,update:u,sub:i,sum:o,peak:f,trend:a,yDist:c}},Table:function(r){var t=[];var e=[];if(r){t=n.cloneDeep(r);t.forEach(function(n,r){e.push(r)})}function u(n,r){var e=[];t.forEach(function(t){var u;if(typeof r==="string"){u=t[r]}else{u={};r.forEach(function(n){u[n]=t[n]})}e.push({x:t[n],y:u})});return e}function i(n,r){var e=null;switch(typeof r){case"number":var u=d3.min(t,function(t){return Math.abs((r-t[n])/r)});e=t.filter(function(t){return Math.abs((t[n]-r)/r)<=u*1.01});break;case"string":default:e=t.filter(function(t){return t[n]===r})}return new du.data.structures.Table(e)}function o(n){t.sort(function(r,t){return r[n]-t[n]});return this}function f(){var n=[];e.forEach(function(r){n.push(t[r])});t=n}return{slice:u,segment:i,sort:o,unsort:f}}};return{format:r,explore:t,structures:e}});