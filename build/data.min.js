(function(n,r){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=r(require("lodash"))}else if(typeof define==="function"&&define.amd){define(["_","exports"],r)}else{n.du=n.du||{};n.du.data=r(n._)}})(this,function(c){"use strict";var n={si:function(){var u="yzafpnÎ¼m kMGTPEZY";var i=(u.length-1)/2;var o=i;var f=-i;function n(n){if(n===null||n===undefined||isNaN(n))return"N/A";if(n===0)return"0";var r=Math.abs(n);var t=Math.max(Math.min(parseInt(Math.floor(Math.log(r)/Math.log(1e3))),o),f);var e=r/Math.pow(1e3,t);return(n<0?"-":"")+(t===f||t===o?e.toExponential(2):e.toPrecision(3)).replace(/e\+0$/,"")+u.charAt(i+t).trim()}return n}(),idfy:function(n){return n?n.replace(/ /g,"__"):""},namify:function(n){return n?n.replace(/__/g," "):""}};var r={sum:function(n,e,r){var u={};var i=[];if(Array.isArray(r)){i=r}else{i=[r]}var o=i.length;n.forEach(function(r){var t=[];i.forEach(function(n){if(r.hasOwnProperty(n)){t.push(r[n])}});if(t.length!==o)return;var n=t.join(".");if(!u.hasOwnProperty(n))u[n]=+r[e];else u[n]+=+r[e]});var t=[];c.forOwn(u,function(n,r){t.push({key:r,value:n})});return t.sort(function(n,r){return r.value-n.value})}};var t={Histogram:function(n){var e=n?n:[];this.set=function(n){e=n;return this};function r(){return c.cloneDeep(e)}function t(n,r){e.push({x:n,y:r,index:e.length});return this}function u(r){e.forEach(function(n){n.y*=r});return this}function i(){var r=d3.sum(e,function(n){return n.y});e.forEach(function(n){n.y/=r});return this}function o(t){e.sort(function(n,r){return t?r.x-n.x:n.x-r.x});return this}function f(t){e.sort(function(n,r){return t?r.y-n.y:n.y-r.y});return this}function a(){e.sort(function(n,r){return n.index-r.index});return this}return{set:set,get:r,add:t,scale:u,normalize:i,sortByX:o,sortByY:f,unsort:a}},TimeSeries:function(e){var i=[];function n(n){i=[];var r=0;if(n!==null){var t=new Date(n);while(t<=new Date){i.push({x:new Date(t),y:{}});e.forEach(function(n){i[r].y[n]=0});t.setDate(t.getDate()+1);r++}}return this}function r(n,r,t,e){i[n].x=r;i[n].y[t]+=e}function u(n,r){if(!n)return i;else{var t=r?r:0;return i.slice(-t-n,-t)}}function o(n,r){if(i.length<1)return{};var e={};c.forOwn(i[0].y,function(n,r){e[r]=0});u(n?n:1,r).forEach(function(t){c.forOwn(i[0].y,function(n,r){e[r]+=t.y[r]})});return e}function t(n,r){var t=0;if(i.length>0){var e=u(n,r);c.forOwn(i[0].y,function(n,r){t=Math.max(d3.max(e,function(n){return n.y.hasOwnProperty(r)?n.y[r]:0}),t)})}return t}function f(n){if(i.length<1)return{};var t=o(1,n);var e=o(2,n);var u={};c.forOwn(i[0].y,function(n,r){e[r]-=t[r];if(e[r]>=10&&t[r]>0){u[r]=(t[r]-e[r])/e[r]}});return u}function a(n,r){var t=o(n,r);var e=0;c.forOwn(t,function(n){e+=n});c.forOwn(t,function(n,r){t[r]/=e>0?e:1});return t}return{clear:n,update:r,sub:u,sum:o,peak:t,trend:f,yDist:a}},Table:function(n){var i=[];var t=[];if(n){i=c.cloneDeep(n);i.forEach(function(n,r){t.push(r)})}function r(n,e){var u=[];i.forEach(function(r){var t;if(typeof e==="string"){t=r[e]}else{t={};e.forEach(function(n){t[n]=r[n]})}u.push({x:r[n],y:t})});return u}function e(r,t){var n=null;switch(typeof t){case"number":var e=d3.min(i,function(n){return Math.abs((t-n[r])/t)});n=i.filter(function(n){return Math.abs((n[r]-t)/t)<=e*1.01});break;case"string":default:n=i.filter(function(n){return n[r]===t})}return new du.data.structures.Table(n)}function u(t){i.sort(function(n,r){return n[t]-r[t]});return this}function o(){var r=[];t.forEach(function(n){r.push(i[n])});i=r}return{slice:r,segment:e,sort:u,unsort:o}}};return{format:n,explore:r,structures:t}});