(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","lodash","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.PieChart=e(t.d3,t._,t.du.Widget)}})(this,function(t,e,r){"use strict";function a(a,i){var n=r.call(this,a,"piechart","svg",i);n.attr.add(this,"innerRadius",0,"dim");n.attr.add(this,"outerRadius",50,"dim");n.attr.add(this,"ticks",false);var u={};var s=[];var o=null;this.data=function(t){s=[];e.forOwn(t,function(t,e){s.push({name:e,value:t})});s.sort(function(t,e){return e.value-t.value});return this};this.highlight=function(t,e){n.utils.highlight(this,u,"path",t,e);n.utils.highlight(this,u,"text",t,e);return this};n.utils.tooltip=function(){return o?{title:o.name,plots:[{id:"",color:n.attr.colors[o.name],value:(100*o.value/t.sum(s,function(t){return t.value})).toFixed(1)+"%&nbsp;("+o.value+")"}]}:null};n.render.build=function(){u.g=n.widget.append("g");u.label=u.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white");u.arc=t.arc();u.pie=t.pie().value(function(t){return t.value}).sort(null);u.arcs=u.g.selectAll(".arc").data(u.pie(s)).enter().append("g").attr("class","arc");u.paths=u.arcs.append("path").attr("class",function(t){return n.utils.encode(t.data.name)}).style("shape-rendering","geometricPrecision").style("pointer-events","all").each(function(t){this._current=t});if(n.attr.ticks){u.labelArc=t.arc();u.ticks=u.arcs.append("text").attr("class",function(t){return n.utils.encode(t.data.name)}).style("text-anchor","middle").attr("dy","0.35em").each(function(t){this._current=t})}};n.render.update=function(e){u.arcs.datum(s);u.paths.data(u.pie(s)).transition().duration(e).attrTween("d",function(e){var r=t.interpolate(this._current,e);this._current=r(0);return function(t){return u.arc(r(t))}});if(n.attr.ticks){u.ticks.data(u.pie(s)).text(function(e){return n.attr.tickFormat(100*e.data.value/t.sum(s,function(t){return t.value}))}).transition().duration(e).attrTween("transform",function(e){var r=t.interpolate(this._current,e);this._current=r(0);return function(t){return"translate("+u.labelArc.centroid(r(t))+")"}})}};n.render.style=function(){n.attr.colors=n.utils.colors(s?s.map(function(t){return t.name}):null);var t=n.attr.outerRadius-n.attr.margins.left;n.attr.width=2*n.attr.outerRadius;n.attr.height=2*n.attr.outerRadius;n.widget.style("width",n.attr.width+"px").style("height",n.attr.height+"px");u.g.attr("transform","translate("+n.attr.outerRadius+","+n.attr.outerRadius+")");u.arc.outerRadius(t).innerRadius(n.attr.innerRadius);u.paths.attr("d",u.arc).attr("fill",function(t){return n.attr.colors[t.data.name]});if(n.attr.ticks){u.labelArc.outerRadius(.5*(n.attr.innerRadius+t)).innerRadius(.5*(n.attr.innerRadius+t));u.ticks.attr("d",u.labelArc).attr("fill",n.attr.fontColor)}u.label.attr("transform","translate(0,"+n.attr.outerRadius+")").style("width",10+2*n.attr.outerRadius+"px").style("font-size",Math.min(16,n.attr.outerRadius*.4)+"px").style("fill",n.attr.fontColor).text(n.attr.label);u.paths.on("mouseover",function(t){n.attr.mouseover&&n.attr.mouseover(t.data.name)}).on("mouseleave",function(t){n.attr.mouseleave&&n.attr.mouseleave(t.data.name)}).on("click",function(t){n.attr.click&&n.attr.click(t.data.name)}).on("mousemove",function(t){o=t.data})}}a.prototype=Object.create(r.prototype);return a});