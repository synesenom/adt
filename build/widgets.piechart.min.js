(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.PieChart=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function a(a,r){var i=e.call(this,a,"piechart","svg",r);i.attr.add(this,"innerRadius",0,"dim");i.attr.add(this,"outerRadius",50,"dim");i.attr.add(this,"ticks",false);var n=null;var s=[{name:"data",value:1}];this.data=function(t){s=t;return this};this.highlight=function(t,e){i.utils.highlight(this,n,"path",t,e);i.utils.highlight(this,n,"text",t,e);return this};i.render.build=function(){if(n!==null)return;n={};n.g=i.widget.append("g");n.label=n.g.append("text").attr("text-anchor","middle").attr("stroke-width","0px").style("fill","white");n.pie=t.pie().value(function(t){return t.value}).sort(null);n.arc=t.arc();n.arcs=n.g.selectAll(".arc").data(n.pie(s)).enter().append("g").attr("class","arc");n.paths=n.arcs.append("path").attr("class",function(t){return i.utils.encode(t.data.name)}).attr("fill",function(t){return i.attr.colors[t.data.name]}).style("shape-rendering","geometricPrecision").style("pointer-events","all").each(function(t){this._current=t});if(i.attr.ticks){n.labelArc=t.arc();n.ticks=n.arcs.append("text").attr("class",function(t){return i.utils.encode(t.data.name)}).style("text-anchor","middle").attr("dy","0.35em").each(function(t){this._current=t})}};i.render.update=function(e){n.arcs.datum(s);n.paths.data(n.pie(s));n.paths.transition().duration(e).attrTween("d",function(e){var a=t.interpolate(this._current,e);this._current=a(0);return function(t){return n.arc(a(t))}});if(i.attr.ticks){n.ticks.data(n.pie(s));n.ticks.text(function(t){return i.attr.tickFormat(t.data.value)}).transition().duration(e).attrTween("transform",function(e){var a=t.interpolate(this._current,e);this._current=a(0);return function(t){return"translate("+n.labelArc.centroid(a(t))+")"}})}};i.render.style=function(){var t=i.attr.outerRadius-i.attr.margins.left;i.attr.width=2*i.attr.outerRadius;i.attr.height=2*i.attr.outerRadius;i.widget.style("width",i.attr.width+"px").style("height",i.attr.height+"px");n.g.attr("transform","translate("+i.attr.outerRadius+","+i.attr.outerRadius+")");n.arc.outerRadius(t).innerRadius(i.attr.innerRadius);n.paths.attr("d",n.arc);if(i.attr.ticks){n.labelArc.outerRadius(.5*(i.attr.innerRadius+t)).innerRadius(.5*(i.attr.innerRadius+t));n.ticks.attr("d",n.labelArc).attr("fill",i.attr.fontColor)}n.label.attr("transform","translate(0,"+i.attr.outerRadius+")").style("width",10+2*i.attr.outerRadius+"px").style("font-size",Math.min(16,i.attr.outerRadius*.4)+"px").style("fill",i.attr.fontColor).text(i.attr.label);n.paths.on("mouseover",function(t){i.attr.mouseover&&i.attr.mouseover(t.data.name)});n.paths.on("mouseleave",function(t){i.attr.mouseleave&&i.attr.mouseleave(t.data.name)});n.paths.on("click",function(t){i.attr.click&&i.attr.click(t.data.name)})}}a.prototype=Object.create(e.prototype);return a});