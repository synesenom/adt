(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function a(a,r){var i=e.call(this,a,"histogram","svg",r);i.attr.add(this,"min",null);i.attr.add(this,"max",null);i.attr.add(this,"bin",null);i.attr.add(this,"normalize",false);var n={};var s=[];var l=[];this.data=function(t){s=t.sort(function(t,e){return+t-e});return this};this.highlight=function(t,e){return i.utils.highlight(this,n,".bar",t,e)};i.utils.tooltip=function(e){var a=t.bisector(function(t){return n.scale.x(t.x0)}).right;var r=e?a(l,e[0]):null;if(r===null){return}var s=l[r-1]?l[r-1]:l[r];var o=l[r]?l[r]:l[r-1];var c=e[0]-s.x>o.x-e[0]?o:s;var x=t.select(document.createElement("div"));x.append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").style("border-bottom","solid 1px "+i.attr.fontColor).text(i.attr.xLabel+": ["+c.x0.toPrecision(3)+", "+c.x1.toPrecision(3)+"]");var d=x.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");d.append("div").style("position","relative").style("width","10px").style("height","10px").style("float","left").style("background-color",i.attr.colors[0]);d.append("div").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").text(c.length.toPrecision(6));return x.node().innerHTML};i.render.build=function(){n.g=i.widget.append("g");n.axisFn={x:t.axisBottom().ticks(4),y:t.axisLeft().ticks(4)};n.axes={x:n.g.append("g").attr("class","x axis"),y:n.g.append("g").attr("class","y axis")};n.labels={x:n.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:n.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};i.render.update=function(e){if(s.length===0){return}var a=typeof i.attr.min==="number"?i.attr.min:s[0];var r=typeof i.attr.max==="number"?i.attr.max:s[s.length-1];var o=i.attr.bin;if(o===null){var c=(s.length+1)/4,x=Math.floor(c),d=Math.ceil(c),g=c-x,h=g*s[x]+(1-g)*s[d];var u=3*(s.length+1)/4,p=Math.floor(u),f=Math.ceil(u),m=u-p,y=m*s[p]+(1-m)*s[f];o=2*(y-h)/Math.pow(s.length,1/3)}var b=[];var v=Math.ceil((r-a)/o);for(var w=0;w<=v;w++){b.push(a+w*o)}var k=i.attr.normalize?s.length:1;l=t.histogram().domain([a,a+v*o]).thresholds(b)(s);var M=t.max(l,function(t){return t.length/k});n.scale=i.utils.scale({x:{min:a,max:a+v*o,domain:[a,r]},y:{min:0,max:M,domain:[0,M]}},i.attr.width-i.attr.margins.left-i.attr.margins.right,i.attr.height-i.attr.margins.top-i.attr.margins.bottom);n.axes.x.transition().duration(e).call(n.axisFn.x.scale(n.scale.x));n.axes.y.transition().duration(e).call(n.axisFn.y.scale(n.scale.y));if(s.length>0){if(n.bars===undefined){n.bars=n.g.selectAll(".bar").data(l).enter().append("rect").attr("class",function(t,e){return"bar bin-"+e}).style("pointer-events","all").style("stroke","none").style("shape-rendering","geometricPrecision");n.bars.attr("y",i.attr.height-i.attr.margins.top-i.attr.margins.bottom-1).attr("height",0)}n.bars.data(l);n.bars.attr("x",function(t){return n.scale.x(t.x0)+2}).attr("width",function(t){return Math.abs(n.scale.x(t.x1-t.x0)-2)}).transition().duration(e).attr("y",function(t){return i.attr.margins.top-i.attr.margins.top+n.scale.y(t.length/k)}).attr("height",function(t){return i.attr.height-i.attr.margins.top-i.attr.margins.bottom-n.scale.y(t.length/k)})}};i.render.style=function(){i.attr.colors=i.utils.colors([0]);var t=i.attr.width-i.attr.margins.left-i.attr.margins.right,e=i.attr.height-i.attr.margins.top-i.attr.margins.bottom;n.g.style("width",t+"px").style("height",e+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");n.axisFn.y.tickFormat(i.attr.yTickFormat);n.axes.x.attr("transform","translate(0,"+e+")");n.axes.y.attr("transform","translate(0,"+1+")");n.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof i.attr.xTickAngle==="number"){n.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+i.attr.xTickAngle+")").style("text-anchor","start")}n.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");n.labels.x.attr("x",t+"px").attr("y",e+2.6*i.attr.fontSize+"px").style("font-size",i.attr.fontSize+"px").style("fill",i.attr.fontColor).text(i.attr.xLabel);n.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",i.attr.fontSize+"px").style("fill",i.attr.fontColor).text(i.attr.yLabel);if(n.bars!==undefined){n.bars.style("fill",i.attr.colors[0]).on("mouseover",function(t,e){i.attr.mouseover&&i.attr.mouseover("bin-"+e)}).on("mouseleave",function(t,e){i.attr.mouseleave&&i.attr.mouseleave("bin-"+e)}).on("click",function(t,e){i.attr.click&&i.attr.click("bin-"+e)})}}}a.prototype=Object.create(e.prototype);return a});