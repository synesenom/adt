(function(t,r){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=r(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],r)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=r(t.d3,t.du.Widget)}})(this,function(t,r){"use strict";function a(a,e){var i=r.call(this,a,"histogram","svg",e);i.attr.add(this,"min",null);i.attr.add(this,"max",null);i.attr.add(this,"bin",null);i.attr.add(this,"normalize",false);var n={};var s=[];var l=[];this.data=function(t){s=t.sort(function(t,r){return+t-r});return this};this.highlight=function(t,r){return i.utils.highlight(this,n,".bar",t,r)};i.utils.tooltip=function(r){var a=t.bisector(function(t){return n.scale.x(t.x0)}).right;var e=r?a(l,r[0]):null;if(e===null){return}var s=l[e-1]?l[e-1]:l[e];var o=l[e]?l[e]:l[e-1];var c=r[0]-s.x>o.x-r[0]?o:s;return{title:i.attr.xLabel+": ["+c.x0.toPrecision(3)+", "+c.x1.toPrecision(3)+"]",plots:[{id:"",color:i.attr.colors[0],value:c.length.toPrecision(6)}]}};i.render.build=function(){n.g=i.widget.append("g");n.axisFn={x:t.axisBottom().ticks(4),y:t.axisLeft().ticks(4)};n.axes={x:n.g.append("g").attr("class","x axis"),y:n.g.append("g").attr("class","y axis")};n.labels={x:n.g.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:n.g.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}};i.render.update=function(r){if(s.length===0){return}var a=typeof i.attr.min==="number"?i.attr.min:s[0];var e=typeof i.attr.max==="number"?i.attr.max:s[s.length-1];var o=i.attr.bin;if(o===null){var c=(s.length+1)/4,u=Math.floor(c),x=Math.ceil(c),g=c-u,d=g*s[u]+(1-g)*s[x];var h=3*(s.length+1)/4,f=Math.floor(h),m=Math.ceil(h),p=h-f,y=p*s[f]+(1-p)*s[m];o=2*(y-d)/Math.pow(s.length,1/3)}var b=[];var v=Math.ceil((e-a)/o);for(var k=0;k<=v;k++){b.push(a+k*o)}var w=i.attr.normalize?s.length:1;l=t.histogram().domain([a,a+v*o]).thresholds(b)(s);var z=t.max(l,function(t){return t.length/w});n.scale=i.utils.scale({x:{min:a,max:a+v*o,domain:[a,e]},y:{min:0,max:z,domain:[0,z]}},i.attr.width-i.attr.margins.left-i.attr.margins.right,i.attr.height-i.attr.margins.top-i.attr.margins.bottom);n.axes.x.transition().duration(r).call(n.axisFn.x.scale(n.scale.x));n.axes.y.transition().duration(r).call(n.axisFn.y.scale(n.scale.y));if(s.length>0){if(n.bars===undefined){n.bars=n.g.selectAll(".bar").data(l).enter().append("rect").attr("class",function(t,r){return"bar bin-"+r}).style("pointer-events","all").style("stroke","none").style("shape-rendering","geometricPrecision");n.bars.attr("y",i.attr.height-i.attr.margins.top-i.attr.margins.bottom-1).attr("height",0)}n.bars.data(l);n.bars.attr("x",function(t){return n.scale.x(t.x0)+2}).attr("width",function(t){return Math.abs(n.scale.x(t.x1-t.x0)-2)}).transition().duration(r).attr("y",function(t){return i.attr.margins.top-i.attr.margins.top+n.scale.y(t.length/w)}).attr("height",function(t){return i.attr.height-i.attr.margins.top-i.attr.margins.bottom-n.scale.y(t.length/w)})}};i.render.style=function(){i.attr.colors=i.utils.colors([0]);var t=i.attr.width-i.attr.margins.left-i.attr.margins.right,r=i.attr.height-i.attr.margins.top-i.attr.margins.bottom;n.g.style("width",t+"px").style("height",r+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");n.axisFn.y.tickFormat(i.attr.yTickFormat);n.axes.x.attr("transform","translate(0,"+r+")");n.axes.y.attr("transform","translate(0,"+1+")");n.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof i.attr.xTickAngle==="number"){n.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+i.attr.xTickAngle+")").style("text-anchor","start")}n.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");n.labels.x.attr("x",t+"px").attr("y",r+2.6*i.attr.fontSize+"px").style("font-size",i.attr.fontSize+"px").style("fill",i.attr.fontColor).text(i.attr.xLabel);n.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",i.attr.fontSize+"px").style("fill",i.attr.fontColor).text(i.attr.yLabel);if(n.bars!==undefined){n.bars.style("fill",i.attr.colors[0]).on("mouseover",function(t,r){i.attr.mouseover&&i.attr.mouseover("bin-"+r)}).on("mouseleave",function(t,r){i.attr.mouseleave&&i.attr.mouseleave("bin-"+r)}).on("click",function(t,r){i.attr.click&&i.attr.click("bin-"+r)})}}}a.prototype=Object.create(r.prototype);return a});