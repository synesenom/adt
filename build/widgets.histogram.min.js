(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Histogram=e(t.d3,t.du.Widget)}})(this,function(m,a){"use strict";function t(t,e){var o=a.call(this,t,"histogram","svg",e);o.attr.add(this,"min",null);o.attr.add(this,"max",null);o.attr.add(this,"bin",null);o.attr.add(this,"normalize",false);var u={};var c=[];var f=[];var x={};var h=false;this.data=function(t){c=t.sort(function(t,e){return t-e});return this};this.highlight=function(t,e){if(!h)o.utils.highlight(this,u,".bar",t,e);return this};o.utils.tooltip=function(t){var e=m.bisector(function(t){return u.scale.x(t.values.x0)}).right;var a=t?e(f,t[0]):null;if(a===null){return}var r=f[a-1]?f[a-1]:f[a];var n=f[a]?f[a]:f[a-1];var i=t[0]-r.x>n.x-t[0]?n:r;return{title:i.name,content:{type:"metrics",data:[{label:"min:",value:i.values.x0.toPrecision(3)},{label:"max:",value:i.values.x1.toPrecision(3)},{label:"count:",value:i.values.length},{label:"fraction:",value:(100*i.values.length/m.sum(f,function(t){return t.values.length})).toFixed(2)+"%"}]}}};o.render.build=function(){u=o.utils.standardAxis();u.plots={}};o.render.update=function(t){if(c.length===0){return}var e=typeof o.attr.min==="number"?o.attr.min:c[0];var a=typeof o.attr.max==="number"?o.attr.max:c[c.length-1];var r=o.attr.bin;if(r===null){r=2*(m.quantile(c,.75)-m.quantile(c,.25))/Math.pow(c.length,1/3)}var n=[];var i=Math.ceil((a-e)/r);for(var l=0;l<=i;l++){n.push(e+l*r)}var s=o.attr.normalize?c.length:1;f=m.histogram().domain([e,e+i*r]).thresholds(n)(c).map(function(t,e){return{name:"bin "+e,values:t}});u.scale={x:o.utils.scale([e,e+i*r],[0,o.attr.innerWidth]),y:o.utils.scale([0,m.max(f,function(t){return t.values.length/s})],[o.attr.innerHeight,0])};u.axes.x.transition().duration(t).call(u.axisFn.x.scale(u.scale.x));u.axes.y.transition().duration(t).call(u.axisFn.y.scale(u.scale.y));x=o.utils.colors(f?f.map(function(t){return t.name}):null);u.plots.bars=u.g.selectAll(".bar").data(f,function(t){return t.name});u.plots.bars.exit().transition().duration(t).style("height",0).remove();u.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+o.utils.encode(t.name)}).attr("x",function(t){return u.scale.x(t.values.x0)+1}).attr("y",o.attr.height-o.attr.margins.top-o.attr.margins.bottom-1).attr("width",function(t){return Math.max(0,Math.abs(u.scale.x(t.values.x1)-u.scale.x(t.values.x0))-2)}).attr("height",0).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none").style("fill",function(){return x[f[0].name]}).merge(u.plots.bars).each(function(){h=true}).on("mouseover",function(t){o.attr.mouseover&&o.attr.mouseover(t.name)}).on("mouseleave",function(t){o.attr.mouseleave&&o.attr.mouseleave(t.name)}).on("click",function(t){o.attr.click&&o.attr.click(t.name)}).transition().duration(t).attr("x",function(t){return u.scale.x(t.values.x0)+1}).attr("y",function(t){return o.attr.margins.top-o.attr.margins.top+u.scale.y(t.values.length/s)}).attr("width",function(t){return Math.max(0,Math.abs(u.scale.x(t.values.x1)-u.scale.x(t.values.x0))-2)}).attr("height",function(t){return o.attr.height-o.attr.margins.top-o.attr.margins.bottom-u.scale.y(t.values.length/s)}).style("opacity",1).style("fill",function(){return x[f[0].name]}).on("end",function(){h=false})};o.render.style=function(){u.g.style("width",o.attr.innerWidth+"px").style("height",o.attr.innerHeight+"px").attr("transform","translate("+o.attr.margins.left+","+o.attr.margins.top+")").style("pointer-events","all");u.axisFn.y.tickFormat(o.attr.yTickFormat);u.axes.x.attr("transform","translate(0,"+o.attr.innerHeight+")");u.axes.y.attr("transform","translate(0,"+1+")");u.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(typeof o.attr.xTickAngle==="number"){u.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+o.attr.xTickAngle+")").style("text-anchor","start")}u.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");u.labels.x.attr("x",o.attr.innerWidth+"px").attr("y",o.attr.innerHeight+2.2*o.attr.fontSize+"px").style("font-size",o.attr.fontSize+"px").style("fill",o.attr.fontColor).text(o.attr.xLabel);u.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",o.attr.fontSize+"px").style("fill",o.attr.fontColor).text(o.attr.yLabel)}}t.prototype=Object.create(a.prototype);return t});