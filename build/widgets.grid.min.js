(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Grid=e(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(r,i){var a=e.call(this,r,"grid","div",i);var s=a.attr.x;var d=a.attr.y;var l=1;var o=1;var h=[];var n=[];var g=false;function f(){h.forEach(function(t){t.forEach(function(t){if(t){t.remove()}})});h=[];for(var t=0;t<o;t++){h.push([]);for(var e=0;e<l;e++){h[t].push(null)}}}this.x=function(t,e){a.attr.x=e!=="%"?t:window.innerWidth*t/100;s=a.attr.x;return this};this.y=function(t,e){a.attr.y=e!=="%"?t:window.innerHeight*t/100;d=a.attr.y;return this};this.rows=function(t){l=t;f();return this};this.cols=function(t){o=t;f();return this};this.show=function(t){if(t){g=true;a.widget.style("box-shadow","0 0 1px black inset");for(var e=1;e<l;e++){a.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*a.attr.height/l-1.5+"px").style("width",a.attr.width+"px").style("height","3px").style("background-color","white")}for(var r=1;r<o;r++){a.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*a.attr.width/o-1.5+"px").style("top","0").style("width","3px").style("height",a.attr.height+"px").style("background-color","white")}for(e=1;e<l;e++){a.widget.append("div").attr("class","grid-border-h").attr("data-y",e).style("position","absolute").style("left","0").style("top",e*a.attr.height/l-.5+"px").style("width",a.attr.width+"px").style("height","1px").style("background-color","black")}for(r=1;r<o;r++){a.widget.append("div").attr("class","grid-border-v").attr("data-x",r).style("position","absolute").style("left",r*a.attr.width/o-.5+"px").style("top","0").style("width","1px").style("height",a.attr.height+"px").style("background-color","black")}}else{g=false;a.widget.style("border",null);a.widget.selectAll(".grid-border-h").remove();a.widget.selectAll(".grid-border-v").remove()}return this};this.add=function(e,r,s,d,g){if(r<0||d<1||r+d>o||s<0||g<1||s+g>l){e.remove();return null}for(var f=r;f<r+d;f++){if(h[f]){for(var u=s;u<s+g;u++){if(h[f][u]){e.remove();return null}}}}n.push({x:r,y:s,width:d,height:g,widget:e});for(f=r;f<r+d;f++){for(u=s;u<s+g;u++){h[f][u]=e}}t.select("#"+this.id()).node().appendChild(t.select("#"+e.id()).node());e.x(r*a.attr.width/o+a.attr.x+a.attr.margins.left).y(s*a.attr.height/l+a.attr.y+t.select(i).attr("top")+a.attr.margins.left).width(d*a.attr.width/o-2*a.attr.margins.left).height(g*a.attr.height/l-2*a.attr.margins.left).render();return e};this.get=function(t,e){if(h[e]&&h[e][t]){return h[e][t].widget}else{return null}};a.render.style=function(){a.widget.style("position","absolute").style(a.attr.x>0?"left":"right",Math.abs(a.attr.x)+a.attr.xDim).style(a.attr.y>0?"top":"bottom",Math.abs(a.attr.y)+a.attr.yDim).style("width",a.attr.width+"px").style("height",a.attr.height+"px");a.widget.selectAll(".grid-border-h").style("top",function(){return t.select(this).attr("data-y")*a.attr.height/l-1+"px"}).style("width",a.attr.width+"px");a.widget.selectAll(".grid-border-v").style("left",function(){return t.select(this).attr("data-x")*a.attr.width/o-1+"px"}).style("height",a.attr.height+"px");n.forEach(function(t){t.widget.x(t.x*a.attr.width/o+a.attr.x+a.attr.margins.left).y(t.y*a.attr.height/l+a.attr.y+a.attr.margins.left).width(t.width*a.attr.width/o-2*a.attr.margins.left).height(t.height*a.attr.height/l-2*a.attr.margins.left).render(0)})}}r.prototype=Object.create(e.prototype);return r});