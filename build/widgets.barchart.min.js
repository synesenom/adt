(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BarChart=e(t.d3,t.du.Widget)}})(this,function(f,a){"use strict";function t(t,e){var s=a.call(this,t,"barchart","svg",e);s.attr.add(this,"vertical",false);var o={};var c=[];var u={};var r=false;this.data=function(t){c=t;return this};this.highlight=function(t,e){if(!r)s.utils.highlight(this,o,".bar",t,e);return this};s.utils.tooltip=function(t){var e=s.attr.vertical?1:0;var a=f.bisector(function(t){return o.scale.x(t.name)}).right;var r=t?a(c,t[e]):null;if(r===null){return}var n=c[r-1]?c[r-1]:c[r];var i=c[r]?c[r]:c[r-1];var l=t[e]-n.name>i.name-t[e]?i:n;return{title:l.name,stripe:u[l.name],content:{type:"metrics",data:[{label:s.attr.yLabel+":",value:s.attr.tooltipYFormat(l.value)}]}}};s.render.build=function(){o=s.utils.standardAxis();o.plots={}};s.render.update=function(t){o.scale={x:s.utils.scale(c.map(function(t){return t.name}).reverse(),[s.attr.vertical?s.attr.innerHeight:s.attr.innerWidth,0],"band"),y:s.utils.scale([0,f.max(c,function(t){return t.value})],s.attr.vertical?[0,s.attr.innerWidth]:[s.attr.innerHeight,0])};o.axes.x.transition().duration(t).call(o.axisFn.x.tickValues(s.attr.xTicks).scale(s.attr.vertical?o.scale.y:o.scale.x));o.axes.y.transition().duration(t).call(o.axisFn.y.tickValues(s.attr.yTicks).scale(s.attr.vertical?o.scale.x:o.scale.y));u=s.utils.colors(c?c.map(function(t){return t.name}):null);o.plots.bars=o.g.selectAll(".bar").data(c,function(t){return t.name});o.plots.bars.exit().transition().duration(t).style("opacity",0).remove();var e=o.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+s.utils.encode(t.name)}).style("fill",function(t){return u[t.name]}).style("pointer-events","all").style("shape-rendering","geometricPrecision").style("stroke","none");if(s.attr.vertical){e.attr("y",function(t){return o.scale.x(t.name)}).attr("height",o.scale.x.bandwidth()).attr("x",1).attr("width",0)}else{e.attr("x",function(t){return o.scale.x(t.name)}).attr("width",o.scale.x.bandwidth()).attr("y",s.attr.height-s.attr.margins.top-s.attr.margins.bottom).attr("height",0)}var a=e.merge(o.plots.bars).each(function(){r=true}).on("mouseover",function(t){s.attr.mouseover&&s.attr.mouseover(t.name)}).on("mouseleave",function(t){s.attr.mouseleave&&s.attr.mouseleave(t.name)}).on("click",function(t){s.attr.click&&s.attr.click(t.name)});if(s.attr.vertical){a=a.transition().duration(t).attr("y",function(t){return o.scale.x(t.name)}).attr("height",o.scale.x.bandwidth()).attr("x",1).attr("width",function(t){return o.scale.y(t.value)})}else{a=a.transition().duration(t).attr("x",function(t){return o.scale.x(t.name)}).attr("width",o.scale.x.bandwidth()).attr("y",function(t){return o.scale.y(t.value)}).attr("height",function(t){return s.attr.height-s.attr.margins.top-s.attr.margins.bottom-o.scale.y(t.value)})}a.style("opacity",1).style("fill",function(t){return u[t.name]}).on("end",function(){r=false})};s.render.style=function(){o.g.style("width",s.attr.innerWidth+"px").style("height",s.attr.innerHeight+"px").attr("transform","translate("+s.attr.margins.left+","+s.attr.margins.top+")").style("pointer-events","all");if(s.attr.vertical){o.axisFn.x.tickFormat(s.attr.yTickFormat)}else{o.axisFn.y.tickFormat(s.attr.yTickFormat)}o.axes.x.attr("transform","translate(0,"+s.attr.innerHeight+")");o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events","all");if(s.attr.vertical){o.g.selectAll(".y.axis .tick > line").style("display","none")}if(typeof s.attr.xTickAngle==="number"){o.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+s.attr.xTickAngle+")").style("text-anchor","start")}o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",s.attr.innerWidth+"px").attr("y",s.attr.innerHeight+2.2*s.attr.fontSize+"px").style("font-size",s.attr.fontSize+"px").style("fill",s.attr.fontColor).text(s.attr.vertical?s.attr.yLabel:s.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",s.attr.fontSize+"px").style("fill",s.attr.fontColor).text(s.attr.vertical?s.attr.xLabel:s.attr.yLabel)}}t.prototype=Object.create(a.prototype);return t});