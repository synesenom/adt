(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.BarChart=e(t.d3,t.du.Widget)}})(this,function(m,a){"use strict";function t(t,e){var o=a.call(this,t,"barchart","svg",e);o.attr.add(this,"vertical",false);o.attr.add(this,"xDomain",null);o.attr.add(this,"corners",0);o.attr.add(this,"values",false);o.attr.add(this,"valueFormat",function(t){return t});var s={};var c=[];var u={};var f=false;this.data=function(t){c=t;return this};this.highlight=function(t,e){if(!f)o.utils.highlight(this,s,".bar",t,e);return this};o.utils.tooltip=function(t){var e=o.attr.vertical?1:0;var a=m.bisector(function(t){return s.scale.x(t.name)}).right;var r=t?a(c,t[e]):null;if(r===null){return}var n=c[r-1]?c[r-1]:c[r];var i=c[r]?c[r]:c[r-1];if(typeof n==="undefined"||typeof i==="undefined"){return}var l=t[e]-n.name>i.name-t[e]?i:n;return{title:o.attr.tooltipTitleFormat(l.name),stripe:u[l.name],content:{type:"metrics",data:[{label:o.attr.yLabel+":",value:o.attr.tooltipYFormat(l.value)}]}}};function i(t,e){return t?"a"+t*e[0]+","+t*e[1]+" 0 0 1 "+t*e[2]+","+t*e[3]:""}function d(t,e,a,r,n){n=[Math.min(n[0],r,a)+.01,Math.min(n[1],r,a)+.01,Math.min(n[2],r,a)+.01,Math.min(n[3],r,a)+.01];return"M"+(t+n[0])+","+e+"h"+(a-n[0]-n[1])+i(n[1],[1,1,1,1])+"v"+(r-n[1]-n[2])+i(n[2],[1,1,-1,1])+"h"+(-a+n[2]+n[3])+i(n[3],[1,1,-1,-1])+"v"+(-r+n[3]+n[0])+i(n[0],[1,1,1,-1])+"z"}o.render.build=function(){s=o.utils.standardAxis();s.plots={}};o.render.update=function(t){var e=[];if(o.attr.xDomain){e=o.attr.xDomain}else if(typeof c!=="undefined"&&c.length>0){e=c.map(function(t){return t.name}).reverse()}var a=0;if(typeof c!=="undefined"&&c.length>0){a=m.max(c,function(t){return 1.1*t.value})}if(a===0){a=1}s.scale={x:o.utils.scale(e,[o.attr.vertical?o.attr.innerHeight:o.attr.innerWidth,0],"band"),y:o.utils.scale([0,a],o.attr.vertical?[0,o.attr.innerWidth]:[o.attr.innerHeight,0])};if(o.attr.vertical){s.axisFn.x.tickFormat(o.attr.yTickFormat);s.axisFn.y.tickFormat(o.attr.xTickFormat)}else{s.axisFn.x.tickFormat(o.attr.xTickFormat);s.axisFn.y.tickFormat(o.attr.yTickFormat)}s.axes.x.transition().duration(t).call(s.axisFn.x.tickValues(o.attr.xTicks).scale(o.attr.vertical?s.scale.y:s.scale.x));s.axes.y.transition().duration(t).call(s.axisFn.y.tickValues(o.attr.yTicks).scale(o.attr.vertical?s.scale.x:s.scale.y));if(typeof c==="undefined"||c.length===0){return}u=o.utils.colors(c?c.map(function(t){return t.name}):null);s.plots.bars=s.g.selectAll(".bar").data(c,function(t){return t.name});s.plots.bars.exit().transition().duration(t).style("opacity",0).remove();var r=s.plots.bars.enter().append("path").attr("class",function(t){return"bar "+o.utils.encode(t.name)}).style("fill",function(t){return u[t.name]}).style("pointer-events",o.attr.mouseover||o.attr.click?"all":"none").style("shape-rendering","geometricPrecision").style("stroke","none");if(o.attr.vertical){r.attr("d",function(t){return d(1,s.scale.x(t.name),0,s.scale.x.bandwidth(),[0,o.attr.corners,o.attr.corners,0])})}else{r.attr("d",function(t){return d(s.scale.x(t.name),o.attr.height-o.attr.margins.top-o.attr.margins.bottom,s.scale.x.bandwidth(),0,[o.attr.corners,o.attr.corners,0,0])})}var n=r.merge(s.plots.bars).each(function(){f=true}).on("mouseover",function(t){o.attr.mouseover&&o.attr.mouseover(t.name)}).on("mouseleave",function(t){o.attr.mouseleave&&o.attr.mouseleave(t.name)}).on("click",function(t){o.attr.click&&o.attr.click(t.name)});if(o.attr.vertical){n=n.transition().duration(t).attr("d",function(t){return d(1,s.scale.x(t.name),s.scale.y(t.value),s.scale.x.bandwidth(),[0,o.attr.corners,o.attr.corners,0])})}else{n=n.transition().duration(t).attr("d",function(t){return d(s.scale.x(t.name),s.scale.y(t.value),s.scale.x.bandwidth(),s.scale.y(0)-s.scale.y(t.value),[o.attr.corners,o.attr.corners,0,0])})}n.style("opacity",1).style("fill",function(t){return u[t.name]}).on("end",function(){f=false});s.plots.values=s.g.selectAll(".bar-value").data(c,function(t){return t.name});s.plots.values.exit().transition().duration(t).style("opacity",0).remove();var i=s.plots.values.enter().append("text").attr("class",function(t){return"bar-value "+o.utils.encode(t.name)}).attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size",o.attr.fontSize+"px").style("fill","white").style("stroke","none").text(function(t){return o.attr.valueFormat(t.value)});if(o.attr.vertical){i.attr("y",function(t){return s.scale.x(t.name)+s.scale.x.bandwidth()/2+1}).attr("x",1)}else{i.attr("x",function(t){return s.scale.x(t.name)+s.scale.x.bandwidth()/2}).attr("y",o.attr.height-o.attr.margins.top-o.attr.margins.bottom-2*o.attr.fontSize)}var l=i.merge(s.plots.values).each(function(){f=true});if(o.attr.vertical){l=l.attr("text-anchor",function(t){var e=s.scale.y(t.value)-o.attr.fontSize;return e>1.5*o.attr.fontSize?"end":"start"}).transition().duration(t).attr("y",function(t){return s.scale.x(t.name)+s.scale.x.bandwidth()/2+1}).attr("x",function(t){var e=s.scale.y(t.value)-o.attr.fontSize;return e>1.5*o.attr.fontSize?e+.5*o.attr.fontSize:s.scale.y(t.value)+o.attr.fontSize}).style("fill",function(t){var e=s.scale.y(t.value)-o.attr.fontSize;return e>1.5*o.attr.fontSize?"white":o.attr.fontColor}).text(function(t){return o.attr.valueFormat(t.value)})}else{l=l.transition().duration(t).attr("x",function(t){return s.scale.x(t.name)+s.scale.x.bandwidth()/2}).attr("y",function(t){var e=s.scale.y(t.value)+1.5*o.attr.fontSize;var a=o.attr.height-o.attr.margins.top-o.attr.margins.bottom;return a-e>2*o.attr.fontSize?e:s.scale.y(t.value)-.9*o.attr.fontSize}).style("fill",function(t){var e=s.scale.y(t.value)+1.5*o.attr.fontSize;var a=o.attr.height-o.attr.margins.top-o.attr.margins.bottom;return a-e>2*o.attr.fontSize?"white":o.attr.fontColor}).text(function(t){return o.attr.valueFormat(t.value)})}l.style("opacity",1).on("end",function(){f=false})};o.render.style=function(){s.g.style("width",o.attr.innerWidth+"px").style("height",o.attr.innerHeight+"px").attr("transform","translate("+o.attr.margins.left+","+o.attr.margins.top+")").style("pointer-events",o.attr.mouseover||o.attr.click?"all":"none");if(o.attr.vertical){s.axisFn.x.tickFormat(o.attr.yTickFormat);s.axisFn.y.tickFormat(o.attr.xTickFormat)}else{s.axisFn.x.tickFormat(o.attr.xTickFormat);s.axisFn.y.tickFormat(o.attr.yTickFormat)}s.axes.x.call(s.axisFn.x).attr("transform","translate(0,"+o.attr.innerHeight+")");s.axes.y.call(s.axisFn.y).attr("transform","translate(0,"+1+")");s.g.selectAll(".tick > text").attr("cursor","default").style("pointer-events",o.attr.mouseover||o.attr.click?"all":"none");if(o.attr.vertical){s.g.selectAll(".y.axis .tick > line").style("display","none")}if(typeof o.attr.xTickAngle==="number"){s.g.selectAll(".x.axis .tick > text").attr("transform","rotate("+o.attr.xTickAngle+")").style("text-anchor","start")}s.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");s.labels.x.attr("x",o.attr.innerWidth+"px").attr("y",o.attr.innerHeight+2.8*o.attr.fontSize+"px").style("font-size",o.attr.fontSize+"px").style("fill",o.attr.fontColor).text(o.attr.vertical?o.attr.yLabel:o.attr.xLabel);s.labels.y.attr("x",5+"px").attr("y",-5+"px").style("font-size",o.attr.fontSize+"px").style("fill",o.attr.fontColor).text(o.attr.vertical?o.attr.xLabel:o.attr.yLabel);if(typeof s.plots.values!=="undefined"){s.plots.values.style("font-size",o.attr.fontSize+"px")}}}t.prototype=Object.create(a.prototype);return t});