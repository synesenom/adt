(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("lodash"),require("topojson"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","_","topojson","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Map=e(t.d3,t._,t.topojson,t.du.Widget)}})(this,function(t,e,r,n){"use strict";var a=function(t){var e=t||[1,0];this.x=function(){return e[0]};this.y=function(){return e[1]};this.length=function(t){var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]);if(typeof t==="number"){var n=t/r;return new a(e.map(function(t){return t*n}))}return r};this.angle=function(t){var r=Math.atan2(e[1],e[0]);if(typeof t==="number"){var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return new a([n*Math.cos(t),n*Math.sin(t)])}return r};this.toArray=function(){return[e[0],e[1]]};this.map=function(t){return new a(t(e))};this.add=function(t){return new a([e[0]+t.x(),e[1]+t.y()])};this.sub=function(t){return new a([e[0]-t.x(),e[1]-t.y()])};this.mult=function(t){return new a(e.map(function(e){return e*t}))}};var o=function(t){var e=t||[1,0,0];this.x=function(){return e[0]};this.y=function(){return e[1]};this.z=function(){return e[2]};this.length=function(t){var r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(typeof t==="number"){return new o(e.map(function(e){return e*t/r}))}return r};this.toLatLon=function(){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return new i([Math.asin(e[2]/t),Math.atan2(e[1],e[0])].map(function(t){return t*180/Math.PI}))};this.add=function(t){return new o([e[0]+t.x(),e[1]+t.y(),e[2]+t.z()])};this.mult=function(t){return new o(e.map(function(e){return e*t}))};this.dot=function(t){return e[0]*t.x()+e[1]*t.y()+e[2]*t.z()};this.cross=function(t){return new o([e[1]*t.z()-e[2]*t.y(),e[2]*t.x()-e[0]*t.z(),e[0]*t.y()-e[1]*t.x()])}};var i=function(t){var e=t||[0,0];this.toArray=function(){return[e[0],e[1]]};this.toVec=function(){var t=e[0]*Math.PI/180,r=e[1]*Math.PI/180;var n=Math.cos(t);return new o([n*Math.cos(r),n*Math.sin(r),Math.sin(t)])}};function s(o,s){var u="du-widgets-map";var l=n.call(this,o,"map","div",s);var c=this;l.attr.add(this,"resource",null);l.attr.add(this,"centerX",0);l.attr.add(this,"centerY",0);l.attr.add(this,"backgroundColor","white");l.attr.add(this,"foregroundColor","black");l.attr.add(this,"borderColor","white");l.attr.add(this,"outClick",null);l.attr.add(this,"noZoom",false);l.attr.add(this,"ready",null);var f=function(){var e=null;var n=null;var a=t.map();function o(){t.json(l.attr.resource,function(o,i){e=r.feature(i.paths,i.paths["objects"]["countries"]).features;e.filter(function(t){return i.info.some(function(e){if(t.id===e.id)return t.name=e.name})}).sort(function(t,e){return t.name.localeCompare(e.name)});n=t.map();i.info.forEach(function(t){n.set(t.name,{name:t.name,capital:t.capital,population:t.population})});e.forEach(function(t,e){a.set(t.name,e)});p._build();l.attr.ready&&l.attr.ready()})}function i(t){return a.has(t)?a.get(t):null}function s(){return e.map(function(t){return{id:t.id,name:t.name}})}function u(t){return t&&n.has(t)?n.get(t).capital:n.values().map(function(t){return{name:t.name,capital:t.capital}})}function c(t){return t&&n.has(t)?n.get(t).population:n.values().map(function(t){return{name:t.name,population:t.population}})}function h(t,e){var r,n,a,o,i,s=t[0],u=t[1],l=false;for(var c=0,f=e.length-1;c<e.length;f=c++){r=e[c][0];a=e[c][1];n=e[f][0];o=e[f][1];i=a>u!==o>u&&s<(n-r)*(u-a)/(o-a)+r;if(i)l=!l}return l}function d(t,e){var r=f._id(t);if(r){var n=p._project(e);var a=f._paths()[r].svg.areas;for(var o=0;o<a.length;o++){if(h(n,a[o])){return true}}}return false}return{_paths:function(){return e},_id:i,_build:o,get:s,capital:u,population:c,containsGeoLoc:d}}();this.countries={get:f.get,capital:f.capital,population:f.population,containsGeoLoc:f.containsGeoLoc};var h=function(){var t={};function r(t,e){return l.utils.encode(t)+"__"+l.utils.encode(e)}function n(e){if(e&&t.hasOwnProperty(e)){return Object.keys(t[e])}else{return Object.keys(t)}}function a(e,r){if(!t.hasOwnProperty(e)){t[e]=r;return true}else{return false}}function o(n){if(t.hasOwnProperty(n)){e.forOwn(t[n],function(t,e){var a=r(n,e);t.forEach(function(t){if(typeof f._id(t)==="number"){p._select(t).classed(a,false)}})});return true}else{return false}}function i(){e.forOwn(t,function(t,n){e.forOwn(t,function(t,e){var a=r(n,e);t.forEach(function(t){if(typeof f._id(t)==="number"){p._select(t).classed(a,true)}})})})}return{get:n,add:a,remove:o,selector:r,_mark:i}}();this.clustering={get:h.get,add:h.add,remove:h.remove,selector:h.selector};var d=function(){var e=128;var r=.3;var n={};var a=t.zoomIdentity;var o=1;var i=t.zoom().scaleExtent([1,e]).on("zoom",d);function s(t){return a.apply(t)}function u(t){return a.invert(t)}function c(){return o}function f(){i.translateExtent([[-r*l.attr.width,-r*l.attr.height],[(1+r)*l.attr.width,(1+r)*l.attr.height]])}function h(t,e){n[t]=e}function d(){if(l.attr.noZoom){return}var e=t.event.transform.k;n.map.paths.style("stroke-width",.5/e+"px");n.map.paths.attr("transform",t.event.transform);v._zoom(t.event.transform);y._zoom(t.event.transform);g._zoom(t.event.transform);if(t.event&&t.event.transform){a=t.zoomIdentity.translate(t.event.transform.x,t.event.transform.y).scale(t.event.transform.k);o=t.event.transform.k}}function p(){n.map.svg.transition().duration(1e3).call(i.transform,t.zoomIdentity)}function m(r){var a=r[1][0]-r[0][0],o=r[1][1]-r[0][1],s=(r[0][0]+r[1][0])/2,u=(r[0][1]+r[1][1])/2,c=Math.max(1,Math.min(e,.8/Math.max(a/l.attr.width,o/l.attr.height))),f=[l.attr.width/2-c*s,l.attr.height/2-c*u];n.map.svg.transition().duration(1e3).call(i.transform,t.zoomIdentity.translate(f[0],f[1]).scale(c))}function w(){return a}return{init:f,setLayer:h,zoom:i,reset:p,click:m,transform:s,invert:u,level:c,current:w}}();var p=function(){var e=l.widget.append("svg").attr("id",u+"-map-layer").style("position","absolute").call(d.zoom);var r=e.append("rect").attr("id","water").style("position","absolute").style("width","100%").style("height","100%").style("fill","transparent").style("top",0).style("left",0);var n=e.append("g").attr("id","land");var a=null;var o=t.geoMercator().precision(.1);var i=t.geoPath().projection(o);var s=null;function h(t){return o([t[1],t[0]])}function p(){f._paths().forEach(function(t){t.svg.center=i.centroid(t)})}function v(){f._paths().forEach(function(e){var r=[];var n=[];var a=e.geometry.coordinates;if(a.length===1){a[0].forEach(function(t){var a=o(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))})}else{a.forEach(function(t){t[0].forEach(function(t){var a=o(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))});if(t.length>1){t.forEach(function(t){var a=o(t);r.push(Math.abs(a[0]-e.svg.center[0]));n.push(Math.abs(a[1]-e.svg.center[1]))})}})}e.svg.width=t.max(r)*2;e.svg.height=t.max(n)*2})}function y(){f._paths().forEach(function(t){t.svg.areas=null;if(t.geometry.coordinates.length===1){var e=[];t.geometry.coordinates[0].forEach(function(t){e.push(o(t))});t.svg.areas=[e]}else{t.svg.areas=[];t.geometry.coordinates.forEach(function(e){var r=[];if(e.length>1){e.forEach(function(t){r.push(o(t))})}else{e[0].forEach(function(t){r.push(o(t))})}t.svg.areas.push(r)})}})}function g(t){if(t.geometry.coordinates.length===1){return i.centroid(t)}else{var e={type:"Feature",geometry:{type:"Polygon",coordinates:t.geometry.coordinates[0]}};for(var r=1;r<t.geometry.coordinates.length;r++){var n={type:"Feature",geometry:{type:"Polygon",coordinates:t.geometry.coordinates[r]}};if(i.area(n)>i.area(e)){e=n}}var a=i.centroid(e);if(isNaN(a[0])||isNaN(a[1]))return i.centroid(t);else return a}}function m(){a=n.selectAll("path").data(f._paths()).enter().append("path").attr("class",function(t){return"country-"+f._id(t.name)}).style("stroke-width","0.5px").style("cursor","pointer");w();b()}function w(){if(a===null){return}o.scale(l.attr.width/(2*Math.PI)).translate([l.attr.width/2+l.attr.centerX,l.attr.height/2+l.attr.centerY]);i=t.geoPath().projection(o);f._paths().forEach(function(t){t.svg={}});p();v();y()}function b(){if(a===null){return}e.attr("width",l.attr.width+"px").attr("height",l.attr.height+"px");r.style("fill",l.attr.backgroundColor).style("width",l.attr.width+"px").style("height",l.attr.height+"px").on("click",function(){console.log("clicked!");d.reset();a.classed("focus",false).style("fill",function(t){return l.attr.colors&&l.attr.colors[t.name]?l.attr.colors[t.name]:l.attr.foregroundColor});if(l.attr.outClick)l.attr.outClick()});a.attr("d",i).style("fill",function(t){return l.attr.colors&&l.attr.colors[t.name]?l.attr.colors[t.name]:l.attr.foregroundColor}).style("stroke",l.attr.borderColor).style("cursor","pointer").on("mouseover",function(e,r){t.select(this).style("fill",t.color(l.attr.colors&&l.attr.colors[e.name]?l.attr.colors[e.name]:l.attr.foregroundColor).brighter());l.attr.mouseover&&l.attr.mouseover(e.name)}).on("mouseleave",function(e,r){var n=t.select(this);var a=t.color(l.attr.colors&&l.attr.colors[e.name]?l.attr.colors[e.name]:l.attr.foregroundColor);n.style("fill",n.classed("focus")?a.brighter():a);l.attr.mouseleave&&l.attr.mouseleave(e.name)}).on("click",function(e,r){var n=t.select(this);var o=n.classed("focus");if(o)d.reset();else{d.click(i.bounds(e))}a.classed("focus",function(t){return t===e?!o:false}).style("fill",function(t){return l.attr.colors&&l.attr.colors[t.name]?l.attr.colors[t.name]:l.attr.foregroundColor});var s=t.color(l.attr.colors&&l.attr.colors[e.name]?l.attr.colors[e.name]:l.attr.foregroundColor);n.style("fill",!o?s.brighter():s);l.attr.click&&l.attr.click(e.name)});d.setLayer("map",{svg:e,paths:a,labels:s})}function x(t){if(typeof t==="string"){return f._id(t)?n.select("path.country-"+f._id(t)):n.selectAll("path."+l.utils.encode(t))}else{return a}}function _(t){a.style("opacity",t?t:1);return c}function M(e,r,n){x(e).transition().duration(n?n:0).style("fill",function(n){var a=l.attr.colors&&l.attr.colors[n.name]?l.attr.colors[n.name]:l.attr.foregroundColor;return typeof r==="string"?r:typeof e==="string"?t.color(a).brighter():a});return c}return{_select:x,_project:h,_build:m,_update:w,_style:b,dim:_,highlight:M}}();this.dim=p.dim;this.highlight=p.highlight;var v=function(){var t=l.widget.append("div").attr("id",u+"-static-layers").style("position","absolute").style("pointer-events","none").style("width",l.attr.width+"px").style("height",l.attr.height+"px");var r={};function n(t,e,r){return[e[0]*t[0]+r[0],e[1]*t[1]+r[1]]}function o(){return Object.keys(r)}function s(e){var o=l.utils.encode(e);if(!r.hasOwnProperty(o)){r[o]=function(){var e=t.append("canvas").attr("id",u+"-static-layer-"+o).attr("width",l.attr.width+"px").attr("height",l.attr.height+"px").style("position","absolute").style("pointer-events","none");var r=e.node().getContext("2d");var i=[];function s(t,e){h[t](e);i.push({type:t,params:e});return true}function c(t,e){var r=[1/t,1/t],o=[l.attr.centerX*(t-1)/t,(l.attr.height*(t-e)/2+l.attr.centerY*(t-1))/t];i.forEach(function(t){switch(t.type){case"dot":case"circle":t.params.pos=n(t.params.pos,r,o);break;case"arrow":for(var e=0;e<t.params.segments.length;e++){t.params.segments[e]=new a(n(t.params.segments[e].toArray(),r,o))}break}})}function f(){i=[]}var h={dot:function(t,e){if(t.color)r.fillStyle=t.color;var n=t.size/(e?d.level():1);var a=!e?d.transform(t.pos):t.pos;r.fillRect(a[0]-n/2,a[1]-n/2,n,n)},circle:function(t,e){if(t.color)r.fillStyle=t.color;var n=t.radius/(e?d.level():1);var a=!e?d.transform(t.pos):t.pos;r.beginPath();r.arc(a[0],a[1],n,0,2*Math.PI,false);r.fill()},arrow:function(t,e){if(t.color)r.strokeStyle=t.color;var n=t.width/(e?d.level():1);var a=[];t.segments.forEach(function(t){a.push(!e?t.map(d.transform):t)});var o=n*2;var i=n*5;var s=a[a.length-2];var u=a[a.length-1];var c=u.sub(s).length(i);r.beginPath();r.lineWidth=n;r.lineJoin="round";r.moveTo(a[0].x(),a[0].y());for(var f=1;f<a.length-1;f++){if(a[f].sub(a[f-1]).length()<.6*l.attr.width)r.lineTo(a[f].x(),a[f].y());else r.moveTo(a[f].x(),a[f].y())}var h=u.sub(c.length(.5*i));r.lineTo(h.x(),h.y());r.stroke();var p=c.angle(c.angle()+Math.PI/2).length(o);var v=u.sub(c).sub(p);var y=u.sub(c).add(p);r.beginPath();r.moveTo(v.x(),v.y());r.lineTo(y.x(),y.y());r.lineTo(u.x(),u.y());r.closePath();r.fillStyle=t.color;r.fill()}};function p(){var t=d.invert([0,0]);var e=d.invert([l.attr.width,l.attr.height]);var r={xMin:t[0],xMax:e[0],yMin:t[1],yMax:e[1]};i.forEach(function(t){if(t.params.pos&&(t.params.pos[0]<r.xMin||t.params.pos[0]>r.xMax||t.params.pos[1]<r.yMin||t.params.pos[1]>r.yMax)){return}h[t.type](t.params,true)})}return{g:e,canvas:r,rescaleContent:c,clearContent:f,append:s,render:p}}();return true}else{return false}}function f(){var n=parseFloat(t.style("width"))/l.attr.width;var a=parseFloat(t.style("height"))/l.attr.height;t.style("width",l.attr.width+"px").style("height",l.attr.height+"px");e.forOwn(r,function(t){t.g.attr("width",l.attr.width+"px").attr("height",l.attr.height+"px");t.rescaleContent(n,a);t.render()});x(d.current())}function h(t){var e=l.utils.encode(t);if(r.hasOwnProperty(e)){r[e].canvas.clearRect(0,0,l.attr.width,l.attr.height);r[e].clearContent();return true}else{return false}}function y(){e.forOwn(r,function(t){t.canvas.save();t.canvas.clearRect(0,0,l.attr.width,l.attr.height)})}function g(t){var n=l.utils.encode(t);if(n&&r.hasOwnProperty(n)){e.forOwn(r,function(t,e){t.g.transition().duration(100).style("opacity",n===e?1:0)})}else{e.forOwn(r,function(t){t.g.transition().duration(100).style("opacity",1)})}return c}function m(t){e.forOwn(r,function(e){e.render(t)})}function w(){e.forOwn(r,function(t){t.canvas.restore()})}var b={dot:function(t,e,n,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var o=l.utils.encode(t);return r.hasOwnProperty(o)&&r[o].append("dot",{pos:p._project(e),size:n,color:a})},circle:function(t,e,n,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof n!=="number"||isNaN(n)||n<=0)return false;var o=l.utils.encode(t);return r.hasOwnProperty(o)&&r[o].append("circle",{pos:p._project(e),radius:n,color:a})},arrow:function(t,e,n,o,s){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!n||n.length<2||typeof n[0]!=="number"||typeof n[1]!=="number")return false;if(typeof o!=="number")return false;var u=l.utils.encode(t);if(r.hasOwnProperty(u)){var c=new i(e).toVec(),f=new i(n).toVec(),h=c.cross(f).cross(c).length(1),d=Math.acos(c.dot(f));var v=1,y=100,g=o*5,m=new a(p._project(e)),w=new a(p._project(n)),b=m,x=[b];do{var _=new a(p._project(c.mult(Math.cos((v+1)*d/y)).add(h.mult(Math.sin((v+1)*d/y))).toLatLon().toArray()));v++;b=_;x.push(_)}while(v<y&&_.sub(w).length()>g);x.push(w);r[u].append("arrow",{segments:x,width:o,color:s});return true}else{return false}}};function x(t){v._clear();e.forOwn(r,function(e){e.canvas.translate(t.x,t.y);e.canvas.scale(t.k,t.k)});v._render(t.k);v._restore()}return{_style:f,_zoom:x,_clear:y,_restore:w,_render:m,get:o,add:s,highlight:g,erase:h,draw:b}}();this.staticLayer={get:v.get,add:v.add,erase:v.erase,highlight:v.highlight,draw:v.draw};var y=function(){var r=l.widget.append("div").attr("id",u+"-dynamic-layers").style("position","absolute").style("pointer-events","none");var n={};function o(){return Object.keys(n)}function s(e){var a=l.utils.encode(e);if(!n.hasOwnProperty(a)){n[a]=function(){var e=r.append("svg").attr("id",u+"-dynamic-layer-"+a).attr("width",l.attr.width+"px").attr("height",l.attr.height+"px").style("position","absolute").style("pointer-events","none").append("g");var n=[];function o(t){n.push({elem:t,birth:(new Date).getTime()/1e3})}setInterval(function(){var e=(new Date).getTime()/1e3;var r=[];n.forEach(function(n){if(e-n.birth>10){n.elem.transition().duration(700).style("opacity",0).on("end",function(){t.select(this).remove()})}else{r.push(n)}});n=r},2e3);return{g:e,append:o}}();return true}else{return false}}function f(){r.style("width",l.attr.width+"px").style("height",l.attr.height+"px");e.forOwn(n,function(t){t.g.attr("width",l.attr.width+"px").attr("height",l.attr.height+"px")})}function h(t){var e=l.utils.encode(t);if(n.hasOwnProperty(e)){n[e].g.html("");return true}else{return false}}function v(t){var r=l.utils.encode(t);if(r&&n.hasOwnProperty(r)){e.forOwn(n,function(t,e){t.g.transition().duration(200).style("opacity",r===e?1:0)})}else{e.forOwn(n,function(t){t.g.transition().duration(200).style("opacity",1)})}return c}var y={circle:function(e,r,a,o,i,s){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof a!=="number"||isNaN(a)||a<=0)return false;var u=l.utils.encode(e);if(n.hasOwnProperty(u)){var c=a/d.level();var f=p._project(r);var h=n[u].g.append("circle").attr("class","circle").attr("cx",f[0]).attr("cy",f[1]).attr("r",c).style("fill",o);n[u].append(h);h.transition().duration(i?i:700).ease(t.easeExp).attr("r",0).on("end",function(){s&&s();t.select(this).remove()});return true}else{return false}},arrow:function(e,r,o,s,u,c,f){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(!o||o.length<2||typeof o[0]!=="number"||typeof o[1]!=="number")return false;if(typeof s!=="number")return false;var h=l.utils.encode(e);if(n.hasOwnProperty(h)){var v=100;var y=null;var g=null;var m=new a(p._project(r));var w=new a(p._project(o));var b=s/d.level();var x=b*2;var _=b*5;y=n[h].g.append("path").style("fill","none").style("stroke",u).style("stroke-width",b).attr("d","M"+m.x()+","+m.y());g=n[h].g.append("path").style("fill",u).style("stroke","none");var M=new i(r).toVec();var k=new i(o).toVec();var O=M.cross(k).cross(M).length(1);var P=Math.acos(M.dot(k));var j=1;var E=m;var C=(typeof c==="number"?c:700)/v;var z=setInterval(function(){var e=new a(p._project(M.mult(Math.cos((j+1)*P/v)).add(O.mult(Math.sin((j+1)*P/v))).toLatLon().toArray()));y.attr("d",y.attr("d")+(e.sub(E).length()<.5*l.attr.width?"L":"M")+e.x()+","+e.y());if(e.sub(E).length()<.5*l.attr.width){var r=e.sub(E).length(1);var n=r.angle(r.angle()+Math.PI/2).mult(x);var o=e.sub(n);var i=e.add(n);var s=e.add(r.mult(_));g.attr("d","M"+o.x()+","+o.y()+"L"+i.x()+","+i.y()+"L"+s.x()+","+s.y()+"Z")}if(e.sub(w).length()>_){j++;E=e}else{clearInterval(z);r=w.sub(e).length(1);n=r.angle(r.angle()+Math.PI/2).mult(x);o=w.sub(r.mult(_)).sub(n);i=w.sub(r.mult(_)).add(n);g.transition().duration(C).attr("d","M"+o.x()+","+o.y()+"L"+i.x()+","+i.y()+"L"+w.x()+","+w.y()+"Z").on("end",function(){f&&f();y.transition().duration(1e3).style("opacity",0).on("end",function(){t.select(this).remove()});t.select(this).transition().duration(1e3).style("opacity",0).on("end",function(){t.select(this).remove()})})}},C);return true}else{return false}}};function g(t){e.forOwn(n,function(e){e.g.attr("transform",t)})}return{_style:f,_zoom:g,get:o,add:s,highlight:v,erase:h,draw:y}}();this.dynamicLayer={get:y.get,add:y.add,highlight:y.highlight,erase:y.erase,draw:y.draw};var g=function(){var t=l.widget.append("svg").attr("id",u+"-touch-layer").attr("width",l.attr.width+"px").attr("height",l.attr.height+"px").style("position","absolute").style("pointer-events","none");var e=t.append("g");function r(t,r,n,a,o,i){if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;var s=n/d.level();var l=p._project(r);e.append("circle").attr("id",u+"-touch-layer-"+t).attr("cx",l[0]).attr("cy",l[1]).attr("r",s).style("fill",null).style("opacity",0).style("pointer-events","all").on("mouseover",function(t,e){if(a)a(t,e)}).on("mouseleave",function(t,e){if(o)o(t,e)}).on("click",function(t,e){if(i)i(t,e)});return true}function n(t){var r=e.select("#"+t);if(r.empty())return false;else{r.remove();return true}}function a(){t.style("width",l.attr.width+"px").style("height",l.attr.height+"px");e.style("width",l.attr.width+"px").style("height",l.attr.height+"px")}function o(t){e.attr("transform",t)}function i(){e.html("")}return{_style:a,_zoom:o,add:r,remove:n,erase:i}}();this.touchLayer={add:g.add,remove:g.remove,erase:g.erase};l.render.build=function(){f._build()};l.render.update=function(){p._update()};l.render.style=function(){l.widget.style("background-color",l.attr.backgroundColor).style("pointer-events",null);d.init();p._style();v._style();y._style();g._style();h._mark()}}s.prototype=Object.create(n.prototype);return s});