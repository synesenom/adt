(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("topojson"),require("leaflet"),require("./math.la"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","topojson","leaflet","src/math.la","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.Map=e(t.d3,t.topojson,t.L,t.du.math.la,t.du.Widget)}})(this,function(j,c,s,E,a){"use strict";function t(t,e){var w="du-widgets-map";var O=a.call(this,t,"map","div",e);var b=this;O.attr.add(this,"resource",null);O.attr.add(this,"centerX",0);O.attr.add(this,"centerY",0);O.attr.add(this,"backgroundColor","white");O.attr.add(this,"foregroundColor","black");O.attr.add(this,"borderColor","white");O.attr.add(this,"outClick",null);O.attr.add(this,"tiles",null);O.attr.add(this,"noZoom",false);O.attr.add(this,"ready",null);var m=function(){var a=null;var n=null;var o=j.map();function t(e){j.json(O.attr.resource,function(t,r){a=c.feature(r.paths,r.paths["objects"]["countries"]).features;a.filter(function(e){return r.info.some(function(t){if(e.id===t.id)return e.name=t.name})}).sort(function(t,e){return t.name.localeCompare(e.name)});n=j.map();r.info.forEach(function(t){n.set(t.name,{name:t.name,capital:t.capital,population:t.population})});a.forEach(function(t,e){o.set(t.name,e)});e&&e()})}function e(t){return o.has(t)?o.get(t):null}function r(){return a.map(function(t){return{id:t.id,name:t.name}})}function i(t){return t&&n.has(t)?n.get(t).capital:n.values().map(function(t){return{name:t.name,capital:t.capital}})}function s(t){return t&&n.has(t)?n.get(t).population:n.values().map(function(t){return{name:t.name,population:t.population}})}function l(t,e){var r,a,n,o,i,s=t[0],l=t[1],u=false;for(var c=0,f=e.length-1;c<e.length;f=c++){r=e[c][0];n=e[c][1];a=e[f][0];o=e[f][1];i=n>l!==o>l&&s<(a-r)*(l-n)/(o-n)+r;if(i)u=!u}return u}function u(t,e){var r=m._id(t);if(r){var a=L._project(e);var n=m._paths()[r].svg.areas;for(var o=0;o<n.length;o++){if(l(a,n[o])){return true}}}return false}return{_paths:function(){return a},_id:e,_build:t,get:r,capital:i,population:s,containsGeoLoc:u}}();this.countries={get:m.get,capital:m.capital,population:m.population,containsGeoLoc:m.containsGeoLoc};var r=function(){var o={};function i(t,e){return O.utils.encode(t)+"__"+O.utils.encode(e)}function t(t){if(t&&o.hasOwnProperty(t)){return Object.keys(o[t])}else{return Object.keys(o)}}function e(t,e){if(!o.hasOwnProperty(t)){o[t]=e;return true}else{return false}}function r(t){if(o.hasOwnProperty(t)){for(var e in o[t]){if(o[t].hasOwnProperty(e)){var r=i(t,e),a=o[t][e];a.forEach(function(t){if(typeof m._id(t)==="number"){L._select(t).classed(r,false)}})}}delete o[t];return true}else{return false}}function a(){for(var t in o){if(o.hasOwnProperty(t)){var e=o[t];for(var r in o[t]){if(o[t].hasOwnProperty(r)){var a=i(t,r),n=o[t][r];n.forEach(function(t){if(typeof m._id(t)==="number"){L._select(t).classed(a,true)}})}}}}}return{get:t,add:e,remove:r,selector:i,_mark:a}}();this.clustering={get:r.get,add:r.add,remove:r.remove,selector:r.selector};var M=function(){var s=4096;var t=.3;var l={};var e=j.zoomIdentity;var r=1;var u=j.zoom().scaleExtent([1,s]).on("zoom",f);function a(t){return e.apply(t)}function n(t){return e.invert(t)}function o(){return r}function i(){u.translateExtent([[-t*O.attr.width,-t*O.attr.height],[(1+t)*O.attr.width,(1+t)*O.attr.height]])}function c(t,e){l[t]=e}function f(){if(O.attr.noZoom){return}var t=j.event.transform.k;l.map.paths.style("stroke-width",.5/t+"px");l.map.paths.attr("transform",j.event.transform);y._zoom(j.event.transform);v._zoom(j.event.transform);g._zoom(j.event.transform);x._zoom(j.event.transform);if(j.event&&j.event.transform){e=j.zoomIdentity.translate(j.event.transform.x,j.event.transform.y).scale(j.event.transform.k);r=j.event.transform.k}}function h(){l.map.svg.transition().duration(1e3).call(u.transform,j.zoomIdentity)}function d(t){var e=t[1][0]-t[0][0],r=t[1][1]-t[0][1],a=(t[0][0]+t[1][0])/2,n=(t[0][1]+t[1][1])/2,o=Math.max(1,Math.min(s,.8/Math.max(e/O.attr.width,r/O.attr.height))),i=[O.attr.width/2-o*a,O.attr.height/2-o*n];l.map.svg.transition().duration(1e3).call(u.transform,j.zoomIdentity.translate(i[0],i[1]).scale(o))}function p(){return e}return{init:i,setLayer:c,zoom:u,reset:h,click:d,transform:a,invert:n,level:o,current:p}}();var L=function(){var t=O.widget.append("svg").attr("id",w+"-map-layer").style("position","absolute").call(M.zoom);var e=t.append("rect").attr("id","water").style("position","absolute").style("width","100%").style("height","100%").style("fill","transparent").style("top",0).style("left",0);var r=t.append("g").attr("id","land");var o=null;var i=j.geoMercator().precision(.1);var s=j.geoPath().projection(i);var a=null;function n(t){return i([t[1],t[0]])}function l(t){return i.invert(t).reverse()}function u(){m._paths().forEach(function(t){t.svg.center=s.centroid(t)})}function c(){m._paths().forEach(function(r){var a=[];var n=[];var t=r.geometry.coordinates;if(t.length===1){t[0].forEach(function(t){var e=i(t);a.push(Math.abs(e[0]-r.svg.center[0]));n.push(Math.abs(e[1]-r.svg.center[1]))})}else{t.forEach(function(t){t[0].forEach(function(t){var e=i(t);a.push(Math.abs(e[0]-r.svg.center[0]));n.push(Math.abs(e[1]-r.svg.center[1]))});if(t.length>1){t.forEach(function(t){var e=i(t);a.push(Math.abs(e[0]-r.svg.center[0]));n.push(Math.abs(e[1]-r.svg.center[1]))})}})}r.svg.width=j.max(a)*2;r.svg.height=j.max(n)*2})}function f(){m._paths().forEach(function(r){r.svg.areas=null;if(r.geometry.coordinates.length===1){var e=[];r.geometry.coordinates[0].forEach(function(t){e.push(i(t))});r.svg.areas=[e]}else{r.svg.areas=[];r.geometry.coordinates.forEach(function(t){var e=[];if(t.length>1){t.forEach(function(t){e.push(i(t))})}else{t[0].forEach(function(t){e.push(i(t))})}r.svg.areas.push(e)})}})}function h(){o=r.selectAll("path").data(m._paths()).enter().append("path").attr("class",function(t){return"country-"+m._id(t.name)}).style("stroke-width","0.5px").style("cursor","pointer");d();p()}function d(){if(o===null){return}i.scale(O.attr.width/(2*Math.PI)).translate([O.attr.width/2+O.attr.centerX,O.attr.height/2+O.attr.centerY]);s=j.geoPath().projection(i);m._paths().forEach(function(t){t.svg={}});u();c();f()}function p(){if(o===null){return}t.attr("width",O.attr.width+"px").attr("height",O.attr.height+"px");e.style("fill",O.attr.backgroundColor).style("width",O.attr.width+"px").style("height",O.attr.height+"px").on("click",function(){M.reset();o.classed("focus",false).style("fill",function(t){return O.attr.colors&&O.attr.colors[t.name]?O.attr.colors[t.name]:O.attr.foregroundColor});if(O.attr.outClick)O.attr.outClick()});o.attr("d",s).style("fill",function(t){return O.attr.colors&&O.attr.colors[t.name]?O.attr.colors[t.name]:O.attr.foregroundColor}).style("stroke",O.attr.borderColor).style("cursor","pointer").on("mouseover",function(t,e){j.select(this).style("fill",j.color(O.attr.colors&&O.attr.colors[t.name]?O.attr.colors[t.name]:O.attr.foregroundColor).brighter());O.attr.mouseover&&O.attr.mouseover(t.name)}).on("mouseleave",function(t,e){var r=j.select(this);var a=j.color(O.attr.colors&&O.attr.colors[t.name]?O.attr.colors[t.name]:O.attr.foregroundColor);r.style("fill",r.classed("focus")?a.brighter():a);O.attr.mouseleave&&O.attr.mouseleave(t.name)}).on("click",function(e,t){var r=j.select(this);var a=r.classed("focus");if(a)M.reset();else{M.click(s.bounds(e))}o.classed("focus",function(t){return t===e?!a:false}).style("fill",function(t){return O.attr.colors&&O.attr.colors[t.name]?O.attr.colors[t.name]:O.attr.foregroundColor});var n=j.color(O.attr.colors&&O.attr.colors[e.name]?O.attr.colors[e.name]:O.attr.foregroundColor);r.style("fill",!a?n.brighter():n);O.attr.click&&O.attr.click(e.name)});M.setLayer("map",{svg:t,paths:o,labels:a})}function v(t){if(typeof t==="string"){return m._id(t)?r.select("path.country-"+m._id(t)):r.selectAll("path."+O.utils.encode(t))}else{return o}}function y(t){o.style("opacity",t?t:1);return b}function g(r,a,t){v(r).transition().duration(t?t:0).style("fill",function(t){var e=O.attr.colors&&O.attr.colors[t.name]?O.attr.colors[t.name]:O.attr.foregroundColor;return typeof a==="string"?a:typeof r==="string"?j.color(e).brighter():e});return b}return{_select:v,_project:n,_invert:l,_build:h,_update:d,_style:p,dim:y,highlight:g}}();this.dim=L.dim;this.highlight=L.highlight;var v=function(){var l=O.widget.append("div").attr("id",w+"-static-layers").style("position","absolute").style("pointer-events","none").style("z-index",9).style("width",O.attr.width+"px").style("height",O.attr.height+"px");var m={};function u(t,e,r){return[e[0]*t[0]+r[0],e[1]*t[1]+r[1]]}function t(){return Object.keys(m)}function e(t){var s=O.utils.encode(t);if(!m.hasOwnProperty(s)){m[s]=function(){var t=l.append("canvas").attr("id",w+"-static-layer-"+s).attr("width",O.attr.width+"px").attr("height",O.attr.height+"px").style("position","absolute").style("pointer-events","none");var p=t.node().getContext("2d");var n=[];function e(t,e){o[t](e);n.push({type:t,params:e});return true}function r(t,e){var r=[1/t,1/t],a=[O.attr.centerX*(t-1)/t,(O.attr.height*(t-e)/2+O.attr.centerY*(t-1))/t];n.forEach(function(t){switch(t.type){case"dot":case"circle":t.params.pos=u(t.params.pos,r,a);break;case"arrow":for(var e=0;e<t.params.segments.length;e++){t.params.segments[e]=new E.Vector2(u(t.params.segments[e].toArray(),r,a))}break}})}function a(){n=[]}var o={dot:function(t,e){if(t.color)p.fillStyle=t.color;var r=t.size/(e?M.level():1);var a=!e?M.transform(t.pos):t.pos;p.fillRect(a[0]-r/2,a[1]-r/2,r,r)},circle:function(t,e){if(t.color)p.fillStyle=t.color;var r=t.radius/(e?M.level():1);var a=!e?M.transform(t.pos):t.pos;p.beginPath();p.arc(a[0],a[1],r,0,2*Math.PI,false);p.fill()},arrow:function(t,e){if(t.color)p.strokeStyle=t.color;var r=t.width/(e?M.level():1);var a=[];t.segments.forEach(function(t){a.push(!e?t.map(M.transform):t)});var n=r*2;var o=r*5;var i=a[a.length-2];var s=a[a.length-1];var l=s.sub(i).length(o);p.beginPath();p.lineWidth=r;p.lineJoin="round";p.moveTo(a[0].x(),a[0].y());for(var u=1;u<a.length-1;u++){if(a[u].sub(a[u-1]).length()<.6*O.attr.width)p.lineTo(a[u].x(),a[u].y());else p.moveTo(a[u].x(),a[u].y())}var c=s.sub(l.length(.5*o));p.lineTo(c.x(),c.y());p.stroke();var f=l.angle(l.angle()+Math.PI/2).length(n);var h=s.sub(l).sub(f);var d=s.sub(l).add(f);p.beginPath();p.moveTo(h.x(),h.y());p.lineTo(d.x(),d.y());p.lineTo(s.x(),s.y());p.closePath();p.fillStyle=t.color;p.fill()}};function i(){var t=M.invert([0,0]);var e=M.invert([O.attr.width,O.attr.height]);var r={xMin:t[0],xMax:e[0],yMin:t[1],yMax:e[1]};n.forEach(function(t){if(t.params.pos&&(t.params.pos[0]<r.xMin||t.params.pos[0]>r.xMax||t.params.pos[1]<r.yMin||t.params.pos[1]>r.yMax)){return}o[t.type](t.params,true)})}return{g:t,canvas:p,rescaleContent:r,clearContent:a,append:e,render:i}}();return true}else{return false}}function r(){var t=parseFloat(l.style("width"))/O.attr.width;var e=parseFloat(l.style("height"))/O.attr.height;l.style("width",O.attr.width+"px").style("height",O.attr.height+"px");for(var r in m){if(m.hasOwnProperty(r)){var a=m[r];a.g.attr("width",O.attr.width+"px").attr("height",O.attr.height+"px");a.rescaleContent(t,e);a.render()}}f(M.current())}function a(t){var e=O.utils.encode(t);if(m.hasOwnProperty(e)){m[e].canvas.clearRect(0,0,O.attr.width,O.attr.height);m[e].clearContent();return true}else{return false}}function n(){for(var t in m){if(m.hasOwnProperty(t)){var e=m[t];e.canvas.save();e.canvas.clearRect(0,0,O.attr.width,O.attr.height)}}}function o(t){var e=O.utils.encode(t);if(e&&m.hasOwnProperty(e)){for(var r in m){if(m.hasOwnProperty(r)){m[r].g.transition().duration(100).style("opacity",e===r?1:0)}}}else{for(var r in m){if(m.hasOwnProperty(r)){m[r].g.transition().duration(100).style("opacity",1)}}}return b}function i(t){for(var e in m){if(m.hasOwnProperty(e)){m[e].render(t)}}}function s(){for(var t in m){if(m.hasOwnProperty(t)){m[t].canvas.restore()}}}var c={dot:function(t,e,r,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var n=O.utils.encode(t);return m.hasOwnProperty(n)&&m[n].append("dot",{pos:L._project(e),size:r,color:a})},circle:function(t,e,r,a){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof r!=="number"||isNaN(r)||r<=0)return false;var n=O.utils.encode(t);return m.hasOwnProperty(n)&&m[n].append("circle",{pos:L._project(e),radius:r,color:a})},arrow:function(t,e,r,a,n){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof a!=="number")return false;var o=O.utils.encode(t);if(m.hasOwnProperty(o)){var i=new E.LatLon(e).toVec(),s=new E.LatLon(r).toVec(),l=i.cross(s).cross(i).length(1),u=Math.acos(i.dot(s));var c=1,f=100,h=a*5,d=new E.Vector2(L._project(e)),p=new E.Vector2(L._project(r)),v=d,y=[v];do{var g=new E.Vector2(L._project(i.multiply(Math.cos((c+1)*u/f)).add(l.multiply(Math.sin((c+1)*u/f))).toLatLon().toArray()));c++;v=g;y.push(g)}while(c<f&&g.sub(p).length()>h);y.push(p);m[o].append("arrow",{segments:y,width:a,color:n});return true}else{return false}}};function f(t){v._clear();for(var e in m){if(m.hasOwnProperty(e)){var r=m[e];r.canvas.translate(t.x,t.y);r.canvas.scale(t.k,t.k)}}v._render(t.k);v._restore()}return{_style:r,_zoom:f,_clear:n,_restore:s,_render:i,get:t,add:e,highlight:o,erase:a,draw:c}}();this.staticLayer={get:v.get,add:v.add,erase:v.erase,highlight:v.highlight,draw:v.draw};var y=function(){var t=O.widget.append("div").attr("id",w+"-tiles-layer").style("position","absolute").style("pointer-events","none").style("z-index",99).style("mix-blend-mode","multiply").style("width",O.attr.width+"px").style("height",O.attr.height+"px");var r=null;function a(t){return L._invert([t[0]-.5*O.attr.width,t[1]+.5*O.attr.height])}function n(t){return Math.log(.00391382924*t*O.attr.width)/Math.log(2)}function e(){if(O.attr.tiles===null){return}if(!this.headerAdded){j.select("head").append("link").attr("rel","stylesheet").attr("href","https://unpkg.com/leaflet@1.3.1/dist/leaflet.css").attr("integrity","sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==").attr("crossorigin","");this.headerAdded=true}r=s.map(w+"-tiles-layer",{attributionControl:false,zoomSnap:0,zoomControl:false}).setView(a([0,0]),n(M.level()));var t=null,e=null;switch(O.attr.tiles){case"cartodb-positron":t="https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";e="abcd";break}if(t&&e){s.tileLayer(t,{subdomains:e}).addTo(r)}o()}function o(){if(r===null){return}t.style("width",O.attr.width+"px").style("height",O.attr.height+"px");setTimeout(function(){r.invalidateSize();r.setView(a([0,0]),n(M.level()),{animate:false})},200)}function i(t){if(r===null){return}r.setView(a([-t.x/t.k-.5*(t.k-1)*O.attr.width/t.k,-t.y/t.k-.5*(t.k-1)*O.attr.height/t.k]),n(t.k),true)}return{_build:e,_style:o,_getLatLon:a,_getZoom:n,_zoom:i}}();var g=function(){var n=O.widget.append("div").attr("id",w+"-dynamic-layers").style("z-index",99).style("position","absolute").style("pointer-events","none");var P={};function t(){return Object.keys(P)}function e(t){var r=O.utils.encode(t);if(!P.hasOwnProperty(r)){P[r]=function(){var t=n.append("svg").attr("id",w+"-dynamic-layer-"+r).attr("width",O.attr.width+"px").attr("height",O.attr.height+"px").style("position","absolute").style("pointer-events","none").append("g");var a=[];function e(t){a.push({elem:t,birth:(new Date).getTime()/1e3})}setInterval(function(){var e=(new Date).getTime()/1e3;var r=[];a.forEach(function(t){if(e-t.birth>10){t.elem.transition().duration(700).style("opacity",0).on("end",function(){j.select(this).remove()})}else{r.push(t)}});a=r},2e3);return{g:t,append:e}}();return true}else{return false}}function r(){n.style("width",O.attr.width+"px").style("height",O.attr.height+"px");for(var t in P){if(P.hasOwnProperty(t)){P[t].g.attr("width",O.attr.width+"px").attr("height",O.attr.height+"px")}}}function a(t){var e=O.utils.encode(t);if(P.hasOwnProperty(e)){P[e].g.html("");return true}else{return false}}function o(t){var e=O.utils.encode(t);if(e&&P.hasOwnProperty(e)){for(var r in P){if(P.hasOwnProperty(r)){P[a].g.transition().duration(200).style("opacity",e===r?1:0)}}}else{for(var a in P){if(P.hasOwnProperty(a)){P[a].g.transition().duration(200).style("opacity",1)}}}return b}var i={circle:function(t,e,r,a,n,o){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(typeof r!=="number"||isNaN(r)||r<=0)return false;var i=O.utils.encode(t);if(P.hasOwnProperty(i)){var s=r/M.level();var l=L._project(e);var u=P[i].g.append("circle").attr("class","circle").attr("cx",l[0]).attr("cy",l[1]).attr("r",s).style("fill",a);P[i].append(u);u.transition().duration(n?n:700).ease(j.easeExp).attr("r",0).on("end",function(){o&&o();j.select(this).remove()});return true}else{return false}},arrow:function(t,e,r,a,n,o,i){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;if(!r||r.length<2||typeof r[0]!=="number"||typeof r[1]!=="number")return false;if(typeof a!=="number")return false;var s=O.utils.encode(t);if(P.hasOwnProperty(s)){var l=100;var u=null;var c=null;var f=new E.Vector2(L._project(e));var h=new E.Vector2(L._project(r));var d=a/M.level();var p=d*2;var v=d*5;u=P[s].g.append("path").style("fill","none").style("stroke",n).style("stroke-width",d).attr("d","M"+f.x()+","+f.y());c=P[s].g.append("path").style("fill",n).style("stroke","none");var y=new E.LatLon(e).toVec();var g=new E.LatLon(r).toVec();var m=y.cross(g).cross(y).length(1);var w=Math.acos(y.dot(g));var b=1;var x=f;var _=(typeof o==="number"?o:700)/l;var k=setInterval(function(){var t=new E.Vector2(L._project(y.multiply(Math.cos((b+1)*w/l)).add(m.multiply(Math.sin((b+1)*w/l))).toLatLon().toArray()));u.attr("d",u.attr("d")+(t.sub(x).length()<.5*O.attr.width?"L":"M")+t.x()+","+t.y());if(t.sub(x).length()<.5*O.attr.width){var e=t.sub(x).length(1);var r=e.angle(e.angle()+Math.PI/2).multiply(p);var a=t.sub(r);var n=t.add(r);var o=t.add(e.multiply(v));c.attr("d","M"+a.x()+","+a.y()+"L"+n.x()+","+n.y()+"L"+o.x()+","+o.y()+"Z")}if(t.sub(h).length()>v){b++;x=t}else{clearInterval(k);e=h.sub(t).length(1);r=e.angle(e.angle()+Math.PI/2).multiply(p);a=h.sub(e.multiply(v)).sub(r);n=h.sub(e.multiply(v)).add(r);c.transition().duration(_).attr("d","M"+a.x()+","+a.y()+"L"+n.x()+","+n.y()+"L"+h.x()+","+h.y()+"Z").on("end",function(){i&&i();u.transition().duration(1e3).style("opacity",0).on("end",function(){j.select(this).remove()});j.select(this).transition().duration(1e3).style("opacity",0).on("end",function(){j.select(this).remove()})})}},_);return true}else{return false}}};function s(t){for(var e in P){if(P.hasOwnProperty(e)){P[e].g.attr("transform",t)}}}return{_style:r,_zoom:s,get:t,add:e,highlight:o,erase:a,draw:i}}();this.dynamicLayer={get:g.get,add:g.add,highlight:g.highlight,erase:g.erase,draw:g.draw};var x=function(){var t=O.widget.append("svg").attr("id",w+"-touch-layer").attr("width",O.attr.width+"px").attr("height",O.attr.height+"px").style("position","absolute").style("pointer-events","none");var l=t.append("g");function e(t,e,r,a,n,o){if(!e||e.length<2||typeof e[0]!=="number"||typeof e[1]!=="number")return false;var i=r/M.level();var s=L._project(e);l.append("circle").attr("id",w+"-touch-layer-"+t).attr("cx",s[0]).attr("cy",s[1]).attr("r",i).style("fill",null).style("opacity",0).style("pointer-events","all").on("mouseover",function(t,e){if(a)a(t,e)}).on("mouseleave",function(t,e){if(n)n(t,e)}).on("click",function(t,e){if(o)o(t,e)});return true}function r(t){var e=l.select("#"+t);if(e.empty())return false;else{e.remove();return true}}function a(){t.style("width",O.attr.width+"px").style("height",O.attr.height+"px");l.style("width",O.attr.width+"px").style("height",O.attr.height+"px")}function n(t){l.attr("transform",t)}function o(){l.html("")}return{_style:a,_zoom:n,add:e,remove:r,erase:o}}();this.touchLayer={add:x.add,remove:x.remove,erase:x.erase};O.render.build=function(){m._build(function(){L._build();y._build();O.attr.ready&&O.attr.ready()})};O.render.update=function(){L._update()};O.render.style=function(){O.widget.style("background-color",O.attr.backgroundColor).style("pointer-events",null);M.init();L._style();y._style();v._style();g._style();x._style();r._mark()}}t.prototype=Object.create(a.prototype);return t});