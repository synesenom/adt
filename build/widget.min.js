(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3)}})(this,function(k){"use strict";var a=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function t(l,t,e,r){var g;var m="du-widget-"+t+"-"+l;try{if(r){g=k.select(r).append(e).attr("id",m).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{g=k.select("body").append(e).attr("id",m).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var x={tooltipContainer:"du-widget-tooltips"};var b={xDim:"px",yDim:"px",fontWeight:"normal",innerWidth:200,innerHeight:150,placeholder:null,_categories:{dim:[]},add:function(e,i,t,n,o){b[i]=t;e[i]=function(t){if(o){o(t)}else{b[i]=t}return e};if(typeof n==="string"&&b._categories.hasOwnProperty(n)){b._categories[n].push(i)}}};b.add(this,"relative",false);b.add(this,"x",0,"dim",function(t,e){b.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)b.xDim=e});b.add(this,"y",0,"dim",function(t,e){b.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)b.yDim=e});b.add(this,"width",200,"dim",function(t){b.width=t;b.innerWidth=b.width-b.margins.left-b.margins.right});b.add(this,"height",150,"dim",function(t){b.height=t;b.innerHeight=b.height-b.margins.top-b.margins.bottom});b.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(e){if(typeof e==="number"){["top","left","bottom","right"].forEach(function(t){b.margins[t]=e})}else{for(var t in e){if(e.hasOwnProperty(t)){b.margins[t]=e[t]}}}b.innerWidth=b.width-b.margins.left-b.margins.right;b.innerHeight=b.height-b.margins.top-b.margins.bottom});b.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(e){if(typeof e==="string"){["top","left","bottom","right"].forEach(function(t){b.borders[t]=e})}for(var t in e){if(e.hasOwnProperty(t)){b.borders[t]=e[t]}}});b.add(this,"fontColor","black");b.add(this,"fontSize",10,"dim");b.add(this,"fontWeight","normal");b.add(this,"label",null);b.add(this,"xLabel",null);b.add(this,"yLabel",null);b.add(this,"xTicks",null);b.add(this,"yTicks",null);b.add(this,"tickFormat",function(t){return t>1?k.format(".2s")(t):t});b.add(this,"xTickFormat",function(t){return t>1?k.format(".2s")(t):t});b.add(this,"yTickFormat",function(t){return t>1?k.format(".2s")(t):t});b.add(this,"xTickAngle",null);b.add(this,"yMin",0);b.add(this,"mouseover",null);b.add(this,"mouseleave",null);b.add(this,"click",null);b.add(this,"colors",null);b.add(this,"tooltip",false);b.add(this,"tooltipTitleFormat",function(t){return t});b.add(this,"tooltipXFormat",function(t){return t});b.add(this,"tooltipYFormat",function(t){return t});b.add(this,"tooltipZFormat",function(t){return t});var i=function(){var n=[];function t(i){return{remain:n.reduce(function(t,e){return i.indexOf(e)>-1?t.concat(e):t},[]),exit:n.reduce(function(t,e){return i.indexOf(e)===-1?t.concat(e):t},[]),enter:i.forEach(function(t,e){return n.indexOf(e)===-1?t.concat(e):t},[])}}return{update:t}}();var v=function(){function s(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function t(){var t=g.append("g");return{g:t,axisFn:{x:k.axisBottom(null).ticks(7),y:k.axisLeft(null).ticks(5)},axes:{x:t.append("g").attr("class","x axis"),y:t.append("g").attr("class","y axis")},labels:{x:t.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:t.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}}}function e(t,e,i){if(!t||t.length<1){return k.scaleLinear().domain([0,1]).range(e)}var n;switch(i){case undefined:case"linear":n=k.scaleLinear().domain(k.extent(t));break;case"time":n=k.scaleTime().domain(k.extent(t));break;case"band":n=k.scaleBand().domain(t).padding(.1);break;case"point":n=k.scalePoint().domain(t).padding(.5)}return n.range(e)}function i(t,e,i,n,o){var l=e.g.selectAll(i);l.transition();if(e!==null){if(typeof n==="string"){l.transition().duration(o?o:0).style("opacity",function(){return k.select(this).classed(s(n))?1:.1})}else if(Array.isArray(n)){var r=n.map(function(t){return s(t)});l.transition().duration(o?o:0).style("opacity",function(){var i=k.select(this);return r.reduce(function(t,e){return t||i.classed(e)},false)?1:.1})}else{l.transition().duration(o?o:0).style("opacity",1)}}return t}function n(t,e,i,n,o){var l=e.g.selectAll(i);l.transition();if(e!==null){if(n){l.transition().duration(o?o:0).style("opacity",function(t){return t.x>=n[0]&&t.x<=n[1]?1:.1})}else{l.transition().duration(o?o:0).style("opacity",1)}}return t}function o(t){if(t===null||t===undefined){return{}}if(t.length>0){if(b.colors===null||b.colors===undefined){return t.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,i){t[e]=a[i%18];return t},{})}if(typeof b.colors==="string"){var e=k.scaleLinear().domain([0,t.length]).range([b.colors,"#fff"]).interpolate(k.interpolateRgb);return t.reduce(function(t,e,i){t[e]=b.colors;return t},{})}return b.colors}}return{encode:s,standardAxis:t,scale:e,highlight:i,highlightRange:n,colors:o}}();this.id=function(){return m};this.describe=function(t){var e=null;g.on("contextmenu",function(){k.event.preventDefault();if(e===null){e=k.select("body").append("div").style("position","absolute").style("left",k.event.pageX+20+"px").style("top",k.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").style("font-family","inherit").html(t)}}).on("mouseout",function(){if(e!==null){e.remove();e=null}});return this};this.placeholder=function(t,e){var i=300;var n="du-widget-placeholder-"+l;if(typeof t==="string"){g.transition().duration(i).style("opacity",0);if(b.placeholder===null||b.placeholder.empty()){var o=r?r:"body";b.placeholder=k.select(o).append("div").attr("id",n).style("position","absolute").style("width",b.width+"px").style("height",b.height+"px").style("line-height",b.height+"px").style(b.x>=0?"left":"right",Math.abs(b.x)+b.xDim).style(b.y>=0?"top":"bottom",Math.abs(b.y)+b.yDim).style("text-align","center").style("pointer-events","none");b.placeholder.append("span").style("display","inline-block").style("vertical-align","middle").style("margin-bottom",(typeof e==="number"?e:0)+"px").style("line-height","normal").style("font-weight",b.fontWeight).style("font-size",b.fontSize).style("color",b.fontColor).style("opacity",0).html(t).transition().duration(i).style("opacity",1)}else{b.placeholder.html(t)}}else{g.transition().duration();g.transition().duration(i).style("opacity",1);if(b.placeholder!==null&&!b.placeholder.empty()){b.placeholder.remove();b.placeholder=null}}return this};function w(){var t=m+"-tooltip";k.select("#"+x.tooltipContainer+" > #"+t).transition().duration(200).style("opacity",0).on("end",function(){k.select(this).style("display","none")})}function n(t){var e=m+"-tooltip";var i=k.mouse(g.node());var n=k.event.pageX;var o=k.event.pageY;var l=g.node().getBoundingClientRect();if(!t){w();v.tooltip();return}var r=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop;if(n<l.left+b.margins.left-r||n>l.right-b.margins.right+r||o<l.top+b.margins.top-s||o>l.bottom-b.margins.bottom+s){w();v.tooltip();return}var a=v.tooltip([i[0]-b.margins.left,i[1]-b.margins.top]);if(!a){w();v.tooltip();return}if(k.select("#"+x.tooltipContainer).empty()){k.select("body").append("div").attr("id",x.tooltipContainer)}var d=k.select("#"+e);if(k.select("#"+e).empty()){var p=k.color(b.fontColor);p.opacity=.3;d=k.select("#"+x.tooltipContainer).append("div").attr("id",e).style("position","absolute").style("min-width","100px").style("background-color","rgba(255, 255, 255, 0.98)").style("border-radius","2px").style("box-shadow","0 0 3px "+p).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",b.fontColor).style("pointer-events","none").style("z-index",9999).style("left",(l.left+l.right)/2+"px").style("top",(l.top+l.bottom)/2+"px")}d.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(a.title);d.style("border-left",a.stripe?"solid 3px "+a.stripe:null);switch(a.content.type){case"metrics":a.content.data.forEach(function(t){var e=d.append("div").style("position","relative").style("display","block").style("width","auto").style("height","10px").style("margin","5px");e.append("div").style("position","relative").style("float","left").style("color","#888").html(t.label);e.append("div").style("position","relative").style("float","right").style("margin-left","10px").html(t.value)});break;case"plots":a.content.data.forEach(function(t){if(t.color&&t.color!=="transparent"){var e=d.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");var i=e.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background-color",t.color);if(t.dashed){i.style("background","repeating-linear-gradient(45deg, transparent, transparent 2px, "+t.color+" 2px, "+t.color+" 4px)")}e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)}});break}var c=d.node().getBoundingClientRect(),f=c.width,u=c.height,h=n+20,y=o+20;if(h+f>l.right-b.margins.right+r-5){h-=f+r+40}if(y+u>l.bottom-b.margins.bottom+s-5){y=l.bottom-b.margins.bottom+s-10-u}d.style("display","block").transition().duration(0).style("opacity",1);d.transition().duration(200).ease(k.easeLinear).style("left",h+"px").style("top",y+"px")}var o={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){o.build&&o.build();this._isBuilt=true}o.update&&o.update(e);if(b.relative){g.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{g.style("position","absolute").style(b.x>=0?"left":"right",Math.abs(b.x)+b.xDim).style(b.y>=0?"top":"bottom",Math.abs(b.y)+b.yDim)}g.style("width",b.width+"px").style("height",b.height+"px");g.style("pointer-events",b.tooltip&&v.tooltip?"all":null).on("mousemove",function(){b.tooltip&&b.placeholder===null&&v.tooltip&&n(true)}).on("mouseleave",function(){b.tooltip&&v.tooltip&&n(false)});g.selectAll(".axis path").style("fill","none").style("stroke",b.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");g.selectAll(".tick > line").style("stroke",b.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");g.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",b.fontSize+"px").style("fill",b.fontColor);g.style("font-family","inherit");g.selectAll("g").attr("font-family","inherit");if(b.placeholder!==null&&!b.placeholder.empty()){b.placeholder.style("width",b.width+"px").style("height",b.height+"px").style("line-height",b.height+"px").style(b.x>=0?"left":"right",Math.abs(b.x)+b.xDim).style(b.y>=0?"top":"bottom",Math.abs(b.y)+b.yDim).style("font-size",b.fontSize).style("color",b.fontColor)}o.style&&o.style();g.style("display","block");return this};this.remove=function(){g.remove()};return{widget:g,attr:b,data:i,utils:v,render:o}}return t});