(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3)}})(this,function(g){"use strict";var a=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function t(o,t,e,s){var u;var i="du-widget-"+t+"-"+o;try{if(s){u=g.select(s).append(e).attr("id",i).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{u=g.select("body").append(e).attr("id",i).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var y={xDim:"px",yDim:"px",fontWeight:"normal",innerWidth:200,innerHeight:150,_categories:{dim:[]},add:function(e,i,t,n,l){y[i]=t;e[i]=function(t){if(l){l(t)}else{y[i]=t}return e};if(typeof n==="string"&&y._categories.hasOwnProperty(n)){y._categories[n].push(i)}}};y.add(this,"relative",false);y.add(this,"x",0,"dim",function(t,e){y.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)y.xDim=e});y.add(this,"y",0,"dim",function(t,e){y.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)y.yDim=e});y.add(this,"width",200,"dim",function(t){y.width=t;y.innerWidth=y.width-y.margins.left-y.margins.right});y.add(this,"height",150,"dim",function(t){y.height=t;y.innerHeight=y.height-y.margins.top-y.margins.bottom});y.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(e){if(typeof e==="number"){["top","left","bottom","right"].forEach(function(t){y.margins[t]=e})}else{for(var t in e){if(e.hasOwnProperty(t)){y.margins[t]=e[t]}}}y.innerWidth=y.width-y.margins.left-y.margins.right;y.innerHeight=y.height-y.margins.top-y.margins.bottom});y.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(e){if(typeof e==="string"){["top","left","bottom","right"].forEach(function(t){y.borders[t]=e})}for(var t in e){if(e.hasOwnProperty(t)){y.borders[t]=e[t]}}});y.add(this,"fontColor","black");y.add(this,"fontSize",10,"dim");y.add(this,"fontWeight","normal");y.add(this,"label",null);y.add(this,"xLabel",null);y.add(this,"yLabel",null);y.add(this,"tickFormat",function(t){return t>1?g.format(".2s")(t):t});y.add(this,"yTickFormat",function(t){return t>1?g.format(".2s")(t):t});y.add(this,"xTickAngle",null);y.add(this,"yMin",0);y.add(this,"mouseover",null);y.add(this,"mouseleave",null);y.add(this,"click",null);y.add(this,"colors",null);y.add(this,"tooltip",false);var n=function(){var n=[];function t(i){return{remain:n.reduce(function(t,e){return i.indexOf(e)>-1?t.concat(e):t},[]),exit:n.reduce(function(t,e){return i.indexOf(e)===-1?t.concat(e):t},[]),enter:i.forEach(function(t,e){return n.indexOf(e)===-1?t.concat(e):t},[])}}return{update:t}}();var h=function(){function o(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function t(){var t=u.append("g");return{g:t,axisFn:{x:g.axisBottom(null).ticks(7),y:g.axisLeft(null).ticks(5)},axes:{x:t.append("g").attr("class","x axis"),y:t.append("g").attr("class","y axis")},labels:{x:t.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:t.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}}}function e(t,e,i){if(!t||t.length<1){return g.scaleLinear().domain([0,1]).range(e)}var n;switch(i){case undefined:case"linear":n=g.scaleLinear().domain([g.min(t),g.max(t)]);break;case"band":n=g.scaleBand().domain(t).padding(.1);break;case"point":n=g.scalePoint().domain(t).padding(.5)}return n.range(e)}function i(t,e,i,n,l){if(e!==null){if(typeof n==="string"){e.g.selectAll(i).transition();e.g.selectAll(i).transition().duration(l?l:0).style("opacity",function(){return g.select(this).classed(o(n))?1:.1})}else{e.g.selectAll(i).transition();e.g.selectAll(i).transition().duration(l?l:0).style("opacity",1)}}return t}function n(t){if(t===null||t===undefined){return{}}if(t.length>0){if(y.colors===null||y.colors===undefined){return t.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,e,i){t[e]=a[i%18];return t},{})}if(typeof y.colors==="string"){var n=g.scaleLinear().domain([0,t.length]).range([y.colors,"#fff"]).interpolate(g.interpolateRgb);return t.reduce(function(t,e,i){t[e]=n(i);return t},{})}return y.colors}}return{encode:o,standardAxis:t,scale:e,highlight:i,colors:n}}();this.id=function(){return i};this.describe=function(t){var e=null;u.on("contextmenu",function(){g.event.preventDefault();if(e===null){e=g.select("body").append("div").style("position","absolute").style("left",g.event.pageX+20+"px").style("top",g.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(t)}}).on("mouseleave",function(){if(e!==null){e.remove();e=null}});return this};this.placeholder=function(t){var e=300;var i="du-widget-placeholder-"+o;if(t){u.transition().duration(e).style("opacity",0);if(g.select("#"+i).empty()){var n=s?s:"body";g.select(n).append("div").attr("id",i).style("position","absolute").style("width",y.width+"px").style("height",y.height+"px").style("line-height",y.height+"px").style(y.x>=0?"left":"right",Math.abs(y.x)+y.xDim).style(y.y>=0?"top":"bottom",Math.abs(y.y)+y.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",y.fontWeight).style("font-size",y.fontSize).style("color",y.fontColor).style("opacity",0).html(t).transition().duration(e).style("opacity",1)}}else{u.transition().duration();u.transition().duration(e).style("opacity",1);var l=g.select("#"+i);if(!l.empty()){l.remove()}}return this};function l(){var t="du-widgets-plot-tooltip";var e=g.mouse(u.node());var i=g.event.pageX;var n=g.event.pageY;var l=u.node().getBoundingClientRect();if(i<l.left+y.margins.left||i>l.right-y.margins.right||n<l.top+y.margins.top||n>l.bottom-y.margins.bottom){g.select("#"+t).style("opacity",0).remove();h.tooltip();return}var o=g.select("#"+t);if(g.select("#"+t).empty()){var s=g.color(y.fontColor);s.opacity=.3;o=g.select("body").append("div").attr("id",t).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.9)").style("border-radius","2px").style("box-shadow","0 0 3px "+s).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",y.fontColor).style("pointer-events","none").style("left",(l.left+l.right)/2+"px").style("top",(l.top+l.bottom)/2+"px")}var r=h.tooltip([e[0]-y.margins.left,e[1]-y.margins.top]);if(!r){g.select("#"+t).style("opacity",0).html("");h.tooltip();return}o.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(r.title);o.style("border-left",r.stripe?"solid 2px "+r.stripe:null);switch(r.content.type){case"metrics":r.content.data.forEach(function(t){var e=o.append("div").style("position","relative").style("display","block").style("width","auto").style("height","10px").style("margin","5px");e.append("div").style("position","relative").style("float","left").style("color","#888").html(t.label);e.append("div").style("position","relative").style("float","right").style("margin-left","10px").html(t.value)});break;case"plots":r.content.data.sort(function(t,e){return t.name.localeCompare(e.name)}).forEach(function(t){var e=o.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");e.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background-color",t.color);e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)});break}var a=o.node().getBoundingClientRect();var d=a.width;var p=a.height;var f=i+20;var c=n+20;if(f+d>l.right-y.margins.right-5){f-=d+40}if(c+p>l.bottom-y.margins.bottom-5){c=l.bottom-y.margins.bottom-10-p}o.style("opacity",1).transition();o.transition().duration(200).ease(g.easeLinear).style("left",f+"px").style("top",c+"px")}var r={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){r.build&&r.build();this._isBuilt=true}r.update&&r.update(e);if(y.relative){u.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{u.style("position","absolute").style(y.x>=0?"left":"right",Math.abs(y.x)+y.xDim).style(y.y>=0?"top":"bottom",Math.abs(y.y)+y.yDim)}u.style("width",y.width+"px").style("height",y.height+"px");u.style("pointer-events",y.tooltip&&h.tooltip?"all":null).on("mousemove",function(){y.tooltip&&h.tooltip&&l()});u.selectAll(".axis path").style("fill","none").style("stroke",y.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");u.selectAll(".tick > line").style("stroke",y.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");u.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",y.fontSize+"px").style("fill",y.fontColor);u.style("font-family","inherit");u.selectAll("g").attr("font-family","inherit");r.style&&r.style();u.style("display","block");return this};this.remove=function(){u.remove()};return{widget:u,attr:y,data:n,utils:h,render:r}}return t});