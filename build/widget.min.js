(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),exports)}else if(typeof define==="function"&&define.amd){define(["d3","exports"],e)}else{t.du=t.du||{};t.du.Widget=e(t.d3)}})(this,function(t){"use strict";var e=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"];function i(i,n,l,o){var s;var r="du-widget-"+n+"-"+i;try{if(o){s=t.select(o).append(l).attr("id",r).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}else{s=t.select("body").append(l).attr("id",r).attr("class","du-widget").style("display","none").style("position","absolute").style("pointer-events","none")}}catch(t){console.error("MissingDOMException: there is no DOM, could not add widget")}var a={xDim:"px",yDim:"px",fontWeight:"normal",innerWidth:200,innerHeight:150,_categories:{dim:[]},add:function(t,e,i,n,l){a[e]=i;t[e]=function(i){if(l){l(i)}else{a[e]=i}return t};if(typeof n==="string"&&a._categories.hasOwnProperty(n)){a._categories[n].push(e)}}};a.add(this,"relative",false);a.add(this,"x",0,"dim",function(t,e){a.x=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)a.xDim=e});a.add(this,"y",0,"dim",function(t,e){a.y=t;if(typeof e==="string"&&["px","%"].indexOf(e)>-1)a.yDim=e});a.add(this,"width",200,"dim",function(t){a.width=t;a.innerWidth=a.width-a.margins.left-a.margins.right});a.add(this,"height",150,"dim",function(t){a.height=t;a.innerHeight=a.height-a.margins.top-a.margins.bottom});a.add(this,"margins",{left:0,right:0,top:0,bottom:0},"dim",function(t){if(typeof t==="number"){["top","left","bottom","right"].forEach(function(e){a.margins[e]=t})}else{for(var e in t){if(t.hasOwnProperty(e)){a.margins[e]=t[e]}}}a.innerWidth=a.width-a.margins.left-a.margins.right;a.innerHeight=a.height-a.margins.top-a.margins.bottom});a.add(this,"borders",{left:null,right:null,top:null,bottom:null},null,function(t){if(typeof t==="string"){["top","left","bottom","right"].forEach(function(e){a.borders[e]=t})}for(var e in t){if(t.hasOwnProperty(e)){a.margins[e]=t[e]}}});a.add(this,"fontColor","black");a.add(this,"fontSize",10,"dim");a.add(this,"fontWeight","normal");a.add(this,"label",null);a.add(this,"xLabel",null);a.add(this,"yLabel",null);a.add(this,"tickFormat",function(e){return e>1?t.format(".2s")(e):e});a.add(this,"yTickFormat",function(e){return e>1?t.format(".2s")(e):e});a.add(this,"xTickAngle",null);a.add(this,"yMin",0);a.add(this,"mouseover",null);a.add(this,"mouseleave",null);a.add(this,"click",null);a.add(this,"colors",null);a.add(this,"tooltip",false);var d=function(){var t=[];function e(e){return{remain:t.reduce(function(t,i){return e.indexOf(i)>-1?t.concat(i):t},[]),exit:t.reduce(function(t,i){return e.indexOf(i)===-1?t.concat(i):t},[]),enter:e.forEach(function(e,i){return t.indexOf(i)===-1?e.concat(i):e},[])}}return{update:e}}();var p=function(){function i(t){if(typeof t!=="number"&&typeof t!=="string")return"";return(""+t).replace(/ /g,"__")}function n(){var e=s.append("g");return{g:e,axisFn:{x:t.axisBottom().ticks(7),y:t.axisLeft().ticks(5)},axes:{x:e.append("g").attr("class","x axis"),y:e.append("g").attr("class","y axis")},labels:{x:e.append("text").attr("class","x axis-label").attr("text-anchor","end").attr("stroke-width",0),y:e.append("text").attr("class","y axis-label").attr("text-anchor","begin").attr("stroke-width",0)}}}function l(e,i,n){if(!e||e.length<1){return t.scaleLinear().domain([0,1]).range(i)}var l;switch(n){case undefined:case"linear":l=t.scaleLinear().domain([t.min(e),t.max(e)]);break;case"band":l=t.scaleBand().domain(e).padding(.1);break;case"point":l=t.scalePoint().domain(e).padding(.5)}return l.range(i)}function o(e,n,l,o,s){if(n!==null){if(typeof o==="string"){n.g.selectAll(l).transition();n.g.selectAll(l).transition().duration(s?s:0).style("opacity",function(){return t.select(this).classed(i(o))?1:.1})}else{n.g.selectAll(l).transition();n.g.selectAll(l).transition().duration(s?s:0).style("opacity",1)}}return e}function r(i){if(i===null||i===undefined){return{}}if(i.length>0){if(a.colors===null||a.colors===undefined){return i.sort(function(t,e){return t.localeCompare(e)}).reduce(function(t,i,n){t[i]=e[n%18];return t},{})}if(typeof a.colors==="string"){var n=t.scaleLinear().domain([0,i.length]).range([a.colors,"#fff"]).interpolate(t.interpolateRgb);return i.reduce(function(t,e,i){t[e]=n(i);return t},{})}return a.colors}}return{encode:i,standardAxis:n,scale:l,highlight:o,colors:r}}();this.id=function(){return r};this.describe=function(e){var i=null;s.on("contextmenu",function(){t.event.preventDefault();if(i===null){i=t.select("body").append("div").style("position","absolute").style("left",t.event.pageX+20+"px").style("top",t.event.pageY-20+"px").style("width","auto").style("max-width","500px").style("padding","10px").style("background","white").style("box-shadow","0 0 1px black").style("border-radius","3px").style("color","black").style("font-size","0.8em").style("line-height","1.35em").html(e)}}).on("mouseleave",function(){if(i!==null){i.remove();i=null}});return this};this.placeholder=function(e){var n=300;var l="du-widget-placeholder-"+i;if(e){s.transition().duration(n).style("opacity",0);if(t.select("#"+l).empty()){var r=o?o:"body";t.select(r).append("div").attr("id",l).style("position","absolute").style("width",a.width+"px").style("height",a.height+"px").style("line-height",a.height+"px").style(a.x>=0?"left":"right",Math.abs(a.x)+a.xDim).style(a.y>=0?"top":"bottom",Math.abs(a.y)+a.yDim).style("text-align","center").style("pointer-events","none").append("span").style("display","inline-block").style("vertical-align","middle").style("line-height","normal").style("font-weight",a.fontWeight).style("font-size",a.fontSize).style("color",a.fontColor).style("opacity",0).html(e).transition().duration(n).style("opacity",1)}}else{s.transition().duration();s.transition().duration(n).style("opacity",1);var d=t.select("#"+l);if(!d.empty()){d.remove()}}return this};function f(){var e="du-widgets-plot-tooltip";var i=t.mouse(s.node());var n=t.event.pageX;var l=t.event.pageY;var o=s.node().getBoundingClientRect();if(n<o.left+a.margins.left||n>o.right-a.margins.right||l<o.top+a.margins.top||l>o.bottom-a.margins.bottom){t.select("#"+e).style("opacity",0).html("");p.tooltip();return}var r=t.select("#"+e);if(t.select("#"+e).empty()){var d=t.color(a.fontColor);d.opacity=.3;r=t.select("body").append("div").attr("id",e).style("position","absolute").style("background-color","rgba(255, 255, 255, 0.95)").style("border-radius","2px").style("box-shadow","0 0 3px "+d).style("padding","5px").style("font-family","'Courier', monospace").style("font-size","0.7em").style("color",a.fontColor).style("pointer-events","none").style("left",(o.left+o.right)/2+"px").style("top",(o.top+o.bottom)/2+"px")}var f=p.tooltip([i[0]-a.margins.left,i[1]-a.margins.top]);if(!f){t.select("#"+e).style("opacity",0).html("");p.tooltip();return}r.html("").append("div").style("position","relative").style("width","calc(100% - 10px)").style("line-height","11px").style("margin","5px").style("margin-bottom","10px").text(f.title);r.style("border-left",f.stripe?"solid 2px "+f.stripe:null);switch(f.content.type){case"metrics":f.content.data.forEach(function(t){var e=r.append("div").style("position","relative").style("display","block").style("width","auto").style("height","10px").style("margin","5px");e.append("div").style("position","relative").style("float","left").style("color","#888").html(t.label);e.append("div").style("position","relative").style("float","right").style("margin-left","10px").html(t.value)});break;case"plots":f.content.data.sort(function(t,e){return t.name.localeCompare(e.name)}).forEach(function(t){var e=r.append("div").style("position","relative").style("max-width","150px").style("height","10px").style("margin","5px").style("padding-right","10px");e.append("div").style("position","relative").style("width","9px").style("height","9px").style("float","left").style("background-color",t.color);e.append("span").style("position","relative").style("width","calc(100% - 20px)").style("height","10px").style("float","right").style("line-height","11px").html(t.value)});break}var c=r.node().getBoundingClientRect();var y=c.width;var u=c.height;var h=n+20;var g=l+20;if(h+y>o.right-a.margins.right-5){h-=y+40}if(g+u>o.bottom-a.margins.bottom-5){g=o.bottom-a.margins.bottom-10-u}r.style("opacity",1).transition();r.transition().duration(200).ease(t.easeLinear).style("left",h+"px").style("top",g+"px")}var c={build:null,update:null,style:null};this.render=function(t){var e=typeof t==="number"?t:500;if(!this._isBuilt){c.build&&c.build();this._isBuilt=true}c.update&&c.update(e);if(a.relative){s.style("position","relative").style("top",null).style("bottom",null).style("left",null).style("right",null)}else{s.style("position","absolute").style(a.x>=0?"left":"right",Math.abs(a.x)+a.xDim).style(a.y>=0?"top":"bottom",Math.abs(a.y)+a.yDim)}s.style("width",a.width+"px").style("height",a.height+"px");s.style("pointer-events",a.tooltip&&p.tooltip?"all":null).on("mousemove",function(){a.tooltip&&p.tooltip&&f()});s.selectAll(".axis path").style("fill","none").style("stroke",a.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");s.selectAll(".tick > line").style("stroke",a.fontColor).style("stroke-width","1px").style("shape-rendering","crispEdges");s.selectAll(".tick > text").attr("stroke-width",0).attr("font-family","inherit").style("font-size",a.fontSize+"px").style("fill",a.fontColor);s.style("font-family","inherit");s.selectAll("g").attr("font-family","inherit");c.style&&c.style();s.style("display","block");return this};this.remove=function(){s.remove()};return{widget:s,attr:a,data:d,utils:p,render:c}}return i});