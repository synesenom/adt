(function(t,r){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=r(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],r)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.MultiBarChart=r(t.d3,t.du.Widget)}})(this,function(t,e){"use strict";function r(t,r){var s=e.call(this,t,"multibarchart","svg",r);s.attr.add(this,"barWidth",false);s.attr.add(this,"sortByX",false);var l={};var u=[];var c={};var f=null;var p=false;this.data=function(t){u=t.map(function(t){return{name:t.name,values:t.values.map(function(t){return{x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}})}});return this};this.highlight=function(t,r){if(!p)s.utils.highlight(this,l,".bar",t,r);return this};this.highlightRange=function(t,r){if(!p)s.utils.highlightRange(this,l,".bar",t,r);return this};s.utils.tooltip=function(){if(!f){return null}var e=f.x;var t=u.map(function(t){var r=t.values.filter(function(t){return t.x===e});return{name:t.name,color:c[t.name],value:r.length>0?s.attr.tooltipYFormat(r[0].y):"n/a"}});return{title:s.attr.tooltipXFormat(e),content:{type:"plots",data:t}}};s.render.build=function(){l=s.utils.standardAxis();l.plots={}};s.render.update=function(t){var n=u.slice();var r=n.reduce(function(t,r){return t.concat(r.values)},[]).map(function(t){return t.x});if(s.attr.sortByX){r.sort(function(t,r){return t.localeCompare(r)})}l.scale={x:s.utils.scale(r,[0,s.attr.innerWidth],"band"),y:s.utils.scale(n.reduce(function(t,r){return t.concat(r.values)},[]).map(function(t){return t.y}).concat([0]),[s.attr.innerHeight,0])};l.axes.x.transition().duration(t).call(l.axisFn.x.scale(l.scale.x));l.axes.y.transition().duration(t).call(l.axisFn.y.scale(l.scale.y));c=s.utils.colors(u?u.map(function(t){return t.name}):null);l.plots.groups=l.g.selectAll(".bar-group").data(u,function(t){return t.name});l.plots.groups.exit().transition().duration(t).remove();var e=l.plots.groups.enter().append("g").attr("class",function(t){return"bar-group "+s.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent");l.plots.groups=e.merge(l.plots.groups).each(function(){p=true});l.plots.groups.transition().duration(t).style("fill-opacity",s.attr.opacity).style("fill",function(t){return c[t.name]}).on("end",function(){p=false});var a=u.length>0?l.scale.x.bandwidth():1,i=a*s.attr.barWidth,o=a*(1-s.attr.barWidth)/2;l.plots.bars=l.plots.groups.selectAll(".bar").data(function(r,e){return r.values.map(function(t){return{name:r.name,n:n.length,i:e,x:t.x,y:t.y}})});l.plots.bars.exit().transition().duration(t).style("opacity",0).remove();l.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+s.utils.encode(t.name)}).style("opacity",0).attr("x",function(t){return l.scale.x(t.x)+o+i*t.i/t.n}).attr("y",s.attr.height-s.attr.margins.top-s.attr.margins.bottom).attr("width",function(t){return i/t.n}).attr("height",0).merge(l.plots.bars).on("mouseover",function(t){f=t;s.attr.mouseover&&s.attr.mouseover(t.name)}).on("mouseleave",function(t){f=null;s.attr.mouseleave&&s.attr.mouseleave(t.name)}).on("click",function(t){s.attr.click&&s.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("x",function(t){return l.scale.x(t.x)+o+i*t.i/t.n}).attr("y",function(t){return l.scale.y(t.y)}).attr("width",function(t){return i/t.n}).attr("height",function(t){return s.attr.height-s.attr.margins.top-s.attr.margins.bottom-l.scale.y(t.y)})};s.render.style=function(){l.g.attr("width",s.attr.innerWidth+"px").attr("height",s.attr.innerHeight+"px").attr("transform","translate("+s.attr.margins.left+","+s.attr.margins.top+")").style("pointer-events","all");l.axisFn.x.tickFormat(s.attr.xTickFormat);l.axes.x.attr("transform","translate(0,"+s.attr.innerHeight+")");l.axisFn.y.tickFormat(s.attr.yTickFormat);l.axes.y.attr("transform","translate(0,"+1+")");l.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");l.labels.x.attr("x",s.attr.innerWidth+"px").attr("y",s.attr.innerHeight+2.2*s.attr.fontSize+"px").style("fill",s.attr.fontColor).style("font-size",s.attr.fontSize+"px").text(s.attr.xLabel);l.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",s.attr.fontColor).style("font-size",s.attr.fontSize+"px").text(s.attr.yLabel)}}r.prototype=Object.create(e.prototype);return r});