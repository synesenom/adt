(function(t,e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e(require("d3"),require("./widget"))}else if(typeof define==="function"&&define.amd){define(["d3","src/widget","exports"],e)}else{t.du=t.du||{};t.du.widgets=t.du.widgets||{};t.du.widgets.MultiBarChart=e(t.d3,t.du.Widget)}})(this,function(t,r){"use strict";function e(t,e){var i=r.call(this,t,"multibarchart","svg",e);i.attr.add(this,"barWidth",false);var o={};var s=[];var l={};var u=null;var c=false;this.data=function(t){s=t.map(function(t){return{name:t.name,values:t.values.map(function(t){return{x:t.x,y:t.y,lo:t.lo||0,hi:t.hi||0}})}});return this};this.highlight=function(t,e){if(!c)i.utils.highlight(this,o,".bar",t,e);return this};i.utils.tooltip=function(){if(!u){return null}var r=u.x;var t=s.map(function(t){var e=t.values.filter(function(t){return t.x===r});return{name:t.name,color:l[t.name],value:e.length>0?e[0].y:"n/a"}});return{title:i.attr.xLabel+": "+i.attr.tooltipXFormat(r),content:{type:"plots",data:t}}};i.render.build=function(){o=i.utils.standardAxis();o.plots={}};i.render.update=function(t){var n=s.slice();o.scale={x:i.utils.scale(n.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.x}),[0,i.attr.innerWidth],"band"),y:i.utils.scale(n.reduce(function(t,e){return t.concat(e.values)},[]).map(function(t){return t.y}).concat([0]),[i.attr.innerHeight,0])};o.axes.x.transition().duration(t).call(o.axisFn.x.scale(o.scale.x));o.axes.y.transition().duration(t).call(o.axisFn.y.scale(o.scale.y));l=i.utils.colors(s?s.map(function(t){return t.name}):null);o.plots.groups=o.g.selectAll(".bar-group").data(s,function(t){return t.name});o.plots.groups.exit().transition().duration(t).remove();var e=o.plots.groups.enter().append("g").attr("class",function(t){return"bar-group "+i.utils.encode(t.name)}).style("shape-rendering","geometricPrecision").style("stroke","none").style("fill","transparent");o.plots.groups=e.merge(o.plots.groups).each(function(){c=true});o.plots.groups.transition().duration(t).style("fill-opacity",i.attr.opacity).style("fill",function(t){return l[t.name]}).on("end",function(){c=false});var r=o.scale.x.bandwidth()*i.attr.barWidth,a=o.scale.x.bandwidth()*(1-i.attr.barWidth)/2;o.plots.bars=o.plots.groups.selectAll(".bar").data(function(e,r){return e.values.map(function(t){return{name:e.name,n:n.length,i:r,x:t.x,y:t.y}})});o.plots.bars.exit().transition().duration(t).style("opacity",0).remove();o.plots.bars.enter().append("rect").attr("class",function(t){return"bar "+i.utils.encode(t.name)}).style("opacity",0).attr("x",function(t){return o.scale.x(t.x)+a+r*t.i/t.n}).attr("y",i.attr.height-i.attr.margins.top-i.attr.margins.bottom).attr("width",function(t){return r/t.n}).attr("height",0).merge(o.plots.bars).on("mouseover",function(t){u=t;i.attr.mouseover&&i.attr.mouseover(t.name)}).on("mouseleave",function(t){u=null;i.attr.mouseleave&&i.attr.mouseleave(t.name)}).on("click",function(t){i.attr.click&&i.attr.click(t.name)}).transition().duration(t).style("opacity",1).attr("x",function(t){return o.scale.x(t.x)+a+r*t.i/t.n}).attr("y",function(t){return o.scale.y(t.y)}).attr("width",function(t){return r/t.n}).attr("height",function(t){return i.attr.height-i.attr.margins.top-i.attr.margins.bottom-o.scale.y(t.y)})};i.render.style=function(){o.g.attr("width",i.attr.innerWidth+"px").attr("height",i.attr.innerHeight+"px").attr("transform","translate("+i.attr.margins.left+","+i.attr.margins.top+")").style("pointer-events","all");o.axisFn.x.tickFormat(i.attr.xTickFormat);o.axes.x.attr("transform","translate(0,"+i.attr.innerHeight+")");o.axisFn.y.tickFormat(i.attr.yTickFormat);o.axes.y.attr("transform","translate(0,"+1+")");o.g.selectAll(".tick > line").style("shape-rendering","geometricPrecision").style("stroke-width","1px");o.labels.x.attr("x",i.attr.innerWidth+"px").attr("y",i.attr.innerHeight+2.2*i.attr.fontSize+"px").style("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.xLabel);o.labels.y.attr("x",5+"px").attr("y",-5+"px").style("fill",i.attr.fontColor).style("font-size",i.attr.fontSize+"px").text(i.attr.yLabel)}}e.prototype=Object.create(r.prototype);return e});